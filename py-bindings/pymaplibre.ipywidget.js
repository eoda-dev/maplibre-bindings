var qF=Object.create;var dm=Object.defineProperty;var KF=Object.getOwnPropertyDescriptor;var JF=Object.getOwnPropertyNames;var ZF=Object.getPrototypeOf,$F=Object.prototype.hasOwnProperty;var Jb=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var ur=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),fr=(t,e)=>{for(var r in e)dm(t,r,{get:e[r],enumerable:!0})},eL=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of JF(e))!$F.call(t,n)&&n!==r&&dm(t,n,{get:()=>e[n],enumerable:!(i=KF(e,n))||i.enumerable});return t};var _a=(t,e,r)=>(r=t!=null?qF(ZF(t)):{},eL(e||!t||!t.__esModule?dm(r,"default",{value:t,enumerable:!0}):r,t));var t4=ur((uu,Md)=>{(function(t){"use strict";var e="Compound",r="Identifier",i="MemberExpression",n="Literal",s="ThisExpression",o="CallExpression",a="UnaryExpression",A="BinaryExpression",h="LogicalExpression",g="ConditionalExpression",_="ArrayExpression",b=46,T=44,v=39,C=34,S=40,P=41,F=91,I=93,k=63,W=59,K=58,re=function(Pe,ue){var ti=new Error(Pe+" at character "+ue);throw ti.index=ue,ti.description=Pe,ti},Y=!0,z={"-":Y,"!":Y,"~":Y,"+":Y},L={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},se=function(Pe){var ue=0,ti;for(var Ri in Pe)(ti=Ri.length)>ue&&Pe.hasOwnProperty(Ri)&&(ue=ti);return ue},le=se(z),ce=se(L),he={true:!0,false:!1,null:null},Re="this",Ke=function(Pe){return L[Pe]||0},Ye=function(Pe,ue,ti){var Ri=Pe==="||"||Pe==="&&"?h:A;return{type:Ri,operator:Pe,left:ue,right:ti}},$e=function(Pe){return Pe>=48&&Pe<=57},nt=function(Pe){return Pe===36||Pe===95||Pe>=65&&Pe<=90||Pe>=97&&Pe<=122||Pe>=128&&!L[String.fromCharCode(Pe)]},rt=function(Pe){return Pe===36||Pe===95||Pe>=65&&Pe<=90||Pe>=97&&Pe<=122||Pe>=48&&Pe<=57||Pe>=128&&!L[String.fromCharCode(Pe)]},Ne=function(Pe){for(var ue=0,ti=Pe.charAt,Ri=Pe.charCodeAt,or=function(Te){return ti.call(Pe,Te)},Bt=function(Te){return Ri.call(Pe,Te)},Ks=Pe.length,ri=function(){for(var Te=Bt(ue);Te===32||Te===9||Te===10||Te===13;)Te=Bt(++ue)},os=function(){var Te=Vg(),we,Fe;if(ri(),Bt(ue)===k){if(ue++,we=os(),we||re("Expected expression",ue),ri(),Bt(ue)===K)return ue++,Fe=os(),Fe||re("Expected expression",ue),{type:g,test:Te,consequent:we,alternate:Fe};re("Expected :",ue)}else return Te},Qf=function(){ri();for(var Te,we=Pe.substr(ue,ce),Fe=we.length;Fe>0;){if(L.hasOwnProperty(we)&&(!nt(Bt(ue))||ue+we.length<Pe.length&&!rt(Bt(ue+we.length))))return ue+=Fe,we;we=we.substr(0,--Fe)}return!1},Vg=function(){var Te,we,Fe,Zt,Vt,Wr,qi,Js,Bn,sl;if(qi=fa(),Fe=Qf(),!Fe)return qi;for(Wr={value:Fe,prec:Ke(Fe)},Js=fa(),Js||re("Expected expression after "+Fe,ue),Vt=[qi,Wr,Js];(Fe=Qf())&&(Zt=Ke(Fe),Zt!==0);){for(Wr={value:Fe,prec:Zt},sl=Fe;Vt.length>2&&Zt<=Vt[Vt.length-2].prec;)Js=Vt.pop(),Fe=Vt.pop().value,qi=Vt.pop(),we=Ye(Fe,qi,Js),Vt.push(we);we=fa(),we||re("Expected expression after "+sl,ue),Vt.push(Wr,we)}for(Bn=Vt.length-1,we=Vt[Bn];Bn>1;)we=Ye(Vt[Bn-1].value,Vt[Bn-2],we),Bn-=2;return we},fa=function(){var Te,we,Fe;if(ri(),Te=Bt(ue),$e(Te)||Te===b)return zg();if(Te===v||Te===C)return Hg();if(Te===F)return Rn();for(we=Pe.substr(ue,le),Fe=we.length;Fe>0;){if(z.hasOwnProperty(we)&&(!nt(Bt(ue))||ue+we.length<Pe.length&&!rt(Bt(ue+we.length))))return ue+=Fe,{type:a,operator:we,argument:fa(),prefix:!0};we=we.substr(0,--Fe)}return nt(Te)||Te===S?Gg():!1},zg=function(){for(var Te="",we,Fe;$e(Bt(ue));)Te+=or(ue++);if(Bt(ue)===b)for(Te+=or(ue++);$e(Bt(ue));)Te+=or(ue++);if(we=or(ue),we==="e"||we==="E"){for(Te+=or(ue++),we=or(ue),(we==="+"||we==="-")&&(Te+=or(ue++));$e(Bt(ue));)Te+=or(ue++);$e(Bt(ue-1))||re("Expected exponent ("+Te+or(ue)+")",ue)}return Fe=Bt(ue),nt(Fe)?re("Variable names cannot start with a number ("+Te+or(ue)+")",ue):Fe===b&&re("Unexpected period",ue),{type:n,value:parseFloat(Te),raw:Te}},Hg=function(){for(var Te="",we=or(ue++),Fe=!1,Zt;ue<Ks;)if(Zt=or(ue++),Zt===we){Fe=!0;break}else if(Zt==="\\")switch(Zt=or(ue++),Zt){case"n":Te+=`
`;break;case"r":Te+="\r";break;case"t":Te+="	";break;case"b":Te+="\b";break;case"f":Te+="\f";break;case"v":Te+="\v";break;default:Te+=Zt}else Te+=Zt;return Fe||re('Unclosed quote after "'+Te+'"',ue),{type:n,value:Te,raw:we+Te+we}},qf=function(){var Te=Bt(ue),we=ue,Fe;for(nt(Te)?ue++:re("Unexpected "+or(ue),ue);ue<Ks&&(Te=Bt(ue),rt(Te));)ue++;return Fe=Pe.slice(we,ue),he.hasOwnProperty(Fe)?{type:n,value:he[Fe],raw:Fe}:Fe===Re?{type:s}:{type:r,name:Fe}},Kf=function(Te){for(var we,Fe=[],Zt,Vt=!1,Wr=0;ue<Ks;)if(ri(),we=Bt(ue),we===Te){Vt=!0,ue++,Te===P&&Wr&&Wr>=Fe.length&&re("Unexpected token "+String.fromCharCode(Te),ue);break}else if(we===T){if(ue++,Wr++,Wr!==Fe.length){if(Te===P)re("Unexpected token ,",ue);else if(Te===I)for(var qi=Fe.length;qi<Wr;qi++)Fe.push(null)}}else Zt=os(),(!Zt||Zt.type===e)&&re("Expected comma",ue),Fe.push(Zt);return Vt||re("Expected "+String.fromCharCode(Te),ue),Fe},Gg=function(){var Te,we;for(Te=Bt(ue),Te===S?we=Wg():we=qf(),ri(),Te=Bt(ue);Te===b||Te===F||Te===S;)ue++,Te===b?(ri(),we={type:i,computed:!1,object:we,property:qf()}):Te===F?(we={type:i,computed:!0,object:we,property:os()},ri(),Te=Bt(ue),Te!==I&&re("Unclosed [",ue),ue++):Te===S&&(we={type:o,arguments:Kf(P),callee:we}),ri(),Te=Bt(ue);return we},Wg=function(){ue++;var Te=os();if(ri(),Bt(ue)===P)return ue++,Te;re("Unclosed (",ue)},Rn=function(){return ue++,{type:_,elements:Kf(I)}},as=[],In,Jf;ue<Ks;)In=Bt(ue),In===W||In===T?ue++:(Jf=os())?as.push(Jf):ue<Ks&&re('Unexpected "'+or(ue)+'"',ue);return as.length===1?as[0]:{type:e,body:as}};if(Ne.version="0.3.5",Ne.toString=function(){return"JavaScript Expression Parser (JSEP) v"+Ne.version},Ne.addUnaryOp=function(Pe){return le=Math.max(Pe.length,le),z[Pe]=Y,this},Ne.addBinaryOp=function(Pe,ue){return ce=Math.max(Pe.length,ce),L[Pe]=ue,this},Ne.addLiteral=function(Pe,ue){return he[Pe]=ue,this},Ne.removeUnaryOp=function(Pe){return delete z[Pe],Pe.length===le&&(le=se(z)),this},Ne.removeAllUnaryOps=function(){return z={},le=0,this},Ne.removeBinaryOp=function(Pe){return delete L[Pe],Pe.length===ce&&(ce=se(L)),this},Ne.removeAllBinaryOps=function(){return L={},ce=0,this},Ne.removeLiteral=function(Pe){return delete he[Pe],this},Ne.removeAllLiterals=function(){return he={},this},typeof uu>"u"){var ir=t.jsep;t.jsep=Ne,Ne.noConflict=function(){return t.jsep===Ne&&(t.jsep=ir),Ne}}else typeof Md<"u"&&Md.exports?uu=Md.exports=Ne:uu.parse=Ne})(uu)});var dM=ur((tCe,yy)=>{"use strict";yy.exports=Wd;yy.exports.default=Wd;function Wd(t,e,r){r=r||2;var i=e&&e.length,n=i?e[0]*r:t.length,s=uM(t,0,n,r,!0),o=[];if(!s||s.next===s.prev)return o;var a,A,h,g,_,b,T;if(i&&(s=_W(t,e,s,r)),t.length>80*r){a=h=t[0],A=g=t[1];for(var v=r;v<n;v+=r)_=t[v],b=t[v+1],_<a&&(a=_),b<A&&(A=b),_>h&&(h=_),b>g&&(g=b);T=Math.max(h-a,g-A),T=T!==0?32767/T:0}return Lu(s,o,r,a,A,T,0),o}function uM(t,e,r,i,n){var s,o;if(n===_y(t,e,r,i)>0)for(s=e;s<r;s+=i)o=AM(s,t[s],t[s+1],o);else for(s=r-i;s>=e;s-=i)o=AM(s,t[s],t[s+1],o);return o&&jd(o,o.next)&&(Du(o),o=o.next),o}function Go(t,e){if(!t)return t;e||(e=t);var r=t,i;do if(i=!1,!r.steiner&&(jd(r,r.next)||Gt(r.prev,r,r.next)===0)){if(Du(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Lu(t,e,r,i,n,s,o){if(t){!o&&s&&EW(t,i,n,s);for(var a=t,A,h;t.prev!==t.next;){if(A=t.prev,h=t.next,s?pW(t,i,n,s):dW(t)){e.push(A.i/r|0),e.push(t.i/r|0),e.push(h.i/r|0),Du(t),t=h.next,a=h.next;continue}if(t=h,t===a){o?o===1?(t=gW(Go(t),e,r),Lu(t,e,r,i,n,s,2)):o===2&&mW(t,e,r,i,n,s):Lu(Go(t),e,r,i,n,s,1);break}}}}function dW(t){var e=t.prev,r=t,i=t.next;if(Gt(e,r,i)>=0)return!1;for(var n=e.x,s=r.x,o=i.x,a=e.y,A=r.y,h=i.y,g=n<s?n<o?n:o:s<o?s:o,_=a<A?a<h?a:h:A<h?A:h,b=n>s?n>o?n:o:s>o?s:o,T=a>A?a>h?a:h:A>h?A:h,v=i.next;v!==e;){if(v.x>=g&&v.x<=b&&v.y>=_&&v.y<=T&&uc(n,a,s,A,o,h,v.x,v.y)&&Gt(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function pW(t,e,r,i){var n=t.prev,s=t,o=t.next;if(Gt(n,s,o)>=0)return!1;for(var a=n.x,A=s.x,h=o.x,g=n.y,_=s.y,b=o.y,T=a<A?a<h?a:h:A<h?A:h,v=g<_?g<b?g:b:_<b?_:b,C=a>A?a>h?a:h:A>h?A:h,S=g>_?g>b?g:b:_>b?_:b,P=gy(T,v,e,r,i),F=gy(C,S,e,r,i),I=t.prevZ,k=t.nextZ;I&&I.z>=P&&k&&k.z<=F;){if(I.x>=T&&I.x<=C&&I.y>=v&&I.y<=S&&I!==n&&I!==o&&uc(a,g,A,_,h,b,I.x,I.y)&&Gt(I.prev,I,I.next)>=0||(I=I.prevZ,k.x>=T&&k.x<=C&&k.y>=v&&k.y<=S&&k!==n&&k!==o&&uc(a,g,A,_,h,b,k.x,k.y)&&Gt(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;I&&I.z>=P;){if(I.x>=T&&I.x<=C&&I.y>=v&&I.y<=S&&I!==n&&I!==o&&uc(a,g,A,_,h,b,I.x,I.y)&&Gt(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;k&&k.z<=F;){if(k.x>=T&&k.x<=C&&k.y>=v&&k.y<=S&&k!==n&&k!==o&&uc(a,g,A,_,h,b,k.x,k.y)&&Gt(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function gW(t,e,r){var i=t;do{var n=i.prev,s=i.next.next;!jd(n,s)&&fM(n,i,i.next,s)&&Nu(n,s)&&Nu(s,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(s.i/r|0),Du(i),Du(i.next),i=t=s),i=i.next}while(i!==t);return Go(i)}function mW(t,e,r,i,n,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&CW(o,a)){var A=hM(o,a);o=Go(o,o.next),A=Go(A,A.next),Lu(o,e,r,i,n,s,0),Lu(A,e,r,i,n,s,0);return}a=a.next}o=o.next}while(o!==t)}function _W(t,e,r,i){var n=[],s,o,a,A,h;for(s=0,o=e.length;s<o;s++)a=e[s]*i,A=s<o-1?e[s+1]*i:t.length,h=uM(t,a,A,i,!1),h===h.next&&(h.steiner=!0),n.push(wW(h));for(n.sort(yW),s=0;s<n.length;s++)r=xW(n[s],r);return r}function yW(t,e){return t.x-e.x}function xW(t,e){var r=bW(t,e);if(!r)return e;var i=hM(r,t);return Go(i,i.next),Go(r,r.next)}function bW(t,e){var r=e,i=t.x,n=t.y,s=-1/0,o;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s&&(s=a,o=r.x<r.next.x?r:r.next,a===i))return o}r=r.next}while(r!==e);if(!o)return null;var A=o,h=o.x,g=o.y,_=1/0,b;r=o;do i>=r.x&&r.x>=h&&i!==r.x&&uc(n<g?i:s,n,h,g,n<g?s:i,n,r.x,r.y)&&(b=Math.abs(n-r.y)/(i-r.x),Nu(r,t)&&(b<_||b===_&&(r.x>o.x||r.x===o.x&&TW(o,r)))&&(o=r,_=b)),r=r.next;while(r!==A);return o}function TW(t,e){return Gt(t.prev,t,e.prev)<0&&Gt(e.next,t,t.next)<0}function EW(t,e,r,i){var n=t;do n.z===0&&(n.z=gy(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,vW(n)}function vW(t){var e,r,i,n,s,o,a,A,h=1;do{for(r=t,t=null,s=null,o=0;r;){for(o++,i=r,a=0,e=0;e<h&&(a++,i=i.nextZ,!!i);e++);for(A=h;a>0||A>0&&i;)a!==0&&(A===0||!i||r.z<=i.z)?(n=r,r=r.nextZ,a--):(n=i,i=i.nextZ,A--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=i}s.nextZ=null,h*=2}while(o>1);return t}function gy(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function wW(t){var e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function uc(t,e,r,i,n,s,o,a){return(n-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(n-o)*(i-a)}function CW(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!SW(t,e)&&(Nu(t,e)&&Nu(e,t)&&MW(t,e)&&(Gt(t.prev,t,e.prev)||Gt(t,e.prev,e))||jd(t,e)&&Gt(t.prev,t,t.next)>0&&Gt(e.prev,e,e.next)>0)}function Gt(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function jd(t,e){return t.x===e.x&&t.y===e.y}function fM(t,e,r,i){var n=Gd(Gt(t,e,r)),s=Gd(Gt(t,e,i)),o=Gd(Gt(r,i,t)),a=Gd(Gt(r,i,e));return!!(n!==s&&o!==a||n===0&&Hd(t,r,e)||s===0&&Hd(t,i,e)||o===0&&Hd(r,t,i)||a===0&&Hd(r,e,i))}function Hd(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Gd(t){return t>0?1:t<0?-1:0}function SW(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&fM(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Nu(t,e){return Gt(t.prev,t,t.next)<0?Gt(t,e,t.next)>=0&&Gt(t,t.prev,e)>=0:Gt(t,e,t.prev)<0||Gt(t,t.next,e)<0}function MW(t,e){var r=t,i=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function hM(t,e){var r=new my(t.i,t.x,t.y),i=new my(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function AM(t,e,r,i){var n=new my(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Du(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function my(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Wd.deviation=function(t,e,r,i){var n=e&&e.length,s=n?e[0]*r:t.length,o=Math.abs(_y(t,0,s,r));if(n)for(var a=0,A=e.length;a<A;a++){var h=e[a]*r,g=a<A-1?e[a+1]*r:t.length;o-=Math.abs(_y(t,h,g,r))}var _=0;for(a=0;a<i.length;a+=3){var b=i[a]*r,T=i[a+1]*r,v=i[a+2]*r;_+=Math.abs((t[b]-t[v])*(t[T+1]-t[b+1])-(t[b]-t[T])*(t[v+1]-t[b+1]))}return o===0&&_===0?0:Math.abs((_-o)/o)};function _y(t,e,r,i){for(var n=0,s=e,o=r-i;s<r;s+=i)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}Wd.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var o=0;o<e;o++)r.vertices.push(t[n][s][o]);n>0&&(i+=t[n-1].length,r.holes.push(i))}return r}});var Tp=ur(Kn=>{"use strict";var OP=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",Vj=OP+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",FP="["+OP+"]["+Vj+"]*",zj=new RegExp("^"+FP+"$"),Hj=function(t,e){let r=[],i=e.exec(t);for(;i;){let n=[];n.startIndex=e.lastIndex-i[0].length;let s=i.length;for(let o=0;o<s;o++)n.push(i[o]);r.push(n),i=e.exec(t)}return r},Gj=function(t){let e=zj.exec(t);return!(e===null||typeof e>"u")};Kn.isExist=function(t){return typeof t<"u"};Kn.isEmptyObject=function(t){return Object.keys(t).length===0};Kn.merge=function(t,e,r){if(e){let i=Object.keys(e),n=i.length;for(let s=0;s<n;s++)r==="strict"?t[i[s]]=[e[i[s]]]:t[i[s]]=e[i[s]]}};Kn.getValue=function(t){return Kn.isExist(t)?t:""};Kn.isName=Gj;Kn.getAllMatches=Hj;Kn.nameRegexp=FP});var Oy=ur(UP=>{"use strict";var By=Tp(),Wj={allowBooleanAttributes:!1,unpairedTags:[]};UP.validate=function(t,e){e=Object.assign({},Wj,e);let r=[],i=!1,n=!1;t[0]==="\uFEFF"&&(t=t.substr(1));for(let s=0;s<t.length;s++)if(t[s]==="<"&&t[s+1]==="?"){if(s+=2,s=NP(t,s),s.err)return s}else if(t[s]==="<"){let o=s;if(s++,t[s]==="!"){s=DP(t,s);continue}else{let a=!1;t[s]==="/"&&(a=!0,s++);let A="";for(;s<t.length&&t[s]!==">"&&t[s]!==" "&&t[s]!=="	"&&t[s]!==`
`&&t[s]!=="\r";s++)A+=t[s];if(A=A.trim(),A[A.length-1]==="/"&&(A=A.substring(0,A.length-1),s--),!Zj(A)){let _;return A.trim().length===0?_="Invalid space after '<'.":_="Tag '"+A+"' is an invalid name.",qt("InvalidTag",_,Vr(t,s))}let h=Yj(t,s);if(h===!1)return qt("InvalidAttr","Attributes for '"+A+"' have open quote.",Vr(t,s));let g=h.value;if(s=h.index,g[g.length-1]==="/"){let _=s-g.length;g=g.substring(0,g.length-1);let b=kP(g,e);if(b===!0)i=!0;else return qt(b.err.code,b.err.msg,Vr(t,_+b.err.line))}else if(a)if(h.tagClosed){if(g.trim().length>0)return qt("InvalidTag","Closing tag '"+A+"' can't have attributes or invalid starting.",Vr(t,o));if(r.length===0)return qt("InvalidTag","Closing tag '"+A+"' has not been opened.",Vr(t,o));{let _=r.pop();if(A!==_.tagName){let b=Vr(t,_.tagStartPos);return qt("InvalidTag","Expected closing tag '"+_.tagName+"' (opened in line "+b.line+", col "+b.col+") instead of closing tag '"+A+"'.",Vr(t,o))}r.length==0&&(n=!0)}}else return qt("InvalidTag","Closing tag '"+A+"' doesn't have proper closing.",Vr(t,s));else{let _=kP(g,e);if(_!==!0)return qt(_.err.code,_.err.msg,Vr(t,s-g.length+_.err.line));if(n===!0)return qt("InvalidXml","Multiple possible root nodes found.",Vr(t,s));e.unpairedTags.indexOf(A)!==-1||r.push({tagName:A,tagStartPos:o}),i=!0}for(s++;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="!"){s++,s=DP(t,s);continue}else if(t[s+1]==="?"){if(s=NP(t,++s),s.err)return s}else break;else if(t[s]==="&"){let _=Kj(t,s);if(_==-1)return qt("InvalidChar","char '&' is not expected.",Vr(t,s));s=_}else if(n===!0&&!LP(t[s]))return qt("InvalidXml","Extra text at the end",Vr(t,s));t[s]==="<"&&s--}}else{if(LP(t[s]))continue;return qt("InvalidChar","char '"+t[s]+"' is not expected.",Vr(t,s))}if(i){if(r.length==1)return qt("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",Vr(t,r[0].tagStartPos));if(r.length>0)return qt("InvalidXml","Invalid '"+JSON.stringify(r.map(s=>s.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return qt("InvalidXml","Start tag expected.",1);return!0};function LP(t){return t===" "||t==="	"||t===`
`||t==="\r"}function NP(t,e){let r=e;for(;e<t.length;e++)if(t[e]=="?"||t[e]==" "){let i=t.substr(r,e-r);if(e>5&&i==="xml")return qt("InvalidXml","XML declaration allowed only at the start of the document.",Vr(t,e));if(t[e]=="?"&&t[e+1]==">"){e++;break}else continue}return e}function DP(t,e){if(t.length>e+5&&t[e+1]==="-"&&t[e+2]==="-"){for(e+=3;e<t.length;e++)if(t[e]==="-"&&t[e+1]==="-"&&t[e+2]===">"){e+=2;break}}else if(t.length>e+8&&t[e+1]==="D"&&t[e+2]==="O"&&t[e+3]==="C"&&t[e+4]==="T"&&t[e+5]==="Y"&&t[e+6]==="P"&&t[e+7]==="E"){let r=1;for(e+=8;e<t.length;e++)if(t[e]==="<")r++;else if(t[e]===">"&&(r--,r===0))break}else if(t.length>e+9&&t[e+1]==="["&&t[e+2]==="C"&&t[e+3]==="D"&&t[e+4]==="A"&&t[e+5]==="T"&&t[e+6]==="A"&&t[e+7]==="["){for(e+=8;e<t.length;e++)if(t[e]==="]"&&t[e+1]==="]"&&t[e+2]===">"){e+=2;break}}return e}var jj='"',Xj="'";function Yj(t,e){let r="",i="",n=!1;for(;e<t.length;e++){if(t[e]===jj||t[e]===Xj)i===""?i=t[e]:i!==t[e]||(i="");else if(t[e]===">"&&i===""){n=!0;break}r+=t[e]}return i!==""?!1:{value:r,index:e,tagClosed:n}}var Qj=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function kP(t,e){let r=By.getAllMatches(t,Qj),i={};for(let n=0;n<r.length;n++){if(r[n][1].length===0)return qt("InvalidAttr","Attribute '"+r[n][2]+"' has no space in starting.",sf(r[n]));if(r[n][3]!==void 0&&r[n][4]===void 0)return qt("InvalidAttr","Attribute '"+r[n][2]+"' is without value.",sf(r[n]));if(r[n][3]===void 0&&!e.allowBooleanAttributes)return qt("InvalidAttr","boolean attribute '"+r[n][2]+"' is not allowed.",sf(r[n]));let s=r[n][2];if(!Jj(s))return qt("InvalidAttr","Attribute '"+s+"' is an invalid name.",sf(r[n]));if(!i.hasOwnProperty(s))i[s]=1;else return qt("InvalidAttr","Attribute '"+s+"' is repeated.",sf(r[n]))}return!0}function qj(t,e){let r=/\d/;for(t[e]==="x"&&(e++,r=/[\da-fA-F]/);e<t.length;e++){if(t[e]===";")return e;if(!t[e].match(r))break}return-1}function Kj(t,e){if(e++,t[e]===";")return-1;if(t[e]==="#")return e++,qj(t,e);let r=0;for(;e<t.length;e++,r++)if(!(t[e].match(/\w/)&&r<20)){if(t[e]===";")break;return-1}return e}function qt(t,e,r){return{err:{code:t,msg:e,line:r.line||r,col:r.col}}}function Jj(t){return By.isName(t)}function Zj(t){return By.isName(t)}function Vr(t,e){let r=t.substring(0,e).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function sf(t){return t.startIndex+t[1].length}});var zP=ur(Fy=>{var VP={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t,e,r){return t}},$j=function(t){return Object.assign({},VP,t)};Fy.buildOptions=$j;Fy.defaultOptions=VP});var GP=ur((S5e,HP)=>{"use strict";var Ly=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,r){e==="__proto__"&&(e="#__proto__"),this.child.push({[e]:r})}addChild(e){e.tagname==="__proto__"&&(e.tagname="#__proto__"),e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}};HP.exports=Ly});var jP=ur((M5e,WP)=>{var eX=Tp();function tX(t,e){let r={};if(t[e+3]==="O"&&t[e+4]==="C"&&t[e+5]==="T"&&t[e+6]==="Y"&&t[e+7]==="P"&&t[e+8]==="E"){e=e+9;let i=1,n=!1,s=!1,o="";for(;e<t.length;e++)if(t[e]==="<"&&!s){if(n&&nX(t,e)){e+=7;let a,A;[a,A,e]=rX(t,e+1),A.indexOf("&")===-1&&(r[cX(a)]={regx:RegExp(`&${a};`,"g"),val:A})}else if(n&&sX(t,e))e+=8;else if(n&&oX(t,e))e+=8;else if(n&&aX(t,e))e+=9;else if(iX)s=!0;else throw new Error("Invalid DOCTYPE");i++,o=""}else if(t[e]===">"){if(s?t[e-1]==="-"&&t[e-2]==="-"&&(s=!1,i--):i--,i===0)break}else t[e]==="["?n=!0:o+=t[e];if(i!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:e}}function rX(t,e){let r="";for(;e<t.length&&t[e]!=="'"&&t[e]!=='"';e++)r+=t[e];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");let i=t[e++],n="";for(;e<t.length&&t[e]!==i;e++)n+=t[e];return[r,n,e]}function iX(t,e){return t[e+1]==="!"&&t[e+2]==="-"&&t[e+3]==="-"}function nX(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="N"&&t[e+4]==="T"&&t[e+5]==="I"&&t[e+6]==="T"&&t[e+7]==="Y"}function sX(t,e){return t[e+1]==="!"&&t[e+2]==="E"&&t[e+3]==="L"&&t[e+4]==="E"&&t[e+5]==="M"&&t[e+6]==="E"&&t[e+7]==="N"&&t[e+8]==="T"}function oX(t,e){return t[e+1]==="!"&&t[e+2]==="A"&&t[e+3]==="T"&&t[e+4]==="T"&&t[e+5]==="L"&&t[e+6]==="I"&&t[e+7]==="S"&&t[e+8]==="T"}function aX(t,e){return t[e+1]==="!"&&t[e+2]==="N"&&t[e+3]==="O"&&t[e+4]==="T"&&t[e+5]==="A"&&t[e+6]==="T"&&t[e+7]==="I"&&t[e+8]==="O"&&t[e+9]==="N"}function cX(t){if(eX.isName(t))return t;throw new Error(`Invalid entity name ${t}`)}WP.exports=tX});var YP=ur((P5e,XP)=>{var lX=/^[-+]?0x[a-fA-F0-9]+$/,AX=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var uX={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function fX(t,e={}){if(e=Object.assign({},uX,e),!t||typeof t!="string")return t;let r=t.trim();if(e.skipLike!==void 0&&e.skipLike.test(r))return t;if(e.hex&&lX.test(r))return Number.parseInt(r,16);{let i=AX.exec(r);if(i){let n=i[1],s=i[2],o=hX(i[3]),a=i[4]||i[6];if(!e.leadingZeros&&s.length>0&&n&&r[2]!==".")return t;if(!e.leadingZeros&&s.length>0&&!n&&r[1]!==".")return t;{let A=Number(r),h=""+A;return h.search(/[eE]/)!==-1||a?e.eNotation?A:t:r.indexOf(".")!==-1?h==="0"&&o===""||h===o||n&&h==="-"+o?A:t:s?o===h||n+o===h?A:t:r===h||r===n+h?A:t}}else return t}}function hX(t){return t&&t.indexOf(".")!==-1&&(t=t.replace(/0+$/,""),t==="."?t="0":t[0]==="."?t="0"+t:t[t.length-1]==="."&&(t=t.substr(0,t.length-1))),t}XP.exports=fX});var Ny=ur((R5e,QP)=>{function dX(t){return typeof t=="function"?t:Array.isArray(t)?e=>{for(let r of t)if(typeof r=="string"&&e===r||r instanceof RegExp&&r.test(e))return!0}:()=>!1}QP.exports=dX});var JP=ur((I5e,KP)=>{"use strict";var qP=Tp(),of=GP(),pX=jP(),gX=YP(),mX=Ny(),Dy=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,i)=>String.fromCharCode(Number.parseInt(i,16))}},this.addExternalEntities=_X,this.parseXml=EX,this.parseTextData=yX,this.resolveNameSpace=xX,this.buildAttributesMap=TX,this.isItStopNode=SX,this.replaceEntitiesValue=wX,this.readStopNodeData=PX,this.saveTextToParentTag=CX,this.addChild=vX,this.ignoreAttributesFn=mX(this.options.ignoreAttributes)}};function _X(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:t[i]}}}function yX(t,e,r,i,n,s,o){if(t!==void 0&&(this.options.trimValues&&!i&&(t=t.trim()),t.length>0)){o||(t=this.replaceEntitiesValue(t));let a=this.options.tagValueProcessor(e,t,r,n,s);return a==null?t:typeof a!=typeof t||a!==t?a:this.options.trimValues?Uy(t,this.options.parseTagValue,this.options.numberParseOptions):t.trim()===t?Uy(t,this.options.parseTagValue,this.options.numberParseOptions):t}}function xX(t){if(this.options.removeNSPrefix){let e=t.split(":"),r=t.charAt(0)==="/"?"/":"";if(e[0]==="xmlns")return"";e.length===2&&(t=r+e[1])}return t}var bX=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function TX(t,e,r){if(this.options.ignoreAttributes!==!0&&typeof t=="string"){let i=qP.getAllMatches(t,bX),n=i.length,s={};for(let o=0;o<n;o++){let a=this.resolveNameSpace(i[o][1]);if(this.ignoreAttributesFn(a,e))continue;let A=i[o][4],h=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(h=this.options.transformAttributeName(h)),h==="__proto__"&&(h="#__proto__"),A!==void 0){this.options.trimValues&&(A=A.trim()),A=this.replaceEntitiesValue(A);let g=this.options.attributeValueProcessor(a,A,e);g==null?s[h]=A:typeof g!=typeof A||g!==A?s[h]=g:s[h]=Uy(A,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[h]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){let o={};return o[this.options.attributesGroupName]=s,o}return s}}var EX=function(t){t=t.replace(/\r\n?/g,`
`);let e=new of("!xml"),r=e,i="",n="";for(let s=0;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="/"){let a=Xo(t,">",s,"Closing Tag is not closed."),A=t.substring(s+2,a).trim();if(this.options.removeNSPrefix){let _=A.indexOf(":");_!==-1&&(A=A.substr(_+1))}this.options.transformTagName&&(A=this.options.transformTagName(A)),r&&(i=this.saveTextToParentTag(i,r,n));let h=n.substring(n.lastIndexOf(".")+1);if(A&&this.options.unpairedTags.indexOf(A)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${A}>`);let g=0;h&&this.options.unpairedTags.indexOf(h)!==-1?(g=n.lastIndexOf(".",n.lastIndexOf(".")-1),this.tagsNodeStack.pop()):g=n.lastIndexOf("."),n=n.substring(0,g),r=this.tagsNodeStack.pop(),i="",s=a}else if(t[s+1]==="?"){let a=ky(t,s,!1,"?>");if(!a)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,r,n),!(this.options.ignoreDeclaration&&a.tagName==="?xml"||this.options.ignorePiTags)){let A=new of(a.tagName);A.add(this.options.textNodeName,""),a.tagName!==a.tagExp&&a.attrExpPresent&&(A[":@"]=this.buildAttributesMap(a.tagExp,n,a.tagName)),this.addChild(r,A,n)}s=a.closeIndex+1}else if(t.substr(s+1,3)==="!--"){let a=Xo(t,"-->",s+4,"Comment is not closed.");if(this.options.commentPropName){let A=t.substring(s+4,a-2);i=this.saveTextToParentTag(i,r,n),r.add(this.options.commentPropName,[{[this.options.textNodeName]:A}])}s=a}else if(t.substr(s+1,2)==="!D"){let a=pX(t,s);this.docTypeEntities=a.entities,s=a.i}else if(t.substr(s+1,2)==="!["){let a=Xo(t,"]]>",s,"CDATA is not closed.")-2,A=t.substring(s+9,a);i=this.saveTextToParentTag(i,r,n);let h=this.parseTextData(A,r.tagname,n,!0,!1,!0,!0);h==null&&(h=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:A}]):r.add(this.options.textNodeName,h),s=a+2}else{let a=ky(t,s,this.options.removeNSPrefix),A=a.tagName,h=a.rawTagName,g=a.tagExp,_=a.attrExpPresent,b=a.closeIndex;this.options.transformTagName&&(A=this.options.transformTagName(A)),r&&i&&r.tagname!=="!xml"&&(i=this.saveTextToParentTag(i,r,n,!1));let T=r;if(T&&this.options.unpairedTags.indexOf(T.tagname)!==-1&&(r=this.tagsNodeStack.pop(),n=n.substring(0,n.lastIndexOf("."))),A!==e.tagname&&(n+=n?"."+A:A),this.isItStopNode(this.options.stopNodes,n,A)){let v="";if(g.length>0&&g.lastIndexOf("/")===g.length-1)A[A.length-1]==="/"?(A=A.substr(0,A.length-1),n=n.substr(0,n.length-1),g=A):g=g.substr(0,g.length-1),s=a.closeIndex;else if(this.options.unpairedTags.indexOf(A)!==-1)s=a.closeIndex;else{let S=this.readStopNodeData(t,h,b+1);if(!S)throw new Error(`Unexpected end of ${h}`);s=S.i,v=S.tagContent}let C=new of(A);A!==g&&_&&(C[":@"]=this.buildAttributesMap(g,n,A)),v&&(v=this.parseTextData(v,A,n,!0,_,!0,!0)),n=n.substr(0,n.lastIndexOf(".")),C.add(this.options.textNodeName,v),this.addChild(r,C,n)}else{if(g.length>0&&g.lastIndexOf("/")===g.length-1){A[A.length-1]==="/"?(A=A.substr(0,A.length-1),n=n.substr(0,n.length-1),g=A):g=g.substr(0,g.length-1),this.options.transformTagName&&(A=this.options.transformTagName(A));let v=new of(A);A!==g&&_&&(v[":@"]=this.buildAttributesMap(g,n,A)),this.addChild(r,v,n),n=n.substr(0,n.lastIndexOf("."))}else{let v=new of(A);this.tagsNodeStack.push(r),A!==g&&_&&(v[":@"]=this.buildAttributesMap(g,n,A)),this.addChild(r,v,n),r=v}i="",s=b}}else i+=t[s];return e.child};function vX(t,e,r){let i=this.options.updateTag(e.tagname,r,e[":@"]);i===!1||(typeof i=="string"&&(e.tagname=i),t.addChild(e))}var wX=function(t){if(this.options.processEntities){for(let e in this.docTypeEntities){let r=this.docTypeEntities[e];t=t.replace(r.regx,r.val)}for(let e in this.lastEntities){let r=this.lastEntities[e];t=t.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let e in this.htmlEntities){let r=this.htmlEntities[e];t=t.replace(r.regex,r.val)}t=t.replace(this.ampEntity.regex,this.ampEntity.val)}return t};function CX(t,e,r,i){return t&&(i===void 0&&(i=Object.keys(e.child).length===0),t=this.parseTextData(t,e.tagname,r,!1,e[":@"]?Object.keys(e[":@"]).length!==0:!1,i),t!==void 0&&t!==""&&e.add(this.options.textNodeName,t),t=""),t}function SX(t,e,r){let i="*."+r;for(let n in t){let s=t[n];if(i===s||e===s)return!0}return!1}function MX(t,e,r=">"){let i,n="";for(let s=e;s<t.length;s++){let o=t[s];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===r[0])if(r[1]){if(t[s+1]===r[1])return{data:n,index:s}}else return{data:n,index:s};else o==="	"&&(o=" ");n+=o}}function Xo(t,e,r,i){let n=t.indexOf(e,r);if(n===-1)throw new Error(i);return n+e.length-1}function ky(t,e,r,i=">"){let n=MX(t,e+1,i);if(!n)return;let s=n.data,o=n.index,a=s.search(/\s/),A=s,h=!0;a!==-1&&(A=s.substring(0,a),s=s.substring(a+1).trimStart());let g=A;if(r){let _=A.indexOf(":");_!==-1&&(A=A.substr(_+1),h=A!==n.data.substr(_+1))}return{tagName:A,tagExp:s,closeIndex:o,attrExpPresent:h,rawTagName:g}}function PX(t,e,r){let i=r,n=1;for(;r<t.length;r++)if(t[r]==="<")if(t[r+1]==="/"){let s=Xo(t,">",r,`${e} is not closed`);if(t.substring(r+2,s).trim()===e&&(n--,n===0))return{tagContent:t.substring(i,r),i:s};r=s}else if(t[r+1]==="?")r=Xo(t,"?>",r+1,"StopNode is not closed.");else if(t.substr(r+1,3)==="!--")r=Xo(t,"-->",r+3,"StopNode is not closed.");else if(t.substr(r+1,2)==="![")r=Xo(t,"]]>",r,"StopNode is not closed.")-2;else{let s=ky(t,r,">");s&&((s&&s.tagName)===e&&s.tagExp[s.tagExp.length-1]!=="/"&&n++,r=s.closeIndex)}}function Uy(t,e,r){if(e&&typeof t=="string"){let i=t.trim();return i==="true"?!0:i==="false"?!1:gX(t,r)}else return qP.isExist(t)?t:""}KP.exports=Dy});var eR=ur($P=>{"use strict";function RX(t,e){return ZP(t,e)}function ZP(t,e,r){let i,n={};for(let s=0;s<t.length;s++){let o=t[s],a=IX(o),A="";if(r===void 0?A=a:A=r+"."+a,a===e.textNodeName)i===void 0?i=o[a]:i+=""+o[a];else{if(a===void 0)continue;if(o[a]){let h=ZP(o[a],e,A),g=OX(h,e);o[":@"]?BX(h,o[":@"],A,e):Object.keys(h).length===1&&h[e.textNodeName]!==void 0&&!e.alwaysCreateTextNode?h=h[e.textNodeName]:Object.keys(h).length===0&&(e.alwaysCreateTextNode?h[e.textNodeName]="":h=""),n[a]!==void 0&&n.hasOwnProperty(a)?(Array.isArray(n[a])||(n[a]=[n[a]]),n[a].push(h)):e.isArray(a,A,g)?n[a]=[h]:n[a]=h}}}return typeof i=="string"?i.length>0&&(n[e.textNodeName]=i):i!==void 0&&(n[e.textNodeName]=i),n}function IX(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];if(i!==":@")return i}}function BX(t,e,r,i){if(e){let n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o];i.isArray(a,r+"."+a,!0,!0)?t[a]=[e[a]]:t[a]=e[a]}}}function OX(t,e){let{textNodeName:r}=e,i=Object.keys(t).length;return!!(i===0||i===1&&(t[r]||typeof t[r]=="boolean"||t[r]===0))}$P.prettify=RX});var rR=ur((O5e,tR)=>{var{buildOptions:FX}=zP(),LX=JP(),{prettify:NX}=eR(),DX=Oy(),Vy=class{constructor(e){this.externalEntities={},this.options=FX(e)}parse(e,r){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});let s=DX.validate(e,r);if(s!==!0)throw Error(`${s.err.msg}:${s.err.line}:${s.err.col}`)}let i=new LX(this.options);i.addExternalEntities(this.externalEntities);let n=i.parseXml(e);return this.options.preserveOrder||n===void 0?n:NX(n,this.options)}addEntity(e,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=r}};tR.exports=Vy});var aR=ur((F5e,oR)=>{var kX=`
`;function UX(t,e){let r="";return e.format&&e.indentBy.length>0&&(r=kX),nR(t,e,"",r)}function nR(t,e,r,i){let n="",s=!1;for(let o=0;o<t.length;o++){let a=t[o],A=VX(a);if(A===void 0)continue;let h="";if(r.length===0?h=A:h=`${r}.${A}`,A===e.textNodeName){let v=a[A];zX(h,e)||(v=e.tagValueProcessor(A,v),v=sR(v,e)),s&&(n+=i),n+=v,s=!1;continue}else if(A===e.cdataPropName){s&&(n+=i),n+=`<![CDATA[${a[A][0][e.textNodeName]}]]>`,s=!1;continue}else if(A===e.commentPropName){n+=i+`<!--${a[A][0][e.textNodeName]}-->`,s=!0;continue}else if(A[0]==="?"){let v=iR(a[":@"],e),C=A==="?xml"?"":i,S=a[A][0][e.textNodeName];S=S.length!==0?" "+S:"",n+=C+`<${A}${S}${v}?>`,s=!0;continue}let g=i;g!==""&&(g+=e.indentBy);let _=iR(a[":@"],e),b=i+`<${A}${_}`,T=nR(a[A],e,h,g);e.unpairedTags.indexOf(A)!==-1?e.suppressUnpairedNode?n+=b+">":n+=b+"/>":(!T||T.length===0)&&e.suppressEmptyNode?n+=b+"/>":T&&T.endsWith(">")?n+=b+`>${T}${i}</${A}>`:(n+=b+">",T&&i!==""&&(T.includes("/>")||T.includes("</"))?n+=i+e.indentBy+T+i:n+=T,n+=`</${A}>`),s=!0}return n}function VX(t){let e=Object.keys(t);for(let r=0;r<e.length;r++){let i=e[r];if(t.hasOwnProperty(i)&&i!==":@")return i}}function iR(t,e){let r="";if(t&&!e.ignoreAttributes)for(let i in t){if(!t.hasOwnProperty(i))continue;let n=e.attributeValueProcessor(i,t[i]);n=sR(n,e),n===!0&&e.suppressBooleanAttributes?r+=` ${i.substr(e.attributeNamePrefix.length)}`:r+=` ${i.substr(e.attributeNamePrefix.length)}="${n}"`}return r}function zX(t,e){t=t.substr(0,t.length-e.textNodeName.length-1);let r=t.substr(t.lastIndexOf(".")+1);for(let i in e.stopNodes)if(e.stopNodes[i]===t||e.stopNodes[i]==="*."+r)return!0;return!1}function sR(t,e){if(t&&t.length>0&&e.processEntities)for(let r=0;r<e.entities.length;r++){let i=e.entities[r];t=t.replace(i.regex,i.val)}return t}oR.exports=UX});var lR=ur((L5e,cR)=>{"use strict";var HX=aR(),GX=Ny(),WX={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(t,e){return e},attributeValueProcessor:function(t,e){return e},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function Hs(t){this.options=Object.assign({},WX,t),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=GX(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=YX),this.processTextOrObjNode=jX,this.options.format?(this.indentate=XX,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}Hs.prototype.build=function(t){return this.options.preserveOrder?HX(t,this.options):(Array.isArray(t)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t={[this.options.arrayNodeName]:t}),this.j2x(t,0,[]).val)};Hs.prototype.j2x=function(t,e,r){let i="",n="",s=r.join(".");for(let o in t)if(Object.prototype.hasOwnProperty.call(t,o))if(typeof t[o]>"u")this.isAttribute(o)&&(n+="");else if(t[o]===null)this.isAttribute(o)?n+="":o[0]==="?"?n+=this.indentate(e)+"<"+o+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+o+"/"+this.tagEndChar;else if(t[o]instanceof Date)n+=this.buildTextValNode(t[o],o,"",e);else if(typeof t[o]!="object"){let a=this.isAttribute(o);if(a&&!this.ignoreAttributesFn(a,s))i+=this.buildAttrPairStr(a,""+t[o]);else if(!a)if(o===this.options.textNodeName){let A=this.options.tagValueProcessor(o,""+t[o]);n+=this.replaceEntitiesValue(A)}else n+=this.buildTextValNode(t[o],o,"",e)}else if(Array.isArray(t[o])){let a=t[o].length,A="",h="";for(let g=0;g<a;g++){let _=t[o][g];if(!(typeof _>"u"))if(_===null)o[0]==="?"?n+=this.indentate(e)+"<"+o+"?"+this.tagEndChar:n+=this.indentate(e)+"<"+o+"/"+this.tagEndChar;else if(typeof _=="object")if(this.options.oneListGroup){let b=this.j2x(_,e+1,r.concat(o));A+=b.val,this.options.attributesGroupName&&_.hasOwnProperty(this.options.attributesGroupName)&&(h+=b.attrStr)}else A+=this.processTextOrObjNode(_,o,e,r);else if(this.options.oneListGroup){let b=this.options.tagValueProcessor(o,_);b=this.replaceEntitiesValue(b),A+=b}else A+=this.buildTextValNode(_,o,"",e)}this.options.oneListGroup&&(A=this.buildObjectNode(A,o,h,e)),n+=A}else if(this.options.attributesGroupName&&o===this.options.attributesGroupName){let a=Object.keys(t[o]),A=a.length;for(let h=0;h<A;h++)i+=this.buildAttrPairStr(a[h],""+t[o][a[h]])}else n+=this.processTextOrObjNode(t[o],o,e,r);return{attrStr:i,val:n}};Hs.prototype.buildAttrPairStr=function(t,e){return e=this.options.attributeValueProcessor(t,""+e),e=this.replaceEntitiesValue(e),this.options.suppressBooleanAttributes&&e==="true"?" "+t:" "+t+'="'+e+'"'};function jX(t,e,r,i){let n=this.j2x(t,r+1,i.concat(e));return t[this.options.textNodeName]!==void 0&&Object.keys(t).length===1?this.buildTextValNode(t[this.options.textNodeName],e,n.attrStr,r):this.buildObjectNode(n.val,e,n.attrStr,r)}Hs.prototype.buildObjectNode=function(t,e,r,i){if(t==="")return e[0]==="?"?this.indentate(i)+"<"+e+r+"?"+this.tagEndChar:this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar;{let n="</"+e+this.tagEndChar,s="";return e[0]==="?"&&(s="?",n=""),(r||r==="")&&t.indexOf("<")===-1?this.indentate(i)+"<"+e+r+s+">"+t+n:this.options.commentPropName!==!1&&e===this.options.commentPropName&&s.length===0?this.indentate(i)+`<!--${t}-->`+this.newLine:this.indentate(i)+"<"+e+r+s+this.tagEndChar+t+this.indentate(i)+n}};Hs.prototype.closeTag=function(t){let e="";return this.options.unpairedTags.indexOf(t)!==-1?this.options.suppressUnpairedNode||(e="/"):this.options.suppressEmptyNode?e="/":e=`></${t}`,e};Hs.prototype.buildTextValNode=function(t,e,r,i){if(this.options.cdataPropName!==!1&&e===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${t}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e===this.options.commentPropName)return this.indentate(i)+`<!--${t}-->`+this.newLine;if(e[0]==="?")return this.indentate(i)+"<"+e+r+"?"+this.tagEndChar;{let n=this.options.tagValueProcessor(e,t);return n=this.replaceEntitiesValue(n),n===""?this.indentate(i)+"<"+e+r+this.closeTag(e)+this.tagEndChar:this.indentate(i)+"<"+e+r+">"+n+"</"+e+this.tagEndChar}};Hs.prototype.replaceEntitiesValue=function(t){if(t&&t.length>0&&this.options.processEntities)for(let e=0;e<this.options.entities.length;e++){let r=this.options.entities[e];t=t.replace(r.regex,r.val)}return t};function XX(t){return this.options.indentBy.repeat(t)}function YX(t){return t.startsWith(this.options.attributeNamePrefix)&&t!==this.options.textNodeName?t.substr(this.attrPrefixLen):!1}cR.exports=Hs});var uR=ur((N5e,AR)=>{"use strict";var QX=Oy(),qX=rR(),KX=lR();AR.exports={XMLParser:qX,XMLValidator:QX,XMLBuilder:KX}});var Ky=ur((TR,ff)=>{(function(t,e){typeof define=="function"&&define.amd?define([],e):typeof Jb=="function"&&typeof ff=="object"&&ff&&ff.exports?ff.exports=e():(t.dcodeIO=t.dcodeIO||{}).Long=e()})(TR,function(){"use strict";function t(z,L,se){this.low=z|0,this.high=L|0,this.unsigned=!!se}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function e(z){return(z&&z.__isLong__)===!0}t.isLong=e;var r={},i={};function n(z,L){var se,le,ce;return L?(z>>>=0,(ce=0<=z&&z<256)&&(le=i[z],le)?le:(se=o(z,(z|0)<0?-1:0,!0),ce&&(i[z]=se),se)):(z|=0,(ce=-128<=z&&z<128)&&(le=r[z],le)?le:(se=o(z,z<0?-1:0,!1),ce&&(r[z]=se),se))}t.fromInt=n;function s(z,L){if(isNaN(z)||!isFinite(z))return L?P:S;if(L){if(z<0)return P;if(z>=T)return K}else{if(z<=-v)return re;if(z+1>=v)return W}return z<0?s(-z,L).neg():o(z%b|0,z/b|0,L)}t.fromNumber=s;function o(z,L,se){return new t(z,L,se)}t.fromBits=o;var a=Math.pow;function A(z,L,se){if(z.length===0)throw Error("empty string");if(z==="NaN"||z==="Infinity"||z==="+Infinity"||z==="-Infinity")return S;if(typeof L=="number"?(se=L,L=!1):L=!!L,se=se||10,se<2||36<se)throw RangeError("radix");var le;if((le=z.indexOf("-"))>0)throw Error("interior hyphen");if(le===0)return A(z.substring(1),L,se).neg();for(var ce=s(a(se,8)),he=S,Re=0;Re<z.length;Re+=8){var Ke=Math.min(8,z.length-Re),Ye=parseInt(z.substring(Re,Re+Ke),se);if(Ke<8){var $e=s(a(se,Ke));he=he.mul($e).add(s(Ye))}else he=he.mul(ce),he=he.add(s(Ye))}return he.unsigned=L,he}t.fromString=A;function h(z){return z instanceof t?z:typeof z=="number"?s(z):typeof z=="string"?A(z):o(z.low,z.high,z.unsigned)}t.fromValue=h;var g=65536,_=1<<24,b=g*g,T=b*b,v=T/2,C=n(_),S=n(0);t.ZERO=S;var P=n(0,!0);t.UZERO=P;var F=n(1);t.ONE=F;var I=n(1,!0);t.UONE=I;var k=n(-1);t.NEG_ONE=k;var W=o(-1,2147483647,!1);t.MAX_VALUE=W;var K=o(-1,-1,!0);t.MAX_UNSIGNED_VALUE=K;var re=o(0,-2147483648,!1);t.MIN_VALUE=re;var Y=t.prototype;return Y.toInt=function(){return this.unsigned?this.low>>>0:this.low},Y.toNumber=function(){return this.unsigned?(this.high>>>0)*b+(this.low>>>0):this.high*b+(this.low>>>0)},Y.toString=function(L){if(L=L||10,L<2||36<L)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(re)){var se=s(L),le=this.div(se),ce=le.mul(se).sub(this);return le.toString(L)+ce.toInt().toString(L)}else return"-"+this.neg().toString(L);for(var he=s(a(L,6),this.unsigned),Re=this,Ke="";;){var Ye=Re.div(he),$e=Re.sub(Ye.mul(he)).toInt()>>>0,nt=$e.toString(L);if(Re=Ye,Re.isZero())return nt+Ke;for(;nt.length<6;)nt="0"+nt;Ke=""+nt+Ke}},Y.getHighBits=function(){return this.high},Y.getHighBitsUnsigned=function(){return this.high>>>0},Y.getLowBits=function(){return this.low},Y.getLowBitsUnsigned=function(){return this.low>>>0},Y.getNumBitsAbs=function(){if(this.isNegative())return this.eq(re)?64:this.neg().getNumBitsAbs();for(var L=this.high!=0?this.high:this.low,se=31;se>0&&!(L&1<<se);se--);return this.high!=0?se+33:se+1},Y.isZero=function(){return this.high===0&&this.low===0},Y.isNegative=function(){return!this.unsigned&&this.high<0},Y.isPositive=function(){return this.unsigned||this.high>=0},Y.isOdd=function(){return(this.low&1)===1},Y.isEven=function(){return(this.low&1)===0},Y.equals=function(L){return e(L)||(L=h(L)),this.unsigned!==L.unsigned&&this.high>>>31===1&&L.high>>>31===1?!1:this.high===L.high&&this.low===L.low},Y.eq=Y.equals,Y.notEquals=function(L){return!this.eq(L)},Y.neq=Y.notEquals,Y.lessThan=function(L){return this.comp(L)<0},Y.lt=Y.lessThan,Y.lessThanOrEqual=function(L){return this.comp(L)<=0},Y.lte=Y.lessThanOrEqual,Y.greaterThan=function(L){return this.comp(L)>0},Y.gt=Y.greaterThan,Y.greaterThanOrEqual=function(L){return this.comp(L)>=0},Y.gte=Y.greaterThanOrEqual,Y.compare=function(L){if(e(L)||(L=h(L)),this.eq(L))return 0;var se=this.isNegative(),le=L.isNegative();return se&&!le?-1:!se&&le?1:this.unsigned?L.high>>>0>this.high>>>0||L.high===this.high&&L.low>>>0>this.low>>>0?-1:1:this.sub(L).isNegative()?-1:1},Y.comp=Y.compare,Y.negate=function(){return!this.unsigned&&this.eq(re)?re:this.not().add(F)},Y.neg=Y.negate,Y.add=function(L){e(L)||(L=h(L));var se=this.high>>>16,le=this.high&65535,ce=this.low>>>16,he=this.low&65535,Re=L.high>>>16,Ke=L.high&65535,Ye=L.low>>>16,$e=L.low&65535,nt=0,rt=0,Ne=0,ir=0;return ir+=he+$e,Ne+=ir>>>16,ir&=65535,Ne+=ce+Ye,rt+=Ne>>>16,Ne&=65535,rt+=le+Ke,nt+=rt>>>16,rt&=65535,nt+=se+Re,nt&=65535,o(Ne<<16|ir,nt<<16|rt,this.unsigned)},Y.subtract=function(L){return e(L)||(L=h(L)),this.add(L.neg())},Y.sub=Y.subtract,Y.multiply=function(L){if(this.isZero()||(e(L)||(L=h(L)),L.isZero()))return S;if(this.eq(re))return L.isOdd()?re:S;if(L.eq(re))return this.isOdd()?re:S;if(this.isNegative())return L.isNegative()?this.neg().mul(L.neg()):this.neg().mul(L).neg();if(L.isNegative())return this.mul(L.neg()).neg();if(this.lt(C)&&L.lt(C))return s(this.toNumber()*L.toNumber(),this.unsigned);var se=this.high>>>16,le=this.high&65535,ce=this.low>>>16,he=this.low&65535,Re=L.high>>>16,Ke=L.high&65535,Ye=L.low>>>16,$e=L.low&65535,nt=0,rt=0,Ne=0,ir=0;return ir+=he*$e,Ne+=ir>>>16,ir&=65535,Ne+=ce*$e,rt+=Ne>>>16,Ne&=65535,Ne+=he*Ye,rt+=Ne>>>16,Ne&=65535,rt+=le*$e,nt+=rt>>>16,rt&=65535,rt+=ce*Ye,nt+=rt>>>16,rt&=65535,rt+=he*Ke,nt+=rt>>>16,rt&=65535,nt+=se*$e+le*Ye+ce*Ke+he*Re,nt&=65535,o(Ne<<16|ir,nt<<16|rt,this.unsigned)},Y.mul=Y.multiply,Y.divide=function(L){if(e(L)||(L=h(L)),L.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?P:S;var se,le,ce;if(this.unsigned){if(L.unsigned||(L=L.toUnsigned()),L.gt(this))return P;if(L.gt(this.shru(1)))return I;ce=P}else{if(this.eq(re)){if(L.eq(F)||L.eq(k))return re;if(L.eq(re))return F;var he=this.shr(1);return se=he.div(L).shl(1),se.eq(S)?L.isNegative()?F:k:(le=this.sub(L.mul(se)),ce=se.add(le.div(L)),ce)}else if(L.eq(re))return this.unsigned?P:S;if(this.isNegative())return L.isNegative()?this.neg().div(L.neg()):this.neg().div(L).neg();if(L.isNegative())return this.div(L.neg()).neg();ce=S}for(le=this;le.gte(L);){se=Math.max(1,Math.floor(le.toNumber()/L.toNumber()));for(var Re=Math.ceil(Math.log(se)/Math.LN2),Ke=Re<=48?1:a(2,Re-48),Ye=s(se),$e=Ye.mul(L);$e.isNegative()||$e.gt(le);)se-=Ke,Ye=s(se,this.unsigned),$e=Ye.mul(L);Ye.isZero()&&(Ye=F),ce=ce.add(Ye),le=le.sub($e)}return ce},Y.div=Y.divide,Y.modulo=function(L){return e(L)||(L=h(L)),this.sub(this.div(L).mul(L))},Y.mod=Y.modulo,Y.not=function(){return o(~this.low,~this.high,this.unsigned)},Y.and=function(L){return e(L)||(L=h(L)),o(this.low&L.low,this.high&L.high,this.unsigned)},Y.or=function(L){return e(L)||(L=h(L)),o(this.low|L.low,this.high|L.high,this.unsigned)},Y.xor=function(L){return e(L)||(L=h(L)),o(this.low^L.low,this.high^L.high,this.unsigned)},Y.shiftLeft=function(L){return e(L)&&(L=L.toInt()),(L&=63)===0?this:L<32?o(this.low<<L,this.high<<L|this.low>>>32-L,this.unsigned):o(0,this.low<<L-32,this.unsigned)},Y.shl=Y.shiftLeft,Y.shiftRight=function(L){return e(L)&&(L=L.toInt()),(L&=63)===0?this:L<32?o(this.low>>>L|this.high<<32-L,this.high>>L,this.unsigned):o(this.high>>L-32,this.high>=0?0:-1,this.unsigned)},Y.shr=Y.shiftRight,Y.shiftRightUnsigned=function(L){if(e(L)&&(L=L.toInt()),L&=63,L===0)return this;var se=this.high;if(L<32){var le=this.low;return o(le>>>L|se<<32-L,se>>>L,this.unsigned)}else return L===32?o(se,0,this.unsigned):o(se>>>L-32,0,this.unsigned)},Y.shru=Y.shiftRightUnsigned,Y.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},Y.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},Y.toBytes=function(z){return z?this.toBytesLE():this.toBytesBE()},Y.toBytesLE=function(){var z=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24&255,z&255,z>>>8&255,z>>>16&255,z>>>24&255]},Y.toBytesBE=function(){var z=this.high,L=this.low;return[z>>>24&255,z>>>16&255,z>>>8&255,z&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255]},t})});var u8=ur(Vx=>{Vx.read=function(t,e,r,i,n){var s,o,a=n*8-i-1,A=(1<<a)-1,h=A>>1,g=-7,_=r?n-1:0,b=r?-1:1,T=t[e+_];for(_+=b,s=T&(1<<-g)-1,T>>=-g,g+=a;g>0;s=s*256+t[e+_],_+=b,g-=8);for(o=s&(1<<-g)-1,s>>=-g,g+=i;g>0;o=o*256+t[e+_],_+=b,g-=8);if(s===0)s=1-h;else{if(s===A)return o?NaN:(T?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-h}return(T?-1:1)*o*Math.pow(2,s-i)};Vx.write=function(t,e,r,i,n,s){var o,a,A,h=s*8-n-1,g=(1<<h)-1,_=g>>1,b=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=i?0:s-1,v=i?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=g):(o=Math.floor(Math.log(e)/Math.LN2),e*(A=Math.pow(2,-o))<1&&(o--,A*=2),o+_>=1?e+=b/A:e+=b*Math.pow(2,1-_),e*A>=2&&(o++,A/=2),o+_>=g?(a=0,o=g):o+_>=1?(a=(e*A-1)*Math.pow(2,n),o=o+_):(a=e*Math.pow(2,_-1)*Math.pow(2,n),o=0));n>=8;t[r+T]=a&255,T+=v,a/=256,n-=8);for(o=o<<n|a,h+=n;h>0;t[r+T]=o&255,T+=v,o/=256,h-=8);t[r+T-v]|=C*128}});var m8=ur((G9e,g8)=>{"use strict";g8.exports=bt;var Lg=u8();function bt(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}bt.Varint=0;bt.Fixed64=1;bt.Bytes=2;bt.Fixed32=5;var zx=65536*65536,f8=1/zx,gee=12,p8=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");bt.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,s=this.pos;this.type=i&7,t(n,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ng(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=d8(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ng(this.buf,this.pos)+Ng(this.buf,this.pos+4)*zx;return this.pos+=8,t},readSFixed64:function(){var t=Ng(this.buf,this.pos)+d8(this.buf,this.pos+4)*zx;return this.pos+=8,t},readFloat:function(){var t=Lg.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Lg.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,r,i;return i=e[this.pos++],r=i&127,i<128||(i=e[this.pos++],r|=(i&127)<<7,i<128)||(i=e[this.pos++],r|=(i&127)<<14,i<128)||(i=e[this.pos++],r|=(i&127)<<21,i<128)?r:(i=e[this.pos],r|=(i&15)<<28,mee(r,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=gee&&p8?Iee(this.buf,e,t):Ree(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==bt.Bytes)return t.push(this.readVarint(e));var r=ss(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==bt.Bytes)return t.push(this.readSVarint());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==bt.Bytes)return t.push(this.readBoolean());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==bt.Bytes)return t.push(this.readFloat());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==bt.Bytes)return t.push(this.readDouble());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==bt.Bytes)return t.push(this.readFixed32());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==bt.Bytes)return t.push(this.readSFixed32());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==bt.Bytes)return t.push(this.readFixed64());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==bt.Bytes)return t.push(this.readSFixed64());var e=ss(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===bt.Varint)for(;this.buf[this.pos++]>127;);else if(e===bt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===bt.Fixed32)this.pos+=4;else if(e===bt.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),el(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),el(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),el(this.buf,t&-1,this.pos),el(this.buf,Math.floor(t*f8),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),el(this.buf,t&-1,this.pos),el(this.buf,Math.floor(t*f8),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){_ee(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=Bee(this.buf,t,this.pos);var r=this.pos-e;r>=128&&h8(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Lg.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Lg.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&h8(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,bt.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,bee,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Tee,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,wee,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Eee,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,vee,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Cee,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,See,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Mee,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Pee,e)},writeBytesField:function(t,e){this.writeTag(t,bt.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,bt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,bt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,bt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,bt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,bt.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,bt.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,bt.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,bt.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,bt.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function mee(t,e,r){var i=r.buf,n,s;if(s=i[r.pos++],n=(s&112)>>4,s<128||(s=i[r.pos++],n|=(s&127)<<3,s<128)||(s=i[r.pos++],n|=(s&127)<<10,s<128)||(s=i[r.pos++],n|=(s&127)<<17,s<128)||(s=i[r.pos++],n|=(s&127)<<24,s<128)||(s=i[r.pos++],n|=(s&1)<<31,s<128))return $c(t,n,e);throw new Error("Expected varint not more than 10 bytes")}function ss(t){return t.type===bt.Bytes?t.readVarint()+t.pos:t.pos+1}function $c(t,e,r){return r?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function _ee(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(r=~(-t%4294967296),i=~(-t/4294967296),r^4294967295?r=r+1|0:(r=0,i=i+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),yee(r,i,e),xee(i,e)}function yee(t,e,r){r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos++]=t&127|128,t>>>=7,r.buf[r.pos]=t&127}function xee(t,e){var r=(t&7)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function h8(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function bee(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function Tee(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function Eee(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function vee(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function wee(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Cee(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function See(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Mee(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function Pee(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Ng(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function el(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function d8(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Ree(t,e,r){for(var i="",n=e;n<r;){var s=t[n],o=null,a=s>239?4:s>223?3:s>191?2:1;if(n+a>r)break;var A,h,g;a===1?s<128&&(o=s):a===2?(A=t[n+1],(A&192)===128&&(o=(s&31)<<6|A&63,o<=127&&(o=null))):a===3?(A=t[n+1],h=t[n+2],(A&192)===128&&(h&192)===128&&(o=(s&15)<<12|(A&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(A=t[n+1],h=t[n+2],g=t[n+3],(A&192)===128&&(h&192)===128&&(g&192)===128&&(o=(s&15)<<18|(A&63)<<12|(h&63)<<6|g&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),n+=a}return i}function Iee(t,e,r){return p8.decode(t.subarray(e,r))}function Bee(t,e,r){for(var i=0,n,s;i<e.length;i++){if(n=e.charCodeAt(i),n>55295&&n<57344)if(s)if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,s=n;continue}else n=s-55296<<10|n-56320|65536,s=null;else{n>56319||i+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):s=n;continue}else s&&(t[r++]=239,t[r++]=191,t[r++]=189,s=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=n&63|128)}return r}});import nl from"https://esm.sh/maplibre-gl@3.6.2";import{Protocol as Ete}from"https://esm.sh/pmtiles@3.0.6";var hl=class{constructor(e){this._options=e||{}}onAdd(e){return this._map=e,this._container=document.createElement("div"),this._container.className="maplibregl-ctrl maplibregl-ctrl-group",this._container.style.cssText=this._options.cssText||"padding: 10px;",this._container.innerHTML=this._options.content||"We out here.",this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}};var tL={default:"layer-switcher-ctrl",simple:"layer-switcher-ctrl-simple"};function rL(t,e){let r=document.createElement("a");r.id=e,r.href="#",r.textContent=e;let i=t.getLayoutProperty(e,"visibility");return(typeof i>"u"||i==="visible")&&(r.className="active"),r.onclick=function(n){let s=this.textContent,o=t.getLayoutProperty(s,"visibility");if(console.log(s,o),typeof o>"u"||o==="visible"){t.setLayoutProperty(s,"visibility","none"),this.className="";return}t.setLayoutProperty(s,"visibility","visible"),this.className="active"},r}function iL(t,e){let r=document.createElement("div");r.id="layer-switcher-menu";for(let i of e){let n=rL(t,i);r.appendChild(n)}return r}var dl=class{constructor(e){this._options=e}onAdd(e){this._map=e,this._container=document.createElement("div"),this._container.classList.add("maplibregl-ctrl"),this._container.classList.add(tL[this._options.theme||"default"]),this._container.style.cssText=this._options.cssText||"";let r=this._options.layerIds;return this._container.appendChild(iL(e,r)),this._container}onRemove(){this._container.parentNode.removeChild(this._container),this._map=void 0}getDefaultPosition(){return"top-left"}};async function ii(t,e,r,i){return i._parse(t,e,r,i)}function Ze(t,e){if(!t)throw new Error(e||"loader assertion failed.")}var $i={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},nL=$i.self||$i.window||$i.global||{},sL=$i.window||$i.self||$i.global||{},oL=$i.global||$i.self||$i.window||{},aL=$i.document||{};var Ln=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser);var Zb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),cL=Zb&&parseFloat(Zb[1])||0;var ah=globalThis,lL=globalThis.document||{},ch=globalThis.process||{},AL=globalThis.console,$b=globalThis.navigator||{};function lh(t){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;let e=typeof navigator<"u"&&navigator.userAgent,r=t||e;return!!(r&&r.indexOf("Electron")>=0)}function kr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||lh()}function pm(t){return!t&&!kr()?"Node":lh(t)?"Electron":(t||$b.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var gm="4.1.0";function fL(t){try{let e=window[t],r="__storage_test__";return e.setItem(r,r),e.removeItem(r),e}catch{return null}}var Ah=class{constructor(e,r,i="sessionStorage"){this.storage=fL(i),this.id=e,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let e={};if(this.storage){let r=this.storage.getItem(this.id);e=r?JSON.parse(r):{}}return Object.assign(this.config,e),this}};function eT(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function tT(t,e=8){let r=Math.max(e-t.length,0);return`${" ".repeat(r)}${t}`}var uh;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(uh||(uh={}));var hL=10;function rT(t){return typeof t!="string"?t:(t=t.toUpperCase(),uh[t]||uh.WHITE)}function iT(t,e,r){return!kr&&typeof t=="string"&&(e&&(t=`\x1B[${rT(e)}m${t}\x1B[39m`),r&&(t=`\x1B[${rT(r)+hL}m${t}\x1B[49m`)),t}function nT(t,e=["constructor"]){let r=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(r),n=t;for(let s of i){let o=n[s];typeof o=="function"&&(e.find(a=>s===a)||(n[s]=o.bind(t)))}}function pl(t,e){if(!t)throw new Error(e||"Assertion failed")}function oo(){let t;if(kr()&&ah.performance)t=ah?.performance?.now?.();else if("hrtime"in ch){let e=ch?.hrtime?.();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}var ya={debug:kr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},dL={enabled:!0,level:0};function xa(){}var sT={},oT={once:!0},Yr=class{constructor({id:e}={id:""}){this.VERSION=gm,this._startTs=oo(),this._deltaTs=oo(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Ah(`__probe-${this.id}__`,dL),this.timeStamp(`${this.id} started`),nT(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((oo()-this._startTs).toPrecision(10))}getDelta(){return Number((oo()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,r){this._storage.setConfiguration({[e]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,r){if(!e)throw new Error(r||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ya.warn,arguments,oT)}error(e){return this._getLogFunction(0,e,ya.error,arguments)}deprecated(e,r){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(e,r){return this.error(`\`${e}\` has been removed. Use \`${r}\` instead`)}probe(e,r){return this._getLogFunction(e,r,ya.log,arguments,{time:!0,once:!0})}log(e,r){return this._getLogFunction(e,r,ya.debug,arguments)}info(e,r){return this._getLogFunction(e,r,console.info,arguments)}once(e,r){return this._getLogFunction(e,r,ya.debug||ya.info,arguments,oT)}table(e,r,i){return r?this._getLogFunction(e,r,console.table||xa,i&&[i],{tag:gL(r)}):xa}time(e,r){return this._getLogFunction(e,r,console.time?console.time:console.info)}timeEnd(e,r){return this._getLogFunction(e,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,r){return this._getLogFunction(e,r,console.timeStamp||xa)}group(e,r,i={collapsed:!1}){let n=aT({logLevel:e,message:r,opts:i}),{collapsed:s}=i;return n.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(n)}groupCollapsed(e,r,i={}){return this.group(e,r,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||xa)}withGroup(e,r,i){this.group(e,r)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=cT(e)}_getLogFunction(e,r,i,n,s){if(this._shouldLog(e)){s=aT({logLevel:e,message:r,args:n,opts:s}),i=i||s.method,pl(i),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=oo();let o=s.tag||s.message;if(s.once&&o)if(!sT[o])sT[o]=oo();else return xa;return r=pL(this.id,s.message,s),i.bind(console,r,...s.args)}return xa}};Yr.VERSION=gm;function cT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return pl(Number.isFinite(e)&&e>=0),e}function aT(t){let{logLevel:e,message:r}=t;t.logLevel=cT(e);let i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==r;);switch(typeof e){case"string":case"function":r!==void 0&&i.unshift(r),t.message=e;break;case"object":Object.assign(t,e);break;default:}typeof t.message=="function"&&(t.message=t.message());let n=typeof t.message;return pl(n==="string"||n==="object"),Object.assign(t,{args:i},t.opts)}function pL(t,e,r){if(typeof e=="string"){let i=r.time?tT(eT(r.total)):"";e=r.time?`${t}: ${i}  ${e}`:`${t}: ${e}`,e=iT(e,r.color,r.background)}return e}function gL(t){for(let e in t)for(let r in t[e])return r||"untitled";return"empty"}globalThis.probe={};var mm=new Yr({id:"@probe.gl/log"});var _m="4.3.2",mL=_m[0]>="0"&&_m[0]<="9"?`v${_m}`:"";function _L(){let t=new Yr({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=mL,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}var gl=_L();function ml(t,e){return lT(t||{},e)}function lT(t,e,r=0){if(r>3)return e;let i={...t};for(let[n,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?i[n]=lT(i[n]||{},e[n],r+1):i[n]=e[n];return i}function ym(t){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t)}function xm(t){return globalThis.loaders?.modules?.[t]||null}var AT="latest";function yL(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}var _l=yL();function xr(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}var en={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},one=en.self||en.window||en.global||{},ane=en.window||en.self||en.global||{},cne=en.global||en.self||en.window||{},lne=en.document||{};var hr=typeof process!="object"||String(process)!=="[object process]"||process.browser,yl=typeof importScripts=="function",fT=typeof window<"u"&&typeof window.orientation<"u",uT=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Ane=uT&&parseFloat(uT[1])||0;var xl=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise((i,n)=>{this._resolve=i,this._reject=n})}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){xr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){xr(this.isRunning),this.isRunning=!1,this._reject(e)}};var ba=class{terminate(){}};var bm=new Map;function hT(t){xr(t.source&&!t.url||!t.source&&t.url);let e=bm.get(t.source||t.url);return e||(t.url&&(e=xL(t.url),bm.set(t.url,e)),t.source&&(e=dT(t.source),bm.set(t.source,e))),xr(e),e}function xL(t){if(!t.startsWith("http"))return t;let e=bL(t);return dT(e)}function dT(t){let e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function bL(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Tm(t,e=!0,r){let i=r||new Set;if(t){if(pT(t))i.add(t);else if(pT(t.buffer))i.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(let n in t)Tm(t[n],e,i)}}return r===void 0?Array.from(i):[]}function pT(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}var Em=()=>{},fs=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&hr||typeof ba<"u"&&!hr}constructor(e){let{name:r,source:i,url:n}=e;xr(i||n),this.name=r,this.source=i,this.url=n,this.onMessage=Em,this.onError=s=>console.log(s),this.worker=hr?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Em,this.onError=Em,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,r){r=r||Tm(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=hT({source:this.source,url:this.url});let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},e.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},e.onmessageerror=r=>console.error(r),e}_createNodeWorker(){let e;if(this.url){let i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new ba(i,{eval:!1})}else if(this.source)e=new ba(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",r=>{this.onMessage(r)}),e.on("error",r=>{this.onError(r)}),e.on("exit",r=>{}),e}};var bl=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return fs.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,r=(n,s,o)=>n.done(o),i=(n,s)=>n.error(s)){let n=new Promise(s=>(this.jobQueue.push({name:e,onMessage:r,onError:i,onStart:s}),this));return this._startQueuedJob(),await n}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});let i=new xl(r.name,e);e.onMessage=n=>r.onMessage(i,n.type,n.payload),e.onError=n=>r.onError(i,n),r.onStart(i);try{await i.result}catch(n){console.error(`Worker exception: ${n}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!hr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new fs({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return fT?this.maxMobileConcurrency:this.maxConcurrency}};var TL={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},ao=class t{props;workerPools=new Map;static _workerFarm;static isSupported(){return fs.isSupported()}static getWorkerFarm(e={}){return t._workerFarm=t._workerFarm||new t({}),t._workerFarm.setProps(e),t._workerFarm}constructor(e){this.props={...TL},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:r,source:i,url:n}=e,s=this.workerPools.get(r);return s||(s=new bl({name:r,source:i,url:n}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};function vm(t,e={}){let r=e[t.id]||{},i=hr?`${t.id}-worker.js`:`${t.id}-worker-node.js`,n=r.workerUrl;if(!n&&t.id==="compression"&&(n=e.workerUrl),e._workerType==="test"&&(hr?n=`modules/${t.module}/dist/${i}`:n=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!n){let s=t.version;s==="latest"&&(s=AT);let o=s?`@${s}`:"";n=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${i}`}return xr(n),n}function wm(t,e=_l){xr(t,"no worker provided");let r=t.version;return!(!e||!r)}var Cm={};async function tn(t,e=null,r={},i=null){return e&&(t=gT(t,e,r,i)),Cm[t]=Cm[t]||EL(t),await Cm[t]}function gT(t,e,r={},i=null){if(!r.useLocalLibraries&&t.startsWith("http"))return t;i=i||t;let n=r.modules||{};return n[i]?n[i]:hr?r.CDN?(xr(r.CDN.startsWith("http")),`${r.CDN}/${e}@${_l}/dist/libs/${i}`):yl?`../src/libs/${i}`:`modules/${e}/src/libs/${i}`:`modules/${e}/dist/libs/${i}`}async function EL(t){if(t.endsWith("wasm"))return await wL(t);if(!hr)try{let{requireFromFile:r}=globalThis.loaders||{};return await r?.(t)}catch(r){return console.error(r),null}if(yl)return importScripts(t);let e=await CL(t);return vL(e,t)}function vL(t,e){if(!hr){let{requireFromString:i}=globalThis.loaders||{};return i?.(t,e)}if(yl)return eval.call(globalThis,t),null;let r=document.createElement("script");r.id=e;try{r.appendChild(document.createTextNode(t))}catch{r.text=t}return document.body.appendChild(r),null}async function wL(t){let{readFileAsArrayBuffer:e}=globalThis.loaders||{};return hr||!e||t.startsWith("http")?await(await fetch(t)).arrayBuffer():await e(t)}async function CL(t){let{readFileAsText:e}=globalThis.loaders||{};return hr||!e||t.startsWith("http")?await(await fetch(t)).text():await e(t)}function Sm(t,e){return!ao.isSupported()||!hr&&!e?._nodeWorkers?!1:t.worker&&e?.worker}async function Mm(t,e,r,i,n){let s=t.id,o=vm(t,r),A=ao.getWorkerFarm(r).getWorkerPool({name:s,url:o});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));let h=await A.startJob("process-on-worker",SL.bind(null,n));return h.postMessage("process",{input:e,options:r,context:i}),await(await h.result).result}async function SL(t,e,r,i){switch(r){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":let{id:n,input:s,options:o}=i;try{let a=await t(s,o);e.postMessage("done",{id:n,result:a})}catch(a){let A=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:n,error:A})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function _T(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?mT(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?mT(t,0,e):""}function mT(t,e,r){if(t.byteLength<=e+r)return"";let i=new DataView(t),n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(e+s));return n}function Pm(t){try{return JSON.parse(t)}catch{throw new Error(`Failed to parse JSON from data starting with "${_T(t)}"`)}}function Rm(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;let i=new Uint8Array(t),n=new Uint8Array(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s])return!1;return!0}function Im(...t){return yT(t)}function yT(t){let e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),r=e.reduce((s,o)=>s+o.byteLength,0),i=new Uint8Array(r),n=0;for(let s of e)i.set(s,n),n+=s.byteLength;return i.buffer}function Tl(...t){let e=t,r=e&&e.length>1&&e[0].constructor||null;if(!r)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');let i=e.reduce((o,a)=>o+a.length,0),n=new r(i),s=0;for(let o of e)n.set(o,s),s+=o.length;return n}function co(t,e,r){let i=r!==void 0?new Uint8Array(t).subarray(e,e+r):new Uint8Array(t).subarray(e);return new Uint8Array(i).buffer}function hs(t,e){return Ze(t>=0),Ze(e>0),t+(e-1)&~(e-1)}function Bm(t,e,r){let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{let n=t.byteOffset,s=t.byteLength;i=new Uint8Array(t.buffer||t.arrayBuffer,n,s)}return e.set(i,r),r+hs(i.byteLength,4)}async function Om(t){let e=[];for await(let r of t)e.push(r);return Im(...e)}function El(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){let e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}var lo=class{constructor(e,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=El(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(El()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var Sr=class{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,r="count"){return this._getOrCreate({name:e,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let e of Object.values(this.stats))e.reset();return this}forEach(e){for(let r of Object.values(this.stats))e(r)}getTable(){let e={};return this.forEach(r=>{e[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(r=>this._getOrCreate(r))}_getOrCreate(e){let{name:r,type:i}=e,n=this.stats[r];return n||(e instanceof lo?n=e:n=new lo(r,i),this.stats[r]=n),n}};var ML="Queued Requests",PL="Active Requests",RL="Cancelled Requests",IL="Queued Requests Ever",BL="Active Requests Ever",OL={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},ds=class{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...OL,...e},this.stats=new Sr({id:this.props.id}),this.stats.get(ML),this.stats.get(PL),this.stats.get(RL),this.stats.get(IL),this.stats.get(BL)}scheduleRequest(e,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let i={handle:e,priority:0,getPriority:r},n=new Promise(s=>(i.resolve=s,i));return this.requestQueue.push(i),this.requestMap.set(e,n),this._issueNewRequests(),n}_issueRequest(e){let{handle:r,resolve:i}=e,n=!1,s=()=>{n||(n=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,i?i({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let r=0;r<e;++r){let i=this.requestQueue.shift();i&&this._issueRequest(i)}}}_updateAllRequests(){let e=this.requestQueue;for(let r=0;r<e.length;++r){let i=e[r];this._updateRequest(i)||(e.splice(r,1),this.requestMap.delete(i.handle),r--)}e.sort((r,i)=>r.priority-i.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}};var FL="",xT={};function Fm(t){for(let e in xT)if(t.startsWith(e)){let r=xT[e];t=t.replace(e,r)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${FL}${t}`),t}function bT(t){return t&&typeof t=="object"&&t.isBuffer}function fh(t){if(bT(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){let e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}var ni={};fr(ni,{dirname:()=>NL,filename:()=>LL,join:()=>DL,resolve:()=>kL});function TT(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let t=window.location?.pathname;return t?.slice(0,t.lastIndexOf("/")+1)||""}function LL(t){let e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function NL(t){let e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}function DL(...t){let e="/";return t=t.map((r,i)=>(i&&(r=r.replace(new RegExp(`^${e}`),"")),i!==t.length-1&&(r=r.replace(new RegExp(`${e}$`),"")),r)),t.join(e)}function kL(...t){let e=[];for(let s=0;s<t.length;s++)e[s]=t[s];let r="",i=!1,n;for(let s=e.length-1;s>=-1&&!i;s--){let o;s>=0?o=e[s]:(n===void 0&&(n=TT()),o=n),o.length!==0&&(r=`${o}/${r}`,i=o.charCodeAt(0)===vl)}return r=UL(r,!i),i?`/${r}`:r.length>0?r:"."}var vl=47,Lm=46;function UL(t,e){let r="",i=-1,n=0,s,o=!1;for(let a=0;a<=t.length;++a){if(a<t.length)s=t.charCodeAt(a);else{if(s===vl)break;s=vl}if(s===vl){if(!(i===a-1||n===1))if(i!==a-1&&n===2){if(r.length<2||!o||r.charCodeAt(r.length-1)!==Lm||r.charCodeAt(r.length-2)!==Lm){if(r.length>2){let A=r.length-1,h=A;for(;h>=0&&r.charCodeAt(h)!==vl;--h);if(h!==A){r=h===-1?"":r.slice(0,h),i=a,n=0,o=!1;continue}}else if(r.length===2||r.length===1){r="",i=a,n=0,o=!1;continue}}e&&(r.length>0?r+="/..":r="..",o=!0)}else{let A=t.slice(i+1,a);r.length>0?r+=`/${A}`:r=A,o=!1}i=a,n=0}else s===Lm&&n!==-1?++n:n=-1}return r}var hh=class{fetch;loadOptions;_needsRefresh=!0;props;constructor(e){this.props={...e},this.loadOptions={...e.loadOptions},this.fetch=VL(this.loadOptions)}setProps(e){this.props=Object.assign(this.props,e),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(e=!0){let r=this._needsRefresh;return e&&(this._needsRefresh=!1),r}};function VL(t){let e=t?.fetch;if(e&&typeof e=="function")return(i,n)=>e(i,n);let r=t?.fetch;return r&&typeof r!="function"?i=>fetch(i,r):i=>fetch(i)}var rn=class extends hh{static type="template";static testURL=e=>!1};var zL=t=>typeof t=="boolean",wl=t=>typeof t=="function",Ao=t=>t!==null&&typeof t=="object",Nm=t=>Ao(t)&&t.constructor==={}.constructor;var ET=t=>!!t&&typeof t[Symbol.iterator]=="function",vT=t=>t&&typeof t[Symbol.asyncIterator]=="function";var di=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json;var pi=t=>typeof Blob<"u"&&t instanceof Blob,wT=t=>t&&typeof t=="object"&&t.isBuffer;var HL=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Ao(t)&&wl(t.tee)&&wl(t.cancel)&&wl(t.getReader);var WL=t=>Ao(t)&&wl(t.read)&&wl(t.pipe)&&zL(t.readable),dh=t=>HL(t)||WL(t);var ph=class extends Error{constructor(e,r){super(e),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};var jL=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,XL=/^([-\w.]+\/[-\w.+]+)/;function Dm(t,e){return t.toLowerCase()===e.toLowerCase()}function CT(t){let e=XL.exec(t);return e?e[1]:t}function km(t){let e=jL.exec(t);return e?e[1]:""}var ST=/\?.*/;function MT(t){let e=t.match(ST);return e&&e[0]}function Ta(t){return t.replace(ST,"")}function PT(t){if(t.length<50)return t;let e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function uo(t){return di(t)?t.url:pi(t)?t.name||"":typeof t=="string"?t:""}function Cl(t){if(di(t)){let e=t,r=e.headers.get("content-type")||"",i=Ta(e.url);return CT(r)||km(i)}return pi(t)?t.type||"":typeof t=="string"?km(t):""}function RT(t){return di(t)?t.headers["content-length"]||-1:pi(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function gh(t){if(di(t))return t;let e={},r=RT(t);r>=0&&(e["content-length"]=String(r));let i=uo(t),n=Cl(t);n&&(e["content-type"]=n);let s=await QL(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));let o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function IT(t){if(!t.ok)throw await YL(t)}async function YL(t){let e=PT(t.url),r=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;r=r.length>100?`${r.slice(0,100)}...`:r;let i={reason:t.statusText,url:t.url,response:t};try{let n=t.headers.get("Content-Type");i.reason=!t.bodyUsed&&n?.includes("application/json")?await t.json():await t.text()}catch{}return new ph(r,i)}async function QL(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){let r=t.slice(0,5);return await new Promise(i=>{let n=new FileReader;n.onload=s=>i(s?.target?.result),n.readAsDataURL(r)})}if(t instanceof ArrayBuffer){let r=t.slice(0,5);return`data:base64,${qL(r)}`}return null}function qL(t){let e="",r=new Uint8Array(t);for(let i=0;i<r.byteLength;i++)e+=String.fromCharCode(r[i]);return btoa(e)}function KL(t){return!JL(t)&&!ZL(t)}function JL(t){return t.startsWith("http:")||t.startsWith("https:")}function ZL(t){return t.startsWith("data:")}async function Um(t,e){if(typeof t=="string"){let r=Fm(t);return KL(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,e):await fetch(r,e)}return await gh(t)}var Vm=new Yr({id:"loaders.gl"}),mh=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},_h=class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}};var zm={fetch:null,mimeType:void 0,nothrow:!1,log:new _h,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ln,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},BT={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Hm(){globalThis.loaders=globalThis.loaders||{};let{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function Gm(){let t=Hm();return t.globalOptions=t.globalOptions||{...zm},t.globalOptions}function LT(t,e,r,i){return r=r||[],r=Array.isArray(r)?r:[r],$L(t,r),tN(e,t,i)}function $L(t,e){OT(t,null,zm,BT,e);for(let r of e){let i=t&&t[r.id]||{},n=r.options&&r.options[r.id]||{},s=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};OT(i,r.id,n,s,e)}}function OT(t,e,r,i,n){let s=e||"Top level",o=e?`${e}.`:"";for(let a in t){let A=!e&&Ao(t[a]),h=a==="baseUri"&&!e,g=a==="workerUrl"&&e;if(!(a in r)&&!h&&!g){if(a in i)Vm.warn(`${s} loader option '${o}${a}' no longer supported, use '${i[a]}'`)();else if(!A){let _=eN(a,n);Vm.warn(`${s} loader option '${o}${a}' not recognized. ${_}`)()}}}}function eN(t,e){let r=t.toLowerCase(),i="";for(let n of e)for(let s in n.options){if(t===s)return`Did you mean '${n.id}.${s}'?`;let o=s.toLowerCase();(r.startsWith(o)||o.startsWith(r))&&(i=i||`Did you mean '${n.id}.${s}'?`)}return i}function tN(t,e,r){let n={...t.options||{}};return rN(n,r),n.log===null&&(n.log=new mh),FT(n,Gm()),FT(n,e),n}function FT(t,e){for(let r in e)if(r in e){let i=e[r];Nm(i)&&Nm(t[r])?t[r]={...t[r],...e[r]}:t[r]=e[r]}}function rN(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Sl(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t?.extensions)):!1}function Ml(t){Ze(t,"null loader"),Ze(Sl(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t?.parseTextSync||t?.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}var NT=()=>{let t=Hm();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Wm(t){let e=NT();t=Array.isArray(t)?t:[t];for(let r of t){let i=Ml(r);e.find(n=>i===n)||e.unshift(i)}}function DT(){return NT()}var iN=/\.([^.]+)$/;async function VT(t,e=[],r,i){if(!zT(t))return null;let n=kT(t,e,{...r,nothrow:!0},i);if(n)return n;if(pi(t)&&(t=await t.slice(0,10).arrayBuffer(),n=kT(t,e,r,i)),!n&&!r?.nothrow)throw new Error(HT(t));return n}function kT(t,e=[],r,i){if(!zT(t))return null;if(e&&!Array.isArray(e))return Ml(e);let n=[];e&&(n=n.concat(e)),r?.ignoreRegisteredLoaders||n.push(...DT()),sN(n);let s=nN(t,n,r,i);if(!s&&!r?.nothrow)throw new Error(HT(t));return s}function nN(t,e,r,i){let n=uo(t),s=Cl(t),o=Ta(n)||i?.url,a=null,A="";return r?.mimeType&&(a=jm(e,r?.mimeType),A=`match forced by supplied MIME type ${r?.mimeType}`),a=a||oN(e,o),A=A||(a?`matched url ${o}`:""),a=a||jm(e,s),A=A||(a?`matched MIME type ${s}`:""),a=a||cN(e,t),A=A||(a?`matched initial data ${GT(t)}`:""),r?.fallbackMimeType&&(a=a||jm(e,r?.fallbackMimeType),A=A||(a?`matched fallback MIME type ${s}`:"")),A&&gl.log(1,`selectLoader selected ${a?.name}: ${A}.`),a}function zT(t){return!(t instanceof Response&&t.status===204)}function HT(t){let e=uo(t),r=Cl(t),i="No valid loader found (";i+=e?`${ni.filename(e)}, `:"no url provided, ",i+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let n=t?GT(t):"";return i+=n?` first bytes: "${n}"`:"first bytes: not available",i+=")",i}function sN(t){for(let e of t)Ml(e)}function oN(t,e){let r=e&&iN.exec(e),i=r&&r[1];return i?aN(t,i):null}function aN(t,e){e=e.toLowerCase();for(let r of t)for(let i of r.extensions)if(i.toLowerCase()===e)return r;return null}function jm(t,e){for(let r of t)if(r.mimeTypes?.some(i=>Dm(e,i))||Dm(e,`application/x.${r.id}`))return r;return null}function cN(t,e){if(!e)return null;for(let r of t)if(typeof e=="string"){if(lN(e,r))return r}else if(ArrayBuffer.isView(e)){if(UT(e.buffer,e.byteOffset,r))return r}else if(e instanceof ArrayBuffer&&UT(e,0,r))return r;return null}function lN(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>t.startsWith(i))}function UT(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(n=>AN(t,e,r,n))}function AN(t,e,r,i){if(i instanceof ArrayBuffer)return Rm(i,t,i.byteLength);switch(typeof i){case"function":return i(t);case"string":let n=Xm(t,e,i.length);return i===n;default:return!1}}function GT(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Xm(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Xm(t,0,e):""}function Xm(t,e,r){if(t.byteLength<e+r)return"";let i=new DataView(t),n="";for(let s=0;s<r;s++)n+=String.fromCharCode(i.getUint8(e+s));return n}function*WT(t,e){let r=e?.chunkSize||262144,i=0,n=new TextEncoder;for(;i<t.length;){let s=Math.min(t.length-i,r),o=t.slice(i,i+s);i+=s,yield n.encode(o)}}function*jT(t,e={}){let{chunkSize:r=262144}=e,i=0;for(;i<t.byteLength;){let n=Math.min(t.byteLength-i,r),s=new ArrayBuffer(n),o=new Uint8Array(t,i,n);new Uint8Array(s).set(o),i+=n,yield s}}async function*XT(t,e){let r=e?.chunkSize||1048576,i=0;for(;i<t.size;){let n=i+r,s=await t.slice(i,n).arrayBuffer();i=n,yield s}}function Ym(t,e){return Ln?uN(t,e):fN(t,e)}async function*uN(t,e){let r=t.getReader(),i;try{for(;;){let n=i||r.read();e?._streamReadAhead&&(i=r.read());let{done:s,value:o}=await n;if(s)return;yield fh(o)}}catch{r.releaseLock()}}async function*fN(t,e){for await(let r of t)yield fh(r)}function YT(t,e){if(typeof t=="string")return WT(t,e);if(t instanceof ArrayBuffer)return jT(t,e);if(pi(t))return XT(t,e);if(dh(t))return Ym(t,e);if(di(t))return Ym(t.body,e);throw new Error("makeIterator")}var QT="Cannot convert supplied data type";function hN(t,e,r){if(e.text&&typeof t=="string")return t;if(wT(t)&&(t=t.buffer),t instanceof ArrayBuffer){let i=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let i=t.buffer,n=t.byteLength||t.length;return(t.byteOffset!==0||n!==i.byteLength)&&(i=i.slice(t.byteOffset,t.byteOffset+n)),i}throw new Error(QT)}async function qT(t,e,r){let i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||i)return hN(t,e,r);if(pi(t)&&(t=await gh(t)),di(t)){let n=t;return await IT(n),e.binary?await n.arrayBuffer():await n.text()}if(dh(t)&&(t=YT(t,r)),ET(t)||vT(t))return Om(t);throw new Error(QT)}function yh(t,e){let r=Gm(),i=t||r;return typeof i.fetch=="function"?i.fetch:Ao(i.fetch)?n=>Um(n,i.fetch):e?.fetch?e?.fetch:Um}function KT(t,e,r){if(r)return r;let i={fetch:yh(e,t),...t};if(i.url){let n=Ta(i.url);i.baseUrl=n,i.queryString=MT(i.url),i.filename=ni.filename(n),i.baseUrl=ni.dirname(n)}return Array.isArray(i.loaders)||(i.loaders=null),i}function JT(t,e){if(t&&!Array.isArray(t))return t;let r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){let i=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[...r,...i]:i}return r&&r.length?r:void 0}async function Pl(t,e,r,i){e&&!Array.isArray(e)&&!Sl(e)&&(i=void 0,r=e,e=void 0),t=await t,r=r||{};let n=uo(t),o=JT(e,i),a=await VT(t,o,r);return a?(r=LT(r,a,o,n),i=KT({url:n,_parse:Pl,loaders:o},r,i||null),await dN(a,t,r,i)):null}async function dN(t,e,r,i){if(wm(t),r=ml(t.options,r),di(e)){let s=e,{ok:o,redirected:a,status:A,statusText:h,type:g,url:_}=s,b=Object.fromEntries(s.headers.entries());i.response={headers:b,ok:o,redirected:a,status:A,statusText:h,type:g,url:_}}e=await qT(e,t,r);let n=t;if(n.parseTextSync&&typeof e=="string")return n.parseTextSync(e,r,i);if(Sm(t,r))return await Mm(t,e,r,i,Pl);if(n.parseText&&typeof e=="string")return await n.parseText(e,r,i);if(n.parse)return await n.parse(e,r,i);throw xr(!n.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}function ZT(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Nn(t){let e=1/0,r=1/0,i=1/0,n=-1/0,s=-1/0,o=-1/0,a=t.POSITION?t.POSITION.value:[],A=a&&a.length;for(let h=0;h<A;h+=3){let g=a[h],_=a[h+1],b=a[h+2];e=g<e?g:e,r=_<r?_:r,i=b<i?b:i,n=g>n?g:n,s=_>s?_:s,o=b>o?b:o}return[[e,r,i],[n,s,o]]}function Qm(t,e,r){let i=ZT(e.value),n=r||$T(e);return{name:t,type:{type:"fixed-size-list",listSize:e.size,children:[{name:"value",type:i}]},nullable:!1,metadata:n}}function $T(t){let e={};return"byteOffset"in t&&(e.byteOffset=t.byteOffset.toString(10)),"byteStride"in t&&(e.byteStride=t.byteStride.toString(10)),"normalized"in t&&(e.normalized=t.normalized.toString()),e}async function dr(t,e,r,i){let n,s;!Array.isArray(e)&&!Sl(e)?(n=[],s=e,i=void 0):(n=e,s=r);let o=yh(s),a=t;return typeof t=="string"&&(a=await o(t)),pi(t)&&(a=await o(t)),Array.isArray(n)?await Pl(a,n,s):await Pl(a,n,s)}var eE="4.3.2";var pN=globalThis.loaders?.parseImageNode,qm=typeof Image<"u",Km=typeof ImageBitmap<"u",gN=!!pN,Jm=Ln?!0:gN;function tE(t){switch(t){case"auto":return Km||qm||Jm;case"imagebitmap":return Km;case"image":return qm;case"data":return Jm;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function rE(){if(Km)return"imagebitmap";if(qm)return"image";if(Jm)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function iE(t){let e=mN(t);if(!e)throw new Error("Not an image");return e}function Rl(t){switch(iE(t)){case"data":return t;case"image":case"imagebitmap":let e=document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("getImageData");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function mN(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}var _N=/^data:image\/svg\+xml/,yN=/\.svg((\?|#).*)?$/;function xh(t){return t&&(_N.test(t)||yN.test(t))}function nE(t,e){if(xh(e)){let i=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return Zm(t,e)}function Zm(t,e){if(xh(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function bh(t,e,r){let i=nE(t,r),n=self.URL||self.webkitURL,s=typeof i!="string"&&n.createObjectURL(i);try{return await xN(s||i,e)}finally{s&&n.revokeObjectURL(s)}}async function xN(t,e){let r=new Image;return r.src=t,e.image&&e.image.decode&&r.decode?(await r.decode(),r):await new Promise((i,n)=>{try{r.onload=()=>i(r),r.onerror=s=>{let o=s instanceof Error?s.message:"error";n(new Error(o))}}catch(s){n(s)}})}var bN={},sE=!0;async function oE(t,e,r){let i;xh(r)?i=await bh(t,e,r):i=Zm(t,r);let n=e&&e.imagebitmap;return await TN(i,n)}async function TN(t,e=null){if((EN(e)||!sE)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(r){console.warn(r),sE=!1}return await createImageBitmap(t)}function EN(t){for(let e in t||bN)return!1;return!0}function aE(t){return!SN(t,"ftyp",4)||!(t[8]&96)?null:vN(t)}function vN(t){switch(wN(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function wN(t,e,r){return String.fromCharCode(...t.slice(e,r))}function CN(t){return[...t].map(e=>e.charCodeAt(0))}function SN(t,e,r=0){let i=CN(e);for(let n=0;n<i.length;++n)if(i[n]!==t[n+r])return!1;return!0}var nn=!1,Il=!0;function fo(t){let e=Bl(t);return PN(e)||BN(e)||RN(e)||IN(e)||MN(e)}function MN(t){let e=new Uint8Array(t instanceof DataView?t.buffer:t),r=aE(e);return r?{mimeType:r.mimeType,width:0,height:0}:null}function PN(t){let e=Bl(t);return e.byteLength>=24&&e.getUint32(0,nn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,nn),height:e.getUint32(20,nn)}:null}function RN(t){let e=Bl(t);return e.byteLength>=10&&e.getUint32(0,nn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Il),height:e.getUint16(8,Il)}:null}function IN(t){let e=Bl(t);return e.byteLength>=14&&e.getUint16(0,nn)===16973&&e.getUint32(2,Il)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Il),height:e.getUint32(22,Il)}:null}function BN(t){let e=Bl(t);if(!(e.byteLength>=3&&e.getUint16(0,nn)===65496&&e.getUint8(2)===255))return null;let{tableMarkers:i,sofMarkers:n}=ON(),s=2;for(;s+9<e.byteLength;){let o=e.getUint16(s,nn);if(n.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,nn),width:e.getUint16(s+7,nn)};if(!i.has(o))return null;s+=2,s+=e.getUint16(s,nn)}return null}function ON(){let t=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)t.add(r);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Bl(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function cE(t,e){let{mimeType:r}=fo(t)||{},i=globalThis.loaders?.parseImageNode;return Ze(i),await i(t,r)}async function lE(t,e,r){e=e||{};let n=(e.image||{}).type||"auto",{url:s}=r||{},o=FN(n),a;switch(o){case"imagebitmap":a=await oE(t,e,s);break;case"image":a=await bh(t,e,s);break;case"data":a=await cE(t,e);break;default:Ze(!1)}return n==="data"&&(a=Rl(a)),a}function FN(t){switch(t){case"auto":case"data":return rE();default:return tE(t),t}}var LN=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],NN=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],DN={image:{type:"auto",decode:!0}},ps={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:eE,mimeTypes:NN,extensions:LN,parse:lE,tests:[t=>!!fo(new DataView(t))],options:DN};var $m={};function e1(t){if($m[t]===void 0){let e=Ln?UN(t):kN(t);$m[t]=e}return $m[t]}function kN(t){let e=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||e;return!!globalThis.loaders?.parseImageNode&&r.includes(t)}function UN(t){switch(t){case"image/avif":case"image/webp":return VN(t);default:return!0}}function VN(t){try{return document.createElement("canvas").toDataURL(t).indexOf(`data:${t}`)===0}catch{return!1}}var zN=new Yr({id:"deck"}),me=zN;var t1={};function AE(t){t1=t}function Wt(t,e,r,i){me.level>0&&t1[t]&&t1[t].call(null,e,r,i)}function HN(t){let e=t[0],r=t[t.length-1];return e==="{"&&r==="}"||e==="["&&r==="]"}var uE={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:HN,parseTextSync:JSON.parse};function GN(){let t="9.1.0",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(me.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:me,_registerLoggers:AE},Wm([uE,[ps,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}var fE=GN();function Th(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}var r1={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function dE(t){let e={};for(let[r,i]of Object.entries(t))e[r]=WN(i);return e}function WN(t){let e=hE(t);if(e!=="object")return{value:t,...r1[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...r1[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=hE(t.value),{...t,...r1[e],type:e}):{type:"object",value:null};throw new Error("props")}function hE(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}var pE=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,gE=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`;var jN={vertex:pE,fragment:gE},mE=/void\s+main\s*\([^)]*\)\s*\{\n?/,_E=/}\n?[^{}]*$/,i1=[],Ol="__LUMA_INJECT_DECLARATIONS__";function yE(t){let e={vertex:{},fragment:{}};for(let r in t){let i=t[r],n=XN(r);typeof i=="string"&&(i={order:0,injection:i}),e[n][r]=i}return e}function XN(t){let e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Fl(t,e,r,i=!1){let n=e==="vertex";for(let s in r){let o=r[s];o.sort((A,h)=>A.order-h.order),i1.length=o.length;for(let A=0,h=o.length;A<h;++A)i1[A]=o[A].injection;let a=`${i1.join(`
`)}
`;switch(s){case"vs:#decl":n&&(t=t.replace(Ol,a));break;case"vs:#main-start":n&&(t=t.replace(mE,A=>A+a));break;case"vs:#main-end":n&&(t=t.replace(_E,A=>a+A));break;case"fs:#decl":n||(t=t.replace(Ol,a));break;case"fs:#main-start":n||(t=t.replace(mE,A=>A+a));break;case"fs:#main-end":n||(t=t.replace(_E,A=>a+A));break;default:t=t.replace(s,A=>A+a)}}return t=t.replace(Ol,""),i&&(t=t.replace(/\}\s*$/,s=>s+jN[e])),t}function Ea(t){t.map(e=>YN(e))}function YN(t){if(t.instance)return;Ea(t.dependencies||[]);let{propTypes:e={},deprecations:r=[],inject:i={}}=t,n={normalizedInjections:yE(i),parsedDeprecations:QN(r)};e&&(n.propValidators=dE(e)),t.instance=n;let s={};e&&(s=Object.entries(e).reduce((o,[a,A])=>{let h=A?.value;return h&&(o[a]=h),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function n1(t,e,r){t.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?r.deprecated(i.old,i.new)():r.removed(i.old,i.new)())})}function QN(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function va(t){Ea(t);let e={},r={};xE({modules:t,level:0,moduleMap:e,moduleDepth:r});let i=Object.keys(r).sort((n,s)=>r[s]-r[n]).map(n=>e[n]);return Ea(i),i}function xE(t){let{modules:e,level:r,moduleMap:i,moduleDepth:n}=t;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let s of e)i[s.name]=s,(n[s.name]===void 0||n[s.name]<r)&&(n[s.name]=r);for(let s of e)s.dependencies&&xE({modules:s.dependencies,level:r+1,moduleMap:i,moduleDepth:n})}function bE(t){switch(t?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function EE(t,e){if(Number(t.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=TE(t,qN),t;case"fragment":return t=TE(t,KN),t;default:throw new Error(e)}}var vE=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],qN=[...vE,[s1("attribute"),"in $1"],[s1("varying"),"out $1"]],KN=[...vE,[s1("varying"),"in $1"]];function TE(t,e){for(let[r,i]of e)t=t.replace(r,i);return t}function s1(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function o1(t,e){let r="";for(let i in t){let n=t[i];if(r+=`void ${n.signature} {
`,n.header&&(r+=`  ${n.header}`),e[i]){let s=e[i];s.sort((o,a)=>o.order-a.order);for(let o of s)r+=`  ${o.injection}
`}n.footer&&(r+=`  ${n.footer}`),r+=`}
`}return r}function a1(t){let e={vertex:{},fragment:{}};for(let r of t){let i,n;typeof r!="string"?(i=r,n=i.hook):(i={},n=r),n=n.trim();let[s,o]=n.split(":"),a=n.replace(/\(.+/,""),A=Object.assign(i,{signature:o});switch(s){case"vs":e.vertex[a]=A;break;case"fs":e.fragment[a]=A;break;default:throw new Error(s)}}return e}function wE(t,e){return{name:JN(t,e),language:"glsl",version:ZN(t)}}function JN(t,e="unnamed"){let i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return i?i[1]:e}function ZN(t){let e=100,r=t.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let i=parseInt(r[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}var SE=`

${Ol}
`,$N=`precision highp float;
`;function ME(t){let e=va(t.modules||[]);return{source:eD(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:RE(e)}}function PE(t){let{vs:e,fs:r}=t,i=va(t.modules||[]);return{vs:CE(t.platformInfo,{...t,source:e,stage:"vertex",modules:i}),fs:CE(t.platformInfo,{...t,source:r,stage:"fragment",modules:i}),getUniforms:RE(i)}}function eD(t,e){let{source:r,stage:i,modules:n,hookFunctions:s=[],inject:o={},log:a}=e;Th(typeof r=="string","shader source must be a string");let A=r,h="",g=a1(s),_={},b={},T={};for(let C in o){let S=typeof o[C]=="string"?{injection:o[C],order:0}:o[C],P=/^(v|f)s:(#)?([\w-]+)$/.exec(C);if(P){let F=P[2],I=P[3];F?I==="decl"?b[C]=[S]:T[C]=[S]:_[C]=[S]}else T[C]=[S]}let v=n;for(let C of v){a&&n1(C,A,a);let S=IE(C,"wgsl");h+=S;let P=C.injections?.[i]||{};for(let F in P){let I=/^(v|f)s:#([\w-]+)$/.exec(F);if(I){let W=I[2]==="decl"?b:T;W[F]=W[F]||[],W[F].push(P[F])}else _[F]=_[F]||[],_[F].push(P[F])}}return h+=SE,h=Fl(h,i,b),h+=o1(g[i],_),h+=A,h=Fl(h,i,T),h}function CE(t,e){let{id:r,source:i,stage:n,language:s="glsl",modules:o,defines:a={},hookFunctions:A=[],inject:h={},prologue:g=!0,log:_}=e;Th(typeof i=="string","shader source must be a string");let b=s==="glsl"?wE(i).version:-1,T=t.shaderLanguageVersion,v=b===100?"#version 100":"#version 300 es",S=i.split(`
`).slice(1).join(`
`),P={};o.forEach(re=>{Object.assign(P,re.defines)}),Object.assign(P,a);let F="";switch(s){case"wgsl":break;case"glsl":F=g?`${v}

// ----- PROLOGUE -------------------------
${tD({id:r,source:i,stage:n})}
${`#define SHADER_TYPE_${n.toUpperCase()}`}

${bE(t)}
${n==="fragment"?$N:""}

// ----- APPLICATION DEFINES -------------------------

${rD(P)}

`:`${v}
`;break}let I=a1(A),k={},W={},K={};for(let re in h){let Y=typeof h[re]=="string"?{injection:h[re],order:0}:h[re],z=/^(v|f)s:(#)?([\w-]+)$/.exec(re);if(z){let L=z[2],se=z[3];L?se==="decl"?W[re]=[Y]:K[re]=[Y]:k[re]=[Y]}else K[re]=[Y]}for(let re of o){_&&n1(re,S,_);let Y=IE(re,n);F+=Y;let z=re.instance?.normalizedInjections[n]||{};for(let L in z){let se=/^(v|f)s:#([\w-]+)$/.exec(L);if(se){let ce=se[2]==="decl"?W:K;ce[L]=ce[L]||[],ce[L].push(z[L])}else k[L]=k[L]||[],k[L].push(z[L])}}return F+="// ----- MAIN SHADER SOURCE -------------------------",F+=SE,F=Fl(F,n,W),F+=o1(I[n],k),F+=S,F=Fl(F,n,K),s==="glsl"&&b!==T&&(F=EE(F,n)),F.trim()}function RE(t){return function(r){let i={};for(let n of t){let s=n.getUniforms?.(r,i);Object.assign(i,s)}return i}}function tD(t){let{id:e,source:r,stage:i}=t;return e&&r.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function rD(t={}){let e="";for(let r in t){let i=t[r];(i||Number.isFinite(i))&&(e+=`#define ${r.toUpperCase()} ${t[r]}
`)}return e}function IE(t,e){let r;switch(e){case"vertex":r=t.vs||"";break;case"fragment":r=t.fs||"";break;case"wgsl":r=t.source||"";break;default:Th(!1)}if(!t.name)throw new Error("Shader module must have a name");let i=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),n=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(n+=`#define MODULE_${i}
`),n+=`${r}
`,n}var iD=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,nD=/^\s*\#\s*endif\s*$/;function BE(t,e){let r=t.split(`
`),i=[],n=!0,s=null;for(let o of r){let a=o.match(iD),A=o.match(nD);a?(s=a[1],n=!!e?.defines?.[s]):A?n=!0:n&&i.push(o)}return i.join(`
`)}var ho=class t{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return t.defaultShaderAssembler=t.defaultShaderAssembler||new t,t.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(r=>r.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let r=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==r)}addShaderHook(e,r){r&&(e=Object.assign(r,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){let r=this._getModuleList(e.modules),i=this._hookFunctions,{source:n,getUniforms:s}=ME({...e,source:e.source,modules:r,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?BE(n):n,getUniforms:s,modules:r}}assembleGLSLShaderPair(e){let r=this._getModuleList(e.modules),i=this._hookFunctions;return{...PE({...e,vs:e.vs,fs:e.fs,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){let r=new Array(this._defaultModules.length+e.length),i={},n=0;for(let s=0,o=this._defaultModules.length;s<o;++s){let a=this._defaultModules[s],A=a.name;r[n++]=a,i[A]=!0}for(let s=0,o=e.length;s<o;++s){let a=e[s],A=a.name;i[A]||(r[n++]=a,i[A]=!0)}return r.length=n,Ea(r),r}};var sD=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,oD=`#version 300 es
${sD}`;function Ll(t){let{input:e,inputChannels:r,output:i}=t||{};if(!e)return oD;if(!r)throw new Error("inputChannels");let n=aD(r),s=OE(e,r);return`#version 300 es
in ${n} ${e};
out vec4 ${i};
void main() {
  ${i} = ${s};
}`}function aD(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function OE(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}var c1=class{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Sr({id:e})),this.stats.get(e)}},Eh=new c1;var oe=new Yr({id:"luma.gl"});var l1={};function gs(t="id"){l1[t]=l1[t]||1;let e=l1[t]++;return`${t}-${e}`}var He=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,r,i){if(!e)throw new Error("no device");this._device=e,this.props=cD(r,i);let n=this.props.id!=="undefined"?this.props.id:gs(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(let e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(e,r=this[Symbol.toStringTag]){let i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${r} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let e=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${r}s Created`).incrementCount(),e.get(`${r}s Active`).incrementCount()}};function cD(t,e){let r={...e};for(let i in t)t[i]!==void 0&&(r[i]=t[i]);return r}var ct=class t extends He{static defaultProps={...He.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,r){let i={...r};(r.usage||0)&t.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,t.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,r){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,r,i){let n=ArrayBuffer.isView(e)?e.buffer:e,s=Math.min(e?e.byteLength:i,t.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(s):r===0&&i===n.byteLength?this.debugData=n.slice(0,s):this.debugData=n.slice(r,r+s)}};function vh(t){let e=FE[t],r=lD(e),i=t.includes("norm"),n=!i&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:FE[t],byteLength:r,integer:n,signed:s,normalized:i}}function lD(t){return AD[t]}var FE={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},AD={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var Mr="texture-compression-bc",St="texture-compression-astc",sn="texture-compression-etc2",uD="texture-compression-etc1-webgl",wh="texture-compression-pvrtc-webgl",A1="texture-compression-atc-webgl",Ch="float32-renderable-webgl",u1="float16-renderable-webgl",fD="rgb9e5ufloat-renderable-webgl",f1="snorm8-renderable-webgl",Nl="norm16-renderable-webgl",h1="snorm16-renderable-webgl",Sh="float32-filterable",LE="float16-filterable-webgl";function Mh(t){let e=hD[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}var hD={r8unorm:{},r8snorm:{render:f1},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:f1},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:u1,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Nl},"r16snorm-webgl":{f:h1},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:f1},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:u1,filter:LE},"rg16unorm-webgl":{render:Nl},"rg16snorm-webgl":{render:h1},r32uint:{},r32sint:{},r32float:{render:Ch,filter:Sh},rgb9e5ufloat:{channels:"rgb",packed:!0,render:fD},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Ch},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Nl},"rgb16snorm-webgl":{f:Nl},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Sh},rgba16uint:{},rgba16sint:{},rgba16float:{render:u1,filter:LE},"rgba16unorm-webgl":{render:Nl},"rgba16snorm-webgl":{render:h1},"rgb32float-webgl":{render:Ch,filter:Sh},rgba32uint:{},rgba32sint:{},rgba32float:{render:Ch,filter:Sh},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Mr},"bc1-rgb-unorm-srgb-webgl":{f:Mr},"bc1-rgba-unorm":{f:Mr},"bc1-rgba-unorm-srgb":{f:Mr},"bc2-rgba-unorm":{f:Mr},"bc2-rgba-unorm-srgb":{f:Mr},"bc3-rgba-unorm":{f:Mr},"bc3-rgba-unorm-srgb":{f:Mr},"bc4-r-unorm":{f:Mr},"bc4-r-snorm":{f:Mr},"bc5-rg-unorm":{f:Mr},"bc5-rg-snorm":{f:Mr},"bc6h-rgb-ufloat":{f:Mr},"bc6h-rgb-float":{f:Mr},"bc7-rgba-unorm":{f:Mr},"bc7-rgba-unorm-srgb":{f:Mr},"etc2-rgb8unorm":{f:sn},"etc2-rgb8unorm-srgb":{f:sn},"etc2-rgb8a1unorm":{f:sn},"etc2-rgb8a1unorm-srgb":{f:sn},"etc2-rgba8unorm":{f:sn},"etc2-rgba8unorm-srgb":{f:sn},"eac-r11unorm":{f:sn},"eac-r11snorm":{f:sn},"eac-rg11unorm":{f:sn},"eac-rg11snorm":{f:sn},"astc-4x4-unorm":{f:St},"astc-4x4-unorm-srgb":{f:St},"astc-5x4-unorm":{f:St},"astc-5x4-unorm-srgb":{f:St},"astc-5x5-unorm":{f:St},"astc-5x5-unorm-srgb":{f:St},"astc-6x5-unorm":{f:St},"astc-6x5-unorm-srgb":{f:St},"astc-6x6-unorm":{f:St},"astc-6x6-unorm-srgb":{f:St},"astc-8x5-unorm":{f:St},"astc-8x5-unorm-srgb":{f:St},"astc-8x6-unorm":{f:St},"astc-8x6-unorm-srgb":{f:St},"astc-8x8-unorm":{f:St},"astc-8x8-unorm-srgb":{f:St},"astc-10x5-unorm":{f:St},"astc-10x5-unorm-srgb":{f:St},"astc-10x6-unorm":{f:St},"astc-10x6-unorm-srgb":{f:St},"astc-10x8-unorm":{f:St},"astc-10x8-unorm-srgb":{f:St},"astc-10x10-unorm":{f:St},"astc-10x10-unorm-srgb":{f:St},"astc-12x10-unorm":{f:St},"astc-12x10-unorm-srgb":{f:St},"astc-12x12-unorm":{f:St},"astc-12x12-unorm-srgb":{f:St},"pvrtc-rgb4unorm-webgl":{f:wh},"pvrtc-rgba4unorm-webgl":{f:wh},"pvrtc-rbg2unorm-webgl":{f:wh},"pvrtc-rgba2unorm-webgl":{f:wh},"etc1-rbg-unorm-webgl":{f:uD},"atc-rgb-unorm-webgl":{f:A1},"atc-rgba-unorm-webgl":{f:A1},"atc-rgbai-unorm-webgl":{f:A1}};var dD=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],pD=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function d1(t){return dD.some(e=>t.startsWith(e))}function wa(t){let e=gD(t);if(d1(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;let i=mD(t);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}let r=pD.exec(t);if(r){let[,i,n,s,o,a]=r,A=`${s}${n}`,h=vh(A),g=h.byteLength*8,_=i.length,b=[g,_>=2?g:0,_>=3?g:0,_>=4?g:0];e={format:t,attachment:e.attachment,dataType:h.dataType,components:_,channels:i,integer:h.integer,signed:h.signed,normalized:h.normalized,bitsPerChannel:b,bytesPerPixel:h.byteLength*i.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function gD(t){let e=Mh(t),r=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:r,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function mD(t){let r=/.*-(\d+)x(\d+)-.*/.exec(t);if(r){let[,i,n]=r;return{blockWidth:Number(i),blockHeight:Number(n)}}return null}function NE(t){let e=Mh(t),r={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=wa(t),n=t.startsWith("depth")||t.startsWith("stencil"),s=i?.signed,o=i?.integer,a=i?.webgl;return r.render&&=!s,r.filter&&=!n&&!s&&!o&&!a,r}var Dl=class{},kl=class{features;disabledFeatures;constructor(e=[],r){this.features=new Set(e),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}},Ii=class t{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>oe.error(e.message)(),_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:oe.get("debug")||void 0,debugShaders:oe.get("debug-shaders")||void 0,debugFramebuffers:!!oe.get("debug-framebuffers"),debugWebGL:!!oe.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...t.defaultProps,...e},this.id=this.props.id||gs(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=Eh;timestamp=0;_lumaData={};getTextureFormatCapabilities(e){let r=NE(e),i=o=>(typeof o=="string"?this.features.has(o):o)??!0,n=i(r.create),s={format:e,create:n,render:n&&i(r.render),filter:n&&i(r.filter),blend:n&&i(r.blend),store:n&&i(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,r){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return d1(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,r){throw new Error("not implemented")}readPixelsToBufferWebGL(e,r){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,r){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let r={...e};return(e.usage||0)&ct.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array?r.indexType="uint16":oe.warn("indices buffer content must be of integer type")()),r}};var _D=kr()&&typeof document<"u",yD=()=>_D&&document.readyState==="complete",xD="set luma.log.level=1 (or higher) to trace rendering",DE="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",p1=class t{static defaultProps={...Ii.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=bD().then(()=>{oe.probe(2,"DOM is loaded")()});stats=Eh;log=oe;VERSION="9.1.0";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw oe.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),oe.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");oe.error("This version of luma.gl has already been initialized")()}oe.log(1,`${this.VERSION} - ${xD}`)(),globalThis.luma=this}registerAdapters(e){for(let r of e)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(e=[]){let r=this.getAdapterMap(e);return Array.from(r).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){let r=this.getAdapterMap(e);return r.get("webgpu")?.isSupported?.()?"webgpu":r.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(t.defaultProps,e)}async createDevice(e={}){e={...t.defaultProps,...e},e.waitForPageLoad&&await t.pageLoaded;let r=this.getAdapterMap(e.adapters),i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);let o=await(this.getAdapterMap(e.adapters)||r).get(i)?.create?.(e);if(o)return o;throw new Error(DE)}async attachDevice(e){let r=this.getAdapterMap(e.adapters),i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await t.pageLoaded,e.handle===null&&(i="unknown");let s=await r.get(i)?.attach?.(null);if(s)return s;throw new Error(DE)}enforceWebGL2(e=!0,r=[]){let n=this.getAdapterMap(r).get("webgl");n||oe.warn("enforceWebGL2: webgl adapter not found")(),n?.enforceWebGL2?.(e)}getAdapterMap(e=[]){let r=new Map(this.preregisteredAdapters);for(let i of e)r.set(i.type,i);return r}registerDevices(e){oe.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(let r of e){let i=r.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}},Ca=new p1;function bD(){return yD()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}var Ul=class{};var Vl=class t{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...t.defaultProps,...e},e=this.props,!kr()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=ED(e.canvas):this.canvas=e.canvas;else{let r=vD(e),i=TD(e?.container||null);i.insertBefore(r,i.firstChild),this.canvas=r,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(let i of r)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let e=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*e,r.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[e,r]=this.getPixelSize();return e/r}cssToDeviceRatio(){try{let[e]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?e/r:1}catch{return 1}}cssToDevicePixels(e,r=!0){let i=this.cssToDeviceRatio(),[n,s]=this.getDrawingBufferSize();return wD(e,i,n,s,r)}setDevicePixelRatio(e,r={}){if(!this.htmlCanvas)return;let i="width"in r?r.width:this.htmlCanvas.clientWidth,n="height"in r?r.height:this.htmlCanvas.clientHeight;(!i||!n)&&(oe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,n=this.htmlCanvas.height||1);let s=this._canvasSizeInfo;if(s.clientWidth!==i||s.clientHeight!==n||s.devicePixelRatio!==e){let o=e,a=Math.floor(i*o),A=Math.floor(n*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=A,this.device.gl){let[g,_]=this.getDrawingBufferSize();(g!==a||_!==A)&&(o=Math.min(g/i,_/n),this.htmlCanvas.width=Math.floor(i*o),this.htmlCanvas.height=Math.floor(n*o),oe.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=n,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){let e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};function TD(t){if(typeof t=="string"){let e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function ED(t){let e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function vD(t){let{width:e,height:r}=t,i=document.createElement("canvas");return i.id=gs("lumagl-auto-created-canvas"),i.width=e||1,i.height=r||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",i}function wD(t,e,r,i,n){let s=t,o=kE(s[0],e,r),a=UE(s[1],e,i,n),A=kE(s[0]+1,e,r),h=A===r-1?A:A-1;A=UE(s[1]+1,e,i,n);let g;return n?(A=A===0?A:A+1,g=a,a=A):g=A===i-1?A:A-1,{x:o,y:a,width:Math.max(h-o+1,1),height:Math.max(g-a+1,1)}}function kE(t,e,r){return Math.min(Math.round(t*e),r-1)}function UE(t,e,r,i){return i?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}var _t=class t extends He{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...He.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,r){if(r=t.normalizeProps(e,r),super(e,r,t.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){let i=t.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?t.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){let r=e?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return t.getTextureDataSize(e[0]);if(t.isExternalImage(e))return t.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){let i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,r){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:r.width,height:r.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,r){return Math.floor(Math.log2(Math.max(e,r)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,r){let i={...r},n=e?.props?._resourceDefaults?.texture||{};Object.assign(i,n);let{width:s,height:o}=i;return typeof s=="number"&&(i.width=Math.max(1,Math.ceil(s))),typeof o=="number"&&(i.height=Math.max(1,Math.ceil(o))),i}};var po=class t extends He{static defaultProps={...He.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,r){super(e,r,t.defaultProps)}};function zE(t,e,r){let i="",n=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let o=0;for(let a=1;a<=n.length;a++)for(i+=HE(n[a-1],a,r);s.length>o&&s[o].lineNum===a;){let A=s[o++];i+=VE(A,n,A.lineNum,{...r,inlineSource:!1})}return i;case"issues":case"no":for(let a of t)i+=VE(a,n,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return i}}function VE(t,e,r,i){if(i?.inlineSource){let s=CD(e,r),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}let n=t.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${n};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function CD(t,e,r){let i="";for(let n=e-2;n<=e;n++){let s=t[n-1];s!==void 0&&(i+=HE(s,e,r))}return i}function HE(t,e,r){let i=r?.html?MD(t):t;return`${SD(String(e),4)}: ${i}${r?.html?"<br/>":`
`}`}function SD(t,e){let r="";for(let i=t.length;i<e;++i)r+=" ";return r+t}function MD(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var go=class t extends He{static defaultProps={...He.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,r){r={...r,debugShaders:r.debugShaders||e.props.debugShaders||"errors"},super(e,{id:PD(r),...r},t.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();e==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;let r=GE(this.source),i=`${this.stage} ${r}`,n=zE(e,this.source,{showSourceCode:"all",html:!0}),s=this.getTranslatedSource();s&&(n+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);let o=document.createElement("Button");o.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${n}
</pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{let A=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(A)}}};function PD(t){return GE(t.source)||t.id||gs(`unnamed ${t.stage}-shader`)}function GE(t,e="unnamed"){let i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return i?i[1]:e}var mo=class t extends He{static defaultProps={...He.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,r){r=t.normalizeProps(e,r),super(e,r,t.defaultProps)}static normalizeProps(e,r){let i=e?.props?._resourceDefaults?.sampler||{};return{...r,...i}}};var _o=class t extends He{static defaultProps={...He.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,r={}){super(e,r,t.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){let r=this.colorAttachments.map(n=>n.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(e){let r=!e;if(e){let[i,n]=Array.isArray(e)?e:[e.width,e.height];r=r||n!==this.height||i!==this.width,this.width=i,this.height=n}r&&(oe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){let n=this.createColorTexture(r,i);return this.attachResource(n),n.view}return r instanceof _t?r.view:r});let e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){let r=this.createDepthStencilTexture(e);this.attachResource(r),this.depthStencilAttachment=r.view}else e instanceof _t?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:_t.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:_t.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){let n=this.colorAttachments[i].texture.clone({width:e,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){let i=this.depthStencilAttachment.texture.clone({width:e,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};var on=class t extends He{static defaultProps={...He.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,r){super(e,r,t.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}};var zl=class t extends He{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...He.defaultProps,framebuffer:null,parameters:void 0,clearColor:t.defaultClearColor,clearColors:void 0,clearDepth:t.defaultClearDepth,clearStencil:t.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,r){r=t.normalizeProps(e,r),super(e,r,t.defaultProps)}static normalizeProps(e,r){return{...e.props._resourceDefaults?.renderPass,...r}}};var Sa=class t extends He{static defaultProps={...He.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,r){super(e,r,t.defaultProps),this.shaderLayout=r.shaderLayout}};var Hl=class t extends He{static defaultProps={...He.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,r){super(e,r,t.defaultProps)}};var Gl=class t extends He{static defaultProps={...He.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,r){super(e,r,t.defaultProps)}};function WE(t){let[e,r]=ID[t],i=e==="i32"||e==="u32",n=e!=="u32",s=BD[e]*r,o=RD(e,r);return{dataType:e,components:r,defaultVertexFormat:o,byteLength:s,integer:i,signed:n}}function RD(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?r:`${r}x${e}`}var ID={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},BD={f32:4,f16:2,i32:4,u32:4};function g1(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);let[r,i]=t.split("x"),n=r,s=i?parseInt(i):1,o=vh(n),a={type:n,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function Ph(t,e){let r={};for(let i of t.attributes){let n=OD(t,e,i.name);n&&(r[i.name]=n)}return r}function jE(t,e,r=16){let i=Ph(t,e),n=new Array(r).fill(null);for(let s of Object.values(i))n[s.location]=s;return n}function OD(t,e,r){let i=FD(t,r),n=LD(e,r);if(!i)return null;let s=WE(i.type),o=n?.vertexFormat||s.defaultVertexFormat,a=g1(o);return{attributeName:n?.attributeName||i.name,bufferName:n?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:n?.stepMode||i.stepMode||"vertex",byteOffset:n?.byteOffset||0,byteStride:n?.byteStride||0}}function FD(t,e){let r=t.attributes.find(i=>i.name===e);return r||oe.warn(`shader layout attribute "${e}" not present in shader`),r||null}function LD(t,e){ND(t);let r=DD(t,e);return r||(r=kD(t,e),r)?r:(oe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function ND(t){for(let e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&oe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function DD(t,e){for(let r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function kD(t,e){for(let r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(let s of r.attributes||[]){let o=g1(s.format);i+=o.byteLength}let n=r.attributes?.find(s=>s.attribute===e);if(n)return{attributeName:n.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:i}}return null}var Wl=class t extends He{static defaultProps={...He.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,r){super(e,r,t.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);let{shaderLayout:i,bufferLayout:n}=r.renderPipeline||{};if(!i||!n)throw new Error("VertexArray");this.attributeInfos=jE(i,n,this.maxVertexAttributes)}setConstantWebGL(e,r){throw new Error("constant attributes not supported")}};var jl=class t extends He{static defaultProps={...He.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,r){super(e,r,t.defaultProps)}};var Xl=class t extends He{static defaultProps={...He.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,r){super(e,r,t.defaultProps)}};var UD={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function XE(t){return UD[t]}function YE(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}var Rh;function m1(t){return(!Rh||Rh.byteLength<t)&&(Rh=new ArrayBuffer(t)),Rh}function _1(t,e){let r=m1(t.BYTES_PER_ELEMENT*e);return new t(r,0,e)}function VD(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ma(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":VD(t)}var QE=1024,Ih=class{layout={};byteLength;constructor(e){let r=0;for(let[n,s]of Object.entries(e)){let o=XE(s),{type:a,components:A}=o;r=YE(r,A);let h=r;r+=A,this.layout[n]={type:a,size:A,offset:h}}r+=(4-r%4)%4;let i=r*4;this.byteLength=Math.max(i,QE)}getData(e){let r=Math.max(this.byteLength,QE),i=m1(r),n={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(let[s,o]of Object.entries(e)){let a=this.layout[s];if(!a){oe.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}let{type:A,size:h,offset:g}=a,_=n[A];if(h===1){if(typeof o!="number"&&typeof o!="boolean"){oe.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}_[g]=Number(o)}else{if(!Ma(o)){oe.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}_.set(o,g)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}};function qE(t,e,r=16){if(t!==e)return!1;let i=t,n=e;if(!Ma(i))return!1;if(Ma(n)&&i.length===n.length){for(let s=0;s<i.length;++s)if(n[s]!==i[s])return!1}return!0}function KE(t){return Ma(t)?t.slice():t}var Bh=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){let r=e?.shaderLayout.bindings?.find(n=>n.type==="uniform"&&n.name===e?.name);if(!r)throw new Error(e?.name);let i=r;for(let n of i.uniforms||[])this.bindingLayout[n.name]=n}}setUniforms(e){for(let[r,i]of Object.entries(e))this._setUniform(r,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,r){qE(this.uniforms[e],r)||(this.uniforms[e]=KE(r),this.modifiedUniforms[e]=!0,this.modified=!0)}};var Yl=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(let[r,i]of Object.entries(e)){let n=r,s=new Ih(i.uniformTypes||{});this.uniformBufferLayouts.set(n,s);let o=new Bh({name:r});o.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(n,o)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[r,i]of Object.entries(e))this.uniformBlocks.get(r)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let r=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(r)}createUniformBuffer(e,r,i){i&&this.setUniforms(i);let n=this.getUniformBufferByteLength(r),s=e.createBuffer({usage:ct.UNIFORM|ct.COPY_DST,byteLength:n}),o=this.getUniformBufferData(r);return s.write(o),s}getManagedUniformBuffer(e,r){if(!this.uniformBuffers.get(r)){let i=this.getUniformBufferByteLength(r),n=e.createBuffer({usage:ct.UNIFORM|ct.COPY_DST,byteLength:i});this.uniformBuffers.set(r,n)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let e=!1;for(let r of this.uniformBlocks.keys()){let i=this.updateUniformBuffer(r);e||=i}return e&&oe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let r=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e),n=!1;if(i&&r?.needsRedraw){n||=r.needsRedraw;let s=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(s);let o=this.uniformBlocks.get(e)?.getAllUniforms();oe.log(4,`Writing to uniform buffer ${String(e)}`,s,o)()}return n}};function Oh(t){let e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Ql(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function y1(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);let i=e,n=Oh(t);if(n==="uint8"&&r&&i===1)return"unorm8-webgl";if(n==="uint8"&&r&&i===3)return"unorm8x3-webgl";if(n==="uint8"||n==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}if(n==="uint16"||n==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return r&&(n=n.replace("int","norm")),`${n}x${i}`}return i===1?n:`${n}x${i}`}var yo=class{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(r=>r.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,r){let i=[...e];for(let n of r){let s=i.findIndex(o=>o.name===n.name);s<0?i.push(n):i[s]=n}return i}};var x1=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},Bi=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,r){if(e){r(Ba.instance);for(let i of e)i instanceof Array?this.searchBlock(i,r):i.search(r);r(Oa.instance)}}},Ba=class extends Bi{};Ba.instance=new Ba;var Oa=class extends Bi{};Oa.instance=new Oa;var Lt=class extends Bi{constructor(){super()}},Kl=class extends Lt{constructor(e,r,i,n,s,o){super(),this.calls=new Set,this.name=e,this.args=r,this.returnType=i,this.body=n,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}},b1=class extends Lt{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}},T1=class extends Lt{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},E1=class extends Lt{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}},v1=class extends Lt{constructor(e,r,i,n){super(),this.init=e,this.condition=r,this.increment=i,this.body=n}get astNodeType(){return"for"}search(e){var r,i,n;(r=this.init)===null||r===void 0||r.search(e),(i=this.condition)===null||i===void 0||i.search(e),(n=this.increment)===null||n===void 0||n.search(e),this.searchBlock(this.body,e)}},kn=class extends Lt{constructor(e,r,i,n,s){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"var"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},Fh=class extends Lt{constructor(e,r,i){super(),this.name=e,this.type=r,this.value=i}get astNodeType(){return"override"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}},Jl=class extends Lt{constructor(e,r,i,n,s){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"let"}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},Lh=class extends Lt{constructor(e,r,i,n,s){super(),this.name=e,this.type=r,this.storage=i,this.access=n,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var r;e(this),(r=this.value)===null||r===void 0||r.search(e)}},Fa;(function(t){t.increment="++",t.decrement="--"})(Fa||(Fa={}));(function(t){function e(r){let i=r;if(i=="parse")throw new Error("Invalid value for IncrementOperator");return t[i]}t.parse=e})(Fa||(Fa={}));var w1=class extends Lt{constructor(e,r){super(),this.operator=e,this.variable=r}get astNodeType(){return"increment"}search(e){this.variable.search(e)}},Zl;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Zl||(Zl={}));(function(t){function e(r){let i=r;if(i=="parse")throw new Error("Invalid value for AssignOperator");return i}t.parse=e})(Zl||(Zl={}));var C1=class extends Lt{constructor(e,r,i){super(),this.operator=e,this.variable=r,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}},Nh=class extends Lt{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"call"}search(e){for(let r of this.args)r.search(e);e(this)}},S1=class extends Lt{constructor(e,r){super(),this.body=e,this.continuing=r}get astNodeType(){return"loop"}},M1=class extends Lt{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"body"}},P1=class extends Lt{constructor(e,r,i,n){super(),this.condition=e,this.body=r,this.elseif=i,this.else=n}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}},R1=class extends Lt{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var r;(r=this.value)===null||r===void 0||r.search(e)}},I1=class extends Lt{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}},B1=class extends Lt{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}},O1=class extends Lt{constructor(e,r){super(),this.severity=e,this.rule=r}get astNodeType(){return"diagnostic"}},Dh=class extends Lt{constructor(e,r){super(),this.name=e,this.type=r}get astNodeType(){return"alias"}},F1=class extends Lt{constructor(){super()}get astNodeType(){return"discard"}},L1=class extends Lt{constructor(){super()}get astNodeType(){return"break"}},N1=class extends Lt{constructor(){super()}get astNodeType(){return"continue"}},Un=class extends Lt{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}},Dn=class extends Un{constructor(e,r,i,n){super(e),this.members=r,this.startLine=i,this.endLine=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let r=0;r<this.members.length;r++)if(this.members[r].name==e)return r;return-1}},kh=class extends Un{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"template"}},D1=class extends Un{constructor(e,r,i,n){super(e),this.storage=r,this.type=i,this.access=n}get astNodeType(){return"pointer"}},Uh=class extends Un{constructor(e,r,i,n){super(e),this.attributes=r,this.format=i,this.count=n}get astNodeType(){return"array"}get isArray(){return!0}},xo=class extends Un{constructor(e,r,i){super(e),this.format=r,this.access=i}get astNodeType(){return"sampler"}},mi=class extends Bi{constructor(){super()}},k1=class extends mi{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}},_s=class extends mi{constructor(e,r){super(),this.type=e,this.args=r}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let r of this.args)r.search(e)}evaluate(e){return this.args[0].evaluate(e)}},Vh=class extends mi{constructor(e,r){super(),this.name=e,this.args=r}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(let r of this.args)r.search(e);e(this)}},$l=class extends mi{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){let r=e.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(e)}},zh=class extends mi{constructor(e,r){super(),this.name=e,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(e){var r,i;if(this.initializer instanceof _s){let n=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(e),s=(i=this.initializer.type)===null||i===void 0?void 0:i.name,o=e.structs.get(s),a=o?.getMemberIndex(n);return a!==void 0&&a!=-1?this.initializer.args[a].evaluate(e):this.initializer.evaluate(e)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}},Hh=class extends mi{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}},U1=class extends mi{constructor(e,r){super(),this.type=e,this.value=r}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}};var Gh=class extends mi{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}},V1=class extends mi{constructor(e){super(),this.index=e}search(e){this.index.search(e)}},Wh=class extends mi{constructor(){super()}},z1=class extends Wh{constructor(e,r){super(),this.operator=e,this.right=r}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}},gi=class extends Wh{constructor(e,r,i){super(),this.operator=e,this.left=r,this.right=i}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}},jh=class extends Bi{constructor(){super()}},H1=class extends jh{constructor(e,r){super(),this.selector=e,this.body=r}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}},G1=class extends jh{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}},W1=class extends Bi{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"argument"}},j1=class extends Bi{constructor(e,r){super(),this.condition=e,this.body=r}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}},X1=class extends Bi{constructor(e,r,i){super(),this.name=e,this.type=r,this.attributes=i}get astNodeType(){return"member"}},Y1=class extends Bi{constructor(e,r){super(),this.name=e,this.value=r}get astNodeType(){return"attribute"}},J,X;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(X||(X={}));var j=class{constructor(e,r,i){this.name=e,this.type=r,this.rule=i}toString(){return this.name}},N=class{};J=N;N.none=new j("",X.reserved,"");N.eof=new j("EOF",X.token,"");N.reserved={asm:new j("asm",X.reserved,"asm"),bf16:new j("bf16",X.reserved,"bf16"),do:new j("do",X.reserved,"do"),enum:new j("enum",X.reserved,"enum"),f16:new j("f16",X.reserved,"f16"),f64:new j("f64",X.reserved,"f64"),handle:new j("handle",X.reserved,"handle"),i8:new j("i8",X.reserved,"i8"),i16:new j("i16",X.reserved,"i16"),i64:new j("i64",X.reserved,"i64"),mat:new j("mat",X.reserved,"mat"),premerge:new j("premerge",X.reserved,"premerge"),regardless:new j("regardless",X.reserved,"regardless"),typedef:new j("typedef",X.reserved,"typedef"),u8:new j("u8",X.reserved,"u8"),u16:new j("u16",X.reserved,"u16"),u64:new j("u64",X.reserved,"u64"),unless:new j("unless",X.reserved,"unless"),using:new j("using",X.reserved,"using"),vec:new j("vec",X.reserved,"vec"),void:new j("void",X.reserved,"void")};N.keywords={array:new j("array",X.keyword,"array"),atomic:new j("atomic",X.keyword,"atomic"),bool:new j("bool",X.keyword,"bool"),f32:new j("f32",X.keyword,"f32"),i32:new j("i32",X.keyword,"i32"),mat2x2:new j("mat2x2",X.keyword,"mat2x2"),mat2x3:new j("mat2x3",X.keyword,"mat2x3"),mat2x4:new j("mat2x4",X.keyword,"mat2x4"),mat3x2:new j("mat3x2",X.keyword,"mat3x2"),mat3x3:new j("mat3x3",X.keyword,"mat3x3"),mat3x4:new j("mat3x4",X.keyword,"mat3x4"),mat4x2:new j("mat4x2",X.keyword,"mat4x2"),mat4x3:new j("mat4x3",X.keyword,"mat4x3"),mat4x4:new j("mat4x4",X.keyword,"mat4x4"),ptr:new j("ptr",X.keyword,"ptr"),sampler:new j("sampler",X.keyword,"sampler"),sampler_comparison:new j("sampler_comparison",X.keyword,"sampler_comparison"),struct:new j("struct",X.keyword,"struct"),texture_1d:new j("texture_1d",X.keyword,"texture_1d"),texture_2d:new j("texture_2d",X.keyword,"texture_2d"),texture_2d_array:new j("texture_2d_array",X.keyword,"texture_2d_array"),texture_3d:new j("texture_3d",X.keyword,"texture_3d"),texture_cube:new j("texture_cube",X.keyword,"texture_cube"),texture_cube_array:new j("texture_cube_array",X.keyword,"texture_cube_array"),texture_multisampled_2d:new j("texture_multisampled_2d",X.keyword,"texture_multisampled_2d"),texture_storage_1d:new j("texture_storage_1d",X.keyword,"texture_storage_1d"),texture_storage_2d:new j("texture_storage_2d",X.keyword,"texture_storage_2d"),texture_storage_2d_array:new j("texture_storage_2d_array",X.keyword,"texture_storage_2d_array"),texture_storage_3d:new j("texture_storage_3d",X.keyword,"texture_storage_3d"),texture_depth_2d:new j("texture_depth_2d",X.keyword,"texture_depth_2d"),texture_depth_2d_array:new j("texture_depth_2d_array",X.keyword,"texture_depth_2d_array"),texture_depth_cube:new j("texture_depth_cube",X.keyword,"texture_depth_cube"),texture_depth_cube_array:new j("texture_depth_cube_array",X.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new j("texture_depth_multisampled_2d",X.keyword,"texture_depth_multisampled_2d"),texture_external:new j("texture_external",X.keyword,"texture_external"),u32:new j("u32",X.keyword,"u32"),vec2:new j("vec2",X.keyword,"vec2"),vec3:new j("vec3",X.keyword,"vec3"),vec4:new j("vec4",X.keyword,"vec4"),bitcast:new j("bitcast",X.keyword,"bitcast"),block:new j("block",X.keyword,"block"),break:new j("break",X.keyword,"break"),case:new j("case",X.keyword,"case"),continue:new j("continue",X.keyword,"continue"),continuing:new j("continuing",X.keyword,"continuing"),default:new j("default",X.keyword,"default"),diagnostic:new j("diagnostic",X.keyword,"diagnostic"),discard:new j("discard",X.keyword,"discard"),else:new j("else",X.keyword,"else"),enable:new j("enable",X.keyword,"enable"),fallthrough:new j("fallthrough",X.keyword,"fallthrough"),false:new j("false",X.keyword,"false"),fn:new j("fn",X.keyword,"fn"),for:new j("for",X.keyword,"for"),function:new j("function",X.keyword,"function"),if:new j("if",X.keyword,"if"),let:new j("let",X.keyword,"let"),const:new j("const",X.keyword,"const"),loop:new j("loop",X.keyword,"loop"),while:new j("while",X.keyword,"while"),private:new j("private",X.keyword,"private"),read:new j("read",X.keyword,"read"),read_write:new j("read_write",X.keyword,"read_write"),return:new j("return",X.keyword,"return"),requires:new j("requires",X.keyword,"requires"),storage:new j("storage",X.keyword,"storage"),switch:new j("switch",X.keyword,"switch"),true:new j("true",X.keyword,"true"),alias:new j("alias",X.keyword,"alias"),type:new j("type",X.keyword,"type"),uniform:new j("uniform",X.keyword,"uniform"),var:new j("var",X.keyword,"var"),override:new j("override",X.keyword,"override"),workgroup:new j("workgroup",X.keyword,"workgroup"),write:new j("write",X.keyword,"write"),r8unorm:new j("r8unorm",X.keyword,"r8unorm"),r8snorm:new j("r8snorm",X.keyword,"r8snorm"),r8uint:new j("r8uint",X.keyword,"r8uint"),r8sint:new j("r8sint",X.keyword,"r8sint"),r16uint:new j("r16uint",X.keyword,"r16uint"),r16sint:new j("r16sint",X.keyword,"r16sint"),r16float:new j("r16float",X.keyword,"r16float"),rg8unorm:new j("rg8unorm",X.keyword,"rg8unorm"),rg8snorm:new j("rg8snorm",X.keyword,"rg8snorm"),rg8uint:new j("rg8uint",X.keyword,"rg8uint"),rg8sint:new j("rg8sint",X.keyword,"rg8sint"),r32uint:new j("r32uint",X.keyword,"r32uint"),r32sint:new j("r32sint",X.keyword,"r32sint"),r32float:new j("r32float",X.keyword,"r32float"),rg16uint:new j("rg16uint",X.keyword,"rg16uint"),rg16sint:new j("rg16sint",X.keyword,"rg16sint"),rg16float:new j("rg16float",X.keyword,"rg16float"),rgba8unorm:new j("rgba8unorm",X.keyword,"rgba8unorm"),rgba8unorm_srgb:new j("rgba8unorm_srgb",X.keyword,"rgba8unorm_srgb"),rgba8snorm:new j("rgba8snorm",X.keyword,"rgba8snorm"),rgba8uint:new j("rgba8uint",X.keyword,"rgba8uint"),rgba8sint:new j("rgba8sint",X.keyword,"rgba8sint"),bgra8unorm:new j("bgra8unorm",X.keyword,"bgra8unorm"),bgra8unorm_srgb:new j("bgra8unorm_srgb",X.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new j("rgb10a2unorm",X.keyword,"rgb10a2unorm"),rg11b10float:new j("rg11b10float",X.keyword,"rg11b10float"),rg32uint:new j("rg32uint",X.keyword,"rg32uint"),rg32sint:new j("rg32sint",X.keyword,"rg32sint"),rg32float:new j("rg32float",X.keyword,"rg32float"),rgba16uint:new j("rgba16uint",X.keyword,"rgba16uint"),rgba16sint:new j("rgba16sint",X.keyword,"rgba16sint"),rgba16float:new j("rgba16float",X.keyword,"rgba16float"),rgba32uint:new j("rgba32uint",X.keyword,"rgba32uint"),rgba32sint:new j("rgba32sint",X.keyword,"rgba32sint"),rgba32float:new j("rgba32float",X.keyword,"rgba32float"),static_assert:new j("static_assert",X.keyword,"static_assert")};N.tokens={decimal_float_literal:new j("decimal_float_literal",X.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new j("hex_float_literal",X.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new j("int_literal",X.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new j("uint_literal",X.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new j("ident",X.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new j("and",X.token,"&"),and_and:new j("and_and",X.token,"&&"),arrow:new j("arrow ",X.token,"->"),attr:new j("attr",X.token,"@"),forward_slash:new j("forward_slash",X.token,"/"),bang:new j("bang",X.token,"!"),bracket_left:new j("bracket_left",X.token,"["),bracket_right:new j("bracket_right",X.token,"]"),brace_left:new j("brace_left",X.token,"{"),brace_right:new j("brace_right",X.token,"}"),colon:new j("colon",X.token,":"),comma:new j("comma",X.token,","),equal:new j("equal",X.token,"="),equal_equal:new j("equal_equal",X.token,"=="),not_equal:new j("not_equal",X.token,"!="),greater_than:new j("greater_than",X.token,">"),greater_than_equal:new j("greater_than_equal",X.token,">="),shift_right:new j("shift_right",X.token,">>"),less_than:new j("less_than",X.token,"<"),less_than_equal:new j("less_than_equal",X.token,"<="),shift_left:new j("shift_left",X.token,"<<"),modulo:new j("modulo",X.token,"%"),minus:new j("minus",X.token,"-"),minus_minus:new j("minus_minus",X.token,"--"),period:new j("period",X.token,"."),plus:new j("plus",X.token,"+"),plus_plus:new j("plus_plus",X.token,"++"),or:new j("or",X.token,"|"),or_or:new j("or_or",X.token,"||"),paren_left:new j("paren_left",X.token,"("),paren_right:new j("paren_right",X.token,")"),semicolon:new j("semicolon",X.token,";"),star:new j("star",X.token,"*"),tilde:new j("tilde",X.token,"~"),underscore:new j("underscore",X.token,"_"),xor:new j("xor",X.token,"^"),plus_equal:new j("plus_equal",X.token,"+="),minus_equal:new j("minus_equal",X.token,"-="),times_equal:new j("times_equal",X.token,"*="),division_equal:new j("division_equal",X.token,"/="),modulo_equal:new j("modulo_equal",X.token,"%="),and_equal:new j("and_equal",X.token,"&="),or_equal:new j("or_equal",X.token,"|="),xor_equal:new j("xor_equal",X.token,"^="),shift_right_equal:new j("shift_right_equal",X.token,">>="),shift_left_equal:new j("shift_left_equal",X.token,"<<=")};N.simpleTokens={"@":J.tokens.attr,"{":J.tokens.brace_left,"}":J.tokens.brace_right,":":J.tokens.colon,",":J.tokens.comma,"(":J.tokens.paren_left,")":J.tokens.paren_right,";":J.tokens.semicolon};N.literalTokens={"&":J.tokens.and,"&&":J.tokens.and_and,"->":J.tokens.arrow,"/":J.tokens.forward_slash,"!":J.tokens.bang,"[":J.tokens.bracket_left,"]":J.tokens.bracket_right,"=":J.tokens.equal,"==":J.tokens.equal_equal,"!=":J.tokens.not_equal,">":J.tokens.greater_than,">=":J.tokens.greater_than_equal,">>":J.tokens.shift_right,"<":J.tokens.less_than,"<=":J.tokens.less_than_equal,"<<":J.tokens.shift_left,"%":J.tokens.modulo,"-":J.tokens.minus,"--":J.tokens.minus_minus,".":J.tokens.period,"+":J.tokens.plus,"++":J.tokens.plus_plus,"|":J.tokens.or,"||":J.tokens.or_or,"*":J.tokens.star,"~":J.tokens.tilde,_:J.tokens.underscore,"^":J.tokens.xor,"+=":J.tokens.plus_equal,"-=":J.tokens.minus_equal,"*=":J.tokens.times_equal,"/=":J.tokens.division_equal,"%=":J.tokens.modulo_equal,"&=":J.tokens.and_equal,"|=":J.tokens.or_equal,"^=":J.tokens.xor_equal,">>=":J.tokens.shift_right_equal,"<<=":J.tokens.shift_left_equal};N.regexTokens={decimal_float_literal:J.tokens.decimal_float_literal,hex_float_literal:J.tokens.hex_float_literal,int_literal:J.tokens.int_literal,uint_literal:J.tokens.uint_literal,ident:J.tokens.ident};N.storage_class=[J.keywords.function,J.keywords.private,J.keywords.workgroup,J.keywords.uniform,J.keywords.storage];N.access_mode=[J.keywords.read,J.keywords.write,J.keywords.read_write];N.sampler_type=[J.keywords.sampler,J.keywords.sampler_comparison];N.sampled_texture_type=[J.keywords.texture_1d,J.keywords.texture_2d,J.keywords.texture_2d_array,J.keywords.texture_3d,J.keywords.texture_cube,J.keywords.texture_cube_array];N.multisampled_texture_type=[J.keywords.texture_multisampled_2d];N.storage_texture_type=[J.keywords.texture_storage_1d,J.keywords.texture_storage_2d,J.keywords.texture_storage_2d_array,J.keywords.texture_storage_3d];N.depth_texture_type=[J.keywords.texture_depth_2d,J.keywords.texture_depth_2d_array,J.keywords.texture_depth_cube,J.keywords.texture_depth_cube_array,J.keywords.texture_depth_multisampled_2d];N.texture_external_type=[J.keywords.texture_external];N.any_texture_type=[...J.sampled_texture_type,...J.multisampled_texture_type,...J.storage_texture_type,...J.depth_texture_type,...J.texture_external_type];N.texel_format=[J.keywords.r8unorm,J.keywords.r8snorm,J.keywords.r8uint,J.keywords.r8sint,J.keywords.r16uint,J.keywords.r16sint,J.keywords.r16float,J.keywords.rg8unorm,J.keywords.rg8snorm,J.keywords.rg8uint,J.keywords.rg8sint,J.keywords.r32uint,J.keywords.r32sint,J.keywords.r32float,J.keywords.rg16uint,J.keywords.rg16sint,J.keywords.rg16float,J.keywords.rgba8unorm,J.keywords.rgba8unorm_srgb,J.keywords.rgba8snorm,J.keywords.rgba8uint,J.keywords.rgba8sint,J.keywords.bgra8unorm,J.keywords.bgra8unorm_srgb,J.keywords.rgb10a2unorm,J.keywords.rg11b10float,J.keywords.rg32uint,J.keywords.rg32sint,J.keywords.rg32float,J.keywords.rgba16uint,J.keywords.rgba16sint,J.keywords.rgba16float,J.keywords.rgba32uint,J.keywords.rgba32sint,J.keywords.rgba32float];N.const_literal=[J.tokens.int_literal,J.tokens.uint_literal,J.tokens.decimal_float_literal,J.tokens.hex_float_literal,J.keywords.true,J.keywords.false];N.literal_or_ident=[J.tokens.ident,J.tokens.int_literal,J.tokens.uint_literal,J.tokens.decimal_float_literal,J.tokens.hex_float_literal];N.element_count_expression=[J.tokens.int_literal,J.tokens.uint_literal,J.tokens.ident];N.template_types=[J.keywords.vec2,J.keywords.vec3,J.keywords.vec4,J.keywords.mat2x2,J.keywords.mat2x3,J.keywords.mat2x4,J.keywords.mat3x2,J.keywords.mat3x3,J.keywords.mat3x4,J.keywords.mat4x2,J.keywords.mat4x3,J.keywords.mat4x4,J.keywords.atomic,J.keywords.bitcast,...J.any_texture_type];N.attribute_name=[J.tokens.ident,J.keywords.block,J.keywords.diagnostic];N.assignment_operators=[J.tokens.equal,J.tokens.plus_equal,J.tokens.minus_equal,J.tokens.times_equal,J.tokens.division_equal,J.tokens.modulo_equal,J.tokens.and_equal,J.tokens.or_equal,J.tokens.xor_equal,J.tokens.shift_right_equal,J.tokens.shift_left_equal];N.increment_operators=[J.tokens.plus_plus,J.tokens.minus_minus];var Xh=class{constructor(e,r,i){this.type=e,this.lexeme=r,this.line=i}toString(){return this.lexeme}isTemplateType(){return N.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==N.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},Q1=class{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Xh(N.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}let r=N.simpleTokens[e];if(r)return this._addToken(r),!0;let i=N.none,n=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(n){let o=N.keywords[e];if(o)return this._addToken(o),!0}if(n||s)return this._addToken(N.tokens.ident),!0;for(;;){let o=this._findType(e),a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(N.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(N.tokens.minus_minus),!0;let A=this._tokens.length-1;if((N.literal_or_ident.indexOf(this._tokens[A].type)!=-1||this._tokens[A].type==N.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let A=!1,h=this._tokens.length-1;for(let g=0;g<5&&h>=0&&N.assignment_operators.indexOf(this._tokens[h].type)===-1;++g,--h)if(this._tokens[h].type===N.tokens.less_than){h>0&&this._tokens[h-1].isArrayOrTemplateType()&&(A=!0);break}if(A)return this._addToken(o),!0}if(o===N.none){let A=e,h=0,g=2;for(let _=0;_<g;++_)if(A+=this._peekAhead(_),o=this._findType(A),o!==N.none){h=_;break}if(o===N.none)return i===N.none?!1:(this._current--,this._addToken(i),!0);e=A,this._current+=h+1}if(i=o,this._isAtEnd())break;e+=this._advance()}return i===N.none?!1:(this._addToken(i),!0)}_findType(e){for(let i in N.regexTokens){let n=N.regexTokens[i];if(this._match(e,n.rule))return n}let r=N.literalTokens[e];return r||N.none}_match(e,r){let i=r.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let r=this._source[this._current];return e=e||0,e++,this._current+=e,r}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let r=this._source.substring(this._start,this._current);this._tokens.push(new Xh(e,r,this._line))}},q1=class{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new x1,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let r=[];for(;!this._isAtEnd();){let i=this._global_decl_or_directive();if(!i)break;r.push(i)}if(this._deferArrayCountEval.length>0){for(let i of this._deferArrayCountEval){let n=i.arrayType,s=i.countNode;if(s instanceof $l){let a=s.name,A=this._context.constants.get(a);if(A)try{let h=A.evaluate(this._context);n.count=h}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(e){if(e)if(typeof e=="string"){let r=new Q1(e);this._tokens=r.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,r){return{token:e,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==N.eof}_match(e){if(e instanceof j)return this._check(e)?(this._advance(),!0):!1;for(let r=0,i=e.length;r<i;++r){let n=e[r];if(this._check(n))return this._advance(),!0}return!1}_consume(e,r){if(this._check(e))return this._advance();throw this._error(this._peek(),r)}_check(e){if(this._isAtEnd())return!1;let r=this._peek();if(e instanceof Array){let i=r.type;return e.indexOf(i)!=-1}return r.type==e}_advance(){var e,r;return this._currentLine=(r=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(N.tokens.semicolon)&&!this._isAtEnd(););if(this._match(N.keywords.alias)){let r=this._type_alias();return this._consume(N.tokens.semicolon,"Expected ';'"),r}if(this._match(N.keywords.diagnostic)){let r=this._diagnostic();return this._consume(N.tokens.semicolon,"Expected ';'"),r}if(this._match(N.keywords.requires)){let r=this._requires_directive();return this._consume(N.tokens.semicolon,"Expected ';'"),r}if(this._match(N.keywords.enable)){let r=this._enable_directive();return this._consume(N.tokens.semicolon,"Expected ';'"),r}let e=this._attribute();if(this._check(N.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=e),this._consume(N.tokens.semicolon,"Expected ';'."),r}if(this._check(N.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=e),this._consume(N.tokens.semicolon,"Expected ';'."),r}if(this._check(N.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=e),this._consume(N.tokens.semicolon,"Expected ';'."),r}if(this._check(N.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=e),this._consume(N.tokens.semicolon,"Expected ';'."),r}if(this._check(N.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=e),r}if(this._check(N.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=e),r}return null}_function_decl(){if(!this._match(N.keywords.fn))return null;let e=this._currentLine,r=this._consume(N.tokens.ident,"Expected function name.").toString();this._consume(N.tokens.paren_left,"Expected '(' for function arguments.");let i=[];if(!this._check(N.tokens.paren_right))do{if(this._check(N.tokens.paren_right))break;let a=this._attribute(),A=this._consume(N.tokens.ident,"Expected argument name.").toString();this._consume(N.tokens.colon,"Expected ':' for argument type.");let h=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=h,i.push(new W1(A,g,a)))}while(this._match(N.tokens.comma));this._consume(N.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(N.tokens.arrow)){let a=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=a)}let s=this._compound_statement(),o=this._currentLine;return new Kl(r,i,n,s,e,o)}_compound_statement(){let e=[];for(this._consume(N.tokens.brace_left,"Expected '{' for block.");!this._check(N.tokens.brace_right);){let r=this._statement();r!==null&&e.push(r)}return this._consume(N.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(N.tokens.semicolon)&&!this._isAtEnd(););if(this._check(N.tokens.attr)&&this._attribute(),this._check(N.keywords.if))return this._if_statement();if(this._check(N.keywords.switch))return this._switch_statement();if(this._check(N.keywords.loop))return this._loop_statement();if(this._check(N.keywords.for))return this._for_statement();if(this._check(N.keywords.while))return this._while_statement();if(this._check(N.keywords.continuing))return this._continuing_statement();if(this._check(N.keywords.static_assert))return this._static_assert_statement();if(this._check(N.tokens.brace_left))return this._compound_statement();let e=null;return this._check(N.keywords.return)?e=this._return_statement():this._check([N.keywords.var,N.keywords.let,N.keywords.const])?e=this._variable_statement():this._match(N.keywords.discard)?e=new F1:this._match(N.keywords.break)?e=new L1:this._match(N.keywords.continue)?e=new N1:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(N.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(N.keywords.static_assert))return null;let e=this._optional_paren_expression();return new b1(e)}_while_statement(){if(!this._match(N.keywords.while))return null;let e=this._optional_paren_expression();this._check(N.tokens.attr)&&this._attribute();let r=this._compound_statement();return new T1(e,r)}_continuing_statement(){if(!this._match(N.keywords.continuing))return null;let e=this._compound_statement();return new E1(e)}_for_statement(){if(!this._match(N.keywords.for))return null;this._consume(N.tokens.paren_left,"Expected '('.");let e=this._check(N.tokens.semicolon)?null:this._for_init();this._consume(N.tokens.semicolon,"Expected ';'.");let r=this._check(N.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(N.tokens.semicolon,"Expected ';'.");let i=this._check(N.tokens.paren_right)?null:this._for_increment();this._consume(N.tokens.paren_right,"Expected ')'."),this._check(N.tokens.attr)&&this._attribute();let n=this._compound_statement();return new v1(e,r,i,n)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(N.keywords.var)){let e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(N.tokens.equal)&&(r=this._short_circuit_or_expression()),new kn(e.name,e.type,e.storage,e.access,r)}if(this._match(N.keywords.let)){let e=this._consume(N.tokens.ident,"Expected name for let.").toString(),r=null;if(this._match(N.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}this._consume(N.tokens.equal,"Expected '=' for let.");let i=this._short_circuit_or_expression();return new Jl(e,r,null,null,i)}if(this._match(N.keywords.const)){let e=this._consume(N.tokens.ident,"Expected name for const.").toString(),r=null;if(this._match(N.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}this._consume(N.tokens.equal,"Expected '=' for const.");let i=this._short_circuit_or_expression();return new Lh(e,r,null,null,i)}return null}_increment_decrement_statement(){let e=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(N.increment_operators))return this._current=e,null;let i=this._consume(N.increment_operators,"Expected increment operator");return new w1(i.type===N.tokens.plus_plus?Fa.increment:Fa.decrement,r)}_assignment_statement(){let e=null;if(this._check(N.tokens.brace_right))return null;let r=this._match(N.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;let i=this._consume(N.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return new C1(Zl.parse(i.lexeme),e,n)}_func_call_statement(){if(!this._check(N.tokens.ident))return null;let e=this._current,r=this._consume(N.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=e,null):new Nh(r.lexeme,i)}_loop_statement(){if(!this._match(N.keywords.loop))return null;this._check(N.tokens.attr)&&this._attribute(),this._consume(N.tokens.brace_left,"Expected '{' for loop.");let e=[],r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let n of r)e.push(n);else e.push(r);r=this._statement()}let i=null;return this._match(N.keywords.continuing)&&(i=this._compound_statement()),this._consume(N.tokens.brace_right,"Expected '}' for loop."),new S1(e,i)}_switch_statement(){if(!this._match(N.keywords.switch))return null;let e=this._optional_paren_expression();this._check(N.tokens.attr)&&this._attribute(),this._consume(N.tokens.brace_left,"Expected '{' for switch.");let r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(N.tokens.brace_right,"Expected '}' for switch."),new M1(e,r)}_switch_body(){let e=[];if(this._match(N.keywords.case)){let r=this._case_selectors();this._match(N.tokens.colon),this._check(N.tokens.attr)&&this._attribute(),this._consume(N.tokens.brace_left,"Exected '{' for switch case.");let i=this._case_body();this._consume(N.tokens.brace_right,"Exected '}' for switch case."),e.push(new H1(r,i))}if(this._match(N.keywords.default)){this._match(N.tokens.colon),this._check(N.tokens.attr)&&this._attribute(),this._consume(N.tokens.brace_left,"Exected '{' for switch default.");let r=this._case_body();this._consume(N.tokens.brace_right,"Exected '}' for switch default."),e.push(new G1(r))}if(this._check([N.keywords.default,N.keywords.case])){let r=this._switch_body();e.push(r[0])}return e}_case_selectors(){let e=[this._shift_expression()];for(;this._match(N.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(N.keywords.fallthrough))return this._consume(N.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);let r=this._case_body();return r.length==0?e:[...e,r[0]]}_if_statement(){if(!this._match(N.keywords.if))return null;let e=this._optional_paren_expression();this._check(N.tokens.attr)&&this._attribute();let r=this._compound_statement(),i=[];this._match_elseif()&&(this._check(N.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let n=null;return this._match(N.keywords.else)&&(this._check(N.tokens.attr)&&this._attribute(),n=this._compound_statement()),new P1(e,r,i,n)}_match_elseif(){return this._tokens[this._current].type===N.keywords.else&&this._tokens[this._current+1].type===N.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){let r=this._optional_paren_expression(),i=this._compound_statement();return e.push(new j1(r,i)),this._match_elseif()&&(this._check(N.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(N.keywords.return))return null;let e=this._short_circuit_or_expression();return new R1(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(N.tokens.or_or);)e=new gi(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(N.tokens.and_and);)e=new gi(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(N.tokens.or);)e=new gi(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(N.tokens.xor);)e=new gi(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(N.tokens.and);)e=new gi(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){let e=this._relational_expression();return this._match([N.tokens.equal_equal,N.tokens.not_equal])?new gi(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([N.tokens.less_than,N.tokens.greater_than,N.tokens.less_than_equal,N.tokens.greater_than_equal]);)e=new gi(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([N.tokens.shift_left,N.tokens.shift_right]);)e=new gi(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([N.tokens.plus,N.tokens.minus]);)e=new gi(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([N.tokens.star,N.tokens.forward_slash,N.tokens.modulo]);)e=new gi(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([N.tokens.minus,N.tokens.bang,N.tokens.tilde,N.tokens.star,N.tokens.and])?new z1(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),r=this._postfix_expression();return r&&(e.postfix=r),e}_postfix_expression(){if(this._match(N.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(N.tokens.bracket_right,"Expected ']'.");let r=new V1(e),i=this._postfix_expression();return i&&(r.postfix=i),r}if(this._match(N.tokens.period)){let e=this._consume(N.tokens.ident,"Expected member name."),r=this._postfix_expression(),i=new k1(e.lexeme);return r&&(i.postfix=r),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(N.tokens.ident)){let i=this._previous().toString();if(this._check(N.tokens.paren_left)){let n=this._argument_expression_list(),s=this._getStruct(i);return s!=null?new _s(s,n):new Vh(i,n)}if(this._context.constants.has(i)){let n=this._context.constants.get(i);return new zh(i,n.value)}return new $l(i)}if(this._match(N.const_literal))return new Hh(parseFloat(this._previous().toString()));if(this._check(N.tokens.paren_left))return this._paren_expression();if(this._match(N.keywords.bitcast)){this._consume(N.tokens.less_than,"Expected '<'.");let i=this._type_decl();this._consume(N.tokens.greater_than,"Expected '>'.");let n=this._paren_expression();return new U1(i,n)}let e=this._type_decl(),r=this._argument_expression_list();return new _s(e,r)}_argument_expression_list(){if(!this._match(N.tokens.paren_left))return null;let e=[];do{if(this._check(N.tokens.paren_right))break;let r=this._short_circuit_or_expression();e.push(r)}while(this._match(N.tokens.comma));return this._consume(N.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(N.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(N.tokens.paren_right),new Gh([e])}_paren_expression(){this._consume(N.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(N.tokens.paren_right,"Expected ')'."),new Gh([e])}_struct_decl(){if(!this._match(N.keywords.struct))return null;let e=this._currentLine,r=this._consume(N.tokens.ident,"Expected name for struct.").toString();this._consume(N.tokens.brace_left,"Expected '{' for struct body.");let i=[];for(;!this._check(N.tokens.brace_right);){let o=this._attribute(),a=this._consume(N.tokens.ident,"Expected variable name.").toString();this._consume(N.tokens.colon,"Expected ':' for struct member type.");let A=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=A),this._check(N.tokens.brace_right)?this._match(N.tokens.comma):this._consume(N.tokens.comma,"Expected ',' for struct member."),i.push(new X1(a,h,o))}this._consume(N.tokens.brace_right,"Expected '}' after struct body.");let n=this._currentLine,s=new Dn(r,i,e,n);return this._context.structs.set(r,s),s}_global_variable_decl(){let e=this._variable_decl();return e&&this._match(N.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(N.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(N.keywords.const))return null;let e=this._consume(N.tokens.ident,"Expected variable name"),r=null;if(this._match(N.tokens.colon)){let s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(N.tokens.equal)){let s=this._short_circuit_or_expression();if(s instanceof _s)i=s;else if(s instanceof zh&&s.initializer instanceof _s)i=s.initializer;else try{let o=s.evaluate(this._context);i=new Hh(o)}catch{i=s}}let n=new Lh(e.toString(),r,"","",i);return this._context.constants.set(n.name,n),n}_global_let_decl(){if(!this._match(N.keywords.let))return null;let e=this._consume(N.tokens.ident,"Expected variable name"),r=null;if(this._match(N.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}let i=null;return this._match(N.tokens.equal)&&(i=this._const_expression()),new Jl(e.toString(),r,"","",i)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(N.keywords.var))return null;let e="",r="";this._match(N.tokens.less_than)&&(e=this._consume(N.storage_class,"Expected storage_class.").toString(),this._match(N.tokens.comma)&&(r=this._consume(N.access_mode,"Expected access_mode.").toString()),this._consume(N.tokens.greater_than,"Expected '>'."));let i=this._consume(N.tokens.ident,"Expected variable name"),n=null;if(this._match(N.tokens.colon)){let s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}return new kn(i.toString(),n,e,r,null)}_override_decl(){if(!this._match(N.keywords.override))return null;let e=this._consume(N.tokens.ident,"Expected variable name"),r=null;if(this._match(N.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}return new Fh(e.toString(),r,null)}_diagnostic(){this._consume(N.tokens.paren_left,"Expected '('");let e=this._consume(N.tokens.ident,"Expected severity control name.");this._consume(N.tokens.comma,"Expected ','");let r=this._consume(N.tokens.ident,"Expected diagnostic rule name.");return this._consume(N.tokens.paren_right,"Expected ')'"),new O1(e.toString(),r.toString())}_enable_directive(){let e=this._consume(N.tokens.ident,"identity expected.");return new I1(e.toString())}_requires_directive(){let e=[this._consume(N.tokens.ident,"identity expected.").toString()];for(;this._match(N.tokens.comma);){let r=this._consume(N.tokens.ident,"identity expected.");e.push(r.toString())}return new B1(e)}_type_alias(){let e=this._consume(N.tokens.ident,"identity expected.");this._consume(N.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let i=new Dh(e.toString(),r);return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([N.tokens.ident,...N.texel_format,N.keywords.bool,N.keywords.f32,N.keywords.i32,N.keywords.u32])){let i=this._advance(),n=i.toString();return this._context.structs.has(n)?this._context.structs.get(n):this._context.aliases.has(n)?this._context.aliases.get(n).type:new Un(i.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(N.template_types)){let i=this._advance().toString(),n=null,s=null;return this._match(N.tokens.less_than)&&(n=this._type_decl(),s=null,this._match(N.tokens.comma)&&(s=this._consume(N.access_mode,"Expected access_mode for pointer").toString()),this._consume(N.tokens.greater_than,"Expected '>' for type.")),new kh(i,n,s)}if(this._match(N.keywords.ptr)){let i=this._previous().toString();this._consume(N.tokens.less_than,"Expected '<' for pointer.");let n=this._consume(N.storage_class,"Expected storage_class for pointer");this._consume(N.tokens.comma,"Expected ',' for pointer.");let s=this._type_decl(),o=null;return this._match(N.tokens.comma)&&(o=this._consume(N.access_mode,"Expected access_mode for pointer").toString()),this._consume(N.tokens.greater_than,"Expected '>' for pointer."),new D1(i,n.toString(),s,o)}let r=this._attribute();if(this._match(N.keywords.array)){let i=null,n=-1,s=this._previous(),o=null;if(this._match(N.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let A="";if(this._match(N.tokens.comma)){o=this._shift_expression();try{A=o.evaluate(this._context).toString(),o=null}catch{A="1"}}this._consume(N.tokens.greater_than,"Expected '>' for array."),n=A?parseInt(A):0}let a=new Uh(s.toString(),r,i,n);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(N.sampler_type))return new xo(this._previous().toString(),null,null);if(this._match(N.depth_texture_type))return new xo(this._previous().toString(),null,null);if(this._match(N.sampled_texture_type)||this._match(N.multisampled_texture_type)){let e=this._previous();this._consume(N.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(N.tokens.greater_than,"Expected '>' for sampler type."),new xo(e.toString(),r,null)}if(this._match(N.storage_texture_type)){let e=this._previous();this._consume(N.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(N.texel_format,"Invalid texel format.").toString();this._consume(N.tokens.comma,"Expected ',' after texel format.");let i=this._consume(N.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(N.tokens.greater_than,"Expected '>' for sampler type."),new xo(e.toString(),r,i)}return null}_attribute(){let e=[];for(;this._match(N.tokens.attr);){let r=this._consume(N.attribute_name,"Expected attribute name"),i=new Y1(r.toString(),null);if(this._match(N.tokens.paren_left)){if(i.value=this._consume(N.literal_or_ident,"Expected attribute value").toString(),this._check(N.tokens.comma)){this._advance();do{let n=this._consume(N.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(n)}while(this._match(N.tokens.comma))}this._consume(N.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}},ys=class{constructor(e,r){this.name=e,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}},Yh=class{constructor(e,r,i){this.name=e,this.type=r,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},Pa=class extends ys{constructor(e,r){super(e,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},ql=class extends ys{constructor(e,r){super(e,r),this.count=0,this.stride=0}get isArray(){return!0}},Qh=class extends ys{constructor(e,r,i,n){super(e,i),this.format=r,this.access=n}get isTemplate(){return!0}},ms;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(ms||(ms={}));var Ra=class{constructor(e,r,i,n,s,o,a){this.name=e,this.type=r,this.group=i,this.binding=n,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},K1=class{constructor(e,r){this.name=e,this.type=r}},Ia=class{constructor(e,r){this.align=e,this.size=r}},J1=class{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n,this.interpolation=null}},qh=class{constructor(e,r,i,n){this.name=e,this.type=r,this.locationType=i,this.location=n}},Z1=class{constructor(e,r,i,n){this.name=e,this.type=r,this.attributes=i,this.id=n}},$1=class{constructor(e,r){this.name=e,this.type=r}},e2=class{constructor(e,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=r}},t2=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},r2=class{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}},bo=class t{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new t2,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){let i=new q1().parse(e);for(let n of i)n instanceof Kl&&this._functions.set(n.name,new r2(n));for(let n of i)if(n instanceof Dn){let s=this._getTypeInfo(n,null);s instanceof Pa&&this.structs.push(s)}for(let n of i){if(n instanceof Dh){this.aliases.push(this._getAliasInfo(n));continue}if(n instanceof Fh){let s=n,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new Z1(s.name,a,s.attributes,o));continue}if(this._isUniformVar(n)){let s=n,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),A=this._getTypeInfo(s.type,s.attributes),h=new Ra(s.name,A,o,a,s.attributes,ms.Uniform,s.access);this.uniforms.push(h);continue}if(this._isStorageVar(n)){let s=n,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),A=this._getTypeInfo(s.type,s.attributes),h=this._isStorageTexture(A),g=new Ra(s.name,A,o,a,s.attributes,h?ms.StorageTexture:ms.Storage,s.access);this.storage.push(g);continue}if(this._isTextureVar(n)){let s=n,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),A=this._getTypeInfo(s.type,s.attributes),h=this._isStorageTexture(A),g=new Ra(s.name,A,o,a,s.attributes,h?ms.StorageTexture:ms.Texture,s.access);h?this.storage.push(g):this.textures.push(g);continue}if(this._isSamplerVar(n)){let s=n,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),A=this._getTypeInfo(s.type,s.attributes),h=new Ra(s.name,A,o,a,s.attributes,ms.Sampler,s.access);this.samplers.push(h);continue}if(n instanceof Kl){let s=this._getAttribute(n,"vertex"),o=this._getAttribute(n,"fragment"),a=this._getAttribute(n,"compute"),A=s||o||a,h=new e2(n.name,A?.name);h.startLine=n.startLine,h.endLine=n.endLine,this.functions.push(h),this._functions.get(n.name).info=h,A?(this._functions.get(n.name).inUse=!0,h.inUse=!0,h.resources=this._findResources(n,!!A),h.inputs=this._getInputs(n.args),h.outputs=this._getOutputs(n.returnType),this.entry[A.name].push(h)):(h.arguments=n.args.map(g=>new $1(g.name,this._getTypeInfo(g.type,g.attributes))),h.returnType=n.returnType?this._getTypeInfo(n.returnType,n.attributes):null);continue}}for(let n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(let n of this._functions.values())n.node.search(s=>{var o;if(s.astNodeType==="varExpr"){let a=s;for(let A of this.overrides)a.name==A.name&&((o=n.info)===null||o===void 0||o.overrides.push(A))}});for(let n of this.uniforms)this._markStructsInUse(n.type);for(let n of this.storage)this._markStructsInUse(n.type)}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let r of e.members)this._markStructsInUse(r.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let r=this._getAlias(e.name);r&&this._markStructsInUse(r)}}_addCalls(e,r){var i;for(let n of e.calls){let s=(i=this._functions.get(n.name))===null||i===void 0?void 0:i.info;s&&r.add(s)}}findResource(e,r){for(let i of this.uniforms)if(i.group==e&&i.binding==r)return i;for(let i of this.storage)if(i.group==e&&i.binding==r)return i;for(let i of this.textures)if(i.group==e&&i.binding==r)return i;for(let i of this.samplers)if(i.group==e&&i.binding==r)return i;return null}_findResource(e){for(let r of this.uniforms)if(r.name==e)return r;for(let r of this.storage)if(r.name==e)return r;for(let r of this.textures)if(r.name==e)return r;for(let r of this.samplers)if(r.name==e)return r;return null}_markStructsFromAST(e){let r=this._getTypeInfo(e,null);this._markStructsInUse(r)}_findResources(e,r){let i=[],n=this,s=[];return e.search(o=>{if(o instanceof Ba)s.push({});else if(o instanceof Oa)s.pop();else if(o instanceof kn){let a=o;r&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof _s){let a=o;r&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Jl){let a=o;r&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof $l){let a=o;if(s.length>0&&s[s.length-1][a.name])return;let A=n._findResource(a.name);A&&i.push(A)}else if(o instanceof Vh){let a=o,A=n._functions.get(a.name);A&&(r&&(A.inUse=!0),e.calls.add(A.node),A.resources===null&&(A.resources=n._findResources(A.node,r)),i.push(...A.resources))}else if(o instanceof Nh){let a=o,A=n._functions.get(a.name);A&&(r&&(A.inUse=!0),e.calls.add(A.node),A.resources===null&&(A.resources=n._findResources(A.node,r)),i.push(...A.resources))}}),[...new Map(i.map(o=>[o.name,o])).values()]}getBindGroups(){let e=[];function r(i,n){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),n>=e[i].length&&(e[i].length=n+1)}for(let i of this.uniforms){r(i.group,i.binding);let n=e[i.group];n[i.binding]=i}for(let i of this.storage){r(i.group,i.binding);let n=e[i.group];n[i.binding]=i}for(let i of this.textures){r(i.group,i.binding);let n=e[i.group];n[i.binding]=i}for(let i of this.samplers){r(i.group,i.binding);let n=e[i.group];n[i.binding]=i}return e}_getOutputs(e,r=void 0){if(r===void 0&&(r=[]),e instanceof Dn)this._getStructOutputs(e,r);else{let i=this._getOutputInfo(e);i!==null&&r.push(i)}return r}_getStructOutputs(e,r){for(let i of e.members)if(i.type instanceof Dn)this._getStructOutputs(i.type,r);else{let n=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(n!==null){let s=this._getTypeInfo(i.type,i.type.attributes),o=this._parseInt(n.value),a=new qh(i.name,s,n.name,o);r.push(a)}}}_getOutputInfo(e){let r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){let i=this._getTypeInfo(e,e.attributes),n=this._parseInt(r.value);return new qh("",i,r.name,n)}return null}_getInputs(e,r=void 0){r===void 0&&(r=[]);for(let i of e)if(i.type instanceof Dn)this._getStructInputs(i.type,r);else{let n=this._getInputInfo(i);n!==null&&r.push(n)}return r}_getStructInputs(e,r){for(let i of e.members)if(i.type instanceof Dn)this._getStructInputs(i.type,r);else{let n=this._getInputInfo(i);n!==null&&r.push(n)}}_getInputInfo(e){let r=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(r!==null){let i=this._getAttribute(e,"interpolation"),n=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(r.value),o=new J1(e.name,n,r.name,s);return i!==null&&(o.interpolation=this._parseString(i.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let r=parseInt(e);return isNaN(r)?e:r}_getAlias(e){for(let r of this.aliases)if(r.name==e)return r.type;return null}_getAliasInfo(e){return new K1(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,r){if(this._types.has(e))return this._types.get(e);if(e instanceof Uh){let n=e,s=n.format?this._getTypeInfo(n.format,n.attributes):null,o=new ql(n.name,r);return o.format=s,o.count=n.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Dn){let n=e,s=new Pa(n.name,r);s.startLine=n.startLine,s.endLine=n.endLine;for(let o of n.members){let a=this._getTypeInfo(o.type,o.attributes);s.members.push(new Yh(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof xo){let n=e,s=n.format instanceof Un,o=n.format?s?this._getTypeInfo(n.format,null):new ys(n.format,null):null,a=new Qh(n.name,o,r,n.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof kh){let n=e,s=n.format?this._getTypeInfo(n.format,null):null,o=new Qh(n.name,s,r,n.access);return this._types.set(e,o),this._updateTypeInfo(o),o}let i=new ys(e.name,r);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var r,i;let n=this._getTypeSize(e);if(e.size=(r=n?.size)!==null&&r!==void 0?r:0,e instanceof ql&&e.format){let s=this._getTypeSize(e.format);e.stride=(i=s?.size)!==null&&i!==void 0?i:0,this._updateTypeInfo(e.format)}e instanceof Pa&&this._updateStructInfo(e)}_updateStructInfo(e){var r;let i=0,n=0,s=0,o=0;for(let a=0,A=e.members.length;a<A;++a){let h=e.members[a],g=this._getTypeSize(h);if(!g)continue;(r=this._getAlias(h.type.name))!==null&&r!==void 0||h.type;let _=g.align,b=g.size;i=this._roundUp(_,i+n),n=b,s=i,o=Math.max(o,_),h.offset=i,h.size=b,this._updateTypeInfo(h.type)}e.size=this._roundUp(o,s+n),e.align=o}_getTypeSize(e){var r,i;if(e==null)return null;let n=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Yh&&(e=e.type),e instanceof ys){let o=this._getAlias(e.name);o!==null&&(e=o)}{let o=t._typeInfo[e.name];if(o!==void 0){let a=((r=e.format)===null||r===void 0?void 0:r.name)==="f16"?2:1;return new Ia(Math.max(s,o.align/a),Math.max(n,o.size/a))}}{let o=t._typeInfo[e.name.substring(0,e.name.length-1)];if(o){let a=e.name[e.name.length-1]==="h"?2:1;return new Ia(Math.max(s,o.align/a),Math.max(n,o.size/a))}}if(e instanceof ql){let o=e,a=8,A=8,h=this._getTypeSize(o.format);h!==null&&(A=h.size,a=h.align);let g=o.count,_=this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(a,A));return A=g*_,n&&(A=n),new Ia(Math.max(s,a),Math.max(n,A))}if(e instanceof Pa){let o=0,a=0,A=0,h=0,g=0;for(let _ of e.members){let b=this._getTypeSize(_.type);b!==null&&(o=Math.max(b.align,o),A=this._roundUp(b.align,A+h),h=b.size,g=A)}return a=this._roundUp(o,g+h),new Ia(Math.max(s,o),Math.max(n,a))}return null}_isUniformVar(e){return e instanceof kn&&e.storage=="uniform"}_isStorageVar(e){return e instanceof kn&&e.storage=="storage"}_isTextureVar(e){return e instanceof kn&&e.type!==null&&t._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof kn&&e.type!==null&&t._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,r){let i=e;if(!i||!i.attributes)return null;let n=i.attributes;for(let s of n)if(s.name==r)return s;return null}_getAttributeNum(e,r,i){if(e===null)return i;for(let n of e)if(n.name==r){let s=n!==null&&n.value!==null?n.value:i;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):i}return i}_roundUp(e,r){return Math.ceil(r/e)*e}};bo._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};bo._textureTypes=N.any_texture_type.map(t=>t.name);bo._samplerTypes=N.sampler_type.map(t=>t.name);function i2(t){let e={attributes:[],bindings:[]},r;try{r=zD(t)}catch(s){return oe.error(s.message)(),e}for(let s of r.uniforms){let o=[];for(let a of s.type?.members||[])o.push({name:a.name,type:JE(a.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:o})}for(let s of r.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(let s of r.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});let i=r.entry.vertex[0],n=i?.inputs.length||0;for(let s=0;s<n;s++){let o=i.inputs[s];if(o.locationType==="location"){let a=JE(o.type);e.attributes.push({name:o.name,location:Number(o.location),type:a})}}return e}function JE(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function zD(t){try{return new bo(t)}catch(e){if(e instanceof Error)throw e;let r="WGSL parse error";throw typeof e=="object"&&e?.message&&(r+=`: ${e.message} `),typeof e=="object"&&e?.token&&(r+=e.token.line||""),new Error(r,{cause:e})}}var HD=1/Math.PI*180,GD=1/180*Math.PI,WD={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...WD}};var It=globalThis.mathgl.config;function n2(t,{precision:e=It.precision}={}){return t=jD(t),`${parseFloat(t.toPrecision(e))}`}function si(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function s2(t){return ZE(t)}function o2(t){return oi(t)}function ZE(t,e){return a2(t,r=>r*GD,e)}function oi(t,e){return a2(t,r=>r*HD,e)}function pr(t,e,r){return a2(t,i=>Math.max(e,Math.min(r,i)))}function br(t,e,r){return si(t)?t.map((i,n)=>br(i,e[n],r)):r*e+(1-r)*t}function er(t,e,r){let i=It.EPSILON;r&&(It.EPSILON=r);try{if(t===e)return!0;if(si(t)&&si(e)){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!er(t[n],e[n]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=It.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{It.EPSILON=i}}function jD(t){return Math.round(t/It.EPSILON)*It.EPSILON}function XD(t){return t.clone?t.clone():new Array(t.length)}function a2(t,e,r){if(si(t)){let i=t;r=r||XD(i);for(let n=0;n<r.length&&n<i.length;++n){let s=typeof t=="number"?t:t[n];r[n]=e(s,n,r)}return r}return e(t)}var xs=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,r=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+r];return this.check()}toArray(e=[],r=0){for(let i=0;i<this.ELEMENTS;++i)e[r+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:si(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(It)}formatString(e){let r="";for(let i=0;i<this.ELEMENTS;++i)r+=(i>0?", ":"")+n2(this[i],e);return`${e.printTypes?this.constructor.name:""}[${r}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!er(this[r],e[r]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==e[r])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,r,i){if(i===void 0)return this.lerp(this,e,r);for(let n=0;n<this.ELEMENTS;++n){let s=e[n],o=typeof r=="number"?r:r[n];this[n]=s+i*(o-s)}return this.check()}min(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(e[r],this[r]);return this.check()}max(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(e[r],this[r]);return this.check()}clamp(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),r[i]);return this.check()}add(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=r[i];return this.check()}subtract(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=r[i];return this.check()}scale(e){if(typeof e=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;else for(let r=0;r<this.ELEMENTS&&r<e.length;++r)this[r]*=e[r];return this.check()}multiplyByScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}check(){if(It.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)e=e&&Number.isFinite(this[r]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]=e;return this.check()}addScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let r=0;r<this.ELEMENTS;++r)this[r]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,r){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),r);return this.check()}get elements(){return this}};function YD(t,e){if(t.length!==e)return!1;for(let r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function it(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function bs(t,e,r=""){if(It.debug&&!YD(t,e))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return t}function gr(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}var Ts=class extends xs{get x(){return this[0]}set x(e){this[0]=it(e)}get y(){return this[1]}set y(e){this[1]=it(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let r=0;r<this.ELEMENTS;++r)e+=this[r]*this[r];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let r=0;for(let i=0;i<this.ELEMENTS;++i){let n=this[i]-e[i];r+=n*n}return it(r)}dot(e){let r=0;for(let i=0;i<this.ELEMENTS;++i)r+=this[i]*e[i];return it(r)}normalize(){let e=this.magnitude();if(e!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=e;return this.check()}multiply(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=r[i];return this.check()}divide(...e){for(let r of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=r[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return gr(e>=0&&e<this.ELEMENTS,"index is out of range"),it(this[e])}setComponent(e,r){return gr(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=r,this.check()}addVectors(e,r){return this.copy(e).add(r)}subVectors(e,r){return this.copy(e).subtract(r)}multiplyVectors(e,r){return this.copy(e).multiply(r)}addScaledVector(e,r){return this.add(new this.constructor(e).multiplyScalar(r))}};var cn={};fr(cn,{add:()=>ZD,angle:()=>d9,ceil:()=>$D,clone:()=>QD,copy:()=>KD,create:()=>$E,cross:()=>A9,dist:()=>E9,distance:()=>iv,div:()=>T9,divide:()=>rv,dot:()=>l9,equals:()=>_9,exactEquals:()=>m9,floor:()=>e9,forEach:()=>C9,fromValues:()=>qD,inverse:()=>a9,len:()=>y9,length:()=>sv,lerp:()=>u9,max:()=>r9,min:()=>t9,mul:()=>b9,multiply:()=>tv,negate:()=>o9,normalize:()=>c9,random:()=>f9,rotate:()=>h9,round:()=>i9,scale:()=>n9,scaleAndAdd:()=>s9,set:()=>JD,sqrDist:()=>v9,sqrLen:()=>w9,squaredDistance:()=>nv,squaredLength:()=>ov,str:()=>g9,sub:()=>x9,subtract:()=>ev,transformMat2:()=>c2,transformMat2d:()=>l2,transformMat3:()=>eA,transformMat4:()=>tA,zero:()=>p9});var Mt=typeof Float32Array<"u"?Float32Array:Array,an=Math.random;function _i(t){return t>=0?Math.round(t):t%.5===0?Math.floor(t):Math.round(t)}var Sue=Math.PI/180;function $E(){let t=new Mt(2);return Mt!=Float32Array&&(t[0]=0,t[1]=0),t}function QD(t){let e=new Mt(2);return e[0]=t[0],e[1]=t[1],e}function qD(t,e){let r=new Mt(2);return r[0]=t,r[1]=e,r}function KD(t,e){return t[0]=e[0],t[1]=e[1],t}function JD(t,e,r){return t[0]=e,t[1]=r,t}function ZD(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function ev(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function tv(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function rv(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function $D(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function e9(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function t9(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function r9(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function i9(t,e){return t[0]=_i(e[0]),t[1]=_i(e[1]),t}function n9(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function s9(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function iv(t,e){let r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function nv(t,e){let r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function sv(t){let e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function ov(t){let e=t[0],r=t[1];return e*e+r*r}function o9(t,e){return t[0]=-e[0],t[1]=-e[1],t}function a9(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function c9(t,e){let r=e[0],i=e[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t}function l9(t,e){return t[0]*e[0]+t[1]*e[1]}function A9(t,e,r){let i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function u9(t,e,r,i){let n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function f9(t,e){e=e===void 0?1:e;let r=an()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function c2(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function l2(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function eA(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function tA(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function h9(t,e,r,i){let n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function d9(t,e){let r=t[0],i=t[1],n=e[0],s=e[1],o=Math.sqrt((r*r+i*i)*(n*n+s*s)),a=o&&(r*n+i*s)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function p9(t){return t[0]=0,t[1]=0,t}function g9(t){return`vec2(${t[0]}, ${t[1]})`}function m9(t,e){return t[0]===e[0]&&t[1]===e[1]}function _9(t,e){let r=t[0],i=t[1],n=e[0],s=e[1];return Math.abs(r-n)<=1e-6*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))}var y9=sv,x9=ev,b9=tv,T9=rv,E9=iv,v9=nv,w9=ov,C9=function(){let t=$E();return function(e,r,i,n,s,o){let a,A;for(r||(r=2),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,a=i;a<A;a+=r)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}}();function Kh(t,e,r){let i=e[0],n=e[1],s=r[3]*i+r[7]*n||1;return t[0]=(r[0]*i+r[4]*n)/s,t[1]=(r[1]*i+r[5]*n)/s,t}function Jh(t,e,r){let i=e[0],n=e[1],s=e[2],o=r[3]*i+r[7]*n+r[11]*s||1;return t[0]=(r[0]*i+r[4]*n+r[8]*s)/o,t[1]=(r[1]*i+r[5]*n+r[9]*s)/o,t[2]=(r[2]*i+r[6]*n+r[10]*s)/o,t}function av(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t}function cv(t,e,r){let i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t[2]=e[2],t[3]=e[3],t}function Zh(t,e,r){let i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[3]*n+r[6]*s,t[1]=r[1]*i+r[4]*n+r[7]*s,t[2]=r[2]*i+r[5]*n+r[8]*s,t[3]=e[3],t}var To=class extends Ts{constructor(e=0,r=0){super(2),si(e)&&arguments.length===1?this.copy(e):(It.debug&&(it(e),it(r)),this[0]=e,this[1]=r)}set(e,r){return this[0]=e,this[1]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return It.debug&&(it(e.x),it(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return tA(this,this,e),this.check()}transformAsVector(e){return Kh(this,this,e),this.check()}transformByMatrix3(e){return eA(this,this,e),this.check()}transformByMatrix2x3(e){return l2(this,this,e),this.check()}transformByMatrix2(e){return c2(this,this,e),this.check()}};var Tr={};fr(Tr,{add:()=>R9,angle:()=>d2,bezier:()=>G9,ceil:()=>I9,clone:()=>S9,copy:()=>M9,create:()=>$h,cross:()=>Eo,dist:()=>Z9,distance:()=>hv,div:()=>J9,divide:()=>fv,dot:()=>rA,equals:()=>Q9,exactEquals:()=>Y9,floor:()=>B9,forEach:()=>t7,fromValues:()=>e0,hermite:()=>H9,inverse:()=>U9,len:()=>p2,length:()=>lv,lerp:()=>V9,max:()=>F9,min:()=>O9,mul:()=>K9,multiply:()=>uv,negate:()=>k9,normalize:()=>A2,random:()=>W9,rotateX:()=>u2,rotateY:()=>f2,rotateZ:()=>h2,round:()=>L9,scale:()=>N9,scaleAndAdd:()=>D9,set:()=>P9,slerp:()=>z9,sqrDist:()=>$9,sqrLen:()=>e7,squaredDistance:()=>dv,squaredLength:()=>pv,str:()=>X9,sub:()=>q9,subtract:()=>Av,transformMat3:()=>iA,transformMat4:()=>vo,transformQuat:()=>nA,zero:()=>j9});function $h(){let t=new Mt(3);return Mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function S9(t){let e=new Mt(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function lv(t){let e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function e0(t,e,r){let i=new Mt(3);return i[0]=t,i[1]=e,i[2]=r,i}function M9(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function P9(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function R9(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function Av(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function uv(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function fv(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function I9(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function B9(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function O9(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function F9(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function L9(t,e){return t[0]=_i(e[0]),t[1]=_i(e[1]),t[2]=_i(e[2]),t}function N9(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function D9(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function hv(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function dv(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function pv(t){let e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function k9(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function U9(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function A2(t,e){let r=e[0],i=e[1],n=e[2],s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function rA(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Eo(t,e,r){let i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],A=r[2];return t[0]=n*A-s*a,t[1]=s*o-i*A,t[2]=i*a-n*o,t}function V9(t,e,r,i){let n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function z9(t,e,r,i){let n=Math.acos(Math.min(Math.max(rA(e,r),-1),1)),s=Math.sin(n),o=Math.sin((1-i)*n)/s,a=Math.sin(i*n)/s;return t[0]=o*e[0]+a*r[0],t[1]=o*e[1]+a*r[1],t[2]=o*e[2]+a*r[2],t}function H9(t,e,r,i,n,s){let o=s*s,a=o*(2*s-3)+1,A=o*(s-2)+s,h=o*(s-1),g=o*(3-2*s);return t[0]=e[0]*a+r[0]*A+i[0]*h+n[0]*g,t[1]=e[1]*a+r[1]*A+i[1]*h+n[1]*g,t[2]=e[2]*a+r[2]*A+i[2]*h+n[2]*g,t}function G9(t,e,r,i,n,s){let o=1-s,a=o*o,A=s*s,h=a*o,g=3*s*a,_=3*A*o,b=A*s;return t[0]=e[0]*h+r[0]*g+i[0]*_+n[0]*b,t[1]=e[1]*h+r[1]*g+i[1]*_+n[1]*b,t[2]=e[2]*h+r[2]*g+i[2]*_+n[2]*b,t}function W9(t,e){e=e===void 0?1:e;let r=an()*2*Math.PI,i=an()*2-1,n=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*n,t[1]=Math.sin(r)*n,t[2]=i*e,t}function vo(t,e,r){let i=e[0],n=e[1],s=e[2],o=r[3]*i+r[7]*n+r[11]*s+r[15];return o=o||1,t[0]=(r[0]*i+r[4]*n+r[8]*s+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*s+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*s+r[14])/o,t}function iA(t,e,r){let i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function nA(t,e,r){let i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],A=e[1],h=e[2],g=n*h-s*A,_=s*a-i*h,b=i*A-n*a,T=n*b-s*_,v=s*g-i*b,C=i*_-n*g,S=o*2;return g*=S,_*=S,b*=S,T*=2,v*=2,C*=2,t[0]=a+g+T,t[1]=A+_+v,t[2]=h+b+C,t}function u2(t,e,r,i){let n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function f2(t,e,r,i){let n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function h2(t,e,r,i){let n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function d2(t,e){let r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],A=Math.sqrt((r*r+i*i+n*n)*(s*s+o*o+a*a)),h=A&&rA(t,e)/A;return Math.acos(Math.min(Math.max(h,-1),1))}function j9(t){return t[0]=0,t[1]=0,t[2]=0,t}function X9(t){return`vec3(${t[0]}, ${t[1]}, ${t[2]})`}function Y9(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Q9(t,e){let r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=1e-6*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))}var q9=Av,K9=uv,J9=fv,Z9=hv,$9=dv,p2=lv,e7=pv,t7=function(){let t=$h();return function(e,r,i,n,s,o){let a,A;for(r||(r=3),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,a=i;a<A;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}}();var g2=[0,0,0],t0,G=class t extends Ts{static get ZERO(){return t0||(t0=new t(0,0,0),Object.freeze(t0)),t0}constructor(e=0,r=0,i=0){super(-0,-0,-0),arguments.length===1&&si(e)?this.copy(e):(It.debug&&(it(e),it(r),it(i)),this[0]=e,this[1]=r,this[2]=i)}set(e,r,i){return this[0]=e,this[1]=r,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return It.debug&&(it(e.x),it(e.y),it(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=it(e)}angle(e){return d2(this,e)}cross(e){return Eo(this,this,e),this.check()}rotateX({radians:e,origin:r=g2}){return u2(this,this,r,e),this.check()}rotateY({radians:e,origin:r=g2}){return f2(this,this,r,e),this.check()}rotateZ({radians:e,origin:r=g2}){return h2(this,this,r,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return vo(this,this,e),this.check()}transformAsVector(e){return Jh(this,this,e),this.check()}transformByMatrix3(e){return iA(this,this,e),this.check()}transformByMatrix2(e){return av(this,this,e),this.check()}transformByQuaternion(e){return nA(this,this,e),this.check()}};var r0,i0=class t extends Ts{static get ZERO(){return r0||(r0=new t(0,0,0,0),Object.freeze(r0)),r0}constructor(e=0,r=0,i=0,n=0){super(-0,-0,-0,-0),si(e)&&arguments.length===1?this.copy(e):(It.debug&&(it(e),it(r),it(i),it(n)),this[0]=e,this[1]=r,this[2]=i,this[3]=n)}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return It.debug&&(it(e.x),it(e.y),it(e.z),it(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=it(e)}get w(){return this[3]}set w(e){this[3]=it(e)}transform(e){return vo(this,this,e),this.check()}transformByMatrix3(e){return Zh(this,this,e),this.check()}transformByMatrix2(e){return cv(this,this,e),this.check()}transformByQuaternion(e){return nA(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}};var Na=class extends xs{toString(){let e="[";if(It.printRowMajor){e+="row-major:";for(let r=0;r<this.RANK;++r)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+r]}`}else{e+="column-major:";for(let r=0;r<this.ELEMENTS;++r)e+=` ${this[r]}`}return e+="]",e}getElementIndex(e,r){return r*this.RANK+e}getElement(e,r){return this[r*this.RANK+e]}setElement(e,r,i){return this[r*this.RANK+e]=it(i),this}getColumn(e,r=new Array(this.RANK).fill(-0)){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)r[n]=this[i+n];return r}setColumn(e,r){let i=e*this.RANK;for(let n=0;n<this.RANK;++n)this[i+n]=r[n];return this}};function gv(){let t=new Mt(9);return Mt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function mv(t,e){if(t===e){let r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function _v(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],A=e[6],h=e[7],g=e[8],_=g*o-a*h,b=-g*s+a*A,T=h*s-o*A,v=r*_+i*b+n*T;return v?(v=1/v,t[0]=_*v,t[1]=(-g*i+n*h)*v,t[2]=(a*i-n*o)*v,t[3]=b*v,t[4]=(g*r-n*A)*v,t[5]=(-a*r+n*s)*v,t[6]=T*v,t[7]=(-h*r+i*A)*v,t[8]=(o*r-i*s)*v,t):null}function yv(t){let e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],A=t[7],h=t[8];return e*(h*s-o*A)+r*(-h*n+o*a)+i*(A*n-s*a)}function m2(t,e,r){let i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],g=e[7],_=e[8],b=r[0],T=r[1],v=r[2],C=r[3],S=r[4],P=r[5],F=r[6],I=r[7],k=r[8];return t[0]=b*i+T*o+v*h,t[1]=b*n+T*a+v*g,t[2]=b*s+T*A+v*_,t[3]=C*i+S*o+P*h,t[4]=C*n+S*a+P*g,t[5]=C*s+S*A+P*_,t[6]=F*i+I*o+k*h,t[7]=F*n+I*a+k*g,t[8]=F*s+I*A+k*_,t}function xv(t,e,r){let i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],g=e[7],_=e[8],b=r[0],T=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=A,t[6]=b*i+T*o+h,t[7]=b*n+T*a+g,t[8]=b*s+T*A+_,t}function bv(t,e,r){let i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],g=e[7],_=e[8],b=Math.sin(r),T=Math.cos(r);return t[0]=T*i+b*o,t[1]=T*n+b*a,t[2]=T*s+b*A,t[3]=T*o-b*i,t[4]=T*a-b*n,t[5]=T*A-b*s,t[6]=h,t[7]=g,t[8]=_,t}function _2(t,e,r){let i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Tv(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,A=n+n,h=r*o,g=i*o,_=i*a,b=n*o,T=n*a,v=n*A,C=s*o,S=s*a,P=s*A;return t[0]=1-_-v,t[3]=g-P,t[6]=b+S,t[1]=g+P,t[4]=1-h-v,t[7]=T-C,t[2]=b-S,t[5]=T+C,t[8]=1-h-_,t}var y2;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(y2||(y2={}));var r7=Object.freeze([1,0,0,0,1,0,0,0,1]),yt=class extends Na{static get IDENTITY(){return n7()}static get ZERO(){return i7()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return y2}constructor(e,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):r.length>0?this.copy([e,...r]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(r7)}fromObject(e){return this.check()}fromQuaternion(e){return Tv(this,e),this.check()}set(e,r,i,n,s,o,a,A,h){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=o,this[6]=a,this[7]=A,this[8]=h,this.check()}setRowMajor(e,r,i,n,s,o,a,A,h){return this[0]=e,this[1]=n,this[2]=a,this[3]=r,this[4]=s,this[5]=A,this[6]=i,this[7]=o,this[8]=h,this.check()}determinant(){return yv(this)}transpose(){return mv(this,this),this.check()}invert(){return _v(this,this),this.check()}multiplyLeft(e){return m2(this,e,this),this.check()}multiplyRight(e){return m2(this,this,e),this.check()}rotate(e){return bv(this,this,e),this.check()}scale(e){return Array.isArray(e)?_2(this,this,e):_2(this,this,[e,e]),this.check()}translate(e){return xv(this,this,e),this.check()}transform(e,r){let i;switch(e.length){case 2:i=eA(r||[-0,-0],e,this);break;case 3:i=iA(r||[-0,-0,-0],e,this);break;case 4:i=Zh(r||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return bs(i,e.length),i}transformVector(e,r){return this.transform(e,r)}transformVector2(e,r){return this.transform(e,r)}transformVector3(e,r){return this.transform(e,r)}},n0,s0=null;function i7(){return n0||(n0=new yt([0,0,0,0,0,0,0,0,0]),Object.freeze(n0)),n0}function n7(){return s0||(s0=new yt,Object.freeze(s0)),s0}var Xt={};fr(Xt,{add:()=>P7,adjoint:()=>A7,clone:()=>o7,copy:()=>a7,create:()=>s7,decompose:()=>x7,determinant:()=>T2,equals:()=>O7,exactEquals:()=>B7,frob:()=>M7,fromQuat:()=>P2,fromQuat2:()=>m7,fromRotation:()=>h7,fromRotationTranslation:()=>wv,fromRotationTranslationScale:()=>b7,fromRotationTranslationScaleOrigin:()=>T7,fromScaling:()=>f7,fromTranslation:()=>u7,fromValues:()=>c7,fromXRotation:()=>d7,fromYRotation:()=>p7,fromZRotation:()=>g7,frustum:()=>R2,getRotation:()=>y7,getScaling:()=>Cv,getTranslation:()=>_7,identity:()=>vv,invert:()=>b2,lookAt:()=>O2,mul:()=>F7,multiply:()=>sA,multiplyScalar:()=>R7,multiplyScalarAndAdd:()=>I7,ortho:()=>B2,orthoNO:()=>Mv,orthoZO:()=>w7,perspective:()=>I2,perspectiveFromFieldOfView:()=>v7,perspectiveNO:()=>Sv,perspectiveZO:()=>E7,rotate:()=>w2,rotateX:()=>C2,rotateY:()=>S2,rotateZ:()=>M2,scale:()=>v2,set:()=>l7,str:()=>S7,sub:()=>L7,subtract:()=>Pv,targetTo:()=>C7,translate:()=>E2,transpose:()=>x2});function s7(){let t=new Mt(16);return Mt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function o7(t){let e=new Mt(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a7(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c7(t,e,r,i,n,s,o,a,A,h,g,_,b,T,v,C){let S=new Mt(16);return S[0]=t,S[1]=e,S[2]=r,S[3]=i,S[4]=n,S[5]=s,S[6]=o,S[7]=a,S[8]=A,S[9]=h,S[10]=g,S[11]=_,S[12]=b,S[13]=T,S[14]=v,S[15]=C,S}function l7(t,e,r,i,n,s,o,a,A,h,g,_,b,T,v,C,S){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=A,t[8]=h,t[9]=g,t[10]=_,t[11]=b,t[12]=T,t[13]=v,t[14]=C,t[15]=S,t}function vv(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function x2(t,e){if(t===e){let r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function b2(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],A=e[6],h=e[7],g=e[8],_=e[9],b=e[10],T=e[11],v=e[12],C=e[13],S=e[14],P=e[15],F=r*a-i*o,I=r*A-n*o,k=r*h-s*o,W=i*A-n*a,K=i*h-s*a,re=n*h-s*A,Y=g*C-_*v,z=g*S-b*v,L=g*P-T*v,se=_*S-b*C,le=_*P-T*C,ce=b*P-T*S,he=F*ce-I*le+k*se+W*L-K*z+re*Y;return he?(he=1/he,t[0]=(a*ce-A*le+h*se)*he,t[1]=(n*le-i*ce-s*se)*he,t[2]=(C*re-S*K+P*W)*he,t[3]=(b*K-_*re-T*W)*he,t[4]=(A*L-o*ce-h*z)*he,t[5]=(r*ce-n*L+s*z)*he,t[6]=(S*k-v*re-P*I)*he,t[7]=(g*re-b*k+T*I)*he,t[8]=(o*le-a*L+h*Y)*he,t[9]=(i*L-r*le-s*Y)*he,t[10]=(v*K-C*k+P*F)*he,t[11]=(_*k-g*K-T*F)*he,t[12]=(a*z-o*se-A*Y)*he,t[13]=(r*se-i*z+n*Y)*he,t[14]=(C*I-v*W-S*F)*he,t[15]=(g*W-_*I+b*F)*he,t):null}function A7(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],A=e[6],h=e[7],g=e[8],_=e[9],b=e[10],T=e[11],v=e[12],C=e[13],S=e[14],P=e[15],F=r*a-i*o,I=r*A-n*o,k=r*h-s*o,W=i*A-n*a,K=i*h-s*a,re=n*h-s*A,Y=g*C-_*v,z=g*S-b*v,L=g*P-T*v,se=_*S-b*C,le=_*P-T*C,ce=b*P-T*S;return t[0]=a*ce-A*le+h*se,t[1]=n*le-i*ce-s*se,t[2]=C*re-S*K+P*W,t[3]=b*K-_*re-T*W,t[4]=A*L-o*ce-h*z,t[5]=r*ce-n*L+s*z,t[6]=S*k-v*re-P*I,t[7]=g*re-b*k+T*I,t[8]=o*le-a*L+h*Y,t[9]=i*L-r*le-s*Y,t[10]=v*K-C*k+P*F,t[11]=_*k-g*K-T*F,t[12]=a*z-o*se-A*Y,t[13]=r*se-i*z+n*Y,t[14]=C*I-v*W-S*F,t[15]=g*W-_*I+b*F,t}function T2(t){let e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],A=t[7],h=t[8],g=t[9],_=t[10],b=t[11],T=t[12],v=t[13],C=t[14],S=t[15],P=e*o-r*s,F=e*a-i*s,I=r*a-i*o,k=h*v-g*T,W=h*C-_*T,K=g*C-_*v,re=e*K-r*W+i*k,Y=s*K-o*W+a*k,z=h*I-g*F+_*P,L=T*I-v*F+C*P;return A*re-n*Y+S*z-b*L}function sA(t,e,r){let i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],A=e[5],h=e[6],g=e[7],_=e[8],b=e[9],T=e[10],v=e[11],C=e[12],S=e[13],P=e[14],F=e[15],I=r[0],k=r[1],W=r[2],K=r[3];return t[0]=I*i+k*a+W*_+K*C,t[1]=I*n+k*A+W*b+K*S,t[2]=I*s+k*h+W*T+K*P,t[3]=I*o+k*g+W*v+K*F,I=r[4],k=r[5],W=r[6],K=r[7],t[4]=I*i+k*a+W*_+K*C,t[5]=I*n+k*A+W*b+K*S,t[6]=I*s+k*h+W*T+K*P,t[7]=I*o+k*g+W*v+K*F,I=r[8],k=r[9],W=r[10],K=r[11],t[8]=I*i+k*a+W*_+K*C,t[9]=I*n+k*A+W*b+K*S,t[10]=I*s+k*h+W*T+K*P,t[11]=I*o+k*g+W*v+K*F,I=r[12],k=r[13],W=r[14],K=r[15],t[12]=I*i+k*a+W*_+K*C,t[13]=I*n+k*A+W*b+K*S,t[14]=I*s+k*h+W*T+K*P,t[15]=I*o+k*g+W*v+K*F,t}function E2(t,e,r){let i=r[0],n=r[1],s=r[2],o,a,A,h,g,_,b,T,v,C,S,P;return e===t?(t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15]):(o=e[0],a=e[1],A=e[2],h=e[3],g=e[4],_=e[5],b=e[6],T=e[7],v=e[8],C=e[9],S=e[10],P=e[11],t[0]=o,t[1]=a,t[2]=A,t[3]=h,t[4]=g,t[5]=_,t[6]=b,t[7]=T,t[8]=v,t[9]=C,t[10]=S,t[11]=P,t[12]=o*i+g*n+v*s+e[12],t[13]=a*i+_*n+C*s+e[13],t[14]=A*i+b*n+S*s+e[14],t[15]=h*i+T*n+P*s+e[15]),t}function v2(t,e,r){let i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function w2(t,e,r,i){let n=i[0],s=i[1],o=i[2],a=Math.sqrt(n*n+s*s+o*o),A,h,g,_,b,T,v,C,S,P,F,I,k,W,K,re,Y,z,L,se,le,ce,he,Re;return a<1e-6?null:(a=1/a,n*=a,s*=a,o*=a,h=Math.sin(r),A=Math.cos(r),g=1-A,_=e[0],b=e[1],T=e[2],v=e[3],C=e[4],S=e[5],P=e[6],F=e[7],I=e[8],k=e[9],W=e[10],K=e[11],re=n*n*g+A,Y=s*n*g+o*h,z=o*n*g-s*h,L=n*s*g-o*h,se=s*s*g+A,le=o*s*g+n*h,ce=n*o*g+s*h,he=s*o*g-n*h,Re=o*o*g+A,t[0]=_*re+C*Y+I*z,t[1]=b*re+S*Y+k*z,t[2]=T*re+P*Y+W*z,t[3]=v*re+F*Y+K*z,t[4]=_*L+C*se+I*le,t[5]=b*L+S*se+k*le,t[6]=T*L+P*se+W*le,t[7]=v*L+F*se+K*le,t[8]=_*ce+C*he+I*Re,t[9]=b*ce+S*he+k*Re,t[10]=T*ce+P*he+W*Re,t[11]=v*ce+F*he+K*Re,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function C2(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],A=e[7],h=e[8],g=e[9],_=e[10],b=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+h*i,t[5]=o*n+g*i,t[6]=a*n+_*i,t[7]=A*n+b*i,t[8]=h*n-s*i,t[9]=g*n-o*i,t[10]=_*n-a*i,t[11]=b*n-A*i,t}function S2(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],A=e[3],h=e[8],g=e[9],_=e[10],b=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-h*i,t[1]=o*n-g*i,t[2]=a*n-_*i,t[3]=A*n-b*i,t[8]=s*i+h*n,t[9]=o*i+g*n,t[10]=a*i+_*n,t[11]=A*i+b*n,t}function M2(t,e,r){let i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],A=e[3],h=e[4],g=e[5],_=e[6],b=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+h*i,t[1]=o*n+g*i,t[2]=a*n+_*i,t[3]=A*n+b*i,t[4]=h*n-s*i,t[5]=g*n-o*i,t[6]=_*n-a*i,t[7]=b*n-A*i,t}function u7(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function f7(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h7(t,e,r){let i=r[0],n=r[1],s=r[2],o=Math.sqrt(i*i+n*n+s*s),a,A,h;return o<1e-6?null:(o=1/o,i*=o,n*=o,s*=o,A=Math.sin(e),a=Math.cos(e),h=1-a,t[0]=i*i*h+a,t[1]=n*i*h+s*A,t[2]=s*i*h-n*A,t[3]=0,t[4]=i*n*h-s*A,t[5]=n*n*h+a,t[6]=s*n*h+i*A,t[7]=0,t[8]=i*s*h+n*A,t[9]=n*s*h-i*A,t[10]=s*s*h+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function d7(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function p7(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g7(t,e){let r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function wv(t,e,r){let i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,A=n+n,h=s+s,g=i*a,_=i*A,b=i*h,T=n*A,v=n*h,C=s*h,S=o*a,P=o*A,F=o*h;return t[0]=1-(T+C),t[1]=_+F,t[2]=b-P,t[3]=0,t[4]=_-F,t[5]=1-(g+C),t[6]=v+S,t[7]=0,t[8]=b+P,t[9]=v-S,t[10]=1-(g+T),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function m7(t,e){let r=new Mt(3),i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],A=e[5],h=e[6],g=e[7],_=i*i+n*n+s*s+o*o;return _>0?(r[0]=(a*o+g*i+A*s-h*n)*2/_,r[1]=(A*o+g*n+h*i-a*s)*2/_,r[2]=(h*o+g*s+a*n-A*i)*2/_):(r[0]=(a*o+g*i+A*s-h*n)*2,r[1]=(A*o+g*n+h*i-a*s)*2,r[2]=(h*o+g*s+a*n-A*i)*2),wv(t,e,r),t}function _7(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Cv(t,e){let r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],A=e[8],h=e[9],g=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(A*A+h*h+g*g),t}function y7(t,e){let r=new Mt(3);Cv(r,e);let i=1/r[0],n=1/r[1],s=1/r[2],o=e[0]*i,a=e[1]*n,A=e[2]*s,h=e[4]*i,g=e[5]*n,_=e[6]*s,b=e[8]*i,T=e[9]*n,v=e[10]*s,C=o+g+v,S=0;return C>0?(S=Math.sqrt(C+1)*2,t[3]=.25*S,t[0]=(_-T)/S,t[1]=(b-A)/S,t[2]=(a-h)/S):o>g&&o>v?(S=Math.sqrt(1+o-g-v)*2,t[3]=(_-T)/S,t[0]=.25*S,t[1]=(a+h)/S,t[2]=(b+A)/S):g>v?(S=Math.sqrt(1+g-o-v)*2,t[3]=(b-A)/S,t[0]=(a+h)/S,t[1]=.25*S,t[2]=(_+T)/S):(S=Math.sqrt(1+v-o-g)*2,t[3]=(a-h)/S,t[0]=(b+A)/S,t[1]=(_+T)/S,t[2]=.25*S),t}function x7(t,e,r,i){e[0]=i[12],e[1]=i[13],e[2]=i[14];let n=i[0],s=i[1],o=i[2],a=i[4],A=i[5],h=i[6],g=i[8],_=i[9],b=i[10];r[0]=Math.sqrt(n*n+s*s+o*o),r[1]=Math.sqrt(a*a+A*A+h*h),r[2]=Math.sqrt(g*g+_*_+b*b);let T=1/r[0],v=1/r[1],C=1/r[2],S=n*T,P=s*v,F=o*C,I=a*T,k=A*v,W=h*C,K=g*T,re=_*v,Y=b*C,z=S+k+Y,L=0;return z>0?(L=Math.sqrt(z+1)*2,t[3]=.25*L,t[0]=(W-re)/L,t[1]=(K-F)/L,t[2]=(P-I)/L):S>k&&S>Y?(L=Math.sqrt(1+S-k-Y)*2,t[3]=(W-re)/L,t[0]=.25*L,t[1]=(P+I)/L,t[2]=(K+F)/L):k>Y?(L=Math.sqrt(1+k-S-Y)*2,t[3]=(K-F)/L,t[0]=(P+I)/L,t[1]=.25*L,t[2]=(W+re)/L):(L=Math.sqrt(1+Y-S-k)*2,t[3]=(P-I)/L,t[0]=(K+F)/L,t[1]=(W+re)/L,t[2]=.25*L),t}function b7(t,e,r,i){let n=e[0],s=e[1],o=e[2],a=e[3],A=n+n,h=s+s,g=o+o,_=n*A,b=n*h,T=n*g,v=s*h,C=s*g,S=o*g,P=a*A,F=a*h,I=a*g,k=i[0],W=i[1],K=i[2];return t[0]=(1-(v+S))*k,t[1]=(b+I)*k,t[2]=(T-F)*k,t[3]=0,t[4]=(b-I)*W,t[5]=(1-(_+S))*W,t[6]=(C+P)*W,t[7]=0,t[8]=(T+F)*K,t[9]=(C-P)*K,t[10]=(1-(_+v))*K,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function T7(t,e,r,i,n){let s=e[0],o=e[1],a=e[2],A=e[3],h=s+s,g=o+o,_=a+a,b=s*h,T=s*g,v=s*_,C=o*g,S=o*_,P=a*_,F=A*h,I=A*g,k=A*_,W=i[0],K=i[1],re=i[2],Y=n[0],z=n[1],L=n[2],se=(1-(C+P))*W,le=(T+k)*W,ce=(v-I)*W,he=(T-k)*K,Re=(1-(b+P))*K,Ke=(S+F)*K,Ye=(v+I)*re,$e=(S-F)*re,nt=(1-(b+C))*re;return t[0]=se,t[1]=le,t[2]=ce,t[3]=0,t[4]=he,t[5]=Re,t[6]=Ke,t[7]=0,t[8]=Ye,t[9]=$e,t[10]=nt,t[11]=0,t[12]=r[0]+Y-(se*Y+he*z+Ye*L),t[13]=r[1]+z-(le*Y+Re*z+$e*L),t[14]=r[2]+L-(ce*Y+Ke*z+nt*L),t[15]=1,t}function P2(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,A=n+n,h=r*o,g=i*o,_=i*a,b=n*o,T=n*a,v=n*A,C=s*o,S=s*a,P=s*A;return t[0]=1-_-v,t[1]=g+P,t[2]=b-S,t[3]=0,t[4]=g-P,t[5]=1-h-v,t[6]=T+C,t[7]=0,t[8]=b+S,t[9]=T-C,t[10]=1-h-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R2(t,e,r,i,n,s,o){let a=1/(r-e),A=1/(n-i),h=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*A,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*A,t[10]=(o+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*h,t[15]=0,t}function Sv(t,e,r,i,n){let s=1/Math.tan(e/2);if(t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){let o=1/(i-n);t[10]=(n+i)*o,t[14]=2*n*i*o}else t[10]=-1,t[14]=-2*i;return t}var I2=Sv;function E7(t,e,r,i,n){let s=1/Math.tan(e/2);if(t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0){let o=1/(i-n);t[10]=n*o,t[14]=n*i*o}else t[10]=-1,t[14]=-i;return t}function v7(t,e,r,i){let n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),A=2/(o+a),h=2/(n+s);return t[0]=A,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-((o-a)*A*.5),t[9]=(n-s)*h*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function Mv(t,e,r,i,n,s,o){let a=1/(e-r),A=1/(i-n),h=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*A,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*A,t[14]=(o+s)*h,t[15]=1,t}var B2=Mv;function w7(t,e,r,i,n,s,o){let a=1/(e-r),A=1/(i-n),h=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*A,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=h,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*A,t[14]=s*h,t[15]=1,t}function O2(t,e,r,i){let n,s,o,a,A,h,g,_,b,T,v=e[0],C=e[1],S=e[2],P=i[0],F=i[1],I=i[2],k=r[0],W=r[1],K=r[2];return Math.abs(v-k)<1e-6&&Math.abs(C-W)<1e-6&&Math.abs(S-K)<1e-6?vv(t):(_=v-k,b=C-W,T=S-K,n=1/Math.sqrt(_*_+b*b+T*T),_*=n,b*=n,T*=n,s=F*T-I*b,o=I*_-P*T,a=P*b-F*_,n=Math.sqrt(s*s+o*o+a*a),n?(n=1/n,s*=n,o*=n,a*=n):(s=0,o=0,a=0),A=b*a-T*o,h=T*s-_*a,g=_*o-b*s,n=Math.sqrt(A*A+h*h+g*g),n?(n=1/n,A*=n,h*=n,g*=n):(A=0,h=0,g=0),t[0]=s,t[1]=A,t[2]=_,t[3]=0,t[4]=o,t[5]=h,t[6]=b,t[7]=0,t[8]=a,t[9]=g,t[10]=T,t[11]=0,t[12]=-(s*v+o*C+a*S),t[13]=-(A*v+h*C+g*S),t[14]=-(_*v+b*C+T*S),t[15]=1,t)}function C7(t,e,r,i){let n=e[0],s=e[1],o=e[2],a=i[0],A=i[1],h=i[2],g=n-r[0],_=s-r[1],b=o-r[2],T=g*g+_*_+b*b;T>0&&(T=1/Math.sqrt(T),g*=T,_*=T,b*=T);let v=A*b-h*_,C=h*g-a*b,S=a*_-A*g;return T=v*v+C*C+S*S,T>0&&(T=1/Math.sqrt(T),v*=T,C*=T,S*=T),t[0]=v,t[1]=C,t[2]=S,t[3]=0,t[4]=_*S-b*C,t[5]=b*v-g*S,t[6]=g*C-_*v,t[7]=0,t[8]=g,t[9]=_,t[10]=b,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function S7(t){return`mat4(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}, ${t[4]}, ${t[5]}, ${t[6]}, ${t[7]}, ${t[8]}, ${t[9]}, ${t[10]}, ${t[11]}, ${t[12]}, ${t[13]}, ${t[14]}, ${t[15]})`}function M7(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8]+t[9]*t[9]+t[10]*t[10]+t[11]*t[11]+t[12]*t[12]+t[13]*t[13]+t[14]*t[14]+t[15]*t[15])}function P7(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Pv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function R7(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function I7(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function B7(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function O7(t,e){let r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],A=t[6],h=t[7],g=t[8],_=t[9],b=t[10],T=t[11],v=t[12],C=t[13],S=t[14],P=t[15],F=e[0],I=e[1],k=e[2],W=e[3],K=e[4],re=e[5],Y=e[6],z=e[7],L=e[8],se=e[9],le=e[10],ce=e[11],he=e[12],Re=e[13],Ke=e[14],Ye=e[15];return Math.abs(r-F)<=1e-6*Math.max(1,Math.abs(r),Math.abs(F))&&Math.abs(i-I)<=1e-6*Math.max(1,Math.abs(i),Math.abs(I))&&Math.abs(n-k)<=1e-6*Math.max(1,Math.abs(n),Math.abs(k))&&Math.abs(s-W)<=1e-6*Math.max(1,Math.abs(s),Math.abs(W))&&Math.abs(o-K)<=1e-6*Math.max(1,Math.abs(o),Math.abs(K))&&Math.abs(a-re)<=1e-6*Math.max(1,Math.abs(a),Math.abs(re))&&Math.abs(A-Y)<=1e-6*Math.max(1,Math.abs(A),Math.abs(Y))&&Math.abs(h-z)<=1e-6*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(g-L)<=1e-6*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(_-se)<=1e-6*Math.max(1,Math.abs(_),Math.abs(se))&&Math.abs(b-le)<=1e-6*Math.max(1,Math.abs(b),Math.abs(le))&&Math.abs(T-ce)<=1e-6*Math.max(1,Math.abs(T),Math.abs(ce))&&Math.abs(v-he)<=1e-6*Math.max(1,Math.abs(v),Math.abs(he))&&Math.abs(C-Re)<=1e-6*Math.max(1,Math.abs(C),Math.abs(Re))&&Math.abs(S-Ke)<=1e-6*Math.max(1,Math.abs(S),Math.abs(Ke))&&Math.abs(P-Ye)<=1e-6*Math.max(1,Math.abs(P),Math.abs(Ye))}var F7=sA,L7=Pv;var Qr={};fr(Qr,{add:()=>F2,ceil:()=>N7,clone:()=>Iv,copy:()=>Ov,create:()=>Rv,cross:()=>W7,dist:()=>Z7,distance:()=>kv,div:()=>J7,divide:()=>Dv,dot:()=>D2,equals:()=>Q7,exactEquals:()=>Vv,floor:()=>D7,forEach:()=>rk,fromValues:()=>Bv,inverse:()=>G7,len:()=>ek,length:()=>o0,lerp:()=>k2,max:()=>U7,min:()=>k7,mul:()=>K7,multiply:()=>Nv,negate:()=>H7,normalize:()=>N2,random:()=>j7,round:()=>V7,scale:()=>L2,scaleAndAdd:()=>z7,set:()=>Fv,sqrDist:()=>$7,sqrLen:()=>tk,squaredDistance:()=>Uv,squaredLength:()=>a0,str:()=>Y7,sub:()=>q7,subtract:()=>Lv,transformMat4:()=>U2,transformQuat:()=>V2,zero:()=>X7});function Rv(){let t=new Mt(4);return Mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Iv(t){let e=new Mt(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Bv(t,e,r,i){let n=new Mt(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function Ov(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Fv(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function F2(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Lv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Nv(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Dv(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function N7(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function D7(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function k7(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function U7(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function V7(t,e){return t[0]=_i(e[0]),t[1]=_i(e[1]),t[2]=_i(e[2]),t[3]=_i(e[3]),t}function L2(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function z7(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function kv(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function Uv(t,e){let r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function o0(t){let e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function a0(t){let e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function H7(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function G7(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function N2(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o,t}function D2(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function W7(t,e,r,i){let n=r[0]*i[1]-r[1]*i[0],s=r[0]*i[2]-r[2]*i[0],o=r[0]*i[3]-r[3]*i[0],a=r[1]*i[2]-r[2]*i[1],A=r[1]*i[3]-r[3]*i[1],h=r[2]*i[3]-r[3]*i[2],g=e[0],_=e[1],b=e[2],T=e[3];return t[0]=_*h-b*A+T*a,t[1]=-(g*h)+b*o-T*s,t[2]=g*A-_*o+T*n,t[3]=-(g*a)+_*s-b*n,t}function k2(t,e,r,i){let n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function j7(t,e){e=e===void 0?1:e;let r,i,n,s,o,a;do r=an()*2-1,i=an()*2-1,o=r*r+i*i;while(o>=1);do n=an()*2-1,s=an()*2-1,a=n*n+s*s;while(a>=1);let A=Math.sqrt((1-o)/a);return t[0]=e*r,t[1]=e*i,t[2]=e*n*A,t[3]=e*s*A,t}function U2(t,e,r){let i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function V2(t,e,r){let i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],A=r[2],h=r[3],g=h*i+a*s-A*n,_=h*n+A*i-o*s,b=h*s+o*n-a*i,T=-o*i-a*n-A*s;return t[0]=g*h+T*-o+_*-A-b*-a,t[1]=_*h+T*-a+b*-o-g*-A,t[2]=b*h+T*-A+g*-a-_*-o,t[3]=e[3],t}function X7(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Y7(t){return`vec4(${t[0]}, ${t[1]}, ${t[2]}, ${t[3]})`}function Vv(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Q7(t,e){let r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],A=e[2],h=e[3];return Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-A)<=1e-6*Math.max(1,Math.abs(n),Math.abs(A))&&Math.abs(s-h)<=1e-6*Math.max(1,Math.abs(s),Math.abs(h))}var q7=Lv,K7=Nv,J7=Dv,Z7=kv,$7=Uv,ek=o0,tk=a0,rk=function(){let t=Rv();return function(e,r,i,n,s,o){let a,A;for(r||(r=4),i||(i=0),n?A=Math.min(n*r+i,e.length):A=e.length,a=i;a<A;a+=r)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}();var G2;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(G2||(G2={}));var ik=45*Math.PI/180,nk=1,z2=.1,H2=500,sk=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ce=class extends Na{static get IDENTITY(){return ak()}static get ZERO(){return ok()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return G2}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,r,i,n,s,o,a,A,h,g,_,b,T,v,C,S){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this[4]=s,this[5]=o,this[6]=a,this[7]=A,this[8]=h,this[9]=g,this[10]=_,this[11]=b,this[12]=T,this[13]=v,this[14]=C,this[15]=S,this.check()}setRowMajor(e,r,i,n,s,o,a,A,h,g,_,b,T,v,C,S){return this[0]=e,this[1]=s,this[2]=h,this[3]=T,this[4]=r,this[5]=o,this[6]=g,this[7]=v,this[8]=i,this[9]=a,this[10]=_,this[11]=C,this[12]=n,this[13]=A,this[14]=b,this[15]=S,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(sk)}fromObject(e){return this.check()}fromQuaternion(e){return P2(this,e),this.check()}frustum(e){let{left:r,right:i,bottom:n,top:s,near:o=z2,far:a=H2}=e;return a===1/0?ck(this,r,i,n,s,o):R2(this,r,i,n,s,o,a),this.check()}lookAt(e){let{eye:r,center:i=[0,0,0],up:n=[0,1,0]}=e;return O2(this,r,i,n),this.check()}ortho(e){let{left:r,right:i,bottom:n,top:s,near:o=z2,far:a=H2}=e;return B2(this,r,i,n,s,o,a),this.check()}orthographic(e){let{fovy:r=ik,aspect:i=nk,focalDistance:n=1,near:s=z2,far:o=H2}=e;zv(r);let a=r/2,A=n*Math.tan(a),h=A*i;return this.ortho({left:-h,right:h,bottom:-A,top:A,near:s,far:o})}perspective(e){let{fovy:r=45*Math.PI/180,aspect:i=1,near:n=.1,far:s=500}=e;return zv(r),I2(this,r,i,n,s),this.check()}determinant(){return T2(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let i=this.getScale(r),n=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*n,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*n,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,r){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let i=this.getScale(r),n=1/i[0],s=1/i[1],o=1/i[2];return e[0]=this[0]*n,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*n,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*n,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return x2(this,this),this.check()}invert(){return b2(this,this),this.check()}multiplyLeft(e){return sA(this,e,this),this.check()}multiplyRight(e){return sA(this,this,e),this.check()}rotateX(e){return C2(this,this,e),this.check()}rotateY(e){return S2(this,this,e),this.check()}rotateZ(e){return M2(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,r){return w2(this,this,e,r),this.check()}scale(e){return v2(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return E2(this,this,e),this.check()}transform(e,r){return e.length===4?(r=U2(r||[-0,-0,-0,-0],e,this),bs(r,4),r):this.transformAsPoint(e,r)}transformAsPoint(e,r){let{length:i}=e,n;switch(i){case 2:n=tA(r||[-0,-0],e,this);break;case 3:n=vo(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return bs(n,e.length),n}transformAsVector(e,r){let i;switch(e.length){case 2:i=Kh(r||[-0,-0],e,this);break;case 3:i=Jh(r||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return bs(i,e.length),i}transformPoint(e,r){return this.transformAsPoint(e,r)}transformVector(e,r){return this.transformAsPoint(e,r)}transformDirection(e,r){return this.transformAsVector(e,r)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,r,i){return this.identity().translate([e,r,i])}},c0,l0;function ok(){return c0||(c0=new Ce([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(c0)),c0}function ak(){return l0||(l0=new Ce,Object.freeze(l0)),l0}function zv(t){if(t>Math.PI*2)throw Error("expected radians")}function ck(t,e,r,i,n,s){let o=2*s/(r-e),a=2*s/(n-i),A=(r+e)/(r-e),h=(n+i)/(n-i),g=-1,_=-1,b=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=A,t[9]=h,t[10]=g,t[11]=_,t[12]=0,t[13]=0,t[14]=b,t[15]=0,t}function Hv(){let t=new Mt(4);return Mt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Gv(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function W2(t,e,r){r=r*.5;let i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function j2(t,e,r){let i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],A=r[1],h=r[2],g=r[3];return t[0]=i*g+o*a+n*h-s*A,t[1]=n*g+o*A+s*a-i*h,t[2]=s*g+o*h+i*A-n*a,t[3]=o*g-i*a-n*A-s*h,t}function Wv(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),A=Math.cos(r);return t[0]=i*A+o*a,t[1]=n*A+s*a,t[2]=s*A-n*a,t[3]=o*A-i*a,t}function jv(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),A=Math.cos(r);return t[0]=i*A-s*a,t[1]=n*A+o*a,t[2]=s*A+i*a,t[3]=o*A-n*a,t}function Xv(t,e,r){r*=.5;let i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),A=Math.cos(r);return t[0]=i*A+n*a,t[1]=n*A-i*a,t[2]=s*A+o*a,t[3]=o*A-s*a,t}function Yv(t,e){let r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function oA(t,e,r,i){let n=e[0],s=e[1],o=e[2],a=e[3],A=r[0],h=r[1],g=r[2],_=r[3],b,T,v,C,S;return b=n*A+s*h+o*g+a*_,b<0&&(b=-b,A=-A,h=-h,g=-g,_=-_),1-b>1e-6?(T=Math.acos(b),S=Math.sin(T),v=Math.sin((1-i)*T)/S,C=Math.sin(i*T)/S):(v=1-i,C=i),t[0]=v*n+C*A,t[1]=v*s+C*h,t[2]=v*o+C*g,t[3]=v*a+C*_,t}function Qv(t,e){let r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function qv(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function X2(t,e){let r=e[0]+e[4]+e[8],i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[n*3+n]&&(n=2);let s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[n*3+n]-e[s*3+s]-e[o*3+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[s*3+o]-e[o*3+s])*i,t[s]=(e[s*3+n]+e[n*3+s])*i,t[o]=(e[o*3+n]+e[n*3+o])*i}return t}var Kv=F2;var Jv=L2,Zv=D2,$v=k2,ew=o0;var tw=a0;var rw=N2;var iw=function(){let t=$h(),e=e0(1,0,0),r=e0(0,1,0);return function(i,n,s){let o=rA(n,s);return o<-.999999?(Eo(t,e,n),p2(t)<1e-6&&Eo(t,r,n),A2(t,t),W2(i,t,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(Eo(t,n,s),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+o,rw(i,i))}}(),ffe=function(){let t=Hv(),e=Hv();return function(r,i,n,s,o,a){return oA(t,i,o,a),oA(e,n,s,a),oA(r,t,e,2*a*(1-a)),r}}(),hfe=function(){let t=gv();return function(e,r,i,n){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=n[0],t[4]=n[1],t[7]=n[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],rw(e,X2(e,t))}}();var Ak=[0,0,0,1],yi=class extends xs{constructor(e=0,r=0,i=0,n=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,r,i,n)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,r,i,n){return this[0]=e,this[1]=r,this[2]=i,this[3]=n,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return X2(this,e),this.check()}fromAxisRotation(e,r){return W2(this,e,r),this.check()}identity(){return Gv(this),this.check()}setAxisAngle(e,r){return this.fromAxisRotation(e,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=it(e)}get y(){return this[1]}set y(e){this[1]=it(e)}get z(){return this[2]}set z(e){this[2]=it(e)}get w(){return this[3]}set w(e){this[3]=it(e)}len(){return ew(this)}lengthSquared(){return tw(this)}dot(e){return Zv(this,e)}rotationTo(e,r){return iw(this,e,r),this.check()}add(e){return Kv(this,this,e),this.check()}calculateW(){return Yv(this,this),this.check()}conjugate(){return qv(this,this),this.check()}invert(){return Qv(this,this),this.check()}lerp(e,r,i){return i===void 0?this.lerp(this,e,r):($v(this,e,r,i),this.check())}multiplyRight(e){return j2(this,this,e),this.check()}multiplyLeft(e){return j2(this,e,this),this.check()}normalize(){let e=this.len(),r=e>0?1/e:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,e===0&&(this[3]=1),this.check()}rotateX(e){return Wv(this,this,e),this.check()}rotateY(e){return jv(this,this,e),this.check()}rotateZ(e){return Xv(this,this,e),this.check()}scale(e){return Jv(this,this,e),this.check()}slerp(e,r,i){let n,s,o;switch(arguments.length){case 1:({start:n=Ak,target:s,ratio:o}=e);break;case 2:n=this,s=e,o=r;break;default:n=e,s=r,o=i}return oA(this,n,s,o),this.check()}transformVector4(e,r=new i0){return V2(r,e,this),bs(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,r){return this.setAxisAngle(e,r)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}};var Oi={};fr(Oi,{EPSILON1:()=>uk,EPSILON10:()=>xk,EPSILON11:()=>bk,EPSILON12:()=>Tk,EPSILON13:()=>Ek,EPSILON14:()=>vk,EPSILON15:()=>wk,EPSILON16:()=>Ck,EPSILON17:()=>Sk,EPSILON18:()=>Mk,EPSILON19:()=>Pk,EPSILON2:()=>fk,EPSILON20:()=>Rk,EPSILON3:()=>hk,EPSILON4:()=>dk,EPSILON5:()=>pk,EPSILON6:()=>gk,EPSILON7:()=>mk,EPSILON8:()=>_k,EPSILON9:()=>yk,PI_OVER_FOUR:()=>Bk,PI_OVER_SIX:()=>Ok,PI_OVER_TWO:()=>Ik,TWO_PI:()=>Fk});var uk=.1,fk=.01,hk=.001,dk=1e-4,pk=1e-5,gk=1e-6,mk=1e-7,_k=1e-8,yk=1e-9,xk=1e-10,bk=1e-11,Tk=1e-12,Ek=1e-13,vk=1e-14,wk=1e-15,Ck=1e-16,Sk=1e-17,Mk=1e-18,Pk=1e-19,Rk=1e-20,Ik=Math.PI/2,Bk=Math.PI/4,Ok=Math.PI/6,Fk=Math.PI*2;function Y2(t,e=[],r=0){let i=Math.fround(t),n=t-i;return e[r]=i,e[r+1]=n,e}function nw(t){return t-Math.fround(t)}function sw(t){let e=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){let n=r*4+i;Y2(t[i*4+r],e,n*2)}return e}var Lk=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,Q2={name:"fp32",vs:Lk};var ow=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`;var Nk={ONE:1},q2={name:"fp64arithmetic",vs:ow,defaultUniforms:Nk,uniformTypes:{ONE:"f32"},fp64ify:Y2,fp64LowPart:nw,fp64ifyMatrix4:sw};var Dk=[0,1,1,1],kk=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,Uk=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,A0={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:Dk},vs:kk,fs:Uk,getUniforms:Vk};function Vk(t={},e){let r={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let i=t.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=i}if(t.highlightColor){let i=Array.from(t.highlightColor,n=>n/255);Number.isFinite(i[3])||(i[3]=1),r.highlightColor=i}return t.isActive!==void 0&&(r.isActive=!!t.isActive,r.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(r.useFloatColors=!!t.useFloatColors),r}var K2=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`;var aw=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;var cw=3,zk=255,aA;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(aA||(aA={}));var Vn={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:cw},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:aA.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:aw,vs:K2,fs:K2,getUniforms:Hk};function Hk(t,e={}){if(t=t&&{...t},!t)return{...Vn.defaultUniforms};t.lights&&(t={...t,...Wk(t.lights),lights:void 0});let{ambientLight:r,pointLights:i,directionalLights:n}=t||{};if(!(r||i&&i.length>0||n&&n.length>0))return{...Vn.defaultUniforms,enabled:0};let o={...Vn.defaultUniforms,...e,...Gk({ambientLight:r,pointLights:i,directionalLights:n})};return t.enabled!==void 0&&(o.enabled=t.enabled?1:0),o}function Gk({ambientLight:t,pointLights:e=[],directionalLights:r=[]}){let i={};i.ambientLightColor=J2(t);let n=0;for(let s of e){i.lightType=aA.POINT;let o=n;i[`lightColor${o}`]=J2(s),i[`lightPosition${o}`]=s.position,i[`lightAttenuation${o}`]=s.attenuation||[1,0,0],n++}for(let s of r){i.lightType=aA.DIRECTIONAL;let o=n;i[`lightColor${o}`]=J2(s),i[`lightDirection${o}`]=s.direction,n++}return n>cw&&oe.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=r.length,i.pointLightCount=e.length,i}function Wk(t){let e={pointLights:[],directionalLights:[]};for(let r of t||[])switch(r.type){case"ambient":e.ambientLight=r;break;case"directional":e.directionalLights?.push(r);break;case"point":e.pointLights?.push(r);break;default:}return e}function J2(t={}){let{color:e=[0,0,0],intensity:r=1}=t;return e.map(i=>i*r/zk)}var u0=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,f0=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`;var Es={props:{},name:"gouraudMaterial",vs:f0.replace("phongMaterial","gouraudMaterial"),fs:u0.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Vn],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){let e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...Es.defaultUniforms,...e}}};var lw=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`;var Da={name:"phongMaterial",dependencies:[Vn],source:lw,vs:u0,fs:f0,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){let e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(r=>r/255)),{...Da.defaultUniforms,...e}}};var Aw=`out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`;var uw=`precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`;var fw=`uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,hw={name:"pbrProjection",vs:fw,fs:fw,getUniforms:t=>t,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}};var wo={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Vn,hw],vs:Aw,fs:uw,defines:{LIGHTING_FRAGMENT:1},getUniforms:t=>t,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}};var dw=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,Z2={name:"layer",vs:dw,fs:dw,getUniforms:t=>({opacity:Math.pow(t.opacity,.45454545454545453)}),uniformTypes:{opacity:"f32"}};var pw="#define SMOOTH_EDGE_RADIUS 0.5",jk=`
${pw}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,Xk=`
${pw}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,h0={name:"geometry",vs:jk,fs:Xk};var Tt;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(Tt||(Tt={}));var Dt;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Dt||(Dt={}));var Ie;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(Ie||(Ie={}));var gw="compute",$2="auto",cA="manipulation",Co="none",lA="pan-x",AA="pan-y";function e_(t){if(t.includes(Co))return Co;let e=t.includes(lA),r=t.includes(AA);return e&&r?Co:e||r?e?lA:AA:t.includes(cA)?cA:$2}var uA=class{constructor(e,r){this.actions="",this.manager=e,this.set(r)}set(e){e===gw&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let r of this.manager.recognizers)r.options.enable&&(e=e.concat(r.getTouchAction()));return e_(e.join(" "))}};function ka(t){return t.trim().split(/\s+/g)}function d0(t,e,r){if(t)for(let i of ka(e))t.addEventListener(i,r,!1)}function p0(t,e,r){if(t)for(let i of ka(e))t.removeEventListener(i,r,!1)}function t_(t){return(t.ownerDocument||t).defaultView}function r_(t,e){let r=t;for(;r;){if(r===e)return!0;r=r.parentNode}return!1}function g0(t){let e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let r=0,i=0,n=0;for(;n<e;)r+=t[n].clientX,i+=t[n].clientY,n++;return{x:Math.round(r/e),y:Math.round(i/e)}}function i_(t){let e=[],r=0;for(;r<t.pointers.length;)e[r]={clientX:Math.round(t.pointers[r].clientX),clientY:Math.round(t.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:e,center:g0(e),deltaX:t.deltaX,deltaY:t.deltaY}}function m0(t,e){let r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function n_(t,e){let r=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(r*r+i*i)}function mw(t,e){let r=e.x-t.x,i=e.y-t.y;return Math.atan2(i,r)*180/Math.PI}function s_(t,e){let r=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.atan2(i,r)*180/Math.PI}function _0(t,e){return t===e?Dt.None:Math.abs(t)>=Math.abs(e)?t<0?Dt.Left:Dt.Right:e<0?Dt.Up:Dt.Down}function _w(t,e){let r=e.center,i=t.offsetDelta,n=t.prevDelta,s=t.prevInput;return(e.eventType===Tt.Start||s?.eventType===Tt.End)&&(n=t.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},i=t.offsetDelta={x:r.x,y:r.y}),{deltaX:n.x+(r.x-i.x),deltaY:n.y+(r.y-i.y)}}function y0(t,e,r){return{x:e/t||0,y:r/t||0}}function yw(t,e){return n_(e[0],e[1])/n_(t[0],t[1])}function xw(t,e){return s_(e[1],e[0])-s_(t[1],t[0])}function bw(t,e){let r=t.lastInterval||e,i=e.timeStamp-r.timeStamp,n,s,o,a;if(e.eventType!==Tt.Cancel&&(i>25||r.velocity===void 0)){let A=e.deltaX-r.deltaX,h=e.deltaY-r.deltaY,g=y0(i,A,h);s=g.x,o=g.y,n=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,a=_0(A,h),t.lastInterval=e}else n=r.velocity,s=r.velocityX,o=r.velocityY,a=r.direction;e.velocity=n,e.velocityX=s,e.velocityY=o,e.direction=a}function Tw(t,e){let{session:r}=t,{pointers:i}=e,{length:n}=i;r.firstInput||(r.firstInput=i_(e)),n>1&&!r.firstMultiple?r.firstMultiple=i_(e):n===1&&(r.firstMultiple=!1);let{firstInput:s,firstMultiple:o}=r,a=o?o.center:s.center,A=e.center=g0(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=mw(a,A),e.distance=m0(a,A);let{deltaX:h,deltaY:g}=_w(r,e);e.deltaX=h,e.deltaY=g,e.offsetDirection=_0(e.deltaX,e.deltaY);let _=y0(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=o?yw(o.pointers,i):1,e.rotation=o?xw(o.pointers,i):0,e.maxPointers=r.prevInput?e.pointers.length>r.prevInput.maxPointers?e.pointers.length:r.prevInput.maxPointers:e.pointers.length;let b=t.element;return r_(e.srcEvent.target,b)&&(b=e.srcEvent.target),e.target=b,bw(r,e),e}function Ew(t,e,r){let i=r.pointers.length,n=r.changedPointers.length,s=e&Tt.Start&&i-n===0,o=e&(Tt.End|Tt.Cancel)&&i-n===0;r.isFirst=!!s,r.isFinal=!!o,s&&(t.session={}),r.eventType=e;let a=Tw(t,r);t.emit("hammer.input",a),t.recognize(a),t.session.prevInput=a}var fA=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,r){Ew(this.manager,e,r)}init(){d0(this.element,this.evEl,this.domHandler),d0(this.target,this.evTarget,this.domHandler),d0(t_(this.element),this.evWin,this.domHandler)}destroy(){p0(this.element,this.evEl,this.domHandler),p0(this.target,this.evTarget,this.domHandler),p0(t_(this.element),this.evWin,this.domHandler)}};var Qk={pointerdown:Tt.Start,pointermove:Tt.Move,pointerup:Tt.End,pointercancel:Tt.Cancel,pointerout:Tt.Cancel},qk="pointerdown",Kk="pointermove pointerup pointercancel",hA=class extends fA{constructor(e){super(e),this.evEl=qk,this.evWin=Kk,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:r}=this,i=!1,n=Qk[e.type],s=e.pointerType,o=s==="touch",a=r.findIndex(A=>A.pointerId===e.pointerId);n&Tt.Start&&(e.buttons||o)?a<0&&(r.push(e),a=r.length-1):n&(Tt.End|Tt.Cancel)&&(i=!0),!(a<0)&&(r[a]=e,this.callback(n,{pointers:r,changedPointers:[e],eventType:n,pointerType:s,srcEvent:e}),i&&r.splice(a,1))}};var Jk=["","webkit","Moz","MS","ms","o"];function vw(t,e){let r=e[0].toUpperCase()+e.slice(1);for(let i of Jk){let n=i?i+r:e;if(n in t)return n}}var Zk=1,ww=2,Cw={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}},dA=class{constructor(e,r){this.options={...Cw,...r,cssProps:{...Cw.cssProps,...r.cssProps},inputTarget:r.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new hA(this),this.touchAction=new uA(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?ww:Zk}recognize(e){let{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i,{recognizers:n}=this,{curRecognizer:s}=r;(!s||s&&s.state&Ie.Recognized)&&(s=r.curRecognizer=null);let o=0;for(;o<n.length;)i=n[o],r.stopped!==ww&&(!s||i===s||i.canRecognizeWith(s))?i.recognize(e):i.reset(),!s&&i.state&(Ie.Began|Ie.Changed|Ie.Ended)&&(s=r.curRecognizer=i),o++}get(e){let{recognizers:r}=this;for(let i=0;i<r.length;i++)if(r[i].options.event===e)return r[i];return null}add(e){if(Array.isArray(e)){for(let i of e)this.add(i);return this}let r=this.get(e.options.event);return r&&this.remove(r),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let i of e)this.remove(i);return this}let r=typeof e=="string"?this.get(e):e;if(r){let{recognizers:i}=this,n=i.indexOf(r);n!==-1&&(i.splice(n,1),this.touchAction.update())}return this}on(e,r){if(!e||!r)return;let{handlers:i}=this;for(let n of ka(e))i[n]=i[n]||[],i[n].push(r)}off(e,r){if(!e)return;let{handlers:i}=this;for(let n of ka(e))r?i[n]&&i[n].splice(i[n].indexOf(r),1):delete i[n]}emit(e,r){let i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;let n=r;n.type=e,n.preventDefault=function(){r.srcEvent.preventDefault()};let s=0;for(;s<i.length;)i[s](n),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:r}=this;if(r){for(let[i,n]of Object.entries(this.options.cssProps)){let s=vw(r.style,i);e?(this.oldCssProps[s]=r.style[s],r.style[s]=n):r.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}};var $k=1;function Sw(){return $k++}function o_(t){return t&Ie.Cancelled?"cancel":t&Ie.Ended?"end":t&Ie.Changed?"move":t&Ie.Began?"start":""}var zn=class{constructor(e){this.options=e,this.id=Sw(),this.state=Ie.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(let n of e)this.recognizeWith(n);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;let{simultaneous:i}=this;return i[r.id]||(i[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(let i of e)this.dropRecognizeWith(i);return this}let r;return typeof e=="string"?r=this.manager.get(e):r=e,r&&delete this.simultaneous[r.id],this}requireFailure(e){if(Array.isArray(e)){for(let n of e)this.requireFailure(n);return this}let r;if(typeof e=="string"){if(r=this.manager.get(e),!r)throw new Error(`Cannot find recognizer ${e}`)}else r=e;let{requireFail:i}=this;return i.indexOf(r)===-1&&(i.push(r),r.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(let i of e)this.dropRequireFailure(i);return this}let r;if(typeof e=="string"?r=this.manager.get(e):r=e,r){let i=this.requireFail.indexOf(r);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:r}=this;r<Ie.Ended&&this.manager.emit(this.options.event+o_(r),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),r>=Ie.Ended&&this.manager.emit(this.options.event+o_(r),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ie.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ie.Failed|Ie.Possible)))return!1;e++}return!0}recognize(e){let r={...e};if(!this.options.enable){this.reset(),this.state=Ie.Failed;return}this.state&(Ie.Recognized|Ie.Cancelled|Ie.Failed)&&(this.state=Ie.Possible),this.state=this.process(r),this.state&(Ie.Began|Ie.Changed|Ie.Ended|Ie.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}};var Hn=class extends zn{attrTest(e){let r=this.options.pointers;return r===0||e.pointers.length===r}process(e){let{state:r}=this,{eventType:i}=e,n=r&(Ie.Began|Ie.Changed),s=this.attrTest(e);return n&&(i&Tt.Cancel||!s)?r|Ie.Cancelled:n||s?i&Tt.End?r|Ie.Ended:r&Ie.Began?r|Ie.Changed:Ie.Began:Ie.Failed}};var So=class extends zn{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[cA]}process(e){let{options:r}=this,i=e.pointers.length===r.pointers,n=e.distance<r.threshold,s=e.deltaTime<r.time;if(this.reset(),e.eventType&Tt.Start&&this.count===0)return this.failTimeout();if(n&&s&&i){if(e.eventType!==Tt.End)return this.failTimeout();let o=this.pTime?e.timeStamp-this.pTime<r.interval:!0,a=!this.pCenter||m0(this.pCenter,e.center)<r.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!o?this.count=1:this.count+=1,this._input=e,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ie.Recognized,this.tryEmit(this._input)},r.interval),Ie.Began):Ie.Recognized}return Ie.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ie.Failed},this.options.interval),Ie.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ie.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}};var eU=["","start","move","end","cancel","up","down","left","right"],vs=class extends Hn{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Dt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,r=[];return e&Dt.Horizontal&&r.push(AA),e&Dt.Vertical&&r.push(lA),r}getEventNames(){return eU.map(e=>this.options.event+e)}directionTest(e){let{options:r}=this,i=!0,{distance:n}=e,{direction:s}=e,o=e.deltaX,a=e.deltaY;return s&r.direction||(r.direction&Dt.Horizontal?(s=o===0?Dt.None:o<0?Dt.Left:Dt.Right,i=o!==this.pX,n=Math.abs(e.deltaX)):(s=a===0?Dt.None:a<0?Dt.Up:Dt.Down,i=a!==this.pY,n=Math.abs(e.deltaY))),e.direction=s,i&&n>r.threshold&&!!(s&r.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ie.Began)||!(this.state&Ie.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let r=Dt[e.direction].toLowerCase();r&&(e.additionalEvent=this.options.event+r),super.emit(e)}};var tU=["","start","move","end","cancel","in","out"],Ua=class extends Hn{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Co]}getEventNames(){return tU.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ie.Began))}emit(e){if(e.scale!==1){let r=e.scale<1?"in":"out";e.additionalEvent=this.options.event+r}super.emit(e)}};var ln=class{constructor(e,r,i){this.element=e,this.callback=r,this.options=i}};var Mw=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",Ude=typeof window<"u"?window:global;var sU=Mw.indexOf("firefox")!==-1,Pw=4.000244140625,oU=40,aU=.25,x0=class extends ln{constructor(e,r,i){super(e,r,{enable:!0,...i}),this.handleEvent=n=>{if(!this.options.enable)return;let s=n.deltaY;globalThis.WheelEvent&&(sU&&n.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),n.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=oU)),s!==0&&s%Pw===0&&(s=Math.floor(s/Pw)),n.shiftKey&&s&&(s=s*aU),this.callback({type:"wheel",center:{x:n.clientX,y:n.clientY},delta:-s,srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,r){e==="wheel"&&(this.options.enable=r)}};var Rw=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],b0=class extends ln{constructor(e,r,i){super(e,r,{enable:!0,...i}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;let{enable:n}=this.options;this.enableMoveEvent=n,this.enableLeaveEvent=n,this.enableEnterEvent=n,this.enableOutEvent=n,this.enableOverEvent=n,Rw.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){Rw.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){switch(e){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break;default:}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break;default:}}_emit(e,r){this.callback({type:e,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var Iw=["keydown","keyup"],T0=class extends ln{constructor(e,r,i){super(e,r,{enable:!0,tabIndex:0,...i}),this.handleEvent=n=>{let s=n.target||n.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&n.type==="keydown"&&this.callback({type:"keydown",srcEvent:n,key:n.key,target:n.target}),this.enableUpEvent&&n.type==="keyup"&&this.callback({type:"keyup",srcEvent:n,key:n.key,target:n.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Iw.forEach(n=>e.addEventListener(n,this.handleEvent))}destroy(){Iw.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,r){e==="keydown"&&(this.enableDownEvent=r),e==="keyup"&&(this.enableUpEvent=r)}};var E0=class extends ln{constructor(e,r,i){super(e,r,i),this.handleEvent=n=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,r){e==="contextmenu"&&(this.options.enable=r)}};var cU={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},lU=0,AU=1,uU=2,fU=1,hU=2,dU=4;function Bw(t){let e=cU[t.srcEvent.type];if(!e)return null;let{buttons:r,button:i}=t.srcEvent,n=!1,s=!1,o=!1;return e===2?(n=!!(r&fU),s=!!(r&dU),o=!!(r&hU)):(n=i===lU,s=i===AU,o=i===uU),{leftButton:n,middleButton:s,rightButton:o}}function Ow(t,e){let r=t.center;if(!r)return null;let i=e.getBoundingClientRect(),n=i.width/e.offsetWidth||1,s=i.height/e.offsetHeight||1,o={x:(r.x-i.left-e.clientLeft)/n,y:(r.y-i.top-e.clientTop)/s};return{center:r,offsetCenter:o}}var pU={srcElement:"root",priority:0},v0=class{constructor(e,r){this.handleEvent=i=>{if(this.isEmpty())return;let n=this._normalizeEvent(i),s=i.srcEvent.target;for(;s&&s!==n.rootElement;){if(this._emit(n,s),n.handled)return;s=s.parentNode}this._emit(n,"root")},this.eventManager=e,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,r,i,n=!1,s=!1){let{handlers:o,handlersByElement:a}=this,A={...pU,...i},h=a.get(A.srcElement);h||(h=[],a.set(A.srcElement,h));let g={type:e,handler:r,srcElement:A.srcElement,priority:A.priority};n&&(g.once=!0),s&&(g.passive=!0),o.push(g),this._active=this._active||!g.passive;let _=h.length-1;for(;_>=0&&!(h[_].priority>=g.priority);)_--;h.splice(_+1,0,g)}remove(e,r){let{handlers:i,handlersByElement:n}=this;for(let s=i.length-1;s>=0;s--){let o=i[s];if(o.type===e&&o.handler===r){i.splice(s,1);let a=n.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&n.delete(o.srcElement)}}this._active=i.some(s=>!s.passive)}_emit(e,r){let i=this.handlersByElement.get(r);if(i){let n=!1,s=()=>{e.handled=!0},o=()=>{e.handled=!0,n=!0},a=[];for(let A=0;A<i.length;A++){let{type:h,handler:g,once:_}=i[A];if(g({...e,type:h,stopPropagation:s,stopImmediatePropagation:o}),_&&a.push(i[A]),n)break}for(let A=0;A<a.length;A++){let{type:h,handler:g}=a[A];this.remove(h,g)}}}_normalizeEvent(e){let r=this.eventManager.getElement();return{...e,...Bw(e),...Ow(e,r),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};function gU(t){if("recognizer"in t)return t;let e,r=Array.isArray(t)?[...t]:[t];if(typeof r[0]=="function"){let i=r.shift(),n=r.shift()||{};e=new i(n)}else e=r.shift();return{recognizer:e,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}var pA=class{constructor(e=null,r={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=e,!!e){this.manager=new dA(e,this.options);for(let i of this.options.recognizers){let{recognizer:n,recognizeWith:s,requireFailure:o}=gU(i);this.manager.add(n),s&&n.recognizeWith(s),o&&n.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new x0(e,this._onOtherEvent,{enable:!1}),this.moveInput=new b0(e,this._onOtherEvent,{enable:!1}),this.keyInput=new T0(e,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new E0(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,r,i){this._addEventHandler(e,r,i,!1)}once(e,r,i){this._addEventHandler(e,r,i,!0)}watch(e,r,i){this._addEventHandler(e,r,i,!1,!0)}off(e,r){this._removeEventHandler(e,r)}_toggleRecognizer(e,r){let{manager:i}=this;if(!i)return;let n=i.get(e);n&&(n.set({enable:r}),i.touchAction.update()),this.wheelInput?.enableEventType(e,r),this.moveInput?.enableEventType(e,r),this.keyInput?.enableEventType(e,r),this.contextmenuInput?.enableEventType(e,r)}_addEventHandler(e,r,i,n,s){if(typeof e!="string"){i=r;for(let[h,g]of Object.entries(e))this._addEventHandler(h,g,i,n,s);return}let{manager:o,events:a}=this;if(!o)return;let A=a.get(e);if(!A){let h=this._getRecognizerName(e)||e;A=new v0(this,h),a.set(e,A),o&&o.on(e,A.handleEvent)}A.add(e,r,i,n,s),A.isEmpty()||this._toggleRecognizer(A.recognizerName,!0)}_removeEventHandler(e,r){if(typeof e!="string"){for(let[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}let{events:i}=this,n=i.get(e);if(n&&(n.remove(e,r),n.isEmpty())){let{recognizerName:s}=n,o=!1;for(let a of i.values())if(a.recognizerName===s&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(r=>r.getEventNames().includes(e))?.options.event}};var Se={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Se,"IDENTITY",{get:()=>(me.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var Pr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ut={common:0,meters:1,pixels:2},gA={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},a_={multipan:[vs,{threshold:10,direction:Dt.Vertical,pointers:2}],pinch:[Ua,{},null,["multipan"]],pan:[vs,{threshold:1},["pinch"],["multipan"]],dblclick:[So,{event:"dblclick",taps:2}],click:[So,{event:"click"},null,["dblclick"]]};var mU=Object.keys(Se).map(t=>`const int COORDINATE_SYSTEM_${t} = ${Se[t]};`).join(""),_U=Object.keys(Pr).map(t=>`const int PROJECTION_MODE_${t} = ${Pr[t]};`).join(""),yU=Object.keys(Ut).map(t=>`const int UNIT_${t.toUpperCase()} = ${Ut[t]};`).join(""),Fw=`${mU}
${_U}
${yU}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;function xU(t,e){if(t===e)return!0;if(Array.isArray(t)){let r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}function An(t){let e={},r;return i=>{for(let n in i)if(!xU(i[n],e[n])){r=t(i),e=i;break}return r}}var Lw=[0,0,0,0],bU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Nw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],TU=[0,0,0],Dw=[0,0,0],EU=An(wU);function c_(t,e,r=Dw){r.length<3&&(r=[r[0],r[1],0]);let i=r,n,s=!0;switch(e===Se.LNGLAT_OFFSETS||e===Se.METER_OFFSETS?n=r:n=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Pr.WEB_MERCATOR:(e===Se.LNGLAT||e===Se.CARTESIAN)&&(n=[0,0,0],s=!1);break;case Pr.WEB_MERCATOR_AUTO_OFFSET:e===Se.LNGLAT?i=n:e===Se.CARTESIAN&&(i=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],n=t.unprojectPosition(i),i[0]-=r[0],i[1]-=r[1],i[2]-=r[2]);break;case Pr.IDENTITY:i=t.position.map(Math.fround),i[2]=i[2]||0;break;case Pr.GLOBE:s=!1,n=null;break;default:s=!1}return{geospatialOrigin:n,shaderCoordinateOrigin:i,offsetMode:s}}function vU(t,e,r){let{viewMatrixUncentered:i,projectionMatrix:n}=t,{viewMatrix:s,viewProjectionMatrix:o}=t,a=Lw,A=Lw,h=t.cameraPosition,{geospatialOrigin:g,shaderCoordinateOrigin:_,offsetMode:b}=c_(t,e,r);return b&&(A=t.projectPosition(g||_),h=[h[0]-A[0],h[1]-A[1],h[2]-A[2]],A[3]=1,a=Qr.transformMat4([],A,o),s=i||s,o=Xt.multiply([],n,s),o=Xt.multiply([],o,bU)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:A,cameraPosCommon:h,shaderCoordinateOrigin:_,geospatialOrigin:g}}function kw({viewport:t,devicePixelRatio:e=1,modelMatrix:r=null,coordinateSystem:i=Se.DEFAULT,coordinateOrigin:n=Dw,autoWrapLongitude:s=!1}){i===Se.DEFAULT&&(i=t.isGeospatial?Se.LNGLAT:Se.CARTESIAN);let o=EU({viewport:t,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:n});return o.wrapLongitude=s,o.modelMatrix=r||Nw,o}function wU({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i}){let{projectionCenter:n,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:A,geospatialOrigin:h}=vU(t,r,i),g=t.getDistanceScales(),_=[t.width*e,t.height*e],b=Qr.transformMat4([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,T={coordinateSystem:r,projectionMode:t.projectionMode,coordinateOrigin:A,commonOrigin:o.slice(0,3),center:n,pseudoMeters:!!t._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:b,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:TU,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:Nw,cameraPosition:a};if(h){let v=t.getDistanceScales(h);switch(r){case Se.METER_OFFSETS:T.commonUnitsPerWorldUnit=v.unitsPerMeter,T.commonUnitsPerWorldUnit2=v.unitsPerMeter2;break;case Se.LNGLAT:case Se.LNGLAT_OFFSETS:t._pseudoMeters||(T.commonUnitsPerMeter=v.unitsPerMeter),T.commonUnitsPerWorldUnit=v.unitsPerDegree,T.commonUnitsPerWorldUnit2=v.unitsPerDegree2;break;case Se.CARTESIAN:T.commonUnitsPerWorldUnit=[1,1,v.unitsPerMeter[2]],T.commonUnitsPerWorldUnit2=[0,0,v.unitsPerMeter2[2]];break;default:break}}return T}var CU={};function SU(t=CU){return"viewport"in t?kw(t):{}}var Va={name:"project",dependencies:[Q2,h0],vs:Fw,getUniforms:SU,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};var MU=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,et={name:"project32",dependencies:[Va],vs:MU};function l_(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ws(t,e){let r=Qr.transformMat4([],e,t);return Qr.scale(r,r,1/r[3]),r}function A_(t,e){let r=t%e;return r<0?e+r:r}function mA(t,e,r){return t<e?e:t>r?r:t}function PU(t){return Math.log(t)*Math.LOG2E}var za=Math.log2||PU;function Fi(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var Li=Math.PI,Uw=Li/4,xi=Li/180,u_=180/Li,Ha=512,w0=4003e4,bi=85.051129,Vw=1.5;function f_(t){return za(t)}function nr(t){let[e,r]=t;Fi(Number.isFinite(e)),Fi(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let i=e*xi,n=r*xi,s=Ha*(i+Li)/(2*Li),o=Ha*(Li+Math.log(Math.tan(Uw+n*.5)))/(2*Li);return[s,o]}function Rr(t){let[e,r]=t,i=e/Ha*(2*Li)-Li,n=2*(Math.atan(Math.exp(r/Ha*(2*Li)-Li))-Uw);return[i*u_,n*u_]}function h_(t){let{latitude:e}=t;Fi(Number.isFinite(e));let r=Math.cos(e*xi);return f_(w0*r)-9}function Mo(t){let e=Math.cos(t*xi);return Ha/w0/e}function Ga(t){let{latitude:e,longitude:r,highPrecision:i=!1}=t;Fi(Number.isFinite(e)&&Number.isFinite(r));let n=Ha,s=Math.cos(e*xi),o=n/360,a=o/s,A=n/w0/s,h={unitsPerMeter:[A,A,A],metersPerUnit:[1/A,1/A,1/A],unitsPerDegree:[o,a,A],degreesPerUnit:[1/o,1/a,1/A]};if(i){let g=xi*Math.tan(e*xi)/s,_=o*g/2,b=n/w0*g,T=b/a*A;h.unitsPerDegree2=[0,_,b],h.unitsPerMeter2=[T,0,T]}return h}function _A(t,e){let[r,i,n]=t,[s,o,a]=e,{unitsPerMeter:A,unitsPerMeter2:h}=Ga({longitude:r,latitude:i,highPrecision:!0}),g=nr(t);g[0]+=s*(A[0]+h[0]*o),g[1]+=o*(A[1]+h[1]*o);let _=Rr(g),b=(n||0)+(a||0);return Number.isFinite(n)||Number.isFinite(a)?[_[0],_[1],b]:_}function C0(t){let{height:e,pitch:r,bearing:i,altitude:n,scale:s,center:o}=t,a=l_();Xt.translate(a,a,[0,0,-n]),Xt.rotateX(a,a,-r*xi),Xt.rotateZ(a,a,i*xi);let A=s/e;return Xt.scale(a,a,[A,A,A]),o&&Xt.translate(a,a,Tr.negate([],o)),a}function d_(t){let{width:e,height:r,altitude:i,pitch:n=0,offset:s,center:o,scale:a,nearZMultiplier:A=1,farZMultiplier:h=1}=t,{fovy:g=Gn(Vw)}=t;i!==void 0&&(g=Gn(i));let _=g*xi,b=n*xi,T=Po(g),v=T;o&&(v+=o[2]*a/Math.cos(b)/r);let C=_*(.5+(s?s[1]:0)/r),S=Math.sin(C)*v/Math.sin(mA(Math.PI/2-b-C,.01,Math.PI-.01)),P=Math.sin(b)*S+v,F=v*10,I=Math.min(P*h,F);return{fov:_,aspect:e/r,focalDistance:T,near:A,far:I}}function Gn(t){return 2*Math.atan(.5/t)*u_}function Po(t){return .5/Math.tan(.5*t*xi)}function Wa(t,e){let[r,i,n=0]=t;return Fi(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),ws(e,[r,i,n,1])}function Cs(t,e,r=0){let[i,n,s]=t;if(Fi(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(s))return ws(e,[i,n,s,1]);let o=ws(e,[i,n,0,1]),a=ws(e,[i,n,1,1]),A=o[2],h=a[2],g=A===h?0:((r||0)-A)/(h-A);return cn.lerp([],o,a,g)}function S0(t){let{width:e,height:r,bounds:i,minExtent:n=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,A],[h,g]]=i,_=RU(t.padding),b=nr([a,mA(g,-bi,bi)]),T=nr([h,mA(A,-bi,bi)]),v=[Math.max(Math.abs(T[0]-b[0]),n),Math.max(Math.abs(T[1]-b[1]),n)],C=[e-_.left-_.right-Math.abs(o[0])*2,r-_.top-_.bottom-Math.abs(o[1])*2];Fi(C[0]>0&&C[1]>0);let S=C[0]/v[0],P=C[1]/v[1],F=(_.right-_.left)/2/S,I=(_.top-_.bottom)/2/P,k=[(T[0]+b[0])/2+F,(T[1]+b[1])/2+I],W=Rr(k),K=Math.min(s,za(Math.abs(Math.min(S,P))));return Fi(Number.isFinite(K)),{longitude:W[0],latitude:W[1],zoom:K}}function RU(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(Fi(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}var zw=Math.PI/180;function M0(t,e=0){let{width:r,height:i,unproject:n}=t,s={targetZ:e},o=n([0,i],s),a=n([r,i],s),A,h,g=t.fovy?.5*t.fovy*zw:Math.atan(.5/t.altitude),_=(90-t.pitch)*zw;return g>_-.01?(A=Hw(t,0,e),h=Hw(t,r,e)):(A=n([0,0],s),h=n([r,0],s)),[o,a,h,A]}function Hw(t,e,r){let{pixelUnprojectionMatrix:i}=t,n=ws(i,[e,0,1,1]),s=ws(i,[e,t.height,1,1]),a=(r*t.distanceScales.unitsPerMeter[2]-n[2])/(s[2]-n[2]),A=cn.lerp([],n,s,a),h=Rr(A);return h.push(r),h}var Ww=512;function p_(t){let{width:e,height:r,pitch:i=0}=t,{longitude:n,latitude:s,zoom:o,bearing:a=0}=t;(n<-180||n>180)&&(n=A_(n+180,360)-180),(a<-180||a>180)&&(a=A_(a+180,360)-180);let A=za(r/Ww);if(o<=A)o=A,s=0;else{let h=r/2/Math.pow(2,o),g=Rr([0,h])[1];if(s<g)s=g;else{let _=Rr([0,Ww-h])[1];s>_&&(s=_)}}return{width:e,height:r,longitude:n,latitude:s,zoom:o,pitch:i,bearing:a}}var jw=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,OU=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,FU=`
${jw}
${OU}
`,LU=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,NU=`
${jw}
${LU}
`,DU=An(HU),kU=An(GU),UU=[0,0,0,1],VU=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function zU(t,e){let[r,i,n]=t,s=Cs([r,i,n],e);return Number.isFinite(n)?s:[s[0],s[1],0]}function HU({viewport:t,center:e}){return new Ce(t.viewProjectionMatrix).invert().transform(e)}function GU({viewport:t,shadowMatrices:e}){let r=[],i=t.pixelUnprojectionMatrix,n=t.isGeospatial?void 0:1,s=[[0,0,n],[t.width,0,n],[0,t.height,n],[t.width,t.height,n],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>zU(o,i));for(let o of e){let a=o.clone().translate(new G(t.center).negate()),A=s.map(g=>a.transform(g)),h=new Ce().ortho({left:Math.min(...A.map(g=>g[0])),right:Math.max(...A.map(g=>g[0])),bottom:Math.min(...A.map(g=>g[1])),top:Math.max(...A.map(g=>g[1])),near:Math.min(...A.map(g=>-g[2])),far:Math.max(...A.map(g=>-g[2]))});r.push(h.multiplyRight(o))}return r}function WU(t){let{shadowEnabled:e=!0,project:r}=t;if(!e||!r||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};let i=Va.getUniforms(r),n=DU({viewport:r.viewport,center:i.center}),s=[],o=kU({shadowMatrices:t.shadowMatrices,viewport:r.viewport}).slice();for(let A=0;A<t.shadowMatrices.length;A++){let h=o[A],g=h.clone().translate(new G(r.viewport.center).negate());i.coordinateSystem===Se.LNGLAT&&i.projectionMode===Pr.WEB_MERCATOR?(o[A]=g,s[A]=n):(o[A]=h.clone().multiplyRight(VU),s[A]=g.transform(n))}let a={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||UU,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let A=0;A<o.length;A++)a[`viewProjectionMatrix${A}`]=o[A],a[`projectCenter${A}`]=s[A];for(let A=0;A<2;A++)a[`shadow_uShadowMap${A}`]=t.shadowMaps&&t.shadowMaps[A]||t.dummyShadowMap;return a}var P0={name:"shadow",dependencies:[Va],vs:FU,fs:NU,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:WU,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}};var Pt={...A0,defaultUniforms:{...A0.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}};var jU=[h0],XU=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Xw(){let t=ho.getDefaultShaderAssembler();for(let e of jU)t.addDefaultModule(e);for(let e of XU)t.addShaderHook(e);return t}var YU=[255,255,255],QU=1,qU=0,R0=class{constructor(e={}){this.type="ambient";let{color:r=YU}=e,{intensity:i=QU}=e;this.id=e.id||`ambient-${qU++}`,this.color=r,this.intensity=i}};var KU=[255,255,255],JU=1,ZU=[0,0,-1],$U=0,yA=class{constructor(e={}){this.type="directional";let{color:r=KU}=e,{intensity:i=JU}=e,{direction:n=ZU}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${$U++}`,this.color=r,this.intensity=i,this.type="directional",this.direction=new G(n).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}};var xA=class{constructor(e,r={id:"pass"}){let{id:i}=r;this.id=i,this.device=e,this.props={...r}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}};var Wn=class extends xA{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[r,i]=this.device.canvasContext.getDrawingBufferSize(),n=e.clearCanvas??!0,s=e.clearColor??(n?[0,0,0,0]:!1),o=n?1:!1,a=n?0:!1,A=e.colorMask??15,h={viewport:[0,0,r,i]};e.colorMask&&(h.colorMask=A),e.scissorRect&&(h.scissorRect=e.scissorRect);let g=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(g,e)}finally{g.end()}}_drawLayers(e,r){let{target:i,shaderModuleProps:n,viewports:s,views:o,onViewportActive:a,clearStack:A=!0}=r;r.pass=r.pass||"unknown",A&&(this._lastRenderIndex=-1);let h=[];for(let g of s){let _=o&&o[g.id];a?.(g);let b=this._getDrawLayerParams(g,r),T=g.subViewports||[g];for(let v of T){let C=this._drawLayersInViewport(e,{target:i,shaderModuleProps:n,viewport:v,view:_,pass:r.pass,layers:r.layers},b);h.push(C)}}return h}_getDrawLayerParams(e,{layers:r,pass:i,isPicking:n=!1,layerFilter:s,cullRect:o,effects:a,shaderModuleProps:A},h=!1){let g=[],_=Qw(this._lastRenderIndex+1),b={layer:r[0],viewport:e,isPicking:n,renderPass:i,cullRect:o},T={};for(let v=0;v<r.length;v++){let C=r[v],S=this._shouldDrawLayer(C,b,s,T),P={shouldDrawLayer:S};S&&!h&&(P.shouldDrawLayer=!0,P.layerRenderIndex=_(C,S),P.shaderModuleProps=this._getShaderModuleProps(C,a,i,A),P.layerParameters={...C.context.deck?.props.parameters,...this.getLayerParameters(C,v,e)}),g[v]=P}return g}_drawLayersInViewport(e,{layers:r,shaderModuleProps:i,pass:n,target:s,viewport:o,view:a},A){let h=eV(this.device,{shaderModuleProps:i,target:s,viewport:o});if(a&&a.props.clear){let _=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:h,scissorRect:h},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}let g={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:h});for(let _=0;_<r.length;_++){let b=r[_],T=A[_],{shouldDrawLayer:v}=T;if(v&&b.props.pickable&&g.pickableCount++,b.isComposite&&g.compositeCount++,b.isDrawable&&T.shouldDrawLayer){let{layerRenderIndex:C,shaderModuleProps:S,layerParameters:P}=T;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,C),S.project&&(S.project.viewport=o),b.context.renderPass=e;try{b._drawLayer({renderPass:e,shaderModuleProps:S,uniforms:{layerIndex:C},parameters:P})}catch(F){b.raiseError(F,`drawing ${b} to ${n}`)}}}return g}shouldDrawLayer(e){return!0}getShaderModuleProps(e,r,i){return null}getLayerParameters(e,r,i){return e.props.parameters}_shouldDrawLayer(e,r,i,n){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;r.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(r))return!1;r.layer=o,o=o.parent}if(i){let a=r.layer.id;if(a in n||(n[a]=i(r)),!n[a])return!1}return e.activateViewport(r.viewport),!0}_getShaderModuleProps(e,r,i,n){let s=this.device.canvasContext.cssToDeviceRatio(),o=e.internalState?.propsInTransition||e.props,a={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(r)for(let A of r)Yw(a,A.getShaderModuleProps?.(e,a));return Yw(a,this.getShaderModuleProps(e,r,a),n)}};function Qw(t=0,e={}){let r={},i=(n,s)=>{let o=n.props._offset,a=n.id,A=n.parent&&n.parent.id,h;if(A&&!(A in e)&&i(n.parent,!1),A in r){let g=r[A]=r[A]||Qw(e[A],e);h=g(n,s),r[a]=g}else Number.isFinite(o)?(h=o+(e[A]||0),r[a]=null):h=t;return s&&h>=t&&(t=h+1),e[a]=h,h};return i}function eV(t,{shaderModuleProps:e,target:r,viewport:i}){let n=e?.project?.devicePixelRatio??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=r?r.height:s,a=i;return[a.x*n,o-(a.y+a.height)*n,a.width*n,a.height*n]}function Yw(t,...e){for(let r of e)if(r)for(let i in r)t[i]?Object.assign(t[i],r[i]):t[i]=r[i];return t}var bA=class extends Wn{constructor(e,r){super(e,r);let i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),n=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:n})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let r=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),n=e.viewports[0],s=n.width*i,o=n.height*i,a=[1,1,1,1];(s!==r.width||o!==r.height)&&r.resize({width:s,height:o}),super.render({...e,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(e,r,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,r,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}};var tV={color:[255,255,255],intensity:1},qw=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],rV=[0,0,0,200/255],ja=class{constructor(e={}){this.id="lighting-effect",this.shadowColor=rV,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:r,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),i._addDefaultShaderModule(P0),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(let r in e){let i=e[r];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:r,viewports:i,onViewportActive:n,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,r){let i=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},n={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:i,lighting:n,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(P0))}_calculateMatrices(){let e=[];for(let r of this.directionalLights){let i=new Ce().lookAt({eye:new G(r.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let r=0;r<this.directionalLights.length;r++){let i=new bA(e);this.shadowPasses[r]=i}}_applyDefaultLights(){let{ambientLight:e,pointLights:r,directionalLights:i}=this;!e&&r.length===0&&i.length===0&&(this.ambientLight=new R0(tV),this.directionalLights.push(new yA(qw[0]),new yA(qw[1])))}};var g_=class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,r,{size:i=1,type:n,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:A}){let h=n||e&&e.constructor||Float32Array,g=r*i+s;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,g)}let _=1/0;A&&(_=A*i+s);let b=this._allocate(h,g,a,_);return e&&o?b.set(e):a||b.fill(0,0,4),this._release(e),b}release(e){this._release(e)}_allocate(e,r,i,n){let s=Math.max(Math.ceil(r*this.opts.overAlloc),1);s>n&&(s=n);let o=this._pool,a=e.BYTES_PER_ELEMENT*s,A=o.findIndex(h=>h.byteLength>=a);if(A>=0){let h=new e(o.splice(A,1)[0],0,s);return i&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;let r=this._pool,{buffer:i}=e,{byteLength:n}=i,s=r.findIndex(o=>o.byteLength>=n);s<0?r.push(i):(s>0||r.length<this.opts.poolSize)&&r.splice(s,0,i),r.length>this.opts.poolSize&&r.shift()}},Ni=new g_;function Ya(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Jw(t,e){let r=t%e;return r<0?e+r:r}function Zw(t){return[t[12],t[13],t[14]]}function $w(t){return{left:Xa(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Xa(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Xa(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Xa(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Xa(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Xa(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}var Kw=new G;function Xa(t,e,r,i){Kw.set(t,e,r);let n=Kw.len();return{distance:i/n,normal:new G(-t/n,-e/n,-r/n)}}function iV(t){return t-Math.fround(t)}var TA;function I0(t,e){let{size:r=1,startIndex:i=0}=e,n=e.endIndex!==void 0?e.endIndex:t.length,s=(n-i)/r;TA=Ni.allocate(TA,s,{type:Float32Array,size:r*2});let o=i,a=0;for(;o<n;){for(let A=0;A<r;A++){let h=t[o++];TA[a+A]=h,TA[a+A+r]=iV(h)}a+=r*2}return TA.subarray(0,s*r*2)}function eC(t){let e=null,r=!1;for(let i of t)i&&(e?(r||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],r=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}var nV=Math.PI/180,sV=Ya(),tC=[0,0,0],oV={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function aV({width:t,height:e,orthographic:r,fovyRadians:i,focalDistance:n,padding:s,near:o,far:a}){let A=t/e,h=r?new Ce().orthographic({fovy:i,aspect:A,focalDistance:n,near:o,far:a}):new Ce().perspective({fovy:i,aspect:A,near:o,far:a});if(s){let{left:g=0,right:_=0,top:b=0,bottom:T=0}=s,v=pr((g+t-_)/2,0,t)-t/2,C=pr((b+e-T)/2,0,e)-e/2;h[8]-=v*2/t,h[9]+=C*2/e}return h}var B0=class t{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||oV,this.focalDistance=e.focalDistance||1,this.position=e.position||tC,this.modelMatrix=e.modelMatrix||null;let{longitude:r,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(r),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Pr.WEB_MERCATOR:Pr.WEB_MERCATOR_AUTO_OFFSET:Pr.IDENTITY}equals(e){return e instanceof t?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&er(e.projectionMatrix,this.projectionMatrix)&&er(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:r=!0}={}){let i=this.projectPosition(e),n=Wa(i,this.pixelProjectionMatrix),[s,o]=n,a=r?o:this.height-o;return e.length===2?[s,a]:[s,a,n[2]]}unproject(e,{topLeft:r=!0,targetZ:i}={}){let[n,s,o]=e,a=r?s:this.height-s,A=i&&i*this.distanceScales.unitsPerMeter[2],h=Cs([n,a,o],this.pixelUnprojectionMatrix,A),[g,_,b]=this.unprojectPosition(h);return Number.isFinite(o)?[g,_,b]:Number.isFinite(i)?[g,_,i]:[g,_]}projectPosition(e){let[r,i]=this.projectFlat(e),n=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,i,n]}unprojectPosition(e){let[r,i]=this.unprojectFlat(e),n=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[r,i,n]}projectFlat(e){if(this.isGeospatial){let r=nr(e);return r[1]=pr(r[1],-318,830),r}return e}unprojectFlat(e){return this.isGeospatial?Rr(e):e}getBounds(e={}){let r={targetZ:e.z||0},i=this.unproject([0,0],r),n=this.unproject([this.width,0],r),s=this.unproject([0,this.height],r),o=this.unproject([this.width,this.height],r);return[Math.min(i[0],n[0],s[0],o[0]),Math.min(i[1],n[1],s[1],o[1]),Math.max(i[0],n[0],s[0],o[0]),Math.max(i[1],n[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?Ga({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:r,width:i=1,height:n=1}){return e<this.x+this.width&&this.x<e+i&&r<this.y+this.height&&this.y<r+n}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,$w(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,r){return null}_initProps(e){let r=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=h_({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Ga({latitude:i,longitude:r}));let n=Math.pow(2,this.zoom);this.scale=n;let{position:s,modelMatrix:o}=e,a=tC;if(s&&(a=o?new Ce(o).transformAsVector(s,[]):s),this.isGeospatial){let A=this.projectPosition([r,i,0]);this.center=new G(a).scale(this.distanceScales.unitsPerMeter).add(A)}else this.center=this.projectPosition(a)}_initMatrices(e){let{viewMatrix:r=sV,projectionMatrix:i=null,orthographic:n=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:A=1e3,padding:h=null,focalDistance:g=1}=e;this.viewMatrixUncentered=r,this.viewMatrix=new Ce().multiplyRight(r).translate(new G(this.center).negate()),this.projectionMatrix=i||aV({width:this.width,height:this.height,orthographic:n,fovyRadians:s||o*nV,focalDistance:g,padding:h,near:a,far:A});let _=Ya();Xt.multiply(_,_,this.projectionMatrix),Xt.multiply(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=Xt.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=Zw(this.viewMatrixInverse);let b=Ya(),T=Ya();Xt.scale(b,b,[this.width/2,-this.height/2,1]),Xt.translate(b,b,[1,-1,0]),Xt.multiply(T,b,this.viewProjectionMatrix),this.pixelProjectionMatrix=T,this.pixelUnprojectionMatrix=Xt.invert(Ya(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||me.warn("Pixel project matrix not invertible")()}};B0.displayName="Viewport";var ai=B0;var O0=class t extends ai{constructor(e={}){let{latitude:r=0,longitude:i=0,zoom:n=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:A=1.01,nearZ:h,farZ:g,orthographic:_=!1,projectionMatrix:b,repeat:T=!1,worldOffset:v=0,position:C,padding:S,legacyMeterSizes:P=!1}=e,{width:F,height:I,altitude:k=1.5}=e,W=Math.pow(2,n);F=F||1,I=I||1;let K,re=null;if(b)k=b[5]/2,K=Gn(k);else{e.fovy?(K=e.fovy,k=Po(K)):K=Gn(k);let z;if(S){let{top:L=0,bottom:se=0}=S;z=[0,pr((L+I-se)/2,0,I)-I/2]}re=d_({width:F,height:I,scale:W,center:C&&[0,0,C[2]*Mo(r)],offset:z,pitch:s,fovy:K,nearZMultiplier:a,farZMultiplier:A}),Number.isFinite(h)&&(re.near=h),Number.isFinite(g)&&(re.far=g)}let Y=C0({height:I,pitch:s,bearing:o,scale:W,altitude:k});v&&(Y=new Ce().translate([512*v,0,0]).multiplyLeft(Y)),super({...e,width:F,height:I,viewMatrix:Y,longitude:i,latitude:r,zoom:n,...re,fovy:K,focalDistance:k}),this.latitude=r,this.longitude=i,this.zoom=n,this.pitch=s,this.bearing=o,this.altitude=k,this.fovy=K,this.orthographic=_,this._subViewports=T?[]:null,this._pseudoMeters=P,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),r=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let n=r;n<=i;n++){let s=n?new t({...this,worldOffset:n}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[r,i]=this.projectFlat(e),n=(e[2]||0)*Mo(e[1]);return[r,i,n]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[r,i]=this.unprojectFlat(e),n=(e[2]||0)/Mo(i);return[r,i,n]}addMetersToLngLat(e,r){return _A(e,r)}panByPosition(e,r){let i=Cs(r,this.pixelUnprojectionMatrix),n=this.projectFlat(e),s=cn.add([],n,cn.negate([],i)),o=cn.add([],this.center,s),[a,A]=this.unprojectFlat(o);return{longitude:a,latitude:A}}getBounds(e={}){let r=M0(this,e.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(e,r={}){let{width:i,height:n}=this,{longitude:s,latitude:o,zoom:a}=S0({width:i,height:n,bounds:e,...r});return new t({width:i,height:n,longitude:s,latitude:o,zoom:a})}};O0.displayName="WebMercatorViewport";var un=O0;var rC=[0,0,0];function m_(t,e,r=!1){let i=e.projectPosition(t);if(r&&e instanceof un){let[n,s,o=0]=t,a=e.getDistanceScales([n,s]);i[2]=o*a.unitsPerMeter[2]}return i}function cV(t){let{viewport:e,modelMatrix:r,coordinateOrigin:i}=t,{coordinateSystem:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return n===Se.DEFAULT&&(n=e.isGeospatial?Se.LNGLAT:Se.CARTESIAN),s===void 0&&(s=n),o===void 0&&(o=i),{viewport:e,coordinateSystem:n,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function __(t,{viewport:e,modelMatrix:r,coordinateSystem:i,coordinateOrigin:n,offsetMode:s}){let[o,a,A=0]=t;switch(r&&([o,a,A]=Qr.transformMat4([],[o,a,A,1],r)),i){case Se.LNGLAT:return m_([o,a,A],e,s);case Se.LNGLAT_OFFSETS:return m_([o+n[0],a+n[1],A+(n[2]||0)],e,s);case Se.METER_OFFSETS:return m_(_A(n,[o,a,A]),e,s);case Se.CARTESIAN:default:return e.isGeospatial?[o+n[0],a+n[1],A+n[2]]:e.projectPosition([o,a,A])}}function iC(t,e){let{viewport:r,coordinateSystem:i,coordinateOrigin:n,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=cV(e),{autoOffset:A=!0}=e,{geospatialOrigin:h=rC,shaderCoordinateOrigin:g=rC,offsetMode:_=!1}=A?c_(r,i,n):{},b=__(t,{viewport:r,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:_});if(_){let T=r.projectPosition(h||g);Tr.sub(b,b,T)}return b}var lV=1,AV=1,Ro=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:r=0,duration:i=Number.POSITIVE_INFINITY,rate:n=1,repeat:s=1}=e,o=lV++,a={time:0,delay:r,duration:i,rate:n,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(let[r,i]of this.animations)i.channel===e&&this.detachAnimation(r)}isFinished(e){let r=this.channels.get(e);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(e){if(e===void 0)return this.time;let r=this.channels.get(e);return r===void 0?-1:r.time}setTime(e){this.time=Math.max(0,e);let r=this.channels.values();for(let n of r)this._setChannelTime(n,this.time);let i=this.animations.values();for(let n of i){let{animation:s,channel:o}=n;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,r){let i=AV++;return this.animations.set(i,{animation:e,channel:r}),e.setTime(this.getTime(r)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,r){let i=r-e.delay,n=e.duration*e.repeat;i>=n?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}};function nC(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function sC(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}var uV=0,fV={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Ca.stats.get(`animation-loop-${uV++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},EA=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...fV,...e},e=this.props,!e.device)throw new Error("No device provided");let{useDevicePixels:r=!0}=this.props;this.stats=e.stats||new Sr({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){let i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){let r=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=nC(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(sC(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:r,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=r,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(r);let i=this.props.onAddHTML(r);i&&(r.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,r]=this.device?.canvasContext?.getPixelSize()||[1,1],i=1,n=this.device?.canvasContext?.canvas;return n&&n.clientHeight?i=n.clientWidth/n.clientHeight:e>0&&r>0&&(i=e/r),{width:e,height:r,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}};var y_={};function Ti(t="id"){y_[t]=y_[t]||1;let e=y_[t]++;return`${t}-${e}`}var F0=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||Ti("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&ct.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(let e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}};function oC(t,e){if(e instanceof F0)return e;let r=hV(t,e),{attributes:i,bufferLayout:n}=dV(t,e);return new F0({topology:e.topology||"triangle-list",bufferLayout:n,vertexCount:e.vertexCount,indices:r,attributes:i})}function hV(t,e){if(!e.indices)return;let r=e.indices.value;return t.createBuffer({usage:ct.INDEX,data:r})}function dV(t,e){let r=[],i={};for(let[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){i[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});let{value:A,size:h,normalized:g}=o;r.push({name:a,format:y1(A,h,g)})}}let n=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:r,vertexCount:n}}var L0=class t{static defaultProps={...on.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new t(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){let r={...on.defaultProps,...e},i=this._hashRenderPipeline(r);if(!this._renderPipelineCache[i]){let n=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._renderPipelineCache[i]={pipeline:n,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){let r={...Sa.defaultProps,...e},i=this._hashComputePipeline(r);if(!this._computePipelineCache[i]){let n=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});n.hash=i,this._computePipelineCache[i]={pipeline:n,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){let r=e.hash,i=e instanceof Sa?this._computePipelineCache:this._renderPipelineCache;i[r].useCount--,i[r].useCount===0&&this.destroyPolicy==="unused"&&(i[r].pipeline.destroy(),delete i[r])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){let r=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,n="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${i}V${n}BL${s}`;default:let o=this._getHash(JSON.stringify(e.parameters));return`${r}/${i}V${n}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};var N0=class t{static defaultProps={...go.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new t(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){let r=this._hashShader(e),i=this._cache[r];if(!i){let n=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[r]=i={shader:n,useCount:0}}return i.useCount++,i.shader}release(e){let r=this._hashShader(e),i=this._cache[r];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};function aC(t,e){let r={},i="Values";if(t.attributes.length===0&&!t.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(let n of t.attributes)if(n){let s=`${n.location} ${n.name}: ${n.type}`;r[`in ${s}`]={[i]:n.stepMode||"vertex"}}for(let n of t.varyings||[]){let s=`${n.location} ${n.name}`;r[`out ${s}`]={[i]:JSON.stringify(n)}}return r}var mr=null,x_=null;function cC(t,{id:e,minimap:r,opaque:i,top:n="0",left:s="0",rgbaScale:o=1}){mr||(mr=document.createElement("canvas"),mr.id=e,mr.title=e,mr.style.zIndex="100",mr.style.position="absolute",mr.style.top=n,mr.style.left=s,mr.style.border="blue 5px solid",mr.style.transform="scaleY(-1)",document.body.appendChild(mr),x_=mr.getContext("2d")),(mr.width!==t.width||mr.height!==t.height)&&(mr.width=t.width/2,mr.height=t.height/2,mr.style.width="400px",mr.style.height="400px");let a=t.device.readPixelsToArrayWebGL(t),A=x_?.createImageData(t.width,t.height);if(A){for(let g=0;g<a.length;g+=4)A.data[0+g+0]=a[g+0]*o,A.data[0+g+1]=a[g+1]*o,A.data[0+g+2]=a[g+2]*o,A.data[0+g+3]=i?255:a[g+3]*o;x_?.putImageData(A,0,0)}}function D0(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!D0(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let s of i)if(!e.hasOwnProperty(s)||!D0(t[s],e[s],r-1))return!1;return!0}return!1}function lC(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function AC(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function vA(t){return lC(t)||AC(t)}function pV(t){return vA(t)||typeof t=="number"||typeof t=="boolean"}function k0(t){let e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{let i=t[r];pV(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}var U0=class{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,r){Object.assign(this.options,r);let i=va(Object.values(e).filter(n=>n.dependencies));for(let n of i)e[n.name]=n;oe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(let[n,s]of Object.entries(e))this._addModule(s),s.name&&n!==s.name&&!this.options.disableWarnings&&oe.warn(`Module name: ${n} vs ${s.name}`)()}destroy(){}setProps(e){for(let r of Object.keys(e)){let i=r,n=e[i]||{},s=this.modules[i];if(!s){this.options.disableWarnings||oe.warn(`Module ${r} not found`)();continue}let o=this.moduleUniforms[i],a=this.moduleBindings[i],A=s.getUniforms?.(n,o)||n,{uniforms:h,bindings:g}=k0(A);this.moduleUniforms[i]={...o,...h},this.moduleBindings[i]={...a,...g}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let r of Object.values(this.moduleBindings))Object.assign(e,r);return e}getDebugTable(){let e={};for(let[r,i]of Object.entries(this.moduleUniforms))for(let[n,s]of Object.entries(i))e[`${r}.${n}`]={type:this.modules[r].uniformTypes?.[n],value:String(s)};return e}_addModule(e){let r=e.name;this.moduleUniforms[r]=e.defaultUniforms||{},this.moduleBindings[r]={}}};var gV="";async function uC(t,e){let r=new Image;return r.crossOrigin=e?.crossOrigin||"anonymous",r.src=t.startsWith("http")?t:gV+t,await r.decode(),e?await createImageBitmap(r,e):await createImageBitmap(r)}var Qa=class{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,r){this.device=e,this.id=r.id||Ti("async-texture"),typeof r?.data=="string"&&r.dimension==="2d"&&(r={...r,data:uC(r.data)}),this.ready=new Promise((i,n)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=n}),this.initAsync(r)}async initAsync(e){let r,i,n=e.data,s=await fC(n).then(r,i);if(this.destroyed)return;let o={...e,data:s};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let r=this.texture;this.texture=r.clone(e),r.destroy()}return!0}};async function fC(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(fC));if(t&&typeof t=="object"&&t.constructor===Object){let e=t,r=await Promise.all(Object.values(e)),i=Object.keys(e),n={};for(let s=0;s<i.length;s++)n[i[s]]=r[s];return n}return t}var Io=2,mV=1e4,je=class t{static defaultProps={...on.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:ho.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,r){this.props={...t.defaultProps,...r},r=this.props,this.id=r.id||Ti("model"),this.device=e,Object.assign(this.userData,r.userData);let i=Object.fromEntries(this.props.modules?.map(A=>[A.name,A])||[]),n=r.shaderInputs||new U0(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(n);let s=yV(e),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){this.props.shaderLayout||=i2(this.props.source);let{source:A,getUniforms:h}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=A,this._getModuleUniforms=h}else{let{vs:A,fs:h,getUniforms:g}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=A,this.fs=h,this._getModuleUniforms=g}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||L0.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||N0.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let r=this._areBindingsLoading();if(r)return oe.info(Io,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let n=this._getBindings();this.pipeline.setBindings(n,{disableWarnings:this.props.disableWarnings}),b_(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();let r=e&&oC(this.device,e);if(r){this.setTopology(r.topology||"triangle-list");let i=new yo(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let r=new yo(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){D0(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Yl(this.shaderInputs.modules);for(let[r,i]of Object.entries(this.shaderInputs.modules))if(_V(i)){let n=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=n}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,r){let i=r?.disableWarnings??this.props.disableWarnings;e.indices&&oe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();let n=new yo(this.bufferLayout);for(let[s,o]of Object.entries(e)){let a=n.getBufferLayout(s);if(!a){i||oe.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}let A=n.getAttributeNamesForBuffer(a),h=!1;for(let g of A){let _=this._attributeInfos[g];_&&(this.vertexArray.setBuffer(_.location,o),h=!0)}!h&&!i&&oe.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,r){for(let[i,n]of Object.entries(e)){let s=this._attributeInfos[i];s?this.vertexArray.setConstantWebGL(s.location,n):(r?.disableWarnings??this.props.disableWarnings)||oe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){b_(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){let{bindings:r,uniforms:i}=k0(this._getModuleUniforms(e));Object.assign(this.bindings,r),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof Qa&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[r,i]of Object.entries(this.bindings))i instanceof Qa?i.isReady&&(e[r]=i.texture):e[r]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(let r of Object.values(this.bindings))r instanceof po?e=Math.max(e,r.texture.updateTimestamp):r instanceof ct||r instanceof _t?e=Math.max(e,r.updateTimestamp):r instanceof Qa?e=r.texture?Math.max(e,r.texture.updateTimestamp):1/0:r instanceof mo||(e=Math.max(e,r.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let r={...e.attributes};for(let[i]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(n=>n.name===i)&&i!=="positions"&&delete r[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,r=null;this.pipeline&&(oe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),n=null;this.source?n=i:this.fs&&(n=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:n}),this._attributeInfos=Ph(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=oe.level>3?0:mV;oe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,oe.group(Io,`>>> DRAWING MODEL ${this.id}`,{collapsed:oe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=aC(this.pipeline.shaderLayout,this.id);oe.table(Io,e)();let r=this.shaderInputs.getDebugTable();for(let[n,s]of Object.entries(this.uniforms))r[n]={value:s};oe.table(Io,r)();let i=this._getAttributeDebugTable();oe.table(Io,this._attributeInfos)(),oe.table(Io,i)(),oe.groupEnd(Io)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;let i=e.props.framebuffer;i&&cC(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[r,i]of Object.entries(this._attributeInfos)){let n=this.vertexArray.attributes[i.location];e[i.location]={name:r,type:i.shaderType,values:n?this._getBufferOrConstantValues(n,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,i=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);e.indices={name:"indices",type:r.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,r){let i=Ql(r);return(e instanceof ct?new i(e.debugData):e).toString()}};function _V(t){return!!(t.uniformTypes&&!b_(t.uniformTypes))}function yV(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function b_(t){for(let e in t)return!1;return!0}var fn=class t{device;model;transformFeedback;static defaultProps={...je.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,r=t.defaultProps){if(!t.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new je(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||Ll(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let r=this.device.beginRenderPass(e);this.model.draw(r),r.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let r=this.getBuffer(e);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof ct)return r.readAsync();let{buffer:i,byteOffset:n=0,byteLength:s=i.byteLength}=r;return i.readAsync(n,s)}};var xV="transform_output",qa=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,r){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new je(this.device,{id:r.id||"texture-transform-model",fs:r.fs||Ll({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:xV}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(let e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){let{framebuffer:r}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:r,...e});this.model.draw(i),i.end()}getTargetTexture(){let{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:r,sourceTextures:i,targetTexture:n}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),n){e.targetTexture=n;let{width:s,height:o}=n;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:s,height:o,colorAttachments:[n]}),e.framebuffer.resize({width:s,height:o})}return e}_setSourceTextureParameters(){let e=this.currentIndex,{sourceTextures:r}=this.bindings[e];for(let i in r)r[i].sampler=this.sampler}};var ut=class{id;topology;vertexCount;indices;attributes;userData={};constructor(e){let{attributes:r={},indices:i=null,vertexCount:n=null}=e;this.id=e.id||Ti("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(let[s,o]of Object.entries(r)){let a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=n||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,r){return this}_calculateVertexCount(e,r){if(r)return r.value.length;let i=1/0;for(let n of Object.values(e)){let{value:s,size:o,constant:a}=n;!a&&s&&o!==void 0&&o>=1&&(i=Math.min(i,s.length/o))}return i}};var hn=class{id;matrix=new Ce;display=!0;position=new G;rotation=new G;scale=new G(1,1,1);userData={};props={};constructor(e={}){let{id:r}=e;this.id=r||Ti(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,r=!0){r?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:r,rotation:i,scale:n,update:s=!0}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),s&&this.updateMatrix(),this}updateMatrix(){let e=this.position,r=this.rotation,i=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(r),this.matrix.scale(i),this}update(e={}){let{position:r,rotation:i,scale:n}=e;return r&&this.setPosition(r),i&&this.setRotation(i),n&&this.setScale(n),this.updateMatrix(),this}getCoordinateUniforms(e,r){r=r||this.matrix;let i=new Ce(e).multiplyRight(r),n=i.invert(),s=n.transpose();return{viewMatrix:e,modelMatrix:r,objectMatrix:r,worldMatrix:i,worldInverseMatrix:n,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}};var jn=class t extends hn{children;constructor(e={}){e=Array.isArray(e)?{children:e}:e;let{children:r=[]}=e;oe.assert(r.every(i=>i instanceof hn),"every child must an instance of ScenegraphNode"),super(e),this.children=r}getBounds(){let e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:i})=>{let n=r.getBounds();if(!n)return;let[s,o]=n,a=new G(s).add(o).divide([2,2,2]);i.transformAsPoint(a,a);let A=new G(o).subtract(s).divide([2,2,2]);i.transformAsVector(A,A);for(let h=0;h<8;h++){let g=new G(h&1?-1:1,h&2?-1:1,h&4?-1:1).multiply(A).add(a);for(let _=0;_<3;_++)e[0][_]=Math.min(e[0][_],g[_]),e[1][_]=Math.max(e[1][_],g[_])}}),Number.isFinite(e[0][0])?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(let r of e)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(e){let r=this.children,i=r.indexOf(e);return i>-1&&r.splice(i,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:r=new Ce}={}){let i=new Ce(r).multiplyRight(this.matrix);for(let n of this.children)n instanceof t?n.traverse(e,{worldMatrix:i}):e(n,{worldMatrix:i})}};var Ss=class extends hn{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}};var Bo=class extends ut{constructor(e={}){let{id:r=Ti("cube-geometry"),indices:i=!0}=e;super(i?{...e,id:r,topology:"triangle-list",indices:{size:1,value:bV},attributes:{...MV,...e.attributes}}:{...e,id:r,topology:"triangle-list",indices:void 0,attributes:{...PV,...e.attributes}})}},bV=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),TV=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),EV=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),vV=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),wV=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),CV=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),SV=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),MV={POSITION:{size:3,value:TV},NORMAL:{size:3,value:EV},TEXCOORD_0:{size:2,value:vV}},PV={POSITION:{size:3,value:wV},TEXCOORD_0:{size:2,value:CV},COLOR_0:{size:3,value:SV}};var RV={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},Oo=class extends Wn{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:A,width:h,height:g},cullRect:_,effects:b,pass:T="picking",pickZ:v,shaderModuleProps:C}){this.pickZ=v;let S=this._resetColorEncoder(v),P=[a,A,h,g],F=super.render({target:o,layers:e,layerFilter:r,views:i,viewports:n,onViewportActive:s,cullRect:_,effects:b?.filter(k=>k.useInPicking),pass:T,isPicking:!0,shaderModuleProps:C,clearColor:[0,0,0,0],colorMask:15,scissorRect:P});return this._colorEncoderState=null,{decodePickingColor:S&&BV.bind(null,S),stats:F}}shouldDrawLayer(e){let{pickable:r,operation:i}=e.props;return r&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,r,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,r,i){let n={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?n.blend=!1:s&&o.includes("draw")&&(Object.assign(n,RV),n.blend=!0,n.blendColor=IV(this._colorEncoderState,e,i)),n}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function IV(t,e,r){let{byLayer:i,byAlpha:n}=t,s,o=i.get(e);return o?(o.viewports.push(r),s=o.a):(s=i.size+1,s<=255?(o={a:s,layer:e,viewports:[r]},i.set(e,o),n[s]=o):(me.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function BV(t,e){let r=t.byAlpha[e[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(e)}}var Ms={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Ka=Symbol.for("component"),Ei=Symbol.for("propTypes"),V0=Symbol.for("deprecatedProps"),Xn=Symbol.for("asyncPropDefaults"),dn=Symbol.for("asyncPropOriginal"),Di=Symbol.for("asyncPropResolved");function qr(t,e=()=>!0){return Array.isArray(t)?hC(t,e,[]):e(t)?[t]:[]}function hC(t,e,r){let i=-1;for(;++i<t.length;){let n=t[i];Array.isArray(n)?hC(n,e,r):e(n)&&r.push(n)}return r}function T_({target:t,source:e,start:r=0,count:i=1}){let n=e.length,s=i*n,o=0;for(let a=r;o<n;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(r+o,r,r+o),o*=2):(t.copyWithin(r+o,r,r+s-o),o=s);return t}var wA=class{constructor(e,r,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(r)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,r){if(e===this._data&&!r)return;this._data=e;let i=++this._loadCount,n=e;typeof e=="string"&&(n=dr(e)),n instanceof Promise?(this.isLoaded=!1,this._loader=n.then(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===i&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(let s of this._subscribers)s.onChange(this.getData())}};var CA=class{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:r,forceUpdate:i=!1,persistent:n=!0}){let s=this._resources[e];s?s.setData(r,i):(s=new wA(e,r,this._context),this._resources[e]=s),s.persistent=n}remove(e){let r=this._resources[e];r&&(r.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let r=this._consumers[e];if(r){for(let i in r){let n=r[i],s=this._resources[n.resourceId];s&&s.unsubscribe(n)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:r,consumerId:i,requestId:n="default"}){let{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));let a=s[e];if(this._track(i,n,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,r,i,n){let s=this._consumers,o=s[e]=s[e]||{},a=o[r],A=a&&a.resourceId&&this._resources[a.resourceId];A&&(A.unsubscribe(a),this.prune()),i&&(a?(a.onChange=n,a.resourceId=i.id):a={onChange:n,resourceId:i.id},o[r]=a,i.subscribe(a))}_prune(){this._pruneRequest=null;for(let e of Object.keys(this._resources)){let r=this._resources[e];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[e])}}};var OV="layerManager.setLayers",FV="layerManager.activateViewport",SA=class{constructor(e,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Wt(FV,this,a),a&&(this.context.viewport=a)};let{deck:i,stats:n,viewport:s,timeline:o}=r||{};this.layers=[],this.resourceManager=new CA({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:Xw(),defaultShaderModules:[Z2],renderPass:void 0,stats:n||new Sr({id:"deck.gl"}),viewport:s||new ai({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Ro,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(let i of this.layers){let n=i.getNeedsRedraw(e);r=r||n}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(r=>e.find(i=>r.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,r){Wt(OV,this,r,e),this._lastRenderedLayers=e;let i=qr(e,Boolean);for(let n of i)n.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:r}=this.context;r.find(i=>i.name===e.name)||(r.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:r}=this.context,i=r.findIndex(n=>n.name===e.name);i>=0&&(r.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,r,i){i.raiseError(r,`${e} of ${i}`)}_updateLayers(e,r){let i={};for(let o of e)i[o.id]?me.warn(`Multiple old layers with same id ${o.id}`)():i[o.id]=o;if(this._defaultShaderModulesChanged){for(let o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let n=[];this._updateSublayersRecursively(r,i,n),this._finalizeOldLayers(i);let s=!1;for(let o of n)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=n}_updateSublayersRecursively(e,r,i){for(let n of e){n.context=this.context;let s=r[n.id];s===null&&me.warn(`Multiple new layers with same id ${n.id}`)(),r[n.id]=null;let o=null;try{this._debug&&s!==n&&n.validateProps(),s?(this._transferLayerState(s,n),this._updateLayer(n)):this._initializeLayer(n),i.push(n),o=n.isComposite?n.getSubLayers():null}catch(a){this._handleError("matching",a,n)}o&&this._updateSublayersRecursively(o,r,i)}}_finalizeOldLayers(e){for(let r in e){let i=e[r];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Ms.INITIALIZED}catch(r){this._handleError("initialization",r,e)}}_transferLayerState(e,r){r._transferState(e),r.lifecycle=Ms.MATCHED,r!==e&&(e.lifecycle=Ms.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(r){this._handleError("update",r,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Ms.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Ms.FINALIZED}catch(r){this._handleError("finalization",r,e)}}};function Et(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!Et(t[i],e[i],r-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let s of i)if(!e.hasOwnProperty(s)||!Et(t[s],e[s],r-1))return!1;return!0}return!1}var MA=class{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let r=this.controllers[e];r&&r.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let r=this.controllers[e];r&&r.updateTransition()}}getViewports(e){return e?this._viewports.filter(r=>r.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(r=>{e[r.id]=r}),e}getView(e){return this.views.find(r=>r.id===e)}getViewState(e){let r=typeof e=="string"?this.getView(e):e,i=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,r){let i=this.getViewports(),n={x:e[0],y:e[1]};for(let s=i.length-1;s>=0;--s){let o=i[s];if(o.containsPixel(n)){let a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,r)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,r){(e!==this.width||r!==this.height)&&(this.width=e,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(e){e=qr(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Et(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):me.warn("missing `viewState` or `initialViewState`")()}_createController(e,r){let i=r.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,r,i,n){let s=e.controller;if(s&&i){let o={...r,...s,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!n||n.constructor!==s.type)&&(n=this._createController(e,o)),n&&n.setProps(o),n}return null}_rebuildViewports(){let{views:e}=this,r=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let n=e.length;n--;){let s=e[n],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height}),A=r[s.id],h=!!s.controller;h&&!A&&(i=!0),(i||!h)&&A&&(A.finalize(),A=null),this.controllers[s.id]=this._updateController(s,o,a,A),a&&this._viewports.unshift(a)}for(let n in r){let s=r[n];s&&!this.controllers[n]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,r){return e.length!==r.length?!0:e.some((i,n)=>!e[n].equals(r[n]))}};var LV=/([0-9]+\.?[0-9]*)(%|px)/;function Yn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":let e=LV.exec(t);if(e&&e.length>=3){let r=e[2]==="%",i=parseFloat(e[1]);return{position:r?i/100:i,relative:r}}default:throw new Error(`Could not parse position string ${t}`)}}function Qn(t,e){return t.relative?Math.round(t.position*e):t.position}var Fo=class{constructor(e){let{id:r,x:i=0,y:n=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=r||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Yn(i),this._y=Yn(n),this._width=Yn(s),this._height=Yn(o),this._padding=a&&{left:Yn(a.left||0),right:Yn(a.right||0),top:Yn(a.top||0),bottom:Yn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Et(this.props,e.props,2)}makeViewport({width:e,height:r,viewState:i}){i=this.filterViewState(i);let n=this.getDimensions({width:e,height:r});if(!n.height||!n.width)return null;let s=this.getViewportType(i);return new s({...i,...this.props,...n})}getViewStateId(){let{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...e};for(let i in this.props.viewState)i!=="id"&&(r[i]=this.props.viewState[i]);return r}return e}getDimensions({width:e,height:r}){let i={x:Qn(this._x,e),y:Qn(this._y,r),width:Qn(this._width,e),height:Qn(this._height,r)};return this._padding&&(i.padding={left:Qn(this._padding.left,e),top:Qn(this._padding.top,r),right:Qn(this._padding.right,e),bottom:Qn(this._padding.bottom,r)}),i}get controller(){let e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}};var ki=class{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:e,settings:r}=this;this._handle=e.addChannel({delay:e.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var dC=()=>{},E_={BREAK:1,SNAP_TO_END:2,IGNORE:3},NV=t=>t,DV=E_.BREAK,PA=class{constructor(e){this._onTransitionUpdate=r=>{let{time:i,settings:{interpolator:n,startProps:s,endProps:o,duration:a,easing:A}}=r,h=A(i/a),g=n.interpolateProps(s,o,h);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new ki(e.timeline),this.onViewStateChange=e.onViewStateChange||dC,this.onStateChange=e.onStateChange||dC}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let r=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let n=i;if(this.transition.inProgress){let{interruption:s,endProps:o}=this.transition.settings;n={...i,...s===E_.SNAP_TO_END?o:this.propsInTransition||i}}this._triggerTransition(n,e),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:r,transitionInterpolator:i}=e;return(r>0||r==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,r){return this.transition.inProgress?this.transition.settings.interruption===E_.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(e,r):!0}_triggerTransition(e,r){let i=this.getControllerState(e),n=this.getControllerState(r).shortestPathFrom(i),s=r.transitionInterpolator,o=s.getDuration?s.getDuration(e,r):r.transitionDuration;if(o===0)return;let a=s.initializeProps(e,n);this.propsInTransition={};let A={duration:o,easing:r.transitionEasing||NV,interpolator:s,interruption:r.transitionInterruption||DV,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(A),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(r)}}};function wt(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}var RA=class{constructor(e){let{compare:r,extract:i,required:n}=e;this._propsToCompare=r,this._propsToExtract=i||r,this._requiredProps=n}arePropsEqual(e,r){for(let i of this._propsToCompare)if(!(i in e)||!(i in r)||!er(e[i],r[i]))return!1;return!0}initializeProps(e,r){let i={},n={};for(let s of this._propsToExtract)(s in e||s in r)&&(i[s]=e[s],n[s]=r[s]);return this._checkRequiredProps(i),this._checkRequiredProps(n),{start:i,end:n}}getDuration(e,r){return r.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(r=>{let i=e[r];wt(Number.isFinite(i)||Array.isArray(i),`${r} is required for transition`)})}};var kV=["longitude","latitude","zoom","bearing","pitch"],UV=["longitude","latitude","zoom"],qn=class extends RA{constructor(e={}){let r=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:kV,required:UV},super(i.transitionProps),this.opts=i}initializeProps(e,r){let i=super.initializeProps(e,r),{makeViewport:n,around:s}=this.opts;if(n&&s){let o=n(e),a=n(r),A=o.unproject(s);i.start.around=s,Object.assign(i.end,{around:a.project(A),aroundPosition:A,width:r.width,height:r.height})}return i}interpolateProps(e,r,i){let n={};for(let s of this._propsToExtract)n[s]=br(e[s]||0,r[s]||0,i);if(r.aroundPosition&&this.opts.makeViewport){let s=this.opts.makeViewport({...r,...n});Object.assign(n,s.panByPosition(r.aroundPosition,br(e.around,r.around,i)))}return n}};var Ps={transitionDuration:0},VV=300,z0=t=>1-(1-t)*(1-t),Ja={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Lo={},No=class{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new PA({...e,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let r=this._eventStartBlocked;switch(e.type){case"panstart":return r?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return r?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return r?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:r,y:i}=this.props,{offsetCenter:n}=e;return[n.x-r,n.y-i]}isPointInBounds(e,r){let{width:i,height:n}=this.props;if(r&&r.handled)return!1;let s=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=n;return s&&r&&r.stopPropagation(),s}isFunctionKeyPressed(e){let{srcEvent:r}=e;return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=r}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:r}=e;this.inertia=Number.isFinite(r)?r:r===!0?VV:0;let{scrollZoom:i=!0,dragPan:n=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:A=!1,keyboard:h=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(Ja.WHEEL,g&&i),this.toggleEvents(Ja.PAN,g),this.toggleEvents(Ja.PINCH,g&&(a||A)),this.toggleEvents(Ja.MULTI_PAN,g&&A),this.toggleEvents(Ja.DOUBLE_CLICK,g&&o),this.toggleEvents(Ja.KEYBOARD,g&&h),this.scrollZoom=i,this.dragPan=n,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=A,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,r){this.eventManager&&e.forEach(i=>{this._events[i]!==r&&(this._events[i]=r,r?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,r=null,i={}){let n={...e.getViewportProps(),...r},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),s){let o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:n,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);let n=this.controllerState[i?"panStart":"rotateStart"]({pos:r});return this._panMove=i,this.updateViewport(n,Ps,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;let r=this.getCenter(e),i=this.controllerState.pan({pos:r});return this.updateViewport(i,Ps,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:r}=this;if(this.dragPan&&r&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],s=this.controllerState.pan({pos:n}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:z0},{isDragging:!1,isPanning:!0})}else{let i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let r=this.getCenter(e),i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Ps,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:r}=this;if(this.dragRotate&&r&&e.velocity){let i=this.getCenter(e),n=[i[0]+e.velocityX*r/2,i[1]+e.velocityY*r/2],s=this.controllerState.rotate({pos:n}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:z0},{isDragging:!1,isRotating:!0})}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;e.srcEvent.preventDefault();let{speed:i=.01,smooth:n=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e,o=2/(1+Math.exp(-Math.abs(s*i)));s<0&&o!==0&&(o=1/o);let a=this.controllerState.zoom({pos:r,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:n?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.controllerState.rotateStart({pos:r});return this.updateViewport(i,Ps,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(e);r[0]-=e.deltaX;let i=this.controllerState.rotate({pos:r});return this.updateViewport(i,Ps,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&e.velocityY){let i=this.getCenter(e),n=[i[0],i[1]+=e.velocityY*r/2],s=this.controllerState.rotate({pos:n});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:z0},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Lo._startPinchRotation=e.rotation,Lo._lastPinchEvent=e,this.updateViewport(i,Ps,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:i}=e,n=this.getCenter(e);r=r.zoom({pos:n,scale:i})}if(this.touchRotate){let{rotation:i}=e;r=r.rotate({deltaAngleX:Lo._startPinchRotation-i})}return this.updateViewport(r,Ps,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Lo._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:i}=Lo;if(this.touchZoom&&r&&i&&e.scale!==i.scale){let n=this.getCenter(e),s=this.controllerState.rotateEnd(),o=Math.log2(e.scale),a=(o-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),A=Math.pow(2,o+a*r/2);s=s.zoom({pos:n,scale:A}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:n}),transitionDuration:r,transitionEasing:z0},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let n=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Lo._startPinchRotation=null,Lo._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let r=this.getCenter(e);if(!this.isPointInBounds(r,e))return!1;let i=this.isFunctionKeyPressed(e),n=this.controllerState.zoom({pos:r,scale:i?.5:2});return this.updateViewport(n,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:n,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this,A,h={};switch(e.srcEvent.code){case"Minus":A=r?a.zoomOut(i).zoomOut(i):a.zoomOut(i),h.isZooming=!0;break;case"Equal":A=r?a.zoomIn(i).zoomIn(i):a.zoomIn(i),h.isZooming=!0;break;case"ArrowLeft":r?(A=a.rotateLeft(s),h.isRotating=!0):(A=a.moveLeft(n),h.isPanning=!0);break;case"ArrowRight":r?(A=a.rotateRight(s),h.isRotating=!0):(A=a.moveRight(n),h.isPanning=!0);break;case"ArrowUp":r?(A=a.rotateUp(o),h.isRotating=!0):(A=a.moveUp(n),h.isPanning=!0);break;case"ArrowDown":r?(A=a.rotateDown(o),h.isRotating=!0):(A=a.moveDown(n),h.isPanning=!0);break;default:return!1}return this.updateViewport(A,this._getTransitionProps(),h),!0}_getTransitionProps(e){let{transition:r}=this;return!r||!r.transitionInterpolator?Ps:e?{...r,transitionInterpolator:new qn({...e,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var IA=class{constructor(e,r){this._viewportProps=this.applyConstraints(e),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var pC=5,zV=1.2,BA=class extends IA{constructor(e){let{width:r,height:i,latitude:n,longitude:s,zoom:o,bearing:a=0,pitch:A=0,altitude:h=1.5,position:g=[0,0,0],maxZoom:_=20,minZoom:b=0,maxPitch:T=60,minPitch:v=0,startPanLngLat:C,startZoomLngLat:S,startRotatePos:P,startBearing:F,startPitch:I,startZoom:k,normalize:W=!0}=e;wt(Number.isFinite(s)),wt(Number.isFinite(n)),wt(Number.isFinite(o)),super({width:r,height:i,latitude:n,longitude:s,zoom:o,bearing:a,pitch:A,altitude:h,maxZoom:_,minZoom:b,maxPitch:T,minPitch:v,normalize:W,position:g},{startPanLngLat:C,startZoomLngLat:S,startRotatePos:P,startBearing:F,startPitch:I,startZoom:k}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:r}){let i=this.getState().startPanLngLat||this._unproject(r);if(!i)return this;let s=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:r=0,deltaAngleY:i=0}){let{startRotatePos:n,startBearing:s,startPitch:o}=this.getState();if(!n||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,n,o,s):a={bearing:s+r,pitch:o+i},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:r,scale:i}){let{startZoom:n,startZoomLngLat:s}=this.getState();if(s||(n=this.getViewportProps().zoom,s=this._unproject(r)||this._unproject(e)),!s)return this;let{maxZoom:o,minZoom:a}=this.getViewportProps(),A=n+Math.log2(i);A=pr(A,a,o);let h=this.makeViewport({...this.getViewportProps(),zoom:A});return this._getUpdatedState({zoom:A,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let r=e.getViewportProps(),i={...this.getViewportProps()},{bearing:n,longitude:s}=i;return Math.abs(n-r.bearing)>180&&(i.bearing=n<0?n+360:n-360),Math.abs(s-r.longitude)>180&&(i.longitude=s<0?s+360:s-360),i}applyConstraints(e){let{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=pr(n,i,r);let{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=pr(a,o,s);let{normalize:A=!0}=e;return A&&Object.assign(e,p_(e)),e}_zoomFromCenter(e){let{width:r,height:i}=this.getViewportProps();return this.zoom({pos:[r/2,i/2],scale:e})}_panFromCenter(e){let{width:r,height:i}=this.getViewportProps();return this.pan({startPos:[r/2,i/2],pos:[r/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let r=this.makeViewport(this.getViewportProps());return e&&r.unproject(e)}_getNewRotation(e,r,i,n){let s=e[0]-r[0],o=e[1]-r[1],a=e[1],A=r[1],{width:h,height:g}=this.getViewportProps(),_=s/h,b=0;o>0?Math.abs(g-A)>pC&&(b=o/(A-g)*zV):o<0&&A>pC&&(b=1-a/A),b=pr(b,-1,1);let{minPitch:T,maxPitch:v}=this.getViewportProps(),C=n+180*_,S=i;return b>0?S=i+b*(v-i):b<0&&(S=i-b*(T-i)),{pitch:S,bearing:C}}},OA=class extends No{constructor(){super(...arguments),this.ControllerState=BA,this.transition={transitionDuration:300,transitionInterpolator:new qn({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let r=this.props;super.setProps(e),(!r||r.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}};var H0=class extends Fo{constructor(e={}){super(e)}getViewportType(){return un}get ControllerType(){return OA}};H0.displayName="MapView";var FA=H0;var HV=new ja;function GV(t,e){let r=t.order??1/0,i=e.order??1/0;return r-i}var LA=class{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let r=this._defaultEffects;if(!r.find(i=>i.id===e.id)){let i=r.findIndex(n=>GV(n,e)>0);i<0?r.push(e):r.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Et(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(e){let r={};for(let n of this.effects)r[n.id]=n;let i=[];for(let n of e){let s=r[n.id],o=n;s&&s!==n?s.setProps?(s.setProps(n.props),o=s):s.cleanup(this._context):s||n.setup(this._context),i.push(o),delete r[n.id]}for(let n in r)r[n].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(n=>n instanceof ja)||this._resolvedEffects.push(HV),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var NA=class extends Wn{shouldDrawLayer(e){let{operation:r}=e.props;return r.includes("draw")||r.includes("terrain")}};var WV="deckRenderer.renderLayers",DA=class{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new NA(e),this.pickLayersPass=new Oo(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);let n=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);let s=r.render({...i,target:n});i.effects&&this._postRender(i.effects,i),this.renderCount++,Wt(WV,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){let r=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:e}=this;for(let r of e)r.delete();e.length=0}_preRender(e,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let i of e)r.preRenderStats[i.id]=i.preRender(r),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,r=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{let n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[n]}))});for(let i of e)i.resize(r)}_postRender(e,r){let{renderBuffers:i}=this,n={...r,inputBuffer:i[0],swapBuffer:i[1]};for(let s of e)if(s.postRender){n.target=s.id===this.lastPostProcessEffect?r.target:void 0;let o=s.postRender(n);n.inputBuffer=o,n.swapBuffer=o===i[0]?i[1]:i[0]}}};var jV={pickedColor:null,pickedObjectIndex:-1};function gC({pickedColors:t,decodePickingColor:e,deviceX:r,deviceY:i,deviceRadius:n,deviceRect:s}){let{x:o,y:a,width:A,height:h}=s,g=n*n,_=-1,b=0;for(let T=0;T<h;T++){let v=T+a-i,C=v*v;if(C>g)b+=4*A;else for(let S=0;S<A;S++){if(t[b+3]-1>=0){let F=S+o-r,I=F*F+C;I<=g&&(g=I,_=b)}b+=4}}if(_>=0){let T=t.slice(_,_+4),v=e(T);if(v){let C=Math.floor(_/4/A),S=_/4-C*A;return{...v,pickedColor:T,pickedX:o+S,pickedY:a+C}}me.error("Picked non-existent layer. Is picking buffer corrupt?")()}return jV}function mC({pickedColors:t,decodePickingColor:e}){let r=new Map;if(t){for(let i=0;i<t.length;i+=4)if(t[i+3]-1>=0){let s=t.slice(i,i+4),o=s.join(",");if(!r.has(o)){let a=e(s);a?r.set(o,{...a,color:s}):me.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function v_({pickInfo:t,viewports:e,pixelRatio:r,x:i,y:n,z:s}){let o=e[0];e.length>1&&(o=XV(t?.pickedViewports||e,{x:i,y:n}));let a;if(o){let A=[i-o.x,n-o.y];s!==void 0&&(A[2]=s),a=o.unproject(A)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:i,y:n,pixel:[i,n],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:r}}function _C(t){let{pickInfo:e,lastPickedInfo:r,mode:i,layers:n}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,A=o?[o]:[];if(i==="hover"){let _=r.index,b=r.layerId,T=o?o.props.id:null;if(T!==b||a!==_){if(T!==b){let v=n.find(C=>C.props.id===b);v&&A.unshift(v)}r.layerId=T,r.index=a,r.info=null}}let h=v_(t),g=new Map;return g.set(null,h),A.forEach(_=>{let b={...h};_===o&&(b.color=s,b.index=a,b.picked=!0),b=w_({layer:_,info:b,mode:i});let T=b.layer;_===o&&i==="hover"&&(r.info=b),g.set(T.id,b),i==="hover"&&T.updateAutoHighlight(b)}),g}function w_({layer:t,info:e,mode:r}){for(;t&&e;){let i=e.layer||null;e.sourceLayer=i,e.layer=t,e=t.getPickingInfo({info:e,mode:r,sourceLayer:i}),t=t.parent}return e}function XV(t,e){for(let r=t.length-1;r>=0;r--){let i=t[r];if(i.containsPixel(e))return i}return t[0]}var kA=class{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Oo(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:r,layers:i,viewports:n},s=this.lastPickedInfo.info){let o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,A=o?i.find(b=>b.id===o):null,h=a&&n.find(b=>b.id===a)||n[0],g=h&&h.unproject([e-h.x,r-h.y]);return{...s,...{x:e,y:r,viewport:h,coordinate:g,layer:A}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;let r=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return r.length?r:null}_pickClosestObject({layers:e,views:r,viewports:i,x:n,y:s,radius:o=0,depth:a=1,mode:A="query",unproject3D:h,onViewportActive:g,effects:_}){let b=this.device.canvasContext.cssToDeviceRatio(),T=this._getPickable(e);if(!T||i.length===0)return{result:[],emptyInfo:v_({viewports:i,x:n,y:s,pixelRatio:b})};this._resizeBuffer();let v=this.device.canvasContext.cssToDevicePixels([n,s],!0),C=[v.x+Math.floor(v.width/2),v.y+Math.floor(v.height/2)],S=Math.round(o*b),{width:P,height:F}=this.pickingFBO,I=this._getPickingRect({deviceX:C[0],deviceY:C[1],deviceRadius:S,deviceWidth:P,deviceHeight:F}),k={x:n-o,y:s-o,width:o*2+1,height:o*2+1},W,K=[],re=new Set;for(let Y=0;Y<a;Y++){let z;if(I){let se=this._drawAndSample({layers:T,views:r,viewports:i,onViewportActive:g,deviceRect:I,cullRect:k,effects:_,pass:`picking:${A}`});z=gC({...se,deviceX:C[0],deviceY:C[1],deviceRadius:S,deviceRect:I})}else z={pickedColor:null,pickedObjectIndex:-1};let L;if(z.pickedLayer&&h&&this.depthFBO){let{pickedColors:se}=this._drawAndSample({layers:[z.pickedLayer],views:r,viewports:i,onViewportActive:g,deviceRect:{x:z.pickedX,y:z.pickedY,width:1,height:1},cullRect:k,effects:_,pass:`picking:${A}:z`},!0);se[3]&&(L=se[0])}z.pickedLayer&&Y+1<a&&(re.add(z.pickedLayer),z.pickedLayer.disablePickingIndex(z.pickedObjectIndex)),W=_C({pickInfo:z,lastPickedInfo:this.lastPickedInfo,mode:A,layers:T,viewports:i,x:n,y:s,z:L,pixelRatio:b});for(let se of W.values())se.layer&&K.push(se);if(!z.pickedColor)break}for(let Y of re)Y.restorePickingColors();return{result:K,emptyInfo:W.get(null)}}_pickVisibleObjects({layers:e,views:r,viewports:i,x:n,y:s,width:o=1,height:a=1,mode:A="query",maxObjects:h=null,onViewportActive:g,effects:_}){let b=this._getPickable(e);if(!b||i.length===0)return[];this._resizeBuffer();let T=this.device.canvasContext.cssToDeviceRatio(),v=this.device.canvasContext.cssToDevicePixels([n,s],!0),C=v.x,S=v.y+v.height,P=this.device.canvasContext.cssToDevicePixels([n+o,s+a],!0),F=P.x+P.width,I=P.y,k={x:C,y:I,width:F-C,height:S-I},W=this._drawAndSample({layers:b,views:r,viewports:i,onViewportActive:g,deviceRect:k,cullRect:{x:n,y:s,width:o,height:a},effects:_,pass:`picking:${A}`}),K=mC(W),re=new Map,Y=[],z=Number.isFinite(h);for(let L=0;L<K.length&&!(z&&Y.length>=h);L++){let se=K[L],le={color:se.pickedColor,layer:null,index:se.pickedObjectIndex,picked:!0,x:n,y:s,pixelRatio:T};le=w_({layer:se.pickedLayer,info:le,mode:A});let ce=le.layer.id;re.has(ce)||re.set(ce,new Set);let he=re.get(ce),Re=le.object??le.index;he.has(Re)||(he.add(Re),Y.push(le))}return Y}_drawAndSample({layers:e,views:r,viewports:i,onViewportActive:n,deviceRect:s,cullRect:o,effects:a,pass:A},h=!1){let g=h?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:r,viewports:i,onViewportActive:n,pickingFBO:g,deviceRect:s,cullRect:o,effects:a,pass:A,pickZ:h,preRenderStats:{}};for(let F of a)F.useInPicking&&(_.preRenderStats[F.id]=F.preRender(_));let{decodePickingColor:b}=this.pickLayersPass.render(_),{x:T,y:v,width:C,height:S}=s,P=new(h?Float32Array:Uint8Array)(C*S*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:T,sourceY:v,sourceWidth:C,sourceHeight:S,target:P}),{pickedColors:P,decodePickingColor:b}}_getPickingRect({deviceX:e,deviceY:r,deviceRadius:i,deviceWidth:n,deviceHeight:s}){let o=Math.max(0,e-i),a=Math.max(0,r-i),A=Math.min(n,e+i+1)-o,h=Math.min(s,r+i+1)-a;return A<=0||h<=0?null:{x:o,y:a,width:A,height:h}}};var YV={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},QV="top-left",yC="__root",G0=class{constructor({deck:e,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Et(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(let e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(r=>r.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){let r={};for(let i of this.resolvedWidgets)r[i.id]=i;this.resolvedWidgets.length=0;for(let i of this.defaultWidgets)r[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){let n=r[i.id];n?n.viewId!==i.viewId||n.placement!==i.placement?(this._remove(n),this._add(i)):i!==n&&(n.setProps(i.props),i=n):this._add(i),r[i.id]=null,this.resolvedWidgets.push(i)}for(let i in r){let n=r[i];n&&this._remove(n)}this.widgets=e}_add(e){let{viewId:r=null,placement:i=QV}=e,n=e.onAdd({deck:this.deck,viewId:r});n&&this._getContainer(r,i).append(n),e._element=n}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,r){let i=e||yC,n=this.containers[i];n||(n=document.createElement("div"),n.style.pointerEvents="none",n.style.position="absolute",n.style.overflow="hidden",this.parentElement?.append(n),this.containers[i]=n);let s=n.querySelector(`.${r}`);return s||(s=document.createElement("div"),s.className=r,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,YV[r]),n.append(s)),s}_updateContainers(){let e=this.deck.width,r=this.deck.height;for(let i in this.containers){let n=this.lastViewports[i]||null,s=i===yC||n,o=this.containers[i];s?(o.style.display="block",o.style.left=`${n?n.x:0}px`,o.style.top=`${n?n.y:0}px`,o.style.width=`${n?n.width:e}px`,o.style.height=`${n?n.height:r}px`):o.style.display="none"}}onRedraw({viewports:e,layers:r}){let i=e.reduce((n,s)=>(n[s.id]=s,n),{});for(let n of this.getWidgets()){let{viewId:s}=n;if(s){let o=i[s];o&&(n.onViewportChange&&n.onViewportChange(o),n.onRedraw?.({viewports:[o],layers:r}))}else{if(n.onViewportChange)for(let o of e)n.onViewportChange(o);n.onRedraw?.({viewports:e,layers:r})}}this.lastViewports=i,this._updateContainers()}onHover(e,r){for(let i of this.getWidgets()){let{viewId:n}=i;(!n||n===e.viewport?.id)&&i.onHover?.(e,r)}}onEvent(e,r){let i=gA[r.type];if(i)for(let n of this.getWidgets()){let{viewId:s}=n;(!s||s===e.viewport?.id)&&n[i]?.(e,r)}}};var qV={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},UA=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){let r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,qV),this.deck=e,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:r}=this,i=r&&r.props.getTooltip;if(!i)return;let n=i(e);this.lastViewport=e.viewport,this.setTooltip(n,e.x,e.y)}setTooltip(e,r,i){let n=this.element;if(n){if(typeof e=="string")n.innerText=e;else if(e)e.text&&(n.innerText=e.text),e.html&&(n.innerHTML=e.html),e.className&&(n.className=e.className);else{this.isVisible=!1,n.style.display="none";return}this.isVisible=!0,n.style.display="block",n.style.transform=`translate(${r}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(n.style,e.style)}}};var Rs;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Rs||(Rs={}));var zA={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},tr=(t,e,r)=>e?t.enable(r):t.disable(r),xC=(t,e,r)=>t.hint(r,e),ci=(t,e,r)=>t.pixelStorei(r,e),bC=(t,e,r)=>{let i=r===36006?36009:36008;return t.bindFramebuffer(i,e)},VA=(t,e,r)=>{let n={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r];t.bindBuffer(n,e)};function C_(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}var TC={3042:tr,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:tr,2885:(t,e)=>t.cullFace(e),2929:tr,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:tr,35723:xC,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>t.bindTransformFeedback?.(36386,e),34229:(t,e)=>t.bindVertexArray(e),36006:bC,36010:bC,34964:VA,36662:VA,36663:VA,35053:VA,35055:VA,2886:(t,e)=>t.frontFace(e),33170:xC,2849:(t,e)=>t.lineWidth(e),32823:tr,32824:"polygonOffset",10752:"polygonOffset",35977:tr,32926:tr,32928:tr,32938:"sampleCoverage",32939:"sampleCoverage",3089:tr,3088:(t,e)=>t.scissor(...e),2960:tr,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:tr,10754:tr,12288:tr,12289:tr,12290:tr,12291:tr,12292:tr,12293:tr,12294:tr,12295:tr,3333:ci,3317:ci,37440:ci,37441:ci,37443:ci,3330:ci,3332:ci,3331:ci,3314:ci,32878:ci,3316:ci,3315:ci,32877:ci,framebuffer:(t,e)=>{let r=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,r)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{let r=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...r)},blendFunc:(t,e)=>{let r=e?.length===2?[...e,...e]:e;t.blendFuncSeparate(...r)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=C_(e)?e:[e,e];let[r,i]=e;t.stencilMaskSeparate(1028,r),t.stencilMaskSeparate(1029,i)},stencilFunc:(t,e)=>{e=C_(e)&&e.length===3?[...e,...e]:e;let[r,i,n,s,o,a]=e;t.stencilFuncSeparate(1028,r,i,n),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=C_(e)&&e.length===3?[...e,...e]:e;let[r,i,n,s,o,a]=e;t.stencilOpSeparate(1028,r,i,n),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function jt(t,e,r){return e[t]!==void 0?e[t]:r[t]}var EC={blendEquation:(t,e,r)=>t.blendEquationSeparate(jt(32777,e,r),jt(34877,e,r)),blendFunc:(t,e,r)=>t.blendFuncSeparate(jt(32969,e,r),jt(32968,e,r),jt(32971,e,r),jt(32970,e,r)),polygonOffset:(t,e,r)=>t.polygonOffset(jt(32824,e,r),jt(10752,e,r)),sampleCoverage:(t,e,r)=>t.sampleCoverage(jt(32938,e,r),jt(32939,e,r)),stencilFuncFront:(t,e,r)=>t.stencilFuncSeparate(1028,jt(2962,e,r),jt(2967,e,r),jt(2963,e,r)),stencilFuncBack:(t,e,r)=>t.stencilFuncSeparate(1029,jt(34816,e,r),jt(36003,e,r),jt(36004,e,r)),stencilOpFront:(t,e,r)=>t.stencilOpSeparate(1028,jt(2964,e,r),jt(2965,e,r),jt(2966,e,r)),stencilOpBack:(t,e,r)=>t.stencilOpSeparate(1029,jt(34817,e,r),jt(34818,e,r),jt(34819,e,r))},S_={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,r)=>t({[e]:r}),hint:(t,e,r)=>t({[e]:r}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,r)=>t({36007:r}),bindTransformFeedback:(t,e,r)=>t({36389:r}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,r)=>{switch(e){case 36160:return t({36006:r,36010:r});case 36009:return t({36006:r});case 36008:return t({36010:r});default:return null}},bindBuffer:(t,e,r)=>{let i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?t({[i]:r}):{valueChanged:!0}},blendColor:(t,e,r,i,n)=>t({32773:new Float32Array([e,r,i,n])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,r)=>t({32777:e,34877:r}),blendFunc:(t,e,r)=>t({32969:e,32968:r,32971:e,32970:r}),blendFuncSeparate:(t,e,r,i,n)=>t({32969:e,32968:r,32971:i,32970:n}),clearColor:(t,e,r,i,n)=>t({3106:new Float32Array([e,r,i,n])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,r,i,n)=>t({3107:[e,r,i,n]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,r)=>t({2928:new Float32Array([e,r])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,r)=>t({32824:e,10752:r}),sampleCoverage:(t,e,r)=>t({32938:e,32939:r}),scissor:(t,e,r,i,n)=>t({3088:new Int32Array([e,r,i,n])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,r)=>t({[e===1028?2968:36005]:r}),stencilFunc:(t,e,r,i)=>t({2962:e,2967:r,2963:i,34816:e,36003:r,36004:i}),stencilFuncSeparate:(t,e,r,i,n)=>t({[e===1028?2962:34816]:r,[e===1028?2967:36003]:i,[e===1028?2963:36004]:n}),stencilOp:(t,e,r,i)=>t({2964:e,2965:r,2966:i,34817:e,34818:r,34819:i}),stencilOpSeparate:(t,e,r,i,n)=>t({[e===1028?2964:34817]:r,[e===1028?2965:34818]:i,[e===1028?2966:34819]:n}),viewport:(t,e,r,i,n)=>t({2978:[e,r,i,n]})},pn=(t,e)=>t.isEnabled(e),M_={3042:pn,2884:pn,2929:pn,3024:pn,32823:pn,32926:pn,32928:pn,3089:pn,2960:pn,35977:pn},vC=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ui(t,e){if(KV(e))return;let r={};for(let n in e){let s=Number(n),o=TC[n];o&&(typeof o=="string"?r[o]=!0:o(t,e[n],s))}let i=t.state&&t.state.cache;if(i)for(let n in r){let s=EC[n];s(t,e,i)}}function W0(t,e=zA){if(typeof e=="number"){let n=e,s=M_[n];return s?s(t,n):t.getParameter(n)}let r=Array.isArray(e)?e:Object.keys(e),i={};for(let n of r){let s=M_[n];i[n]=s?s(t,Number(n)):t.getParameter(Number(n))}return i}function wC(t){Ui(t,zA)}function KV(t){for(let e in t)return!1;return!0}function CC(t,e){if(t===e)return!0;let r=Array.isArray(t)||ArrayBuffer.isView(t),i=Array.isArray(e)||ArrayBuffer.isView(e);if(r&&i&&t.length===e.length){for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}return!1}var Vi=class{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,r){this.gl=e,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){let e=this.stateStack[this.stateStack.length-1];Ui(this.gl,e),this.stateStack.pop()}trackState(e,r){if(this.cache=r.copyState?W0(e):Object.assign({},zA),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,ZV(e);for(let i in S_){let n=S_[i];JV(e,i,n)}SC(e,"getParameter"),SC(e,"isEnabled")}_updateCache(e){let r=!1,i,n=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let s in e){let o=e[s],a=this.cache[s];CC(o,a)||(r=!0,i=a,n&&!(s in n)&&(n[s]=a),this.cache[s]=o)}return{valueChanged:r,oldValue:i}}};function SC(t,e){let r=t[e].bind(t);t[e]=function(n){if(n===void 0||vC.has(n))return r(n);let s=Vi.get(t);return n in s.cache||(s.cache[n]=r(n)),s.enable?s.cache[n]:r(n)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function JV(t,e,r){if(!t[e])return;let i=t[e].bind(t);t[e]=function(...s){let o=Vi.get(t),{valueChanged:a,oldValue:A}=r(o._updateCache,...s);return a&&i(...s),A},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function ZV(t){let e=t.useProgram.bind(t);t.useProgram=function(i){let n=Vi.get(t);n.program!==i&&(e(i),n.program=i)}}function MC(t,e,r){let i="",n={preserveDrawingBuffer:!0,...r},s=null;if(s||=t.getContext("webgl2",n),n.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!s&&!r.failIfMajorPerformanceCaveat&&(n.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",n),s.luma||={},s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,i||="Your browser only supports WebGL1")),!s)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);let{onContextLost:o,onContextRestored:a}=e;return t.addEventListener("webglcontextlost",A=>o(A),!1),t.addEventListener("webglcontextrestored",A=>a(A),!1),s.luma||={},s}function gn(t,e,r){return r[e]===void 0&&(r[e]=t.getExtension(e)||null),r[e]}function PC(t,e){let r=t.getParameter(7936),i=t.getParameter(7937);gn(t,"WEBGL_debug_renderer_info",e);let n=e.WEBGL_debug_renderer_info,s=t.getParameter(n?n.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(n?n.UNMASKED_RENDERER_WEBGL:7937),a=s||r,A=o||i,h=t.getParameter(7938),g=RC(a,A),_=$V(a,A),b=ez(a,A);return{type:"webgl",gpu:g,gpuType:b,gpuBackend:_,vendor:a,renderer:A,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function RC(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function $V(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function ez(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(RC(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function j0(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}var HA="WEBGL_compressed_texture_s3tc",GA="WEBGL_compressed_texture_s3tc_srgb",Za="EXT_texture_compression_rgtc",$a="EXT_texture_compression_bptc",tz="WEBGL_compressed_texture_etc",rz="WEBGL_compressed_texture_astc",iz="WEBGL_compressed_texture_etc1",nz="WEBGL_compressed_texture_pvrtc",sz="WEBGL_compressed_texture_atc",IC="EXT_texture_norm16",BC="EXT_render_snorm",oz="EXT_color_buffer_float",X0={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[BC],"norm16-renderable-webgl":[IC],"snorm16-renderable-webgl":[IC,BC],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[HA,GA,Za,$a],"texture-compression-bc5-webgl":[Za],"texture-compression-bc7-webgl":[$a],"texture-compression-etc2":[tz],"texture-compression-astc":[rz],"texture-compression-etc1-webgl":[iz],"texture-compression-pvrtc-webgl":[nz],"texture-compression-atc-webgl":[sz]};function OC(t){return t in X0}function FC(t,e,r){return(X0[e]||[]).every(n=>gn(t,n,r))}var P_={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:oz,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:HA},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:GA},"bc1-rgba-unorm":{gl:33777,x:HA},"bc1-rgba-unorm-srgb":{gl:35916,x:GA},"bc2-rgba-unorm":{gl:33778,x:HA},"bc2-rgba-unorm-srgb":{gl:35918,x:GA},"bc3-rgba-unorm":{gl:33779,x:HA},"bc3-rgba-unorm-srgb":{gl:35919,x:GA},"bc4-r-unorm":{gl:36283,x:Za},"bc4-r-snorm":{gl:36284,x:Za},"bc5-rg-unorm":{gl:36285,x:Za},"bc5-rg-snorm":{gl:36286,x:Za},"bc6h-rgb-ufloat":{gl:36495,x:$a},"bc6h-rgb-float":{gl:36494,x:$a},"bc7-rgba-unorm":{gl:36492,x:$a},"bc7-rgba-unorm-srgb":{gl:36493,x:$a},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function LC(t,e,r){let i=e.create,n=P_[e.format];return n?.gl===void 0&&(i=!1),n?.x&&(i=i&&!!gn(t,n.x,r)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function Y0(t){let e=P_[t],r=cz(t),i=wa(t);return{internalFormat:r,format:e?.dataFormat||az(i.channels,i.integer,i.normalized,r),type:i.dataType?j0(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function NC(t){switch(wa(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function az(t,e,r,i){if(i===6408||i===6407)return i;switch(t){case"r":return e&&!r?36244:6403;case"rg":return e&&!r?33320:33319;case"rgb":return e&&!r?36248:6407;case"rgba":return e&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function cz(t){let r=P_[t]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${t}`);return r}var DC={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},Q0=class extends kl{gl;extensions;testedFeatures=new Set;constructor(e,r,i){super([],i),this.gl=e,this.extensions=r,gn(e,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let e=this.getFeatures();for(let r of e)this.has(r)&&(yield r);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),OC(e)&&FC(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){let e=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of e)this.has(r)}getFeatures(){return[...Object.keys(DC),...Object.keys(X0)]}getWebGLFeature(e){let r=DC[e];return typeof r=="string"?!!gn(this.gl,r,this.extensions):!!r}};var q0=class extends Dl{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}};var mn=class extends _o{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,r){super(e,r);let i=r.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let e=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){let i=this.colorAttachments[r];if(i){let n=36064+r;this._attachTextureView(n,i)}}if(this.depthStencilAttachment){let r=NC(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){let r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${Az(r)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,r){let{gl:i}=this.device,{texture:n}=r,s=r.props.baseMipLevel,o=r.props.baseArrayLayer;switch(i.bindTexture(n.glTarget,n.handle),n.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,n.handle,s,o);break;case 34067:let a=lz(o);i.framebufferTexture2D(36160,e,a,n.handle,s);break;case 3553:i.framebufferTexture2D(36160,e,3553,n.handle,s);break;default:throw new Error("Illegal texture type")}i.bindTexture(n.glTarget,null)}};function lz(t){return t<34069?t+34069:t}function Az(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}var K0=class extends Vl{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,r){super(r),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new mn(this.device,{handle:null}),this._framebuffer}update(){let e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){let r=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(r,e);return}}commit(){}};async function J0(t,e){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",t),e&&(i.id=e),new Promise((n,s)=>{i.onload=n,i.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),r.appendChild(i)})}var uz=1,li=null,kC=!1,Z0={debugSpectorJS:oe.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function UC(t){if(!globalThis.SPECTOR)try{await J0(t.debugSpectorJSUrl||Z0.debugSpectorJSUrl)}catch(e){oe.warn(String(e))}}function VC(t){if(t={...Z0,...t},!t.debugSpectorJS)return null;if(!li&&globalThis.SPECTOR&&!globalThis.luma?.spector){oe.probe(uz,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:e}=globalThis.SPECTOR;li=new e,globalThis.luma&&(globalThis.luma.spector=li)}if(!li)return null;if(kC||(kC=!0,li.spyCanvases(),li?.onCaptureStarted.add(e=>oe.info("Spector capture started:",e)()),li?.onCapture.add(e=>{oe.info("Spector capture complete:",e)(),li?.getResultUI(),li?.resultView.display(),li?.resultView.addCapture(e)})),t.gl){let e=t.gl,r=e.device;li?.startCapture(t.gl,500),e.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{oe.info("Spector capture stopped after 2 seconds")(),li?.stopCapture()})}return li}var fz="https://unpkg.com/webgl-debug@2.0.1/index.js";function HC(t){return t.luma=t.luma||{},t.luma}async function GC(){kr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await J0(fz))}function WC(t,e={}){return e.debugWebGL||e.traceWebGL?dz(t,e):hz(t)}function hz(t){let e=HC(t);return e.realContext?e.realContext:t}function dz(t,e){if(!globalThis.WebGLDebugUtils)return oe.warn("webgl-debug not loaded")(),t;let r=HC(t);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Rs,...t});let i=globalThis.WebGLDebugUtils.makeDebugContext(t,pz.bind(null,e),gz.bind(null,e));for(let o in Rs)!(o in i)&&typeof Rs[o]=="number"&&(i[o]=Rs[o]);class n{}Object.setPrototypeOf(i,Object.getPrototypeOf(t)),Object.setPrototypeOf(n,i);let s=Object.create(n);return r.realContext=t,r.debugContext=s,s.debug=!0,s}function zC(t,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${t}(${r})`}function pz(t,e,r,i){i=Array.from(i).map(a=>a===void 0?"undefined":a);let n=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,i),o=`${n} in gl.${r}(${s})`;oe.error(o)();debugger}function gz(t,e,r){let i="";oe.level>=1&&(i=zC(e,r),t.traceWebGL&&oe.log(1,i)());for(let n of r)if(n===void 0){i=i||zC(e,r);debugger}}var R_={};function jC(t="id"){R_[t]=R_[t]||1;let e=R_[t]++;return`${t}-${e}`}var zi=class extends ct{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,r={}){super(e,r),this.device=e,this.gl=this.device.gl;let i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=mz(this.props.usage),this.glUsage=_z(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(e,r=0,i=e.byteLength+r){let n=this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,i,this.glUsage),this.gl.bufferSubData(n,r,e),this.gl.bindBuffer(n,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let r=e;e===0&&(r=new Float32Array(0));let i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,r,e.byteLength)}async readAsync(e=0,r){return this.readSyncWebGL(e,r)}readSyncWebGL(e=0,r){r=r??this.byteLength-e;let i=new Uint8Array(r),n=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,n,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,r),i}};function mz(t){return t&ct.INDEX?34963:t&ct.VERTEX?34962:t&ct.UNIFORM?35345:34962}function _z(t){return t&ct.INDEX||t&ct.VERTEX?35044:t&ct.UNIFORM?35048:35044}function YC(t){let e=t.split(/\r?\n/),r=[];for(let i of e){if(i.length<=1)continue;let n=i.split(":");if(n.length===2){let[_,b]=n;r.push({message:b.trim(),type:XC(_),lineNum:0,linePos:0});continue}let[s,o,a,...A]=n,h=parseInt(a,10);isNaN(h)&&(h=0);let g=parseInt(o,10);isNaN(g)&&(g=0),r.push({message:A.join(":").trim(),type:XC(s),lineNum:h,linePos:g})}return r}function XC(t){let e=["warning","error","info"],r=t.toLowerCase();return e.includes(r)?r:"info"}var $0=class extends go{device;handle;constructor(e,r){switch(super(e,r),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let e=this.device.gl.getShaderInfoLog(this.handle);return e?YC(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;let{gl:r}=this.device;if(r.shaderSource(this.handle,e),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}oe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),oe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let e=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};function qC(t,e,r,i){if(Tz(e))return i(t);let n=t;n.pushState();try{return yz(t,e),Ui(n.gl,r),i(t)}finally{n.popState()}}function yz(t,e){let r=t,{gl:i}=r;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Do("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){let s=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Do("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){let s=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Do("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,o),s?.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&i.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(bz("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(td("depthCompare",e.depthCompare))),e.stencilWriteMask){let n=e.stencilWriteMask;i.stencilMaskSeparate(1028,n),i.stencilMaskSeparate(1029,n)}if(e.stencilReadMask&&oe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){let n=e.stencilReadMask||4294967295,s=td("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,s,0,n),i.stencilFuncSeparate(1029,s,0,n)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){let n=I_("stencilPassOperation",e.stencilPassOperation),s=I_("stencilFailOperation",e.stencilFailOperation),o=I_("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,s,o,n),i.stencilOpSeparate(1029,s,o,n)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break;default:}if(e.blendColorOperation||e.blendAlphaOperation){let n=QC("blendColorOperation",e.blendColorOperation||"add"),s=QC("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(n,s);let o=ed("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=ed("blendColorDstFactor",e.blendColorDstFactor||"zero"),A=ed("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),h=ed("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(o,a,A,h)}}function td(t,e){return Do(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function I_(t,e){return Do(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function QC(t,e){return Do(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function ed(t,e){return Do(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function xz(t,e){return`Illegal parameter ${e} for ${t}`}function Do(t,e,r){if(!(e in r))throw new Error(xz(t,e));return r[e]}function bz(t,e){return e}function Tz(t){let e=!0;for(let r in t){e=!1;break}return e}function rd(t){let e={};return t.addressModeU&&(e[10242]=B_(t.addressModeU)),t.addressModeV&&(e[10243]=B_(t.addressModeV)),t.addressModeW&&(e[32882]=B_(t.addressModeW)),t.magFilter&&(e[10240]=O_(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=Ez(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=td("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function B_(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function O_(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function Ez(t,e="none"){if(!e)return O_(t);switch(e){case"none":return O_(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}var ko=class extends mo{device;handle;parameters;constructor(e,r){super(e,r),this.device=e,this.parameters=rd(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(let[r,i]of Object.entries(e)){let n=Number(r);switch(n){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,n,i);break;default:this.device.gl.samplerParameteri(this.handle,n,i);break}}}};var _n=class extends po{device;gl;handle;texture;constructor(e,r){super(e,{..._t.defaultProps,...r}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}};var vz="Failed to deduce GL constant from typed array";function KC(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(vz)}}function JC(t,e){let{clamped:r=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function F_(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function ZC(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Uo(t,e,r){if(wz(e))return r(t);let{nocatch:i=!0}=e,n=Vi.get(t);n.push(),Ui(t,e);let s;if(i)s=r(t),n.pop();else try{s=r(t)}finally{n.pop()}return s}function wz(t){for(let e in t)return!1;return!0}function $C(t,e,r){let{dimension:i,width:n,height:s,depth:o=0}=r,{glInternalFormat:a}=r,A=r.glTarget;switch(i){case"2d-array":case"3d":t.texStorage3D(A,e,a,n,s,o);break;default:t.texStorage2D(A,e,a,n,s)}}function L_(t,e,r,i){let{width:n,height:s}=i,{dimension:o,depth:a=0,mipLevel:A=0}=i,{x:h=0,y:g=0,z:_=0}=i,{glFormat:b,glType:T}=i,v=tS(i.glTarget,o,a),C=i.flipY?{37440:!0}:{};Uo(t,C,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(v,e),t.texSubImage3D(v,A,h,g,_,n,s,a,b,T,r),t.bindTexture(v,null);break;case"2d":case"cube":t.bindTexture(v,e),t.texSubImage2D(v,A,h,g,n,s,b,T,r),t.bindTexture(v,null);break;default:throw new Error(o)}})}function N_(t,e,r){let{dimension:i,width:n,height:s,depth:o=0,mipLevel:a=0,byteOffset:A=0}=r,{x:h=0,y:g=0,z:_=0}=r,{glFormat:b,glType:T,compressed:v}=r,C=tS(r.glTarget,i,o);switch(i){case"2d-array":case"3d":v?t.compressedTexSubImage3D(C,a,h,g,_,n,s,o,b,e,A):t.texSubImage3D(C,a,h,g,_,n,s,o,b,T,e,A);break;case"2d":case"cube":v?t.compressedTexSubImage2D(C,a,h,g,n,s,b,e,A):t.texSubImage2D(C,a,h,g,n,s,b,T,e,A);break;default:throw new Error(i)}}function eS(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866;case"cube-array":break}throw new Error(t)}function tS(t,e,r){return e==="cube"?34069+r:t}function rS(t,e){let{sourceX:r=0,sourceY:i=0,sourceAttachment:n=0}=e||{},{target:s=null,sourceWidth:o,sourceHeight:a,sourceDepth:A,sourceFormat:h,sourceType:g}=e||{},{framebuffer:_,deleteFramebuffer:b}=nS(t),{gl:T,handle:v}=_;o||=_.width,a||=_.height;let C=_.colorAttachments[n]?.texture;if(!C)throw new Error(`Invalid framebuffer attachment ${n}`);A=C?.depth||1,h||=C?.glFormat||6408,g||=C?.glType||5121,s=Sz(s,g,h,o,a,A),g=g||KC(s);let S=T.bindFramebuffer(36160,v);return T.readBuffer(36064+n),T.readPixels(r,i,o,a,h,g,s),T.readBuffer(36064),T.bindFramebuffer(36160,S||null),b&&_.destroy(),s}function iS(t,e){let{target:r,sourceX:i=0,sourceY:n=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{},{sourceWidth:a,sourceHeight:A,sourceType:h}=e||{},{framebuffer:g,deleteFramebuffer:_}=nS(t);a=a||g.width,A=A||g.height;let b=g;h=h||5121;let T=r;if(!T){let C=F_(s),S=ZC(h),P=o+a*A*C*S;T=b.device.createBuffer({byteLength:P})}let v=t.device.createCommandEncoder();return v.copyTextureToBuffer({sourceTexture:t,width:a,height:A,origin:[i,n],destinationBuffer:T,byteOffset:o}),v.destroy(),_&&g.destroy(),T}function nS(t){return t instanceof _o?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:Cz(t),deleteFramebuffer:!0}}function Cz(t,e){let{device:r,width:i,height:n,id:s}=t;return r.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:i,height:n,colorAttachments:[t]})}function Sz(t,e,r,i,n,s){if(t)return t;e||=5121;let o=JC(e,{clamped:!1}),a=F_(r);return new o(i*n*a)}var yn=class extends _t{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,r){super(e,r);let i={...this.props};i.data=r.data,this.device=e,this.gl=this.device.gl,this.glTarget=eS(this.props.dimension);let n=Y0(this.props.format);this.glInternalFormat=n.internalFormat,this.glFormat=n.format,this.glType=n.type,this.compressed=n.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:r,height:i}=e;if(!r||!i){let n=_t.getTextureDataSize(e.data);r=n?.width||1,i=n?.height||1}if(this.width=r,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new _n(this.device,{...this.props,texture:this}),this.bind(),$C(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new _n(this.device,{...e,texture:this})}setSampler(e={}){let r;e instanceof ko?(this.sampler=e,r=e.props):(this.sampler=new ko(this.device,e),r=e);let i=rd(r);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(oe.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){oe.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){let r=_t.getExternalImageSize(e.image),i={..._t.defaultCopyExternalImageOptions,...r,...e},{image:n,depth:s,mipLevel:o,x:a,y:A,z:h,flipY:g}=i,{width:_,height:b}=i,{dimension:T,glTarget:v,glFormat:C,glInternalFormat:S,glType:P}=this;if(_=Math.min(_,this.width-a),b=Math.min(b,this.height-A),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return L_(this.device.gl,this.handle,n,{dimension:T,mipLevel:o,x:a,y:A,z:h,width:_,height:b,depth:s,glFormat:C,glInternalFormat:S,glType:P,glTarget:v,flipY:g}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,r=0){this.bind();let i=_t.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&oe.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let n=0;n<i.length;n++){let s=i[n];this._setMipLevel(r,n,s)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),N_(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(let i of _t.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,r,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&oe.warn(`${this.id} has mipmap and multiple LODs.`)();let n=_t.CubeFaces.indexOf(r);this.setTexture2DData(e,n)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){let{face:r,width:i,height:n,pixels:s,data:o,format:a=6408,type:A=5121}=e,{gl:h}=this,g=s||o;this.bind(),g instanceof Promise?g.then(_=>this.setImageDataForFace(Object.assign({},e,{face:r,data:_,pixels:_}))):this.width||this.height?h.texImage2D(r,0,a,i,n,0,a,A,g):h.texImage2D(r,0,a,a,A,g)}_getImageDataMap(e){for(let r=0;r<_t.CubeFaces.length;++r){let i=_t.CubeFaces[r];e[i]&&(e[34069+r]=e[i],delete e[i])}return e}_setSamplerParameters(e){oe.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(let[r,i]of Object.entries(e)){let n=Number(r),s=i;switch(n){case 33082:case 33083:this.gl.texParameterf(this.glTarget,n,s);break;case 10241:this.gl.texParameteri(this.glTarget,n,s);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,n,s);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,n,s);break;default:this.gl.texParameteri(this.glTarget,n,s);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,r,i,n=this.glTarget){if(_t.isExternalImage(i)){L_(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:r,glTarget:n,flipY:this.props.flipY});return}if(_t.isTextureLevelData(i)){N_(this.device.gl,i.data,{...this,depth:e,mipLevel:r,glTarget:n});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){let{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,this.handle),e}unbind(e){let{gl:r}=this;return e!==void 0&&(this.textureUnit=e,r.activeTexture(33984+e)),r.bindTexture(this.glTarget,null),e}};var Mz=[1,2,4,8],id=class extends zl{device;glParameters;constructor(e,r){super(e,r),this.device=e;let i;if(!r?.parameters?.viewport)if(r?.framebuffer){let{width:n,height:s}=r.framebuffer;i=[0,0,n,s]}else{let[n,s]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,n,s]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer){let n=this.props.framebuffer.colorAttachments.map((s,o)=>36064+o);this.device.gl.drawBuffers(n)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){let r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(r.viewport=e.viewport.slice(0,4),r.depthRange=[e.viewport[4],e.viewport[5]]):r.viewport=e.viewport),e.scissorRect&&(r.scissorTest=!0,r.scissor=e.scissorRect),e.blendConstant&&(r.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(r.colorMask=Mz.map(i=>!!(i&e.colorMask))),this.glParameters=r,Ui(this.device.gl,r)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let e={...this.glParameters},r=0;this.props.clearColors&&this.props.clearColors.forEach((i,n)=>{i&&this.clearColorBuffer(n,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,e.clearStencil=this.props.clearStencil),r!==0&&Uo(this.device.gl,e,()=>{this.device.gl.clear(r)})}clearColorBuffer(e=0,r=[0,0,0,0]){Uo(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}};function sS(t){return Pz.includes(t)}var Pz=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],oS={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function D_(t){let e=oS[t];if(!e)throw new Error("uniform");let[r,i,,n]=e;return{format:n,components:i,glType:r}}function aS(t){let e=oS[t];if(!e)throw new Error("attribute");let[,r,,i,n]=e;return{attributeType:i,vertexFormat:n,components:r}}function cS(t,e){let r={attributes:[],bindings:[]};r.attributes=Rz(t,e);let i=Oz(t,e);for(let a of i){let A=a.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));r.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:A})}let n=Bz(t,e),s=0;for(let a of n)if(sS(a.type)){let{viewDimension:A,sampleType:h}=Lz(a.type);r.bindings.push({type:"texture",name:a.name,group:0,location:s,viewDimension:A,sampleType:h}),a.textureUnit=s,s+=1}n.length&&(r.uniforms=n);let o=Iz(t,e);return o?.length&&(r.varyings=o),r}function Rz(t,e){let r=[],i=t.getProgramParameter(e,35721);for(let n=0;n<i;n++){let s=t.getActiveAttrib(e,n);if(!s)throw new Error("activeInfo");let{name:o,type:a}=s,A=t.getAttribLocation(e,o);if(A>=0){let{attributeType:h}=aS(a),g=/instance/i.test(o)?"instance":"vertex";r.push({name:o,location:A,stepMode:g,type:h})}}return r.sort((n,s)=>n.location-s.location),r}function Iz(t,e){let r=[],i=t.getProgramParameter(e,35971);for(let n=0;n<i;n++){let s=t.getTransformFeedbackVarying(e,n);if(!s)throw new Error("activeInfo");let{name:o,type:a,size:A}=s,{glType:h,components:g}=D_(a),_={location:n,name:o,type:h,size:A*g};r.push(_)}return r.sort((n,s)=>n.location-s.location),r}function Bz(t,e){let r=[],i=t.getProgramParameter(e,35718);for(let n=0;n<i;n++){let s=t.getActiveUniform(e,n);if(!s)throw new Error("activeInfo");let{name:o,size:a,type:A}=s,{name:h,isArray:g}=Nz(o),_=t.getUniformLocation(e,h),b={location:_,name:h,size:a,type:A,isArray:g};if(r.push(b),b.size>1)for(let T=0;T<b.size;T++){let v=`${h}[${T}]`;_=t.getUniformLocation(e,v);let C={...b,name:v,location:_};r.push(C)}}return r}function Oz(t,e){let r=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),i=[],n=t.getProgramParameter(e,35382);for(let s=0;s<n;s++){let o={name:t.getActiveUniformBlockName(e,s)||"",location:r(s,35391),byteLength:r(s,35392),vertex:r(s,35396),fragment:r(s,35398),uniformCount:r(s,35394),uniforms:[]},a=r(s,35395)||[],A=t.getActiveUniforms(e,a,35383),h=t.getActiveUniforms(e,a,35384),g=t.getActiveUniforms(e,a,35387),_=t.getActiveUniforms(e,a,35388);for(let b=0;b<o.uniformCount;++b){let T=t.getActiveUniform(e,a[b]);if(!T)throw new Error("activeInfo");o.uniforms.push({name:T.name,format:D_(A[b]).format,type:A[b],arrayLength:h[b],byteOffset:g[b],byteStride:_[b]})}i.push(o)}return i.sort((s,o)=>s.location-o.location),i}var Fz={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function Lz(t){let e=Fz[t];if(!e)throw new Error("sampler");let[r,i]=e;return{viewDimension:r,sampleType:i}}function Nz(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:r[1],length:r[2]?1:0,isArray:!!r[2]}}function lS(t,e,r,i){let n=t,s=i;s===!0&&(s=1),s===!1&&(s=0);let o=typeof s=="number"?[s]:s;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,i);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return n.uniform1uiv(e,o,1);case 36294:return n.uniform2uiv(e,o,2);case 36295:return n.uniform3uiv(e,o,3);case 36296:return n.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return n.uniformMatrix2x3fv(e,!1,o);case 35686:return n.uniformMatrix2x4fv(e,!1,o);case 35687:return n.uniformMatrix3x2fv(e,!1,o);case 35688:return n.uniformMatrix3x4fv(e,!1,o);case 35689:return n.uniformMatrix4x2fv(e,!1,o);case 35690:return n.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function Dz(t){return vA(t)!==null||typeof t=="number"||typeof t=="boolean"}function AS(t){let e={bindings:{},uniforms:{}};return Object.keys(t).forEach(r=>{let i=t[r];Dz(i)?e.uniforms[r]=i:e.bindings[r]=i}),e}function uS(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function fS(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}var hS=4,nd=class extends on{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,r){super(e,r),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;let{varyings:i,bufferMode:n=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,n)),this._linkShaders(),oe.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=cS(this.device.gl,this.handle),oe.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=kz(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,r){for(let[i,n]of Object.entries(e)){let s=this.shaderLayout.bindings.find(o=>o.name===i)||this.shaderLayout.bindings.find(o=>o.name===`${i}Uniforms`);if(!s){let o=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||oe.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${o}`,n)();continue}switch(n||oe.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),s.type){case"uniform":if(!(n instanceof zi)&&!(n.buffer instanceof zi))throw new Error("buffer value");break;case"texture":if(!(n instanceof _n||n instanceof yn||n instanceof mn))throw new Error("texture value");break;case"sampler":oe.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(s.type)}this.bindings[i]=n}}draw(e){let{renderPass:r,parameters:i=this.props.parameters,topology:n=this.props.topology,vertexArray:s,vertexCount:o,instanceCount:a,isInstanced:A=!1,firstVertex:h=0,transformFeedback:g}=e,_=uS(n),b=!!s.indexBuffer,T=s.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),s.bindBeforeRender(r),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let v=r;return qC(this.device,i,v.glParameters,()=>{b&&A?this.device.gl.drawElementsInstanced(_,o||0,T,h,a||0):b?this.device.gl.drawElements(_,o||0,T,h):A?this.device.gl.drawArraysInstanced(_,h,o||0,a||0):this.device.gl.drawArrays(_,h,o||0),g&&g.end()}),s.unbindAfterRender(r),!0}setUniformsWebGL(e){let{bindings:r}=AS(e);Object.keys(r).forEach(i=>{oe.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){let{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),oe.time(hS,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),oe.timeEnd(hS,`linkProgram for ${this.id}`)(),oe.level,!this.device.features.has("compilation-status-async-webgl")){let i=this._getLinkStatus();this._reportLinkStatus(i);return}oe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),oe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break;case"success":break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break;case"success":break}let r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${r}`)}}_getLinkStatus(){let{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let e=async n=>await new Promise(s=>setTimeout(s,n));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(let r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(oe.warn(`Binding ${r.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:e}=this.device;e.useProgram(this.handle);let r=0,i=0;for(let n of this.shaderLayout.bindings){let s=this.bindings[n.name]||this.bindings[n.name.replace(/Uniforms$/,"")];if(!s)throw new Error(`No value for binding ${n.name} in ${this.id}`);switch(n.type){case"uniform":let{name:o}=n,a=e.getUniformBlockIndex(this.handle,o);if(a===4294967295)throw new Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,i,a),s instanceof zi?e.bindBufferBase(35345,i,s.handle):e.bindBufferRange(35345,i,s.buffer.handle,s.offset||0,s.size||s.buffer.byteLength-s.offset),i+=1;break;case"texture":if(!(s instanceof _n||s instanceof yn||s instanceof mn))throw new Error("texture");let A;if(s instanceof _n)A=s.texture;else if(s instanceof yn)A=s;else if(s instanceof mn&&s.colorAttachments[0]instanceof _n)oe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),A=s.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+r),e.bindTexture(A.glTarget,A.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${n.type}' not supported in WebGL`)}}}_applyUniforms(){for(let e of this.shaderLayout.uniforms||[]){let{name:r,location:i,type:n,textureUnit:s}=e,o=this.uniforms[r]??s;o!==void 0&&lS(this.device.gl,i,n,o)}}};function kz(t,e){let r={...t,attributes:t.attributes.map(i=>({...i}))};for(let i of e?.attributes||[]){let n=r.attributes.find(s=>s.name===i.name);n?(n.type=i.type||n.type,n.stepMode=i.stepMode||n.stepMode):oe.warn(`shader layout attribute ${i.name} not present in shader`)}return r}var sd=class extends Gl{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(let r of e)switch(r.name){case"copy-buffer-to-buffer":Uz(this.device,r.options);break;case"copy-buffer-to-texture":Vz(this.device,r.options);break;case"copy-texture-to-buffer":zz(this.device,r.options);break;case"copy-texture-to-texture":Hz(this.device,r.options);break;default:throw new Error(r.name)}}};function Uz(t,e){let r=e.sourceBuffer,i=e.destinationBuffer;t.gl.bindBuffer(36662,r.handle),t.gl.bindBuffer(36663,i.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function Vz(t,e){throw new Error("Not implemented")}function zz(t,e){let{sourceTexture:r,mipLevel:i=0,aspect:n="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:A=[0,0],destinationBuffer:h,byteOffset:g=0,bytesPerRow:_,rowsPerImage:b}=e;if(n!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||a!==0||_||b)throw new Error("not implemented");let{framebuffer:T,destroyFramebuffer:v}=dS(r),C;try{let S=h,P=s||T.width,F=o||T.height,I=Y0(T.colorAttachments[0].texture.props.format),k=I.format,W=I.type;t.gl.bindBuffer(35051,S.handle),C=t.gl.bindFramebuffer(36160,T.handle),t.gl.readPixels(A[0],A[1],P,F,k,W,g)}finally{t.gl.bindBuffer(35051,null),C!==void 0&&t.gl.bindFramebuffer(36160,C),v&&T.destroy()}}function Hz(t,e){let{sourceTexture:r,destinationMipLevel:i=0,origin:n=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e,{width:a=e.destinationTexture.width,height:A=e.destinationTexture.height}=e,{framebuffer:h,destroyFramebuffer:g}=dS(r),[_,b]=n,[T,v,C]=s,S=t.gl.bindFramebuffer(36160,h.handle),P=null,F;if(o instanceof yn)P=o,a=Number.isFinite(a)?a:P.width,A=Number.isFinite(A)?A:P.height,P.bind(0),F=P.glTarget;else throw new Error("invalid destination");switch(F){case 3553:case 34067:t.gl.copyTexSubImage2D(F,i,T,v,_,b,a,A);break;case 35866:case 32879:t.gl.copyTexSubImage3D(F,i,T,v,C,_,b,a,A);break;default:}P&&P.unbind(),t.gl.bindFramebuffer(36160,S),g&&h.destroy()}function dS(t){if(t instanceof _t){let{width:e,height:r,id:i}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:r,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}var od=class extends Hl{device;commandBuffer;constructor(e,r){super(e,r),this.device=e,this.commandBuffer=new sd(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,r,i){}};function pS(t){let{target:e,source:r,start:i=0,count:n=1}=t,s=r.length,o=n*s,a=0;for(let A=i;a<s;a++)e[A++]=r[a];for(;a<o;)a<o-a?(e.copyWithin(i+a,i,i+a),a*=2):(e.copyWithin(i+a,i,i+o-a),a=o);return t.target}var ad=class t extends Wl{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return pm()==="Chrome"}constructor(e,r){super(e,r),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){let r=e;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(e,r){let i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:n,type:s,stride:o,offset:a,normalized:A,integer:h,divisor:g}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),h?this.device.gl.vertexAttribIPointer(e,n,s,o,a):this.device.gl.vertexAttribPointer(e,n,s,A,o,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,g||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,r){this._enable(e,!1),this.attributes[e]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){let r=this.attributes[e];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(e,r)}}_getAccessor(e){let r=this.attributeInfos[e];if(!r)throw new Error(`Unknown attribute location ${e}`);let i=j0(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(e,r=!0){let n=t.isConstantAttributeZeroSupported(this.device)||e!==0;(r||n)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,r){let i=Gz(r),n=i.byteLength*e,s=i.length*e;if(this.buffer&&n!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${n} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:n}),o=o||!Wz(i,this.bufferValue),o){let a=_1(r.constructor,s);pS({target:a,source:i,start:0,count:s}),this.buffer.write(a),this.bufferValue=r}return this.buffer}};function Gz(t){return Array.isArray(t)?new Float32Array(t):t}function Wz(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var cd=class extends jl{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,r){super(e,r),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(fS(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in e)this.setBuffer(r,e[r])})}setBuffer(e,r){let i=this._getVaryingIndex(e),{buffer:n,byteLength:s,byteOffset:o}=this._getBufferRange(r);if(i<0){this.unusedBuffers[e]=n,oe.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:n,byteLength:s,byteOffset:o},this.bindOnUse||this._bindBuffer(i,n,o,s)}getBuffer(e){if(gS(e))return this.buffers[e]||null;let r=this._getVaryingIndex(e);return r>=0?this.buffers[r]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let r;return this._bound?r=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof zi)return{buffer:e,byteOffset:0,byteLength:e.byteLength};let{buffer:r,byteOffset:i=0,byteLength:n=e.buffer.byteLength}=e;return{buffer:r,byteOffset:i,byteLength:n}}_getVaryingIndex(e){if(gS(e))return Number(e);for(let r of this.layout.varyings)if(e===r.name)return r.location;return-1}_bindBuffers(){for(let e in this.buffers){let{buffer:r,byteLength:i,byteOffset:n}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),r,n,i)}}_unbindBuffers(){for(let e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,r,i=0,n){let s=r&&r.handle;!s||n===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,i,n)}};function gS(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}var ld=class extends Xl{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,r){if(super(e,r),this.device=e,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,n)=>{let s=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>e?(n("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}};var Kr=class extends Ii{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){if(super({...e,id:e.id||jC("webgl-device")}),!e.createCanvasContext)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let r=e.createCanvasContext===!0?{}:e.createCanvasContext,i=r.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new K0(this,r),this.lost=new Promise(g=>{this._resolveContextLost=g});let n={...e.webgl};r.alphaMode==="premultiplied"&&(n.premultipliedAlpha=!0),e.powerPreference!==void 0&&(n.powerPreference=e.powerPreference);let o=this.props._handle||MC(this.canvasContext.canvas,{onContextLost:g=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:g=>console.log("WebGL context restored")},n);if(!o)throw new Error("WebGL context creation failed");if(i=o.device,i)throw new Error(`WebGL context already attached to device ${i.id}`);this.handle=o,this.gl=o,this.spectorJS=VC({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=PC(this.gl,this._extensions),this.limits=new q0(this.gl),this.features=new Q0(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Vi(this.gl,{log:(...g)=>oe.log(1,...g)()}).trackState(this.gl,{copyState:!1});let A=e.debugWebGL||e.debug,h=e.debugWebGL;A&&(this.gl=WC(this.gl,{debugWebGL:A,traceWebGL:h}),oe.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(oe.level=Math.max(oe.level,1)))}destroy(){}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){let r=this._normalizeBufferProps(e);return new zi(this,r)}createTexture(e){return new yn(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new ko(this,e)}createShader(e){return new $0(this,e)}createFramebuffer(e){return new mn(this,e)}createVertexArray(e){return new ad(this,e)}createTransformFeedback(e){return new cd(this,e)}createQuerySet(e){return new ld(this,e)}createRenderPipeline(e){return new nd(this,e)}beginRenderPass(e){return new id(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new od(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,r){return rS(e,r)}readPixelsToBufferWebGL(e,r){return iS(e,r)}setParametersWebGL(e){Ui(this.gl,e)}getParametersWebGL(e){return W0(this.gl,e)}withParametersWebGL(e,r){return Uo(this.gl,e,r)}resetWebGL(){oe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),wC(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return LC(this.gl,e,this._extensions)}loseDevice(){let e=!1,i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Vi.get(this.gl).push()}popState(){Vi.get(this.gl).pop()}setSpectorMetadata(e,r){e.__SPECTOR_Metadata=r}getGLKey(e,r){let i=Number(e);for(let n in this.gl)if(this.gl[n]===i)return`GL.${n}`;return r?.emptyIfUnknown?"":String(e)}getGLKeys(e){let r={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[n,s])=>(i[`${n}:${this.getGLKey(n,r)}`]=`${s}:${this.getGLKey(s,r)}`,i),{})}_constants;setConstantAttributeWebGL(e,r){let i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);let n=this._constants[e];switch(n&&Qz(n,r)&&oe.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=r,r.constructor){case Float32Array:jz(this,e,r);break;case Int32Array:Xz(this,e,r);break;case Uint32Array:Yz(this,e,r);break;default:throw new Error("constant")}}getExtension(e){return gn(this.gl,e,this._extensions),this._extensions}};function jz(t,e,r){switch(r.length){case 1:t.gl.vertexAttrib1fv(e,r);break;case 2:t.gl.vertexAttrib2fv(e,r);break;case 3:t.gl.vertexAttrib3fv(e,r);break;case 4:t.gl.vertexAttrib4fv(e,r);break;default:}}function Xz(t,e,r){t.gl.vertexAttribI4iv(e,r)}function Yz(t,e,r){t.gl.vertexAttribI4uiv(e,r)}function Qz(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var qz={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Kz=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Jz=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),Zz=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function mS(t=!0){let e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(r,i){if(r==="webgl"||r==="experimental-webgl"){let n=this.originalGetContext("webgl2",i);return n instanceof HTMLElement&&$z(n),n}return this.originalGetContext(r,i)}}function $z(t){t.getExtension("EXT_color_buffer_float");let e={...qz,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Kz(t),OES_vertex_array_object:Jz(t),ANGLE_instanced_arrays:Zz(t)},r=t.getExtension;t.getExtension=function(n){let s=r.call(t,n);return s||(n in e?e[n]:null)};let i=t.getSupportedExtensions;t.getSupportedExtensions=function(){return(i.apply(t)||[])?.concat(Object.keys(e))}}var Ad=1,k_=class extends Ul{type="webgl";constructor(){super(),Ii.defaultProps={...Ii.defaultProps,...Z0},Kr.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){mS(e)}async attach(e){if(e instanceof Kr)return e;if(e?.device instanceof Ii)return e.device;if(!eH(e))throw new Error("Invalid WebGL2RenderingContext");return new Kr({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){oe.groupCollapsed(Ad,"WebGLDevice created")();let r=[];(e.debugWebGL||e.debug)&&r.push(GC()),e.debugSpectorJS&&r.push(UC(e));let i=await Promise.allSettled(r);for(let o of i)o.status==="rejected"&&oe.error(`Failed to initialize debug libraries ${o.reason}`)();let n=new Kr(e),s=`Created ${n.type}${n.debug?" debug":""} context: ${n.info.vendor}, ${n.info.renderer} for canvas: ${n.canvasContext.id}`;return oe.probe(Ad,s)(),oe.table(Ad,n.info)(),oe.groupEnd(Ad)(),n}};function eH(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}var ud=new k_;function Is(){}var tH=({isDragging:t})=>t?"grabbing":"grab",_S={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Is,onWebGLInitialized:Is,onResize:Is,onViewStateChange:Is,onInteractionStateChange:Is,onBeforeRender:Is,onAfterRender:Is,onLoad:Is,onError:t=>me.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:tH,getTooltip:null,debug:!1,drawPickingColors:!1},WA=class{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Sr({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{let{_pickRequest:n}=this;if(i.type==="pointerleave")n.x=-1,n.y=-1,n.radius=0;else{if(i.leftButton||i.rightButton)return;{let s=i.offsetCenter;if(!s)return;n.x=s.x,n.y=s.y,n.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:n.x,y:n.y}),n.event=i},this._onEvent=i=>{let n=gA[i.type],s=i.offsetCenter;if(!n||!s||!this.layerManager)return;let o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:A}=a,h=A&&(A[n]||A.props[n]),g=this.props[n],_=!1;h&&(_=h.call(A,a,i)),_||(g?.(a,i),this.widgetManager.onEvent(a,i))},this._onPointerDown=i=>{let n=i.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:n.x,y:n.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={..._S,...e},e=this.props,e.viewState&&e.initialViewState&&me.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let r=this.device;!r&&e.gl&&(e.gl instanceof WebGLRenderingContext&&me.error("WebGL1 context not supported.")(),r=ud.attach(e.gl)),r||(r=Ca.createDevice({type:"best-available",adapters:[ud],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,e),this.setProps(e),e._typedArrayManagerProps&&Ni.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&me.removed("onLayerHover","onHover")(),"onLayerClick"in e&&me.removed("onLayerClick","onClick")(),e.initialViewState&&!Et(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let i=this.viewManager.needsRedraw(e),n=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return r=r||i||n||s||o,r}redraw(e){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=e||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return wt(this.viewManager),this.viewManager.views}getViewports(e){return wt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let r=this._pick("pickObject","pickObject Time",e).result;return r.length?r[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,r=!1){for(let i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:r})}_removeResources(e){for(let r of e)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,r,i){wt(this.deckPicker);let{stats:n}=this;n.get("Pick Count").incrementCount(),n.get(r).timeStart();let s=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return n.get(r).timeEnd(),s}_createCanvas(e){let r=e.canvas;return typeof r=="string"&&(r=document.getElementById(r),wt(r)),r||(r=document.createElement("canvas"),r.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(r)),Object.assign(r.style,e.style),r}_setCanvasSize(e){if(!this.canvas)return;let{width:r,height:i}=e;if(r||r===0){let n=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=n}if(i||i===0){let n=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=n}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let r=e.clientWidth??e.width,i=e.clientHeight??e.height;(r!==this.width||i!==this.height)&&(this.width=r,this.height=i,this.viewManager?.setProps({width:r,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:i}))}_createAnimationLoop(e,r){let{gl:i,onError:n,useDevicePixels:s}=r;return new EA({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:n})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,r=Array.isArray(e)?e:e?[e]:[new FA({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){let{_pickRequest:e}=this;if(e.event){let{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let n=i,s=!1;for(let o of r)n=o,s=o.layer?.onHover(o,e.event)||s;s||(this.props.onHover?.(n,e.event),this.widgetManager.onHover(n,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device instanceof Kr&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Kr&&this.props.onWebGLInitialized(this.device.gl);let r=new Ro;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new pA(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(a_).map(n=>{let[s,o,a,A]=a_[n],h=this.props.eventRecognizerOptions?.[n],g={...o,...h,event:n};return{recognizer:new s(g),recognizeWith:a,requestFailure:A}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let n in gA)this.eventManager.on(n,this._onEvent);this.viewManager=new MA({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let i=this.viewManager.getViewports()[0];this.layerManager=new SA(this.device,{deck:this,stats:this.stats,viewport:i,timeline:r}),this.effectManager=new LA({deck:this,device:this.device}),this.deckRenderer=new DA(this.device),this.deckPicker=new kA(this.device),this.widgetManager=new G0({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new UA),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,r){let{device:i,gl:n}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:n});let s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:i,gl:n})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),me.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let r=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let r=this.animationLoop.stats;e.get("GPU Time").addTime(r.get("GPU Time").lastTiming),e.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:r}=this;e.fps=r.get("frameRate").getHz(),e.setPropsTime=r.get("setProps Time").time,e.updateAttributesTime=r.get("Update Attributes").time,e.framesRedrawn=r.get("Redraw Count").count,e.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,e.pickCount=r.get("Pick Count").count,e.gpuTime=r.get("GPU Time").time,e.cpuTime=r.get("CPU Time").time,e.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let i=Ca.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}};WA.defaultProps=_S;WA.VERSION=fE;var ec=WA;function yS(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Ql(t)}}var xS=Oh;function jA(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function Bs(t){return t.stride||t.size*t.bytesPerElement}function bS(t,e){return t.type===e.type&&t.size===e.size&&Bs(t)===Bs(e)&&(t.offset||0)===(e.offset||0)}function U_(t,e){e.offset&&me.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=Bs(t),i=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,n=e.elementOffset||0,s=i*r+n*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:r}}function rH(t,e){let r=U_(t,e);return{high:r,low:{...r,offset:r.offset+t.size*4}}}var XA=class{constructor(e,r,i){this._buffer=null,this.device=e,this.id=r.id||"",this.size=r.size||1;let n=r.logicalType||r.type,s=n==="float64",{defaultValue:o}=r;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!n&&r.isIndexed?a="uint32":a=n||"float32";let A=yS(n||a);this.doublePrecision=s,s&&r.fp64===!1&&(A=Float32Array),this.value=null,this.settings={...r,defaultType:A,defaultValue:o,logicalType:n,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:A.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Bs(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ni.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,r=null){let i={};if(this.state.constant){let n=this.value;if(r){let s=U_(this.getAccessor(),r),o=s.offset/n.BYTES_PER_ELEMENT,a=s.size||this.size;i[e]=n.subarray(o,o+a)}else i[e]=n}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,r=null){let i=this.getAccessor(),n=[],s={name:this.id,byteStride:Bs(i),attributes:n};if(this.doublePrecision){let o=rH(i,r||{});n.push(jA(e,{...i,...o.high}),jA(`${e}64Low`,{...i,...o.low}))}else if(r){let o=U_(i,r);n.push(jA(e,{...i,...o}))}else n.push(jA(e,i));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let r=Array.from(this.value);e=[r,r]}else{let{value:r,numInstances:i,size:n}=this,s=i*n;if(r&&s&&r.length>=s){let o=new Array(n).fill(1/0),a=new Array(n).fill(-1/0);for(let A=0;A<s;)for(let h=0;h<n;h++){let g=r[A++];g<o[h]&&(o[h]=g),g>a[h]&&(a[h]=g)}e=[o,a]}}return this.state.bounds=e,e}setData(e){let{state:r}=this,i;ArrayBuffer.isView(e)?i={value:e}:e instanceof ct?i={buffer:e}:i=e;let n={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)n.type="float32";else{let o=xS(i.value);n.type=n.normalized?o.replace("int","norm"):o}n.bytesPerElement=i.value.BYTES_PER_ELEMENT,n.stride=Bs(n)}if(r.bounds=null,i.constant){let s=i.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!r.constant||!this._areValuesEqual(s,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(i.buffer){let s=i.buffer;r.externalBuffer=s,r.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let s=i.value;r.externalBuffer=null,r.constant=!1,this.value=s;let{buffer:o}=this,a=Bs(n),A=(n.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=I0(s,n)),this.settings.isIndexed){let g=this.settings.defaultType;s.constructor!==g&&(s=new g(s))}let h=s.byteLength+A+a*2;(!o||o.byteLength<h)&&(o=this._createBuffer(h)),o.write(s,A)}return this.setAccessor(n),!0}updateSubBuffer(e={}){this.state.bounds=null;let r=this.value,{startOffset:i=0,endOffset:n}=e;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?I0(r,{size:this.size,startIndex:i,endIndex:n}):r.subarray(i,n),i*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,r=!1){let{state:i}=this,n=i.allocatedValue,s=Ni.allocate(n,e+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=s;let{byteOffset:o}=this,{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),r&&n&&a.write(n instanceof Float64Array?I0(n,this):n,o)),i.allocatedValue=s,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:r}=e;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let i=this.settings.defaultType,n=!1;if(this.doublePrecision&&(n=r.BYTES_PER_ELEMENT<4),n)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof i)&&this.settings.normalized&&!("normalized"in e)&&me.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(e).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(r=>r/255);case"unorm16":return new Float32Array(e).map(r=>r/65535);default:return e}}_normalizeValue(e,r,i){let{defaultValue:n,size:s}=this.settings;if(Number.isFinite(e))return r[i]=e,r;if(!e){let o=s;for(;--o>=0;)r[i+o]=n[o];return r}switch(s){case 4:r[i+3]=Number.isFinite(e[3])?e[3]:n[3];case 3:r[i+2]=Number.isFinite(e[2])?e[2]:n[2];case 2:r[i+1]=Number.isFinite(e[1])?e[1]:n[1];case 1:r[i+0]=Number.isFinite(e[0])?e[0]:n[0];break;default:let o=s;for(;--o>=0;)r[i+o]=Number.isFinite(e[o])?e[o]:n[o]}return r}_areValuesEqual(e,r){if(!e||!r)return!1;let{size:i}=this;for(let n=0;n<i;n++)if(e[n]!==r[n])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:r?ct.INDEX:ct.VERTEX,indexType:r?i:void 0,byteLength:e}),this._buffer}};var TS=[],ES=[];function Yt(t,e=0,r=1/0){let i=TS,n={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?i=t:t.length>0&&(ES.length=t.length,i=ES):i=TS,(e>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,r),n.index=e-1),{iterable:i,objectInfo:n}}function fd(t){return t&&t[Symbol.asyncIterator]}function hd(t,e){let{size:r,stride:i,offset:n,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,A=i?i/a:r,h=n?n/a:0,g=Math.floor((t.length-h)/A);return(_,{index:b,target:T})=>{if(!s){let P=b*A+h;for(let F=0;F<r;F++)T[F]=t[P+F];return T}let v=s[b],C=s[b+1]||g,S;if(o){S=new Array(C-v);for(let P=v;P<C;P++){let F=P*A+h;T=new Array(r);for(let I=0;I<r;I++)T[I]=t[F+I];S[P-v]=T}}else if(A===r)S=t.subarray(v*r+h,C*r+h);else{S=new t.constructor((C-v)*r);let P=0;for(let F=v;F<C;F++){let I=F*A+h;for(let k=0;k<r;k++)S[P++]=t[I+k]}}return S}}var vS=[],YA=[[0,1/0]];function wS(t,e){if(t===YA||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;let r=[],i=t.length,n=0;for(let s=0;s<i;s++){let o=t[s];o[1]<e[0]?(r.push(o),n=s+1):o[0]>e[1]?r.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return r.splice(n,0,e),r}var nH={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function dd(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});let r=t.type||"interpolation";return{...nH[r],...e,...t,type:r}}var Vo=class extends XA{constructor(e,r){super(e,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:YA}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!e,r}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var r;(r=this.state).layoutChanged||(r.layoutChanged=!bS(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:r}=this.settings,i=this.settings.transition,n=Array.isArray(r)?e[r.find(s=>e[s])]:e[r];return dd(n,i)}setNeedsUpdate(e=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),r){let{startRow:i=0,endRow:n=1/0}=r;this.state.updateRanges=wS(this.state.updateRanges,[i,n])}else this.state.updateRanges=YA}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=vS}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:r,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,r.updateRanges!==YA),!0):!1}updateBuffer({numInstances:e,data:r,props:i,context:n}){if(!this.needsUpdate())return!1;let{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this,A=!0;if(o){for(let[h,g]of s)o.call(n,this,{data:r,startRow:h,endRow:g,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[h,g]of s){let _=Number.isFinite(h)?this.getVertexOffset(h):0,b=Number.isFinite(g)?this.getVertexOffset(g):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:b})}this._checkAttributeArray()}else A=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),A}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){let{state:r}=this;return e?(this.clearNeedsUpdate(),r.lastExternalBuffer===e||(r.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(e,r=null){let{state:i,settings:n}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(n.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),n.transform||r!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let o=e;wt(ArrayBuffer.isView(o.value),`invalid ${n.accessor}`);let a=!!o.size&&o.size!==this.size;return i.binaryAccessor=hd(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:r}=this;return(r?e<r.length?r[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,r=super.getValue();if(!e)return r;for(let i in e)Object.assign(r,super.getValue(i,e[i]));return r}getBufferLayout(e){this.state.layoutChanged=!1;let r=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:n}=this.settings;if(n==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=n??"vertex",!r)return i;for(let s in r){let o=super._getBufferLayout(s,r[s]);i.attributes.push(...o.attributes)}return i}_autoUpdater(e,{data:r,startRow:i,endRow:n,props:s,numInstances:o}){if(e.constant)return;let{settings:a,state:A,value:h,size:g,startIndices:_}=e,{accessor:b,transform:T}=a,v=A.binaryAccessor||(typeof b=="function"?b:s[b]);wt(typeof v=="function",`accessor "${b}" is not a function`);let C=e.getVertexOffset(i),{iterable:S,objectInfo:P}=Yt(r,i,n);for(let F of S){P.index++;let I=v(F,P);if(T&&(I=T.call(this,I)),_){let k=(P.index<_.length-1?_[P.index+1]:o)-_[P.index];if(I&&Array.isArray(I[0])){let W=C;for(let K of I)e._normalizeValue(K,h,W),W+=g}else I&&I.length>g?h.set(I,C):(e._normalizeValue(I,P.target,0),T_({target:h,source:P.target,start:C,count:k}));C+=k*g}else e._normalizeValue(I,h,C),C+=g}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,r=Math.min(4,this.size);if(e&&e.length>=r){let i=!0;switch(r){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function V_(t){let{source:e,target:r,start:i=0,size:n,getData:s}=t,o=t.end||r.length,a=e.length,A=o-i;if(a>A){r.set(e.subarray(0,A),i);return}if(r.set(e,i),!s)return;let h=a;for(;h<A;){let g=s(h,e);for(let _=0;_<n;_++)r[i+h]=g[_]||0,h++}}function CS({source:t,target:e,size:r,getData:i,sourceStartIndices:n,targetStartIndices:s}){if(!n||!s)return V_({source:t,target:e,size:r,getData:i}),e;let o=0,a=0,A=i&&((g,_)=>i(g+a,_)),h=Math.min(n.length,s.length);for(let g=1;g<h;g++){let _=n[g]*r,b=s[g]*r;V_({source:t.subarray(o,_),target:e,start:a,end:b,size:r,getData:A}),o=_,a=b}return a<e.length&&V_({source:[],target:e,start:a,size:r,getData:A}),e}function SS(t){let{device:e,settings:r,value:i}=t,n=new Vo(e,r);return n.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),n}function pd(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function gd(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function md(t){t.push(t.shift())}function MS(t,e){let{doublePrecision:r,settings:i,value:n,size:s}=t,o=r&&n instanceof Float64Array?2:1,a=0,{shaderAttributes:A}=t.settings;if(A)for(let h of Object.values(A))a=Math.max(a,h.vertexOffset??0);return(i.noAlloc?n.length:(e+a)*s)*o}function _d({device:t,source:e,target:r}){return(!r||r.byteLength<e.byteLength)&&(r?.destroy(),r=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),r}function yd({device:t,buffer:e,attribute:r,fromLength:i,toLength:n,fromStartIndices:s,getData:o=a=>a}){let a=r.doublePrecision&&r.value instanceof Float64Array?2:1,A=r.size*a,h=r.byteOffset,g=r.settings.bytesPerElement<4?h/r.settings.bytesPerElement*4:h,_=r.startIndices,b=s&&_,T=r.isConstant;if(!b&&e&&i>=n)return e;let v=r.value instanceof Float64Array?Float32Array:r.value.constructor,C=T?r.value:new v(r.getBuffer().readSyncWebGL(h,n*v.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!T){let I=o;o=(k,W)=>r.normalizeConstant(I(k,W))}let S=T?(I,k)=>o(C,k):(I,k)=>o(C.subarray(I+h,I+h+A),k),P=e?new Float32Array(e.readSyncWebGL(g,i*4).buffer):new Float32Array(0),F=new Float32Array(n);return CS({source:P,target:F,sourceStartIndices:s,targetStartIndices:_,size:A,getData:S}),(!e||e.byteLength<F.byteLength+g)&&(e?.destroy(),e=t.createBuffer({byteLength:F.byteLength+g,usage:35050})),e.write(F,g),e}var tc=class{constructor({device:e,attribute:r,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new ki(i),this.attribute=r,this.attributeInTransition=SS(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(e,r,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=MS(this.attribute,r),this.transition.start({...e,duration:i})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let e of this.buffers)e.destroy();this.buffers.length=0}};var QA=class extends tc{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="interpolation",this.transform=cH(e,r)}start(e,r){let i=this.currentLength,n=this.currentStartIndices;if(super.start(e,r,e.duration),e.duration<=0){this.transition.cancel();return}let{buffers:s,attribute:o}=this;md(s),s[0]=yd({device:this.device,buffer:s[0],attribute:o,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter}),s[1]=_d({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);let{transform:a}=this,A=a.model,h=Math.floor(this.currentLength/o.size);RS(o)&&(h/=2),A.setVertexCount(h),o.isConstant?(A.setAttributes({aFrom:s[0]}),A.setConstantAttributes({aTo:o.value})):A.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){let{duration:e,easing:r}=this.settings,{time:i}=this.transition,n=i/e;r&&(n=r(n));let{model:s}=this.transform,o={time:n};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},sH=`uniform interpolationUniforms {
  float time;
} interpolation;
`,PS={name:"interpolation",vs:sH,uniformTypes:{time:"f32"}},oH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,aH=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function RS(t){return t.doublePrecision&&t.value instanceof Float64Array}function cH(t,e){let r=e.size,i=pd(r),n=gd(r),s=e.getBufferLayout();return RS(e)?new fn(t,{vs:aH,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*r}]}],modules:[q2,PS],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new fn(t,{vs:oH,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:s.attributes[0].format}],modules:[PS],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}var qA=class extends tc{constructor({device:e,attribute:r,timeline:i}){super({device:e,attribute:r,timeline:i}),this.type="spring",this.texture=dH(e),this.framebuffer=pH(e,this.texture),this.transform=hH(e,r)}start(e,r){let i=this.currentLength,n=this.currentStartIndices;super.start(e,r);let{buffers:s,attribute:o}=this;for(let A=0;A<2;A++)s[A]=yd({device:this.device,buffer:s[A],attribute:o,fromLength:i,toLength:this.currentLength,fromStartIndices:n,getData:e.enter});s[2]=_d({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){let{buffers:e,transform:r,framebuffer:i,transition:n}=this,s=this.settings;r.model.setAttributes({aPrev:e[0],aCur:e[1]}),r.transformFeedback.setBuffers({vNext:e[2]});let o={stiffness:s.stiffness,damping:s.damping};r.model.shaderInputs.setProps({spring:o}),r.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),md(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||n.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},lH=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,AH={name:"spring",vs:lH,uniformTypes:{damping:"f32",stiffness:"f32"}},uH=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fH=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function hH(t,e){let r=pd(e.size),i=gd(e.size);return new fn(t,{vs:uH,fs:fH,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[AH],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function dH(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function pH(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}var gH={interpolation:QA,spring:qA},KA=class{constructor(e,{id:r,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:r,numInstances:i}){this.numInstances=i||1;for(let n in e){let s=e[n],o=s.getTransitionSetting(r);o&&this._updateAttribute(n,s,o)}for(let n in this.transitions){let s=e[n];(!s||!s.getTransitionSetting(r))&&this._removeTransition(n)}}hasAttribute(e){let r=this.transitions[e];return r&&r.inProgress}getAttributes(){let e={};for(let r in this.transitions){let i=this.transitions[r];i.inProgress&&(e[r]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,r,i){let n=this.transitions[e],s=!n||n.type!==i.type;if(s){n&&this._removeTransition(e);let o=gH[i.type];o?this.transitions[e]=new o({attribute:r,timeline:this.timeline,device:this.device}):(me.error(`unsupported transition type '${i.type}'`)(),s=!1)}(s||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}};var IS="attributeManager.invalidate",mH="attributeManager.updateStart",_H="attributeManager.updateEnd",yH="attribute.updateStart",xH="attribute.allocate",bH="attribute.updateEnd",vi=class{constructor(e,{id:r="attribute-manager",stats:i,timeline:n}={}){this.mergeBoundsMemoized=An(eC),this.id=r,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new KA(e,{id:`${r}-transitions`,timeline:n}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let r of e)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(e,r){let i=this._invalidateTrigger(e,r);Wt(IS,this,e,i)}invalidateAll(e){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,e);Wt(IS,this,"all")}update({data:e,numInstances:r,startIndices:i=null,transitions:n,props:s={},buffers:o={},context:a={}}){let A=!1;Wt(mH,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let h in this.attributes){let g=this.attributes[h],_=g.settings.accessor;g.startIndices=i,g.numInstances=r,s[h]&&me.removed(`props.${h}`,`data.attributes.${h}`)(),g.setExternalBuffer(o[h])||g.setBinaryValue(typeof _=="string"?o[_]:void 0,e.startIndices)||typeof _=="string"&&!o[_]&&g.setConstantValue(s[_])||g.needsUpdate()&&(A=!0,this._updateAttribute({attribute:g,numInstances:r,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}A&&Wt(_H,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:n})}updateTransition(){let{attributeTransitionManager:e}=this,r=e.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let r=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:i}=this,n={...i.getAttributes()};for(let s in r){let o=r[s];o.needsRedraw(e)&&!i.hasAttribute(s)&&(n[s]=o)}return n}getBufferLayouts(e){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(e))}_add(e,r){for(let i in e){let n=e[i],s={...n,id:i,size:n.isIndexed&&1||n.size||1,...r};this.attributes[i]=new Vo(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(n=>{e[n]||(e[n]=[]),e[n].push(r)});this.updateTriggers=e}_invalidateTrigger(e,r){let{attributes:i,updateTriggers:n}=this,s=n[e];return s&&s.forEach(o=>{let a=i[o];a&&a.setNeedsUpdate(a.id,r)}),s}_updateAttribute(e){let{attribute:r,numInstances:i}=e;if(Wt(yH,r),r.constant){r.setConstantValue(r.value);return}r.allocate(i)&&Wt(xH,r,i),r.updateBuffer(e)&&(this.needsRedraw=!0,Wt(bH,r,i))}};var JA=class extends ki{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:r,toValue:i,duration:n,easing:s}}=this,o=s(e/n);this._value=br(r,i,o)}};var BS=1e-5;function OS(t,e,r,i,n){let s=e-t,a=(r-e)*n,A=-s*i;return a+A+s+e}function TH(t,e,r,i,n){if(Array.isArray(r)){let s=[];for(let o=0;o<r.length;o++)s[o]=OS(t[o],e[o],r[o],i,n);return s}return OS(t,e,r,i,n)}function FS(t,e){if(Array.isArray(t)){let r=0;for(let i=0;i<t.length;i++){let n=t[i]-e[i];r+=n*n}return Math.sqrt(r)}return Math.abs(t-e)}var ZA=class extends ki{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:r,damping:i,stiffness:n}=this.settings,{_prevValue:s=e,_currValue:o=e}=this,a=TH(s,o,r,i,n),A=FS(a,r),h=FS(a,o);A<BS&&h<BS&&(a=r,this.end()),this._prevValue=o,this._currValue=a}};var EH={interpolation:JA,spring:ZA},$A=class{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,r,i,n){let{transitions:s}=this;if(s.has(e)){let A=s.get(e),{value:h=A.settings.fromValue}=A;r=h,this.remove(e)}if(n=dd(n),!n)return;let o=EH[n.type];if(!o){me.error(`unsupported transition type '${n.type}'`)();return}let a=new o(this.timeline);a.start({...n,fromValue:r,toValue:i}),s.set(e,a)}remove(e){let{transitions:r}=this;r.has(e)&&(r.get(e).cancel(),r.delete(e))}update(){let e={};for(let[r,i]of this.transitions)i.update(),e[r]=i.value,i.inProgress||this.remove(r);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}};function NS(t){let e=t[Ei];for(let r in e){let i=e[r],{validate:n}=i;if(n&&!n(t[r],i))throw new Error(`Invalid prop ${r}: ${t[r]}`)}}function DS(t,e){let r=eu({newProps:t,oldProps:e,propTypes:t[Ei],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=wH(t,e),n=!1;return i||(n=CH(t,e)),{dataChanged:i,propsChanged:r,updateTriggersChanged:n,extensionsChanged:SH(t,e),transitionsChanged:vH(t,e)}}function vH(t,e){if(!t.transitions)return!1;let r={},i=t[Ei],n=!1;for(let s in t.transitions){let o=i[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&z_(t[s],e[s],o)&&(r[s]=!0,n=!0)}return n?r:!1}function eu({newProps:t,oldProps:e,ignoreProps:r={},propTypes:i={},triggerName:n="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${n} changed shallowly`;if(typeof e!="object"||e===null)return`${n} changed shallowly`;for(let s of Object.keys(t))if(!(s in r)){if(!(s in e))return`${n}.${s} added`;let o=z_(t[s],e[s],i[s]);if(o)return`${n}.${s} ${o}`}for(let s of Object.keys(e))if(!(s in r)){if(!(s in t))return`${n}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){let o=z_(t[s],e[s],i[s]);if(o)return`${n}.${s} ${o}`}}return!1}function z_(t,e,r){let i=r&&r.equal;return i&&!i(t,e,r)||!i&&(i=t&&e&&t.equals,i&&!i.call(t,e))?"changed deeply":!i&&e!==t?"changed shallowly":null}function wH(t,e){if(e===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:i,_dataDiff:n}=t;return i?i(t.data,e.data)||(r="Data comparator detected a change"):t.data!==e.data&&(r="A new data container was supplied"),r&&n&&(r=n(t.data,e.data)||r),r}function CH(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&LS(t,e,"all"))return{all:!0};let r={},i=!1;for(let n in t.updateTriggers)n!=="all"&&LS(t,e,n)&&(r[n]=!0,i=!0);return i?r:!1}function SH(t,e){if(e===null)return!0;let r=e.extensions,{extensions:i}=t;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let n=0;n<i.length;n++)if(!i[n].equals(r[n]))return!0;return!1}function LS(t,e,r){let i=t.updateTriggers[r];i=i??{};let n=e.updateTriggers[r];return n=n??{},eu({oldProps:n,newProps:i,triggerName:r})}var MH="count(): argument not an object",PH="count(): argument not a container";function kS(t){if(!IH(t))throw new Error(MH);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(RH(t))return Object.keys(t).length;throw new Error(PH)}function RH(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function IH(t){return t!==null&&typeof t=="object"}function H_(t,e){if(!e)return t;let r={...t,...e};if("defines"in e&&(r.defines={...t.defines,...e.defines}),"modules"in e&&(r.modules=(t.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){let i=r.modules.findIndex(n=>n.name==="project32");i>=0&&r.modules.splice(i,1)}if("inject"in e)if(!t.inject)r.inject=e.inject;else{let i={...t.inject};for(let n in e.inject)i[n]=(i[n]||"")+e.inject[n];r.inject=i}return r}var BH={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},G_={};function US(t,e,r,i){if(r instanceof _t)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let n=null;r.compressed&&(n={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let s=e.createTexture({...r,sampler:{...BH,...n,...i},mipmaps:!0});return G_[s.id]=t,s}function VS(t,e){!e||!(e instanceof _t)||G_[e.id]===t&&(e.delete(),delete G_[e.id])}var OH={boolean:{validate(t,e){return!0},equal(t,e,r){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||W_(t)&&(t.length===3||t.length===4)},equal(t,e,r){return Et(t,e,1)}},accessor:{validate(t,e){let r=xd(t);return r==="function"||r===xd(e.value)},equal(t,e,r){return typeof e=="function"?!0:Et(t,e,1)}},array:{validate(t,e){return e.optional&&!t||W_(t)},equal(t,e,r){let{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?Et(t,e,n):t===e}},object:{equal(t,e,r){if(r.ignore)return!0;let{compare:i}=r,n=Number.isInteger(i)?i:i?1:0;return i?Et(t,e,n):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,r){return!r.compare&&r.ignore!==!1||t===e}},data:{transform:(t,e,r)=>{if(!t)return t;let{dataTransform:i}=r.props;return i?i(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,r)=>{let i=r.context;return!i||!i.device?null:US(r.id,i.device,t,{...e.parameters,...r.props.textureParameters})},release:(t,e,r)=>{VS(r.id,t)}}};function zS(t){let e={},r={},i={};for(let[n,s]of Object.entries(t)){let o=s?.deprecatedFor;if(o)i[n]=Array.isArray(o)?o:[o];else{let a=FH(n,s);e[n]=a,r[n]=a.value}}return{propTypes:e,defaultProps:r,deprecatedProps:i}}function FH(t,e){switch(xd(e)){case"object":return tu(t,e);case"array":return tu(t,{type:"array",value:e,compare:!1});case"boolean":return tu(t,{type:"boolean",value:e});case"number":return tu(t,{type:"number",value:e});case"function":return tu(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function tu(t,e){return"type"in e?{name:t,...OH[e.type],...e}:"value"in e?{name:t,type:xd(e.value),...e}:{name:t,type:"object",value:e}}function W_(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function xd(t){return W_(t)?"array":t===null?"null":typeof t}function HS(t,e){let r;for(let s=e.length-1;s>=0;s--){let o=e[s];"extensions"in o&&(r=o.extensions)}let i=j_(t.constructor,r),n=Object.create(i);n[Ka]=t,n[dn]={},n[Di]={};for(let s=0;s<e.length;++s){let o=e[s];for(let a in o)n[a]=o[a]}return Object.freeze(n),n}var LH="_mergedDefaultProps";function j_(t,e){if(!(t instanceof bd.constructor))return{};let r=LH;if(e)for(let n of e){let s=n.constructor;s&&(r+=`:${s.extensionName||s.name}`)}let i=GS(t,r);return i||(t[r]=NH(t,e||[]))}function NH(t,e){if(!t.prototype)return null;let i=Object.getPrototypeOf(t),n=j_(i),s=GS(t,"defaultProps")||{},o=zS(s),a=Object.assign(Object.create(null),n,o.defaultProps),A=Object.assign(Object.create(null),n?.[Ei],o.propTypes),h=Object.assign(Object.create(null),n?.[V0],o.deprecatedProps);for(let g of e){let _=j_(g.constructor);_&&(Object.assign(a,_),Object.assign(A,_[Ei]),Object.assign(h,_[V0]))}return DH(a,t),UH(a,A),kH(a,h),a[Ei]=A,a[V0]=h,e.length===0&&!X_(t,"_propTypes")&&(t._propTypes=A),a}function DH(t,e){let r=zH(e);Object.defineProperties(t,{id:{writable:!0,value:r}})}function kH(t,e){for(let r in e)Object.defineProperty(t,r,{enumerable:!1,set(i){let n=`${this.id}: ${r}`;for(let s of e[r])X_(this,s)||(this[s]=i);me.deprecated(n,e[r].join("/"))()}})}function UH(t,e){let r={},i={};for(let n in e){let s=e[n],{name:o,value:a}=s;s.async&&(r[o]=a,i[o]=VH(o))}t[Xn]=r,t[dn]={},Object.defineProperties(t,i)}function VH(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||fd(e)?this[dn][t]=e:this[Di][t]=e},get(){if(this[Di]){if(t in this[Di])return this[Di][t]||this[Xn][t];if(t in this[dn]){let e=this[Ka]&&this[Ka].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Xn][t]}}return this[Xn][t]}}}function X_(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function GS(t,e){return X_(t,e)&&t[e]}function zH(t){let e=t.componentName;return e||me.warn(`${t.name}.componentName not specified`)(),e||t.name}var HH=0,ru=class{constructor(...e){this.props=HS(this,e),this.id=this.props.id,this.count=HH++}clone(e){let{props:r}=this,i={};for(let n in r[Xn])n in r[Di]?i[n]=r[Di][n]:n in r[dn]&&(i[n]=r[dn][n]);return new this.constructor({...r,...i,...e})}};ru.componentName="Component";ru.defaultProps={};var bd=ru;var GH=Object.freeze({}),iu=class{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let r=this.asyncProps[e];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||GH}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let r=this.asyncProps[e];return r&&r.resolvedValue}isAsyncPropLoading(e){if(e){let r=this.asyncProps[e];return!!(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(e,r){this._watchPromise(e,Promise.resolve(r))}setAsyncProps(e){this.component=e[Ka]||this.component;let r=e[Di]||{},i=e[dn]||e,n=e[Xn]||{};for(let s in r){let o=r[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,o),r[s]=this.getAsyncProp(s)}for(let s in i){let o=i[s];this._createAsyncPropData(s,n[s]),this._updateAsyncProp(s,o)}}_fetch(e,r){return null}_onResolve(e,r){}_onError(e,r){}_updateAsyncProp(e,r){if(this._didAsyncInputValueChange(e,r)){if(typeof r=="string"&&(r=this._fetch(e,r)),r instanceof Promise){this._watchPromise(e,r);return}if(fd(r)){this._resolveAsyncIterable(e,r);return}this._setPropValue(e,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,r){let i=this.asyncProps[e];return r===i.resolvedValue||r===i.lastValue?!1:(i.lastValue=r,!0)}_setPropValue(e,r){this._freezeAsyncOldProps();let i=this.asyncProps[e];i&&(r=this._postProcessValue(i,r),i.resolvedValue=r,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,r,i){let n=this.asyncProps[e];n&&i>=n.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),n.resolvedValue=r,n.resolvedLoadCount=i,this.onAsyncPropUpdated(e,r))}_watchPromise(e,r){let i=this.asyncProps[e];if(i){i.pendingLoadCount++;let n=i.pendingLoadCount;r.then(s=>{this.component&&(s=this._postProcessValue(i,s),this._setAsyncPropValue(e,s,n),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,r){if(e!=="data"){this._setPropValue(e,r);return}let i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;let n=i.pendingLoadCount,s=[],o=0;for await(let a of r){if(!this.component)return;let{dataTransform:A}=this.component.props;A?s=A(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,n)}this._onResolve(e,s)}_postProcessValue(e,r){let i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(r,i,this.component):r}_createAsyncPropData(e,r){if(!this.asyncProps[e]){let n=this.component&&this.component.props[Ei];this.asyncProps[e]={type:n&&n[e],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var nu=class extends iu{constructor({attributeManager:e,layer:r}){super(r),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,r){let i=this.layer,n=i?.props.fetch;return n?n(r,{propName:e,layer:i}):super._fetch(e,r)}_onResolve(e,r){let i=this.layer;if(i){let n=i.props.onDataLoad;e==="data"&&n&&n(r,{propName:e,layer:i})}}_onError(e,r){let i=this.layer;i&&i.raiseError(r,`loading ${e} of ${this.layer}`)}};var WH="layer.changeFlag",jH="layer.initialize",XH="layer.update",YH="layer.finalize",QH="layer.matched",WS=2**24-1,qH=Object.freeze([]),KH=An(({oldViewport:t,viewport:e})=>t.equals(e)),Hi=new Uint8ClampedArray(0),JH={data:{type:"data",value:qH,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:r,loaders:i,loadOptions:n,signal:s})=>{let{resourceManager:o}=r.context;n=n||r.getLoadOptions(),i=i||r.props.loaders,s&&(n={...n,fetch:{...n?.fetch,signal:s}});let a=o.contains(t);return!a&&!n&&(o.add({resourceId:t,data:dr(t,i),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:A=>r.internalState?.reloadAsyncProp(e,A),consumerId:r.id,requestId:e}):dr(t,i,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Se.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},su=class extends bd{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Ms.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){wt(this.internalState);let r=this.internalState.viewport||this.context.viewport,i=__(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[n,s,o]=Wa(i,r.pixelProjectionMatrix);return e.length===2?[n,s]:[n,s,o]}unproject(e){return wt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,r){wt(this.internalState);let i=this.internalState.viewport||this.context.viewport;return iC(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let r of this.getModels())r.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===Se.DEFAULT||e===Se.LNGLAT||e===Se.CARTESIAN}onHover(e,r){return this.props.onHover&&this.props.onHover(e,r)||!1}onClick(e,r){return this.props.onClick&&this.props.onClick(e,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,r=[]){return r[0]=e+1&255,r[1]=e+1>>8&255,r[2]=e+1>>8>>8&255,r}decodePickingColor(e){wt(e instanceof Uint8Array);let[r,i,n]=e;return r+i*256+n*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:kS(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=H_(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let r of this.props.extensions)e=H_(e,r.getShaders.call(this,r));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let r=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&r)if(Array.isArray(i))for(let n of i)r.invalidateAll(n);else r.invalidateAll();if(r){let{props:n}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(n.highlightedObjectIndex)||n.pickable||n.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;let{pickingColors:a,instancePickingColors:A}=r.attributes,h=a||A;h&&(o&&h.constant&&(h.constant=!1,r.invalidate(h.id)),!h.value&&!o&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(e){for(let i of this.getModels())i.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let r of this.getModels())r.draw(e.renderPass)}getPickingInfo({info:e,mode:r,sourceLayer:i}){let{index:n}=e;return n>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[n]),e}raiseError(e,r){r&&(e=new Error(`${r}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=e,(!r||!KH({oldViewport:r,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let r=this.getAttributeManager();r&&(e==="all"?r.invalidateAll():r.invalidate(e))}updateAttributes(e){let r=!1;for(let i in e)e[i].layoutChanged()&&(r=!0);for(let i of this.getModels())this._setModelAttributes(i,e,r)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let r=this.props,i=this.getNumInstances(),n=this.getStartIndices();e.update({data:r.data,numInstances:i,startIndices:n,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let r=e.update(),i=Object.create(this.props);for(let n in r)Object.defineProperty(i,n,{value:r[n]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:r}){if(e.constant)return;let i=Math.floor(Hi.length/4);if(this.internalState.usesPickingColorCache=!0,i<r){r>WS&&me.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Hi=Ni.allocate(Hi,r,{size:4,copy:!0,maxCount:Math.max(r,WS)});let n=Math.floor(Hi.length/4),s=[0,0,0];for(let o=i;o<n;o++)this.encodePickingColor(o,s),Hi[o*4+0]=s[0],Hi[o*4+1]=s[1],Hi[o*4+2]=s[2],Hi[o*4+3]=0}e.value=Hi.subarray(0,r*4)}_setModelAttributes(e,r,i=!1){if(!Object.keys(r).length)return;if(i){let a=this.getAttributeManager();e.setBufferLayout(a.getBufferLayouts(e)),r=a.getAttributes()}let n=e.userData?.excludeAttributes||{},s={},o={};for(let a in r){if(n[a])continue;let A=r[a].getValue();for(let h in A){let g=A[h];g instanceof ct?r[a].settings.isIndexed?e.setIndexBuffer(g):s[h]=g:g&&(o[h]=g)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(e);return}let{pickingColors:i,instancePickingColors:n}=this.getAttributeManager().attributes,s=i||n,o=s&&r.attributes&&r.attributes[s.id];if(o&&o.value){let a=o.value,A=this.encodePickingColor(e);for(let h=0;h<r.length;h++){let g=s.getVertexOffset(h);a[g]===A[0]&&a[g+1]===A[1]&&a[g+2]===A[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,n=r||i;if(!n)return;let s=n.getVertexOffset(e),o=n.getVertexOffset(e+1);n.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){let{pickingColors:e,instancePickingColors:r}=this.getAttributeManager().attributes,i=e||r;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Hi.buffer&&(i.value=Hi.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){wt(!this.internalState),wt(Number.isFinite(this.props.coordinateSystem)),Wt(jH,this);let e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new nu({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(me.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new $A(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Wt(QH,this,this===e);let{state:r,internalState:i}=e;this!==e&&(this.internalState=i,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(Wt(XH,this,e),!e)return;let r=this.props,i=this.context,n=this.internalState,s=i.viewport,o=this._updateUniformTransition();n.propsInTransition=o,i.viewport=n.viewport||s,this.props=o;try{let a=this._getUpdateParams(),A=this.getModels();if(i.device)this.updateState(a);else try{this.updateState(a)}catch{}for(let g of this.props.extensions)g.updateState.call(this,a,g);this.setNeedsRedraw(),this._updateAttributes();let h=this.getModels()[0]!==A[0];this._postUpdate(a,h)}finally{i.viewport=s,this.props=r,this._clearChangeFlags(),n.needsUpdate=!1,n.resetOldProps()}}_finalize(){Wt(YH,this),this.finalizeState(this.context);for(let e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:r=null,uniforms:i={},parameters:n={}}){this._updateAttributeTransition();let s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{r&&this.setShaderModuleProps(r);let{getPolygonOffset:a}=this.props,A=a&&a(i)||[0,0];o.device instanceof Kr&&o.device.setParametersWebGL({polygonOffset:A});for(let h of this.getModels())h.setParameters(n);if(o.device instanceof Kr)o.device.withParametersWebGL(n,()=>{let h={renderPass:e,shaderModuleProps:r,uniforms:i,parameters:n,context:o};for(let g of this.props.extensions)g.draw.call(this,h,g);this.draw(h)});else{let h={renderPass:e,shaderModuleProps:r,uniforms:i,parameters:n,context:o};for(let g of this.props.extensions)g.draw.call(this,h,g);this.draw(h)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let n in e)if(e[n]){let s=!1;switch(n){case"dataChanged":let o=e[n],a=r[n];o&&Array.isArray(a)&&(r.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:r[n]||(r[n]=e[n],s=!0)}s&&Wt(WH,this,n,e)}let i=!!(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=i,r.somethingChanged=i||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,r){let i=DS(e,r);if(i.updateTriggersChanged)for(let n in i.updateTriggersChanged)i.updateTriggersChanged[n]&&this.invalidateAttribute(n);if(i.transitionsChanged)for(let n in i.transitionsChanged)this.internalState.uniformTransitions.add(n,r[n],e[n],e.transitions?.[n]);return this.setChangeFlags(i)}validateProps(){NS(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let r={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(r.highlightColor=i(e)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new vi(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,r){let{props:i,oldProps:n}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());let{autoHighlight:o,highlightedObjectIndex:a,highlightColor:A}=i;if(r||n.autoHighlight!==o||n.highlightedObjectIndex!==a||n.highlightColor!==A){let h={};Array.isArray(A)&&(h.highlightColor=A),(r||n.autoHighlight!==o||a!==n.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let i=this.getAttributeManager(),n=i?i.getNeedsRedraw(e):!1;if(r=r||n,r)for(let s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};su.defaultProps=JH;su.layerName="Layer";var xt=su;var ZH="compositeLayer.renderLayers",Td=class extends xt{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:r}=e;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(e.object=r.__source.object,e.index=r.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,r){return r&&r.length}getSubLayerClass(e,r){let{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||r}getSubLayerRow(e,r,i){return e.__source={parent:this,object:r,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){let r={index:-1,data:this.props.data,target:[]};return(i,n)=>i&&i.__source?(r.index=i.__source.index,e(i.__source.object,r)):e(i,n)}return e}getSubLayerProps(e={}){let{opacity:r,pickable:i,visible:n,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:A,highlightColor:h,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:b,positionFormat:T,modelMatrix:v,extensions:C,fetch:S,operation:P,_subLayerProps:F}=this.props,I={id:"",updateTriggers:{},opacity:r,pickable:i,visible:n,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:A,highlightColor:h,coordinateSystem:g,coordinateOrigin:_,wrapLongitude:b,positionFormat:T,modelMatrix:v,extensions:C,fetch:S,operation:P},k=F&&e.id&&F[e.id],W=k&&k.updateTriggers,K=e.id||"sublayer";if(k){let re=this.props[Ei],Y=e.type?e.type._propTypes:{};for(let z in k){let L=Y[z]||re[z];L&&L.type==="accessor"&&(k[z]=this.getSubLayerAccessor(k[z]))}}Object.assign(I,e,k),I.id=`${this.props.id}-${K}`,I.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...W};for(let re of C){let Y=re.getSubLayerProps.call(this,re);Y&&Object.assign(I,Y,{updateTriggers:Object.assign(I.updateTriggers,Y.updateTriggers)})}return I}_updateAutoHighlight(e){for(let r of this.getSubLayers())r.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,r){let i=this.internalState.subLayers,n=!i||this.needsUpdate();if(n){let s=this.renderLayers();i=qr(s,Boolean),this.internalState.subLayers=i}Wt(ZH,this,n,i);for(let s of i)s.parent=this}};Td.layerName="CompositeLayer";var zt=Td;var Ed=Math.PI/180,jS=180/Math.PI,vd=6370972,rc=256;function $H(){let t=rc/vd,e=Math.PI/180*rc;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}var Os=class extends ai{constructor(e={}){let{longitude:r=0,zoom:i=0,nearZMultiplier:n=.5,farZMultiplier:s=1,resolution:o=10}=e,{latitude:a=0,height:A,altitude:h=1.5,fovy:g}=e;a=Math.max(Math.min(a,bi),-bi),A=A||1,g?h=Po(g):g=Gn(h);let _=1/Math.PI/Math.cos(a*Math.PI/180),b=Math.pow(2,i)*_,T=e.nearZ??n,v=e.farZ??(h+rc*2*b/A)*s,C=new Ce().lookAt({eye:[0,-h,0],up:[0,0,1]});C.rotateX(a*Ed),C.rotateZ(-r*Ed),C.scale(b/A),super({...e,height:A,viewMatrix:C,longitude:r,latitude:a,zoom:i,distanceScales:$H(),fovy:g,focalDistance:h,near:T,far:v}),this.scale=b,this.latitude=a,this.longitude=r,this.resolution=o}get projectionMode(){return Pr.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let r={targetZ:e.z||0},i=this.unproject([0,this.height/2],r),n=this.unproject([this.width/2,0],r),s=this.unproject([this.width,this.height/2],r),o=this.unproject([this.width/2,this.height],r);return s[0]<this.longitude&&(s[0]+=360),i[0]>this.longitude&&(i[0]-=360),[Math.min(i[0],s[0],n[0],o[0]),Math.min(i[1],s[1],n[1],o[1]),Math.max(i[0],s[0],n[0],o[0]),Math.max(i[1],s[1],n[1],o[1])]}unproject(e,{topLeft:r=!0,targetZ:i}={}){let[n,s,o]=e,a=r?s:this.height-s,{pixelUnprojectionMatrix:A}=this,h;if(Number.isFinite(o))h=Y_(A,[n,a,o,1]);else{let T=Y_(A,[n,a,-1,1]),v=Y_(A,[n,a,1,1]),C=((i||0)/vd+1)*rc,S=Tr.sqrLen(Tr.sub([],T,v)),P=Tr.sqrLen(T),F=Tr.sqrLen(v),k=4*((4*P*F-(S-P-F)**2)/16)/S,W=Math.sqrt(P-k),K=Math.sqrt(Math.max(0,C*C-k)),re=(W-K)/Math.sqrt(S);h=Tr.lerp([],T,v,re)}let[g,_,b]=this.unprojectPosition(h);return Number.isFinite(o)?[g,_,b]:Number.isFinite(i)?[g,_,i]:[g,_]}projectPosition(e){let[r,i,n=0]=e,s=r*Ed,o=i*Ed,a=Math.cos(o),A=(n/vd+1)*rc;return[Math.sin(s)*a*A,-Math.cos(s)*a*A,Math.sin(o)*A]}unprojectPosition(e){let[r,i,n]=e,s=Tr.len(e),o=Math.asin(n/s),A=Math.atan2(r,-i)*jS,h=o*jS,g=(s/rc-1)*vd;return[A,h,g]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,r){let i=this.unproject(r);return{longitude:e[0]-i[0]+this.longitude,latitude:e[1]-i[1]+this.latitude}}};function Y_(t,e){let r=Qr.transformMat4([],e,t);return Qr.scale(r,r,1/r[3]),r}var Q_=class extends BA{applyConstraints(e){let{maxZoom:r,minZoom:i,zoom:n}=e;e.zoom=pr(n,i,r);let{longitude:s,latitude:o}=e;return(s<-180||s>180)&&(e.longitude=Jw(s+180,360)-180),e.latitude=pr(o,-bi,bi),e}},ou=class extends No{constructor(){super(...arguments),this.ControllerState=Q_,this.transition={transitionDuration:300,transitionInterpolator:new qn(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}};var wd=class extends Fo{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?un:Os}get ControllerType(){return ou}};wd.displayName="GlobeView";var q_=wd;var au=class{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&Et(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){let{defaultProps:r}=e.constructor,i={updateTriggers:{}};for(let n in r)if(n in this.props){let s=r[n],o=this.props[n];i[n]=o,s&&s.type==="accessor"&&(i.updateTriggers[n]=this.props.updateTriggers[n],typeof o=="function"&&(i[n]=this.getSubLayerAccessor(o)))}return i}initializeState(e,r){}updateState(e,r){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,r){}finalizeState(e,r){}};au.defaultProps={};au.extensionName="LayerExtension";var K_=au;var Fs=class{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;let{attributes:r={}}=e;this.typedArrayManager=Ni,this.attributes={},this._attributeDefs=r,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);let{data:r,buffers:i={},getGeometry:n,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:A=!0}=this.opts;if(this.data=r,this.getGeometry=n,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=i,this.normalize=A,s&&(wt(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),A||(i.vertexPositions=s)),this.geometryBuffer=i.vertexPositions,Array.isArray(a))for(let h of a)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:r}){this._rebuildGeometry({startRow:e,endRow:r})}getGeometryFromBuffer(e){let r=e.value||e;return ArrayBuffer.isView(r)?hd(r,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,r){let{attributes:i,buffers:n,_attributeDefs:s,typedArrayManager:o}=this;for(let a in s)if(a in n)o.release(i[a]),i[a]=null;else{let A=s[a];A.copy=r,i[a]=o.allocate(i[a],e,A)}}_forEachGeometry(e,r,i){let{data:n,getGeometry:s}=this,{iterable:o,objectInfo:a}=Yt(n,r,i);for(let A of o){a.index++;let h=s?s(A,a):null;e(h,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:r,vertexStarts:i,instanceCount:n}=this,{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:A=1/0}=e||{},h={};if(e||(r=[0],i=[0]),this.normalize||!o)this._forEachGeometry((_,b)=>{let T=_&&this.normalizeGeometry(_);h[b]=T,i[b+1]=i[b]+(T?this.getGeometrySize(T):0)},a,A),n=i[i.length-1];else if(i=s.startIndices,n=i[s.length]||0,ArrayBuffer.isView(o))n=n||o.length/this.positionSize;else if(o instanceof ct){let _=this.positionSize*4;n=n||o.byteLength/_}else if(o.buffer){let _=o.stride||this.positionSize*4;n=n||o.buffer.byteLength/_}else if(o.value){let _=o.value,b=o.stride/_.BYTES_PER_ELEMENT||this.positionSize;n=n||_.length/b}this._allocate(n,!!e),this.indexStarts=r,this.vertexStarts=i,this.instanceCount=n;let g={};this._forEachGeometry((_,b)=>{let T=h[b]||_;g.vertexStart=i[b],g.indexStart=r[b];let v=b<i.length-1?i[b+1]:n;g.geometrySize=v-i[b],g.geometryIndex=b,this.updateGeometryAttributes(T,g)},a,A),this.vertexCount=r[r.length-1]}};var J_=512,eG=Math.PI/180;function Cd({map:t,gl:e,deck:r}){if(t.__deck)return t.__deck;let i=r?.props._customRender,n=r?.props.onLoad,s={...r?.props,_customRender:()=>{t.triggerRepaint(),i?.("")}};s.parameters={...Sd(t,!0),...s.parameters},s.views||(s.views=cu(t));let o;return(!r||r.props.gl===e)&&(Object.assign(s,{gl:e,width:null,height:null,touchAction:"unset",viewState:ic(t)}),r?.isInitialized?XS(r,t):s.onLoad=()=>{n?.(),XS(o,t)}),r?(o=r,r.setProps(s),r.userData.isExternal=!0):(o=new ec(s),t.on("remove",()=>{Z_(t)})),o.userData.mapboxLayers=new Set,t.__deck=o,t.on("render",()=>{o.isInitialized&&rG(o,t)}),o}function XS(t,e){let r=()=>{t.isInitialized?iG(t,e):e.off("move",r)};e.on("move",r)}function Z_(t){t.__deck?.finalize(),t.__deck=null}function Sd(t,e){let r=e?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return JS(t)==="globe"&&(r.cullMode="back"),r}function YS(t,e){t.userData.mapboxLayers.add(e),$_(t)}function QS(t,e){t.userData.mapboxLayers.delete(e),$_(t)}function qS(t,e){$_(t)}function KS(t,e,r,i){let{currentViewport:n}=t.userData,s=!1;n||(n=ZS(t,e,i),t.userData.currentViewport=n,s=!0),t.isInitialized&&t._drawLayers("mapbox-repaint",{viewports:[n],layerFilter:({layer:o})=>r.id===o.id||o.props.operation.includes("terrain"),clearStack:s,clearCanvas:!1})}function JS(t){let e=t.getProjection?.(),r=e?.type||e?.name;if(r==="globe")return"globe";if(r&&r!=="mercator")throw new Error("Unsupported projection");return"mercator"}function cu(t){return JS(t)==="globe"?new q_({id:"mapbox"}):new FA({id:"mapbox"})}function ic(t){let{lng:e,lat:r}=t.getCenter(),i={longitude:(e+540)%360-180,latitude:r,zoom:t.getZoom(),bearing:t.getBearing(),pitch:t.getPitch(),padding:t.getPadding(),repeat:t.getRenderWorldCopies()};return t.getTerrain?.()&&tG(t,i),i}function tG(t,e){if(t.getFreeCameraOptions){let{position:r}=t.getFreeCameraOptions();if(!r||r.z===void 0)return;let i=t.transform.height,{longitude:n,latitude:s,pitch:o}=e,a=r.x*J_,A=(1-r.y)*J_,h=r.z*J_,g=nr([n,s]),_=a-g[0],b=A-g[1],T=Math.sqrt(_*_+b*b),v=o*eG,C=1.5*i,S=v<.001?C*Math.cos(v)/h:C*Math.sin(v)/T;e.zoom=Math.log2(S);let P=C*Math.cos(v)/S,F=h-P;e.position=[0,0,F/Mo(s)]}else typeof t.transform.elevation=="number"&&(e.position=[0,0,t.transform.elevation])}function ZS(t,e,r){let i=ic(e),n=cu(e);r&&(n.props.nearZMultiplier=.2);let s=r?.nearZ??e.transform._nearZ,o=r?.farZ??e.transform._farZ;return Number.isFinite(s)&&(i.nearZ=s/e.transform.height,i.farZ=o/e.transform.height),n.makeViewport({width:t.width,height:t.height,viewState:i})}function rG(t,e){let{mapboxLayers:r,isExternal:i}=t.userData;if(i){let n=Array.from(r,g=>g.id),o=qr(t.props.layers,Boolean).some(g=>g&&!n.includes(g.id)),a=t.getViewports(),A=a.findIndex(g=>g.id==="mapbox"),h=a.length>1||A<0;(o||h)&&(A>=0&&(a=a.slice(),a[A]=ZS(t,e)),t._drawLayers("mapbox-repaint",{viewports:a,layerFilter:g=>(!t.props.layerFilter||t.props.layerFilter(g))&&(g.viewport.id!=="mapbox"||!n.includes(g.layer.id)),clearCanvas:!1}))}t.userData.currentViewport=null}function iG(t,e){t.setProps({viewState:ic(e)}),t.needsRedraw({clearRedrawFlags:!0})}function $_(t){if(t.userData.isExternal)return;let e=[];t.userData.mapboxLayers.forEach(r=>{let i=r.props.type,n=new i(r.props);e.push(n)}),t.setProps({layers:e})}var lu=class{constructor(e){if(!e.id)throw new Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.map=null,this.deck=null,this.props=e}onAdd(e,r){this.map=e,this.deck=Cd({map:e,gl:r,deck:this.props.deck}),YS(this.deck,this)}onRemove(){this.deck&&QS(this.deck,this)}setProps(e){Object.assign(this.props,e,{id:this.id}),this.deck&&qS(this.deck,this)}render(e,r){KS(this.deck,this.map,this,r)}};var ey="__UNDEFINED__";function Au(t,e,r,i){if(!t||!e||!t.style||!t.style._loaded)return;let n=qr(i,Boolean);if(r!==i){let a=qr(r,Boolean),A=new Set(a.map(h=>h.id));for(let h of n)A.delete(h.id);for(let h of A)t.getLayer(h)&&t.removeLayer(h)}for(let a of n){let A=t.getLayer(a.id);A?(A.implementation||A).setProps(a.props):t.addLayer(new lu({id:a.id,deck:e}),a.props.beforeId)}let s=t.style._order,o={};for(let a of n){let{beforeId:A}=a.props;(!A||!s.includes(A))&&(A=ey),o[A]=o[A]||[],o[A].push(a.id)}for(let a in o){let A=o[a],h=a===ey?s.length:s.indexOf(a),g=a===ey?void 0:a;for(let _=A.length-1;_>=0;_--){let b=A[_],T=s.indexOf(b);T!==h-1&&(t.moveLayer(b,g),T>h&&h++),h--,g=b}}}var nc=class{constructor(e){this._handleStyleChange=()=>{Au(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:n,clientHeight:s}=this._map.getContainer();Object.assign(this._container.style,{width:`${n}px`,height:`${s}px`})}},this._updateViewState=()=>{let n=this._deck,s=this._map;n&&s&&(n.setProps({views:this._props.views||cu(s),viewState:ic(s)}),n.isInitialized&&n.redraw())},this._handleMouseEvent=n=>{let s=this._deck;if(!s||!s.isInitialized)return;let o={type:n.type,offsetCenter:n.point,srcEvent:n},a=this._lastMouseDownPoint;switch(!n.point&&a&&(o.deltaX=n.originalEvent.clientX-a.clientX,o.deltaY=n.originalEvent.clientY-a.clientY,o.offsetCenter={x:a.x+o.deltaX,y:a.y+o.deltaY}),o.type){case"mousedown":s._onPointerDown(o),this._lastMouseDownPoint={...n.point,clientX:n.originalEvent.clientX,clientY:n.originalEvent.clientY};break;case"dragstart":o.type="panstart",s._onEvent(o);break;case"drag":o.type="panmove",s._onEvent(o);break;case"dragend":o.type="panend",s._onEvent(o);break;case"click":o.tapCount=1,s._onEvent(o);break;case"dblclick":o.type="click",o.tapCount=2,s._onEvent(o);break;case"mousemove":o.type="pointermove",s._onPointerMove(o);break;case"mouseout":o.type="pointerleave",s._onPointerMove(o);break;default:return}};let{interleaved:r=!1,...i}=e;this._interleaved=r,this._props=i}setProps(e){this._interleaved&&e.layers&&Au(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...Sd(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new ec({...this._props,parent:r,parameters:{...Sd(e,!1),...this._props.parameters},views:this._props.views||cu(e),viewState:ic(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(e){let r=e.painter.context.gl;return r instanceof WebGLRenderingContext&&me.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=Cd({map:e,gl:r,deck:new ec({...this._props,gl:r})}),e.on("styledata",this._handleStyleChange),Au(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),Au(e,this._deck,this._props.layers,[]),Z_(e)}getDefaultPosition(){return"top-left"}pickObject(e){return wt(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return wt(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return wt(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};function sc(t,e=""){if(!t)throw new Error(`JSON conversion error ${e}`)}function e4(t,e){let r=sG(e),i=t;for(let n of r)i=nG(i)?i[n]:void 0;return i}function nG(t){return t!==null&&typeof t=="object"}var $S={};function sG(t){if(typeof t=="string"){let e=$S[t];return e||(e=t.split("."),$S[t]=e),e}return Array.isArray(t)?t:[t]}var ty=_a(t4(),1);var r4={"||":(t,e)=>t||e,"&&":(t,e)=>t&&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"&":(t,e)=>t&e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e},oG={"-":t=>-t,"+":t=>+t,"~":t=>~t,"!":t=>!t};function i4(t,e){return t.map(function(r){return _r(r,e)})}function n4(t,e){let r=_r(t.object,e),i;if(t.computed?i=_r(t.property,e):i=t.property.name,/^__proto__|prototype|constructor$/.test(i))throw Error(`Access to member "${i}" disallowed.`);return[r,r[i]]}function _r(t,e){let r=t;switch(r.type){case"ArrayExpression":return i4(r.elements,e);case"BinaryExpression":return r4[r.operator](_r(r.left,e),_r(r.right,e));case"CallExpression":let i,n,s;return r.callee.type==="MemberExpression"?(s=n4(r.callee,e),i=s[0],n=s[1]):n=_r(r.callee,e),typeof n!="function"?void 0:n.apply(i,i4(r.arguments,e));case"ConditionalExpression":return _r(r.test,e)?_r(r.consequent,e):_r(r.alternate,e);case"Identifier":return e[r.name];case"Literal":return r.value;case"LogicalExpression":return r.operator==="||"?_r(r.left,e)||_r(r.right,e):r.operator==="&&"?_r(r.left,e)&&_r(r.right,e):r4[r.operator](_r(r.left,e),_r(r.right,e));case"MemberExpression":return n4(r,e)[1];case"ThisExpression":return e;case"UnaryExpression":return oG[r.operator](_r(r.argument,e));default:return}}var ry={"-":t=>t};function fu(t,e){if(t in ry)return ry[t];let r,i=(0,ty.default)(t);return i.type==="Identifier"?r=n=>e4(n,t):(iy(i,n=>{if(n.type==="CallExpression")throw new Error("Function calls not allowed in JSON expressions")}),r=n=>_r(i,n)),ry[t]=r,r}function iy(t,e){if(Array.isArray(t))t.forEach(r=>iy(r,e));else if(t&&typeof t=="object"){t.type&&e(t);for(let r in t)iy(t[r],e)}}var oc="@@=",ny="@@#",s4="@@type",Pd="@@function";var o4=t=>t&&typeof t=="object",xn=class{constructor(...e){this.typeKey=s4,this.functionKey=Pd,this.log=console,this.classes={},this.reactComponents={},this.enumerations={},this.constants={},this.functions={},this.React=null,this.convertFunction=fu,this.preProcessClassProps=(r,i)=>i,this.postProcessConvertedJson=r=>r;for(let r of e)this.merge(r)}merge(e){for(let r in e)switch(r){case"layers":case"views":Object.assign(this.classes,e[r]);break;default:if(r in this){let i=e[r];this[r]=o4(this[r])?Object.assign(this[r],i):i}}}validate(e){return sc(!this.typeKey||typeof this.typeKey=="string"),sc(o4(this.classes)),!0}};function aG(t){return typeof t=="string"&&t.startsWith(oc)}function cG(t){return t.replace(oc,"")}function Rd(t,e){let r={};for(let i in t){let n=t[i];aG(n)&&(n=cG(n),n=fu(n,e)),r[i]=n}return r}function a4(t,e,r){let i=r.classes[t],n=r.reactComponents[t];if(!i&&!n){let{log:s}=r;if(s){let o=JSON.stringify(e,null,0).slice(0,40);s.warn(`JSON converter: No registered class of type ${t}(${o}...)  `)}return null}return i?lG(i,e,r):AG(n,e,r)}function lG(t,e,r){return r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Rd(e,r),new t(e)}function AG(t,e,r){let{React:i}=r,{children:n=[]}=e;return delete e.children,r.preProcessClassProps&&(e=r.preProcessClassProps(t,e,r)),e=Rd(e,r),i.createElement(t,e,n)}function c4(t,e,r){let i=r.functions[t];if(!i){let{log:n}=r;if(n){let s=JSON.stringify(e,null,0).slice(0,40);n.warn(`JSON converter: No registered function ${t}(${s}...)  `)}return null}return i(e)}function sy(t){return typeof t=="string"?JSON.parse(t):t}var oy=t=>t&&typeof t=="object",ac=class{constructor(e){this.log=console,this.onJSONChange=()=>{},this.json=null,this.convertedJson=null,this.setProps(e)}finalize(){}setProps(e){"configuration"in e&&(this.configuration=e.configuration instanceof xn?e.configuration:new xn(e.configuration)),"onJSONChange"in e&&(this.onJSONChange=e.onJSONChange)}mergeConfiguration(e){this.configuration.merge(e)}convert(e){if(!e||e===this.json)return this.convertedJson;this.json=e;let r=sy(e),i=uG(r,this.configuration);return i=this.configuration.postProcessConvertedJson(i),this.convertedJson=i,i}convertJson(e){return this.convert(e)}};function uG(t,e){return e=new xn(e),ay(t,"",e)}function ay(t,e,r){return Array.isArray(t)?t.map((i,n)=>ay(i,String(n),r)):fG(t,r)?hG(t,r):oy(t)?Pd in t?dG(t,r):cy(t,r):typeof t=="string"?pG(t,e,r):t}function fG(t,e){let{typeKey:r}=e;return oy(t)&&!!t[r]}function hG(t,e){let{typeKey:r}=e,i=t[r],n={...t};return delete n[r],n=cy(n,e),a4(i,n,e)}function dG(t,e){let{functionKey:r}=e,i=t[r],n={...t};return delete n[r],n=cy(n,e),c4(i,n,e)}function cy(t,e){sc(oy(t));let r={};for(let i in t){let n=t[i];r[i]=ay(n,i,e)}return r}function pG(t,e,r){if(t.startsWith(oc)&&r.convertFunction)return t=t.replace(oc,""),r.convertFunction(t,r);if(t.startsWith(ny)){if(t=t.replace(ny,""),r.constants[t])return r.constants[t];let[i,n]=t.split(".");return r.enumerations[i][n]}return t}var Jx={};fr(Jx,{ArcLayer:()=>Bd,BitmapLayer:()=>Od,CPUAggregator:()=>Ur,ColumnLayer:()=>bn,ContourLayer:()=>lP,GeoJsonLayer:()=>jo,GeohashLayer:()=>N8,GreatCircleLayer:()=>bR,GridCellLayer:()=>rM,GridLayer:()=>dP,H3ClusterLayer:()=>vI,H3HexagonLayer:()=>Lp,HeatmapLayer:()=>BP,HexagonLayer:()=>R5,IconLayer:()=>cc,LineLayer:()=>R4,MVTLayer:()=>B8,PathLayer:()=>Tn,PointCloudLayer:()=>Fd,PolygonLayer:()=>Us,QuadkeyLayer:()=>LR,S2Layer:()=>OR,ScatterplotLayer:()=>Ld,ScreenGridLayer:()=>y5,SolidPolygonLayer:()=>ks,TerrainLayer:()=>o8,TextLayer:()=>tp,Tile3DLayer:()=>$6,TileLayer:()=>Jo,TripsLayer:()=>tI,WebGLAggregator:()=>Qt,_AggregationLayer:()=>En,_GeoCellLayer:()=>vn,_MultiIconLayer:()=>Zd,_TextBackgroundLayer:()=>ep,_Tile2DHeader:()=>qo,_Tileset2D:()=>Ko,_WMSLayer:()=>Pc,_getURLFromTemplate:()=>Sn});var l4=`uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,A4={name:"arc",vs:l4,fs:l4,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}};var u4=`#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var f4=`#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Id=[0,0,0,255],gG={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getSourceColor:{type:"accessor",value:Id},getTargetColor:{type:"accessor",value:Id},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},hu=class extends xt{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:u4,fs:f4,modules:[et,Pt,A4]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Id},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Id},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:s,greatCircle:o,wrapLongitude:a,numSegments:A}=this.props,h={numSegments:A,widthUnits:Ut[r],widthScale:i,widthMinPixels:n,widthMaxPixels:s,greatCircle:o,useShortestPath:a},g=this.state.model;g.shaderInputs.setProps({arc:h}),g.setVertexCount(A*2),g.draw(this.context.renderPass)}_getModel(){return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}};hu.layerName="ArcLayer";hu.defaultProps=gG;var Bd=hu;var mG=new Uint32Array([0,2,1,0,3,2]),_G=new Float32Array([0,1,0,0,1,0,1,1]);function ly(t,e){if(!e)return yG(t);let r=Math.max(Math.abs(t[0][0]-t[3][0]),Math.abs(t[1][0]-t[2][0])),i=Math.max(Math.abs(t[1][1]-t[0][1]),Math.abs(t[2][1]-t[3][1])),n=Math.ceil(r/e)+1,s=Math.ceil(i/e)+1,o=(n-1)*(s-1)*6,a=new Uint32Array(o),A=new Float32Array(n*s*2),h=new Float64Array(n*s*3),g=0,_=0;for(let b=0;b<n;b++){let T=b/(n-1);for(let v=0;v<s;v++){let C=v/(s-1),S=xG(t,T,C);h[g*3+0]=S[0],h[g*3+1]=S[1],h[g*3+2]=S[2]||0,A[g*2+0]=T,A[g*2+1]=1-C,b>0&&v>0&&(a[_++]=g-s,a[_++]=g-s-1,a[_++]=g-1,a[_++]=g-s,a[_++]=g-1,a[_++]=g),g++}}return{vertexCount:o,positions:h,indices:a,texCoords:A}}function yG(t){let e=new Float64Array(12);for(let r=0;r<t.length;r++)e[r*3+0]=t[r][0],e[r*3+1]=t[r][1],e[r*3+2]=t[r][2]||0;return{vertexCount:6,positions:e,indices:mG,texCoords:_G}}function xG(t,e,r){return br(br(t[0],t[1],r),br(t[3],t[2],r),e)}var h4=`uniform bitmapUniforms {
  vec4 bounds;
  float coordinateConversion;
  float desaturate;
  vec3 tintColor;
  vec4 transparentColor;
} bitmap;
`,d4={name:"bitmap",vs:h4,fs:h4,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}};var p4=`#version 300 es
#define SHADER_NAME bitmap-layer-vertex-shader

in vec2 texCoords;
in vec3 positions;
in vec3 positions64Low;

out vec2 vTexCoord;
out vec2 vTexPos;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (bitmap.coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project.commonOrigin.xy;
  } else if (bitmap.coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var bG=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,g4=`#version 300 es
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

in vec2 vTexCoord;
in vec2 vTexPos;

out vec4 fragColor;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), bitmap.desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * bitmap.tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (bitmap.transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
    (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
  );
}

${bG}

void main(void) {
  vec2 uv = vTexCoord;
  if (bitmap.coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (bitmap.coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture(bitmapTexture, uv);

  fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);

  if (bool(picking.isActive) && !bool(picking.isAttribute)) {
    // Since instance information is not used, we can use picking color for pixel index
    fragColor.rgb = packUVsIntoRGB(uv);
  }
}
`;var TG={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:Se.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},du=class extends xt{getShaders(){return super.getShaders({vs:p4,fs:g4,modules:[et,Pt,d4]})}initializeState(){let e=this.getAttributeManager();e.remove(["instancePickingColors"]);let r=!0;e.add({indices:{size:1,isIndexed:!0,update:i=>i.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:i=>i.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:i=>i.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:e,oldProps:r,changeFlags:i}){let n=this.getAttributeManager();if(i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll()),e.bounds!==r.bounds){let s=this.state.mesh,o=this._createMesh();this.state.model.setVertexCount(o.vertexCount);for(let a in o)s&&s[a]!==o[a]&&n.invalidate(a);this.setState({mesh:o,...this._getCoordinateUniforms()})}else e._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(e){let{image:r}=this.props,i=e.info;if(!i.color||!r)return i.bitmap=null,i;let{width:n,height:s}=r;i.index=0;let o=EG(i.color);return i.bitmap={size:{width:n,height:s},uv:o,pixel:[Math.floor(o[0]*n),Math.floor(o[1]*s)]},i}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(e){super._updateAutoHighlight({...e,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:e}=this.props,r=e;return m4(e)&&(r=[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]]]),ly(r,this.context.viewport.resolution)}_getModel(){return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(e){let{shaderModuleProps:r}=e,{model:i,coordinateConversion:n,bounds:s,disablePicking:o}=this.state,{image:a,desaturate:A,transparentColor:h,tintColor:g}=this.props;if(!(r.picking.isActive&&o)&&a&&i){let _={bitmapTexture:a,bounds:s,coordinateConversion:n,desaturate:A,tintColor:g.slice(0,3).map(b=>b/255),transparentColor:h.map(b=>b/255)};i.shaderInputs.setProps({bitmap:_}),i.draw(this.context.renderPass)}}_getCoordinateUniforms(){let{LNGLAT:e,CARTESIAN:r,DEFAULT:i}=Se,{_imageCoordinateSystem:n}=this.props;if(n!==i){let{bounds:s}=this.props;if(!m4(s))throw new Error("_imageCoordinateSystem only supports rectangular bounds");let o=this.context.viewport.resolution?e:r;if(n=n===e?e:r,n===e&&o===r)return{coordinateConversion:-1,bounds:s};if(n===r&&o===e){let a=nr([s[0],s[1]]),A=nr([s[2],s[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],A[0],A[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};du.layerName="BitmapLayer";du.defaultProps=TG;var Od=du;function EG(t){let[e,r,i]=t,n=(i&240)/256,s=(i&15)/16;return[(e+s)/256,(r+n)/256]}function m4(t){return Number.isFinite(t[0])}var _4=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,y4={name:"icon",vs:_4,fs:_4,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}};var x4=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`;var b4=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var vG=1024,wG=4,T4=()=>{},E4={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},CG={x:0,y:0,width:0,height:0};function SG(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function MG(t,e,r,i){let n=Math.min(r/e.width,i/e.height),s=Math.floor(e.width*n),o=Math.floor(e.height*n);return n===1?{image:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{image:t.canvas,width:s,height:o})}function pu(t){return t&&(t.id||t.url)}function PG(t,e,r,i){let{width:n,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:r,sampler:i,mipmaps:!0}),A=o.createCommandEncoder();return A.copyTextureToTexture({sourceTexture:t,destinationTexture:a,width:n,height:s}),A.finish(),t.destroy(),a}function v4(t,e,r){for(let i=0;i<e.length;i++){let{icon:n,xOffset:s}=e[i],o=pu(n);t[o]={...n,x:s,y:r}}}function RG({icons:t,buffer:e,mapping:r={},xOffset:i=0,yOffset:n=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let A=0;A<t.length;A++){let h=t[A],g=pu(h);if(!r[g]){let{height:_,width:b}=h;i+b+e>o&&(v4(r,a,n),i=0,n=s+n+e,s=0,a=[]),a.push({icon:h,xOffset:i}),i=i+b+e,s=Math.max(s,_)}}return a.length>0&&v4(r,a,n),{mapping:r,rowHeight:s,xOffset:i,yOffset:n,canvasWidth:o,canvasHeight:SG(s+n+e)}}function IG(t,e,r){if(!t||!e)return null;r=r||{};let i={},{iterable:n,objectInfo:s}=Yt(t);for(let o of n){s.index++;let a=e(o,s),A=pu(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!i[A]&&(!r[A]||a.url!==r[A].url)&&(i[A]={...a,source:o,sourceIndex:s.index})}return i}var gu=class{constructor(e,{onUpdate:r=T4,onError:i=T4}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=wG,this._canvasWidth=vG,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=r,this.onError=i}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){let r=this._autoPacking?pu(e):e;return this._mapping[r]||CG}setProps({loadOptions:e,autoPacking:r,iconAtlas:i,iconMapping:n,textureParameters:s}){e&&(this._loadOptions=e),r!==void 0&&(this._autoPacking=r),n&&(this._mapping=n),i&&(this._texture?.delete(),this._texture=null,this._externalTexture=i),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,r){if(!this._autoPacking||typeof document>"u")return;let i=Object.values(IG(e,r,this._mapping)||{});if(i.length>0){let{mapping:n,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:A}=RG({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=n,this._xOffset=s,this._yOffset=o,this._canvasHeight=A,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||E4,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=PG(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||E4)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}_loadIcons(e){let r=this._canvas.getContext("2d",{willReadFrequently:!0});for(let i of e)this._pendingCount++,dr(i.url,this._loadOptions).then(n=>{let s=pu(i),o=this._mapping[s],{x:a,y:A,width:h,height:g}=o,{image:_,width:b,height:T}=MG(r,n,h,g);this._texture?.copyExternalImage({image:_,x:a+(h-b)/2,y:A+(g-T)/2,width:b,height:T}),o.width=b,o.height=T,this._texture.generateMipmap(),this.onUpdate()}).catch(n=>{this.onError({url:i.url,source:i.source,sourceIndex:i.sourceIndex,loadOptions:this._loadOptions,error:n})}).finally(()=>{this._pendingCount--})}};var w4=[0,0,0,255],BG={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:w4},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},mu=class extends xt{getShaders(){return super.getShaders({vs:x4,fs:b4,modules:[et,Pt,y4]})}initializeState(){this.state={iconManager:new gu(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:w4},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:A,getIcon:h,textureParameters:g}=r,{iconManager:_}=this.state;if(typeof o=="string")return;let b=o||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:r.loadOptions,autoPacking:!b,iconAtlas:o,iconMapping:b?a:null,textureParameters:g}),b?i.iconMapping!==r.iconMapping&&s.invalidate("getIcon"):(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getIcon))&&_.packIcons(A,h),n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){let{sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:A}=this.state,h=A.getTexture();if(h){let g=this.state.model,_={iconsTexture:h,iconsTextureDim:[h.width,h.height],sizeUnits:Ut[s],sizeScale:r,sizeMinPixels:i,sizeMaxPixels:n,billboard:o,alphaCutoff:a};g.shaderInputs.setProps({icon:_}),g.draw(this.context.renderPass)}}_getModel(){let e=[-1,-1,1,-1,-1,1,1,1];return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ut({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){let r=this.getCurrentLayer()?.props.onIconError;r?r(e):me.error(e.error.message)()}getInstanceOffset(e){let{width:r,height:i,anchorX:n=r/2,anchorY:s=i/2}=this.state.iconManager.getIconMapping(e);return[r/2-n,i/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){let{x:r,y:i,width:n,height:s}=this.state.iconManager.getIconMapping(e);return[r,i,n,s]}};mu.defaultProps=BG;mu.layerName="IconLayer";var cc=mu;var C4=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,S4={name:"line",vs:C4,fs:C4,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}};var M4=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var P4=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var OG=[0,0,0,255],FG={getSourcePosition:{type:"accessor",value:t=>t.sourcePosition},getTargetPosition:{type:"accessor",value:t=>t.targetPosition},getColor:{type:"accessor",value:OG},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},_u=class extends xt{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:M4,fs:P4,modules:[et,Pt,S4]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:r,widthScale:i,widthMinPixels:n,widthMaxPixels:s,wrapLongitude:o}=this.props,a=this.state.model,A={widthUnits:Ut[r],widthScale:i,widthMinPixels:n,widthMaxPixels:s,useShortestPath:o?1:0};a.shaderInputs.setProps({line:A}),a.draw(this.context.renderPass),o&&(a.shaderInputs.setProps({line:{...A,useShortestPath:-1}}),a.draw(this.context.renderPass))}_getModel(){let e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ut({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};_u.layerName="LineLayer";_u.defaultProps=FG;var R4=_u;var I4=`uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,B4={name:"pointCloud",vs:I4,fs:I4,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}};var O4=`#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var F4=`#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var L4=[0,0,0,255],N4=[0,0,1],LG={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:t=>t.position},getNormal:{type:"accessor",value:N4},getColor:{type:"accessor",value:L4},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function NG(t){let{header:e,attributes:r}=t;if(!(!e||!r)&&(t.length=e.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){let{size:i,value:n}=r.COLOR_0;r.instanceColors={size:i,type:"unorm8",value:n}}}var yu=class extends xt{getShaders(){return super.getShaders({vs:O4,fs:F4,modules:[et,Es,Pt,B4]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:N4},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:L4}})}updateState(e){let{changeFlags:r,props:i}=e;super.updateState(e),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&NG(i.data)}draw({uniforms:e}){let{pointSize:r,sizeUnits:i}=this.props,n=this.state.model,s={sizeUnits:Ut[i],radiusPixels:r};n.shaderInputs.setProps({pointCloud:s}),n.draw(this.context.renderPass)}_getModel(){let e=[];for(let r=0;r<3;r++){let i=r/3*Math.PI*2;e.push(Math.cos(i)*2,Math.sin(i)*2,0)}return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ut({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}};yu.layerName="PointCloudLayer";yu.defaultProps=LG;var Fd=yu;var D4=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  bool filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,k4={name:"scatterplot",vs:D4,fs:D4,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}};var U4=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var V4=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled == false) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var z4=[0,0,0,255],DG={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:z4},getLineColor:{type:"accessor",value:z4},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},xu=class extends xt{getShaders(){return super.getShaders({vs:U4,fs:V4,modules:[et,Pt,k4]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:r,radiusScale:i,radiusMinPixels:n,radiusMaxPixels:s,stroked:o,filled:a,billboard:A,antialiasing:h,lineWidthUnits:g,lineWidthScale:_,lineWidthMinPixels:b,lineWidthMaxPixels:T}=this.props,v={stroked:o,filled:a,billboard:A,antialiasing:h,radiusUnits:Ut[r],radiusScale:i,radiusMinPixels:n,radiusMaxPixels:s,lineWidthUnits:Ut[g],lineWidthScale:_,lineWidthMinPixels:b,lineWidthMaxPixels:T},C=this.state.model;C.shaderInputs.setProps({scatterplot:v}),C.draw(this.context.renderPass)}_getModel(){let e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ut({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};xu.defaultProps=DG;xu.layerName="ScatterplotLayer";var Ld=xu;var lc={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function zo(t,e,r={}){return H4(t,r)!==e?(kG(t,r),!0):!1}function H4(t,e={}){return Math.sign(Ls(t,e))}var bu={x:0,y:1,z:2};function Ls(t,e={}){let{start:r=0,end:i=t.length,plane:n="xy"}=e,s=e.size||2,o=0,a=bu[n[0]],A=bu[n[1]];for(let h=r,g=i-s;h<i;h+=s)o+=(t[h+a]-t[g+a])*(t[h+A]+t[g+A]),g=h;return o/2}function kG(t,e){let{start:r=0,end:i=t.length,size:n=2}=e,s=(i-r)/n,o=Math.floor(s/2);for(let a=0;a<o;++a){let A=r+a*n,h=r+(s-1-a)*n;for(let g=0;g<n;++g){let _=t[A+g];t[A+g]=t[h+g],t[h+g]=_}}}function uy(t,e,r=2,i,n="xy"){let s=e&&e.length,o=s?e[0]*r:t.length,a=W4(t,0,o,r,!0,i&&i[0],n),A=[];if(!a||a.next===a.prev)return A;let h,g,_,b,T,v,C;if(s&&(a=WG(t,e,a,r,i,n)),t.length>80*r){b=g=t[0],T=_=t[1];for(let S=r;S<o;S+=r)v=t[S],C=t[S+1],v<b&&(b=v),C<T&&(T=C),v>g&&(g=v),C>_&&(_=C);h=Math.max(g-b,_-T),h=h!==0?32767/h:0}return Tu(a,A,r,b,T,h,0),A}function W4(t,e,r,i,n,s,o){let a,A;s===void 0&&(s=Ls(t,{start:e,end:r,size:i,plane:o}));let h=bu[o[0]],g=bu[o[1]];if(n===s<0)for(a=e;a<r;a+=i)A=G4(a,t[a+h],t[a+g],A);else for(a=r-i;a>=e;a-=i)A=G4(a,t[a+h],t[a+g],A);return A&&kd(A,A.next)&&(vu(A),A=A.next),A}function Ho(t,e){if(!t)return t;e||(e=t);let r=t,i;do if(i=!1,!r.steiner&&(kd(r,r.next)||Ht(r.prev,r,r.next)===0)){if(vu(r),r=e=r.prev,r===r.next)break;i=!0}else r=r.next;while(i||r!==e);return e}function Tu(t,e,r,i,n,s,o){if(!t)return;!o&&s&&qG(t,i,n,s);let a=t,A,h;for(;t.prev!==t.next;){if(A=t.prev,h=t.next,s?zG(t,i,n,s):VG(t)){e.push(A.i/r|0),e.push(t.i/r|0),e.push(h.i/r|0),vu(t),t=h.next,a=h.next;continue}if(t=h,t===a){o?o===1?(t=HG(Ho(t),e,r),Tu(t,e,r,i,n,s,2)):o===2&&GG(t,e,r,i,n,s):Tu(Ho(t),e,r,i,n,s,1);break}}}function VG(t){let e=t.prev,r=t,i=t.next;if(Ht(e,r,i)>=0)return!1;let n=e.x,s=r.x,o=i.x,a=e.y,A=r.y,h=i.y,g=n<s?n<o?n:o:s<o?s:o,_=a<A?a<h?a:h:A<h?A:h,b=n>s?n>o?n:o:s>o?s:o,T=a>A?a>h?a:h:A>h?A:h,v=i.next;for(;v!==e;){if(v.x>=g&&v.x<=b&&v.y>=_&&v.y<=T&&Ac(n,a,s,A,o,h,v.x,v.y)&&Ht(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function zG(t,e,r,i){let n=t.prev,s=t,o=t.next;if(Ht(n,s,o)>=0)return!1;let a=n.x,A=s.x,h=o.x,g=n.y,_=s.y,b=o.y,T=a<A?a<h?a:h:A<h?A:h,v=g<_?g<b?g:b:_<b?_:b,C=a>A?a>h?a:h:A>h?A:h,S=g>_?g>b?g:b:_>b?_:b,P=Ay(T,v,e,r,i),F=Ay(C,S,e,r,i),I=t.prevZ,k=t.nextZ;for(;I&&I.z>=P&&k&&k.z<=F;){if(I.x>=T&&I.x<=C&&I.y>=v&&I.y<=S&&I!==n&&I!==o&&Ac(a,g,A,_,h,b,I.x,I.y)&&Ht(I.prev,I,I.next)>=0||(I=I.prevZ,k.x>=T&&k.x<=C&&k.y>=v&&k.y<=S&&k!==n&&k!==o&&Ac(a,g,A,_,h,b,k.x,k.y)&&Ht(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;I&&I.z>=P;){if(I.x>=T&&I.x<=C&&I.y>=v&&I.y<=S&&I!==n&&I!==o&&Ac(a,g,A,_,h,b,I.x,I.y)&&Ht(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;k&&k.z<=F;){if(k.x>=T&&k.x<=C&&k.y>=v&&k.y<=S&&k!==n&&k!==o&&Ac(a,g,A,_,h,b,k.x,k.y)&&Ht(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function HG(t,e,r){let i=t;do{let n=i.prev,s=i.next.next;!kd(n,s)&&j4(n,i,i.next,s)&&Eu(n,s)&&Eu(s,n)&&(e.push(n.i/r|0),e.push(i.i/r|0),e.push(s.i/r|0),vu(i),vu(i.next),i=t=s),i=i.next}while(i!==t);return Ho(i)}function GG(t,e,r,i,n,s){let o=t;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&ZG(o,a)){let A=X4(o,a);o=Ho(o,o.next),A=Ho(A,A.next),Tu(o,e,r,i,n,s,0),Tu(A,e,r,i,n,s,0);return}a=a.next}o=o.next}while(o!==t)}function WG(t,e,r,i,n,s){let o=[],a,A,h,g,_;for(a=0,A=e.length;a<A;a++)h=e[a]*i,g=a<A-1?e[a+1]*i:t.length,_=W4(t,h,g,i,!1,n&&n[a+1],s),_===_.next&&(_.steiner=!0),o.push(JG(_));for(o.sort(jG),a=0;a<o.length;a++)r=XG(o[a],r);return r}function jG(t,e){return t.x-e.x}function XG(t,e){let r=YG(t,e);if(!r)return e;let i=X4(r,t);return Ho(i,i.next),Ho(r,r.next)}function YG(t,e){let r=e,i=t.x,n=t.y,s=-1/0,o;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){let b=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(b<=i&&b>s&&(s=b,o=r.x<r.next.x?r:r.next,b===i))return o}r=r.next}while(r!==e);if(!o)return null;let a=o,A=o.x,h=o.y,g=1/0,_;r=o;do i>=r.x&&r.x>=A&&i!==r.x&&Ac(n<h?i:s,n,A,h,n<h?s:i,n,r.x,r.y)&&(_=Math.abs(n-r.y)/(i-r.x),Eu(r,t)&&(_<g||_===g&&(r.x>o.x||r.x===o.x&&QG(o,r)))&&(o=r,g=_)),r=r.next;while(r!==a);return o}function QG(t,e){return Ht(t.prev,t,e.prev)<0&&Ht(e.next,t,t.next)<0}function qG(t,e,r,i){let n=t;do n.z===0&&(n.z=Ay(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,KG(n)}function KG(t){let e,r,i=1,n,s,o,a,A,h;do{for(s=t,t=null,h=null,n=0;s;){for(n++,a=s,o=0,r=0;r<i&&(o++,a=a.nextZ,!!a);r++);for(A=i;o>0||A>0&&a;)o!==0&&(A===0||!a||s.z<=a.z)?(e=s,s=s.nextZ,o--):(e=a,a=a.nextZ,A--),h?h.nextZ=e:t=e,e.prevZ=h,h=e;s=a}h.nextZ=null,i*=2}while(n>1);return t}function Ay(t,e,r,i,n){return t=(t-r)*n|0,e=(e-i)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function JG(t){let e=t,r=t;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==t);return r}function Ac(t,e,r,i,n,s,o,a){return(n-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(i-a)>=(r-o)*(e-a)&&(r-o)*(s-a)>=(n-o)*(i-a)}function ZG(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!$G(t,e)&&(Eu(t,e)&&Eu(e,t)&&eW(t,e)&&(Ht(t.prev,t,e.prev)||Ht(t,e.prev,e))||kd(t,e)&&Ht(t.prev,t,t.next)>0&&Ht(e.prev,e,e.next)>0)}function Ht(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function kd(t,e){return t.x===e.x&&t.y===e.y}function j4(t,e,r,i){let n=Dd(Ht(t,e,r)),s=Dd(Ht(t,e,i)),o=Dd(Ht(r,i,t)),a=Dd(Ht(r,i,e));return!!(n!==s&&o!==a||n===0&&Nd(t,r,e)||s===0&&Nd(t,i,e)||o===0&&Nd(r,t,i)||a===0&&Nd(r,e,i))}function Nd(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Dd(t){return t>0?1:t<0?-1:0}function $G(t,e){let r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&j4(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}function Eu(t,e){return Ht(t.prev,t,t.next)<0?Ht(t,e,t.next)>=0&&Ht(t,t.prev,e)>=0:Ht(t,e,t.prev)<0||Ht(t,t.next,e)<0}function eW(t,e){let r=t,i=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do r.y>s!=r.next.y>s&&r.next.y!==r.y&&n<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;while(r!==t);return i}function X4(t,e){let r=new wu(t.i,t.x,t.y),i=new wu(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,s.next=i,i.prev=s,i}function G4(t,e,r,i){let n=new wu(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function vu(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}var wu=class{constructor(e,r,i){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=e,this.x=r,this.y=i}};function Jr(t,e){let r=e.length,i=t.length;if(i>0){let n=!0;for(let s=0;s<r;s++)if(t[i-r+s]!==e[s]){n=!1;break}if(n)return!1}for(let n=0;n<r;n++)t[i+n]=e[n];return!0}function Cu(t,e){let r=e.length;for(let i=0;i<r;i++)t[i]=e[i]}function Ns(t,e,r,i,n=[]){let s=i+e*r;for(let o=0;o<r;o++)n[o]=t[s+o];return n}function Ud(t,e,r,i,n=[]){let s,o;if(r&8)s=(i[3]-t[1])/(e[1]-t[1]),o=3;else if(r&4)s=(i[1]-t[1])/(e[1]-t[1]),o=1;else if(r&2)s=(i[2]-t[0])/(e[0]-t[0]),o=2;else if(r&1)s=(i[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)n[a]=(o&1)===a?i[o]:s*(e[a]-t[a])+t[a];return n}function Su(t,e){let r=0;return t[0]<e[0]?r|=1:t[0]>e[2]&&(r|=2),t[1]<e[1]?r|=4:t[1]>e[3]&&(r|=8),r}function Mu(t,e){let{size:r=2,broken:i=!1,gridResolution:n=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},A=(a-o)/r,h=[],g=[h],_=Ns(t,0,r,o),b,T,v=q4(_,n,s,[]),C=[];Jr(h,_);for(let S=1;S<A;S++){for(b=Ns(t,S,r,o,b),T=Su(b,v);T;){Ud(_,b,T,v,C);let P=Su(C,v);P&&(Ud(_,C,P,v,C),T=P),Jr(h,C),Cu(_,C),rW(v,n,T),i&&h.length>r&&(h=[],g.push(h),Jr(h,_)),T=Su(b,v)}Jr(h,b),Cu(_,b)}return i?g:g[0]}var Y4=0,tW=1;function Pu(t,e=null,r){if(!t.length)return[];let{size:i=2,gridResolution:n=10,gridOffset:s=[0,0],edgeTypes:o=!1}=r||{},a=[],A=[{pos:t,types:o?new Array(t.length/i).fill(tW):null,holes:e||[]}],h=[[],[]],g=[];for(;A.length;){let{pos:_,types:b,holes:T}=A.shift();iW(_,i,T[0]||_.length,h),g=q4(h[0],n,s,g);let v=Su(h[1],g);if(v){let C=Q4(_,b,i,0,T[0]||_.length,g,v),S={pos:C[0].pos,types:C[0].types,holes:[]},P={pos:C[1].pos,types:C[1].types,holes:[]};A.push(S,P);for(let F=0;F<T.length;F++)C=Q4(_,b,i,T[F],T[F+1]||_.length,g,v),C[0]&&(S.holes.push(S.pos.length),S.pos=Vd(S.pos,C[0].pos),o&&(S.types=Vd(S.types,C[0].types))),C[1]&&(P.holes.push(P.pos.length),P.pos=Vd(P.pos,C[1].pos),o&&(P.types=Vd(P.types,C[1].types)))}else{let C={positions:_};o&&(C.edgeTypes=b),T.length&&(C.holeIndices=T),a.push(C)}}return a}function Q4(t,e,r,i,n,s,o){let a=(n-i)/r,A=[],h=[],g=[],_=[],b=[],T,v,C,S=Ns(t,a-1,r,i),P=Math.sign(o&8?S[1]-s[3]:S[0]-s[2]),F=e&&e[a-1],I=0,k=0;for(let W=0;W<a;W++)T=Ns(t,W,r,i,T),v=Math.sign(o&8?T[1]-s[3]:T[0]-s[2]),C=e&&e[i/r+W],v&&P&&P!==v&&(Ud(S,T,o,s,b),Jr(A,b)&&g.push(F),Jr(h,b)&&_.push(F)),v<=0?(Jr(A,T)&&g.push(C),I-=v):g.length&&(g[g.length-1]=Y4),v>=0?(Jr(h,T)&&_.push(C),k+=v):_.length&&(_[_.length-1]=Y4),Cu(S,T),P=v,F=C;return[I?{pos:A,types:e&&g}:null,k?{pos:h,types:e&&_}:null]}function q4(t,e,r,i){let n=Math.floor((t[0]-r[0])/e)*e+r[0],s=Math.floor((t[1]-r[1])/e)*e+r[1];return i[0]=n,i[1]=s,i[2]=n+e,i[3]=s+e,i}function rW(t,e,r){r&8?(t[1]+=e,t[3]+=e):r&4?(t[1]-=e,t[3]-=e):r&2?(t[0]+=e,t[2]+=e):r&1&&(t[0]-=e,t[2]-=e)}function iW(t,e,r,i){let n=1/0,s=-1/0,o=1/0,a=-1/0;for(let A=0;A<r;A+=e){let h=t[A],g=t[A+1];n=h<n?h:n,s=h>s?h:s,o=g<o?g:o,a=g>a?g:a}return i[0][0]=n,i[0][1]=o,i[1][0]=s,i[1][1]=a,i}function Vd(t,e){for(let r=0;r<e.length;r++)t.push(e[r]);return t}var nW=85.051129;function fy(t,e){let{size:r=2,startIndex:i=0,endIndex:n=t.length,normalize:s=!0}=e||{},o=t.slice(i,n);K4(o,r,0,n-i);let a=Mu(o,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(let A of a)J4(A,r);return a}function hy(t,e=null,r){let{size:i=2,normalize:n=!0,edgeTypes:s=!1}=r||{};e=e||[];let o=[],a=[],A=0,h=0;for(let _=0;_<=e.length;_++){let b=e[_]||t.length,T=h,v=sW(t,i,A,b);for(let C=v;C<b;C++)o[h++]=t[C];for(let C=A;C<v;C++)o[h++]=t[C];K4(o,i,T,h),oW(o,i,T,h,r?.maxLatitude),A=b,a[_]=h}a.pop();let g=Pu(o,a,{size:i,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(n)for(let _ of g)J4(_.positions,i);return g}function sW(t,e,r,i){let n=-1,s=-1;for(let o=r+1;o<i;o+=e){let a=Math.abs(t[o]);a>n&&(n=a,s=o-1)}return s}function oW(t,e,r,i,n=nW){let s=t[r],o=t[i-e];if(Math.abs(s-o)>180){let a=Ns(t,0,e,r);a[0]+=Math.round((o-s)/360)*360,Jr(t,a),a[1]=Math.sign(a[1])*n,Jr(t,a),a[0]=s,Jr(t,a)}}function K4(t,e,r,i){let n=t[0],s;for(let o=r;o<i;o+=e){s=t[o];let a=s-n;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=n=s}}function J4(t,e){let r,i=t.length/e;for(let s=0;s<i&&(r=t[s*e],(r+180)%360===0);s++);let n=-Math.round(r/360)*360;if(n!==0)for(let s=0;s<i;s++)t[s*e]+=n}var Ru=class extends ut{constructor(e){let{indices:r,attributes:i}=cW(e);super({...e,indices:r,attributes:i})}};function cW(t){let{radius:e,height:r=1,nradial:i=10}=t,{vertices:n}=t;n&&(me.assert(n.length>=i),n=n.flatMap(T=>[T[0],T[1]]),zo(n,lc.COUNTER_CLOCKWISE));let s=r>0,o=i+1,a=s?o*3+1:i,A=Math.PI*2/i,h=new Uint16Array(s?i*3*2:0),g=new Float32Array(a*3),_=new Float32Array(a*3),b=0;if(s){for(let T=0;T<o;T++){let v=T*A,C=T%i,S=Math.sin(v),P=Math.cos(v);for(let F=0;F<2;F++)g[b+0]=n?n[C*2]:P*e,g[b+1]=n?n[C*2+1]:S*e,g[b+2]=(1/2-F)*r,_[b+0]=n?n[C*2]:P,_[b+1]=n?n[C*2+1]:S,b+=3}g[b+0]=g[b-3],g[b+1]=g[b-2],g[b+2]=g[b-1],b+=3}for(let T=s?0:1;T<o;T++){let v=Math.floor(T/2)*Math.sign(.5-T%2),C=v*A,S=(v+i)%i,P=Math.sin(C),F=Math.cos(C);g[b+0]=n?n[S*2]:F*e,g[b+1]=n?n[S*2+1]:P*e,g[b+2]=r/2,_[b+2]=1,b+=3}if(s){let T=0;for(let v=0;v<i;v++)h[T++]=v*2+0,h[T++]=v*2+2,h[T++]=v*2+0,h[T++]=v*2+1,h[T++]=v*2+1,h[T++]=v*2+3}return{indices:h,attributes:{POSITION:{size:3,value:g},NORMAL:{size:3,value:_}}}}var Z4=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,$4={name:"column",vs:Z4,fs:Z4,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}};var eM=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var tM=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var zd=[0,0,0,255],lW={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:zd},getLineColor:{type:"accessor",value:zd},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Iu=class extends xt{getShaders(){let e={},{flatShading:r}=this.props;return r&&(e.FLAT_SHADING=1),super.getShaders({vs:eM,fs:tM,defines:e,modules:[et,r?Da:Es,Pt,$4]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:zd},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:zd},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,s=n.extensionsChanged||r.flatShading!==i.flatShading;s&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(s||r.diskResolution!==i.diskResolution||r.vertices!==i.vertices||(r.extruded||r.stroked)!==(i.extruded||i.stroked))&&this._updateGeometry(r)}getGeometry(e,r,i){let n=new Ru({radius:1,height:i?2:0,vertices:r,nradial:e}),s=0;if(r)for(let o=0;o<e;o++){let a=r[o],A=Math.sqrt(a[0]*a[0]+a[1]*a[1]);s+=A/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),n}_getModels(){let e=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),i=new je(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),n=new je(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:i,wireframeModel:n,models:[n,i]}}_updateGeometry({diskResolution:e,vertices:r,extruded:i,stroked:n}){let s=this.getGeometry(e,r,i||n);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});let o=this.state.fillModel,a=this.state.wireframeModel;o.setGeometry(s),o.setTopology("triangle-strip"),o.setIndexBuffer(null),a.setGeometry(s),a.setTopology("line-list")}draw({uniforms:e}){let{lineWidthUnits:r,lineWidthScale:i,lineWidthMinPixels:n,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:A,filled:h,stroked:g,wireframe:_,offset:b,coverage:T,radius:v,angle:C}=this.props,S=this.state.fillModel,P=this.state.wireframeModel,{fillVertexCount:F,edgeDistance:I}=this.state,k={radius:v,angle:C/180*Math.PI,offset:b,extruded:A,stroked:g,coverage:T,elevationScale:a,edgeDistance:I,radiusUnits:Ut[o],widthUnits:Ut[r],widthScale:i,widthMinPixels:n,widthMaxPixels:s};A&&_&&(P.shaderInputs.setProps({column:{...k,isStroke:!0}}),P.draw(this.context.renderPass)),h&&(S.setVertexCount(F),S.shaderInputs.setProps({column:{...k,isStroke:!1}}),S.draw(this.context.renderPass)),!A&&g&&(S.setVertexCount(F*2/3),S.shaderInputs.setProps({column:{...k,isStroke:!0}}),S.draw(this.context.renderPass))}};Iu.layerName="ColumnLayer";Iu.defaultProps=lW;var bn=Iu;var AW={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},Bu=class extends bn{_updateGeometry(){let e=new Bo;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{elevationScale:r,extruded:i,offset:n,coverage:s,cellSize:o,angle:a,radiusUnits:A}=this.props,h=this.state.fillModel,g={radius:o/2,radiusUnits:Ut[A],angle:a,offset:n,extruded:i,stroked:!1,coverage:s,elevationScale:r,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};h.shaderInputs.setProps({column:g}),h.draw(this.context.renderPass)}};Bu.layerName="GridCellLayer";Bu.defaultProps=AW;var rM=Bu;function iM(t,e,r,i){let n;if(Array.isArray(t[0])){let s=t.length*e;n=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)n[o*e+a]=t[o][a]||0}else n=t;return r?Mu(n,{size:e,gridResolution:r}):i?fy(n,{size:e}):n}var uW=1,fW=2,dy=4,Ou=class extends Fs{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?iM(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(nM(e)){let i=0;for(let n of e)i+=this.getGeometrySize(n);return i}let r=this.getPathLength(e);return r<2?0:this.isClosed(e)?r<3?0:r+2:r}updateGeometryAttributes(e,r){if(r.geometrySize!==0)if(e&&nM(e))for(let i of e){let n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n}else this._updateSegmentTypes(e,r),this._updatePositions(e,r)}_updateSegmentTypes(e,r){let i=this.attributes.segmentTypes,n=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=r;i.fill(0,s,s+o),n?(i[s]=dy,i[s+o-2]=dy):(i[s]+=uW,i[s+o-2]+=fW),i[s+o-1]=dy}_updatePositions(e,r){let{positions:i}=this.attributes;if(!i||!e)return;let{vertexStart:n,geometrySize:s}=r,o=new Array(3);for(let a=n,A=0;A<s;a++,A++)this.getPointOnPath(e,A,o),i[a*3]=o[0],i[a*3+1]=o[1],i[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,r,i=[]){let{positionSize:n}=this;r*n>=e.length&&(r+=1-e.length/n);let s=r*n;return i[0]=e[s],i[1]=e[s+1],i[2]=n===3&&e[s+2]||0,i}isClosed(e){if(!this.normalize)return!!this.opts.loop;let{positionSize:r}=this,i=e.length-r;return e[0]===e[i]&&e[1]===e[i+1]&&(r===2||e[2]===e[i+2])}};function nM(t){return Array.isArray(t[0])}var sM=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,oM={name:"path",vs:sM,fs:sM,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}};var aM=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var cM=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var lM=[0,0,0,255],hW={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:lM},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},py={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Fu=class extends xt{getShaders(){return super.getShaders({vs:aM,fs:cM,modules:[et,Pt,oM]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:py,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:py,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:py,defaultValue:lM},instancePickingColors:{size:4,type:"uint8",accessor:(i,{index:n,target:s})=>this.encodePickingColor(i&&i.__source?i.__source.index:n,s)}}),this.setState({pathTesselator:new Ou({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);let{props:r,changeFlags:i}=e,n=this.getAttributeManager();if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPath)){let{pathTesselator:o}=this.state,a=r.data.attributes||{};o.updateGeometry({data:r.data,geometryBuffer:a.getPath,buffers:a,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:i.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),i.dataChanged||n.invalidateAll()}i.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),n.invalidateAll())}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(s=>s.__source.index===i)),r}disablePickingIndex(e){let r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{jointRounded:r,capRounded:i,billboard:n,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:A,widthMaxPixels:h}=this.props,g=this.state.model,_={jointType:Number(r),capType:Number(i),billboard:n,widthUnits:Ut[o],widthScale:a,miterLimit:s,widthMinPixels:A,widthMaxPixels:h};g.shaderInputs.setProps({path:_}),g.draw(this.context.renderPass)}_getModel(){let e=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ut({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){let{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateSegmentTypes(e){let{pathTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("segmentTypes")}};Fu.defaultProps=hW;Fu.layerName="PathLayer";var Tn=Fu;var yM=_a(dM(),1);var Xd=lc.CLOCKWISE,pM=lc.COUNTER_CLOCKWISE,Ds={isClosed:!0};function PW(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function fc(t){return"positions"in t?t.positions:t}function ku(t){return"holeIndices"in t?t.holeIndices:null}function RW(t){return Array.isArray(t[0])}function IW(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function BW(t){let e=t[0],r=t[t.length-1];return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function OW(t,e,r,i){for(let n=0;n<e;n++)if(t[r+n]!==t[i-e+n])return!1;return!0}function gM(t,e,r,i,n){let s=e,o=r.length;for(let a=0;a<o;a++)for(let A=0;A<i;A++)t[s++]=r[a][A]||0;if(!BW(r))for(let a=0;a<i;a++)t[s++]=r[0][a]||0;return Ds.start=e,Ds.end=s,Ds.size=i,zo(t,n,Ds),s}function mM(t,e,r,i,n=0,s,o){s=s||r.length;let a=s-n;if(a<=0)return e;let A=e;for(let h=0;h<a;h++)t[A++]=r[n+h];if(!OW(r,i,n,s))for(let h=0;h<i;h++)t[A++]=r[n+h];return Ds.start=e,Ds.end=A,Ds.size=i,zo(t,o,Ds),A}function Yd(t,e){PW(t);let r=[],i=[];if("positions"in t){let{positions:n,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=mM(r,o,n,e,s[a-1],s[a],a===0?Xd:pM),i.push(o);return i.pop(),{positions:r,holeIndices:i}}t=n}if(!RW(t))return mM(r,0,t,e,0,r.length,Xd),r;if(!IW(t)){let n=0;for(let[s,o]of t.entries())n=gM(r,n,o,e,s===0?Xd:pM),i.push(n);return i.pop(),{positions:r,holeIndices:i}}return gM(r,0,t,e,Xd),r}function xy(t,e,r){let i=t.length/3,n=0;for(let s=0;s<i;s++){let o=(s+1)%i;n+=t[s*3+e]*t[o*3+r],n-=t[o*3+e]*t[s*3+r]}return Math.abs(n/2)}function _M(t,e,r,i){let n=t.length/3;for(let s=0;s<n;s++){let o=s*3,a=t[o+0],A=t[o+1],h=t[o+2];t[o+e]=a,t[o+r]=A,t[o+i]=h}}function xM(t,e,r,i){let n=ku(t);n&&(n=n.map(a=>a/e));let s=fc(t),o=i&&e===3;if(r){let a=s.length;s=s.slice();let A=[];for(let h=0;h<a;h+=e){A[0]=s[h],A[1]=s[h+1],o&&(A[2]=s[h+2]);let g=r(A);s[h]=g[0],s[h+1]=g[1],o&&(s[h+2]=g[2])}}if(o){let a=xy(s,0,1),A=xy(s,0,2),h=xy(s,1,2);if(!a&&!A&&!h)return[];a>A&&a>h||(A>h?(r||(s=s.slice()),_M(s,0,2,1)):(r||(s=s.slice()),_M(s,2,0,1)))}return(0,yM.default)(s,n,e)}var Uu=class extends Fs{constructor(e){let{fp64:r,IndexType:i=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:i,size:1}}})}get(e){let{attributes:r}=this;return e==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[e]}updateGeometry(e){super.updateGeometry(e);let r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){let r=Yd(e,this.positionSize);return this.opts.resolution?Pu(fc(r),ku(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?hy(fc(r),ku(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return e}getGeometrySize(e){if(TM(e)){let r=0;for(let i of e)r+=this.getGeometrySize(i);return r}return fc(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,r){if(e&&TM(e))for(let i of e){let n=this.getGeometrySize(i);r.geometrySize=n,this.updateGeometryAttributes(i,r),r.vertexStart+=n,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{let i=e;this._updateIndices(i,r),this._updatePositions(i,r),this._updateVertexValid(i,r)}}_updateIndices(e,{geometryIndex:r,vertexStart:i,indexStart:n}){let{attributes:s,indexStarts:o,typedArrayManager:a}=this,A=s.indices;if(!A||!e)return;let h=n,g=xM(e,this.positionSize,this.opts.preproject,this.opts.full3d);A=a.allocate(A,n+g.length,{copy:!0});for(let _=0;_<g.length;_++)A[h++]=g[_]+i;o[r+1]=n+g.length,s.indices=A}_updatePositions(e,{vertexStart:r,geometrySize:i}){let{attributes:{positions:n},positionSize:s}=this;if(!n||!e)return;let o=fc(e);for(let a=r,A=0;A<i;a++,A++){let h=o[A*s],g=o[A*s+1],_=s>2?o[A*s+2]:0;n[a*3]=h,n[a*3+1]=g,n[a*3+2]=_}}_updateVertexValid(e,{vertexStart:r,geometrySize:i}){let{positionSize:n}=this,s=this.attributes.vertexValid,o=e&&ku(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,r):s.fill(1,r,r+i),o)for(let a=0;a<o.length;a++)s[r+o[a]/n-1]=0;s[r+i-1]=0}};function TM(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}var EM=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,vM={name:"solidPolygon",vs:EM,fs:EM,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}};var Qd=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var wM=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${Qd}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`;var CM=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${Qd}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`;var SM=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var Kd=[0,0,0,255],FW={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Kd},getLineColor:{type:"accessor",value:Kd},material:!0},qd={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Vu=class extends xt{getShaders(e){return super.getShaders({vs:e==="top"?wM:CM,fs:SM,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[et,Es,Pt,vM]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let{viewport:e}=this.context,{coordinateSystem:r}=this.props,{_full3d:i}=this.props;e.isGeospatial&&r===Se.DEFAULT&&(r=Se.LNGLAT);let n;r===Se.LNGLAT&&(i?n=e.projectPosition.bind(e):n=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new Uu({preproject:n,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:qd,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:qd,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:qd,accessor:"getFillColor",defaultValue:Kd},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:qd,accessor:"getLineColor",defaultValue:Kd},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:A,target:h})=>this.encodePickingColor(a&&a.__source?a.__source.index:A,h)}})}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i}=r,n=this.props.data;return n[0]&&n[0].__source&&(r.object=n.find(s=>s.__source.index===i)),r}disablePickingIndex(e){let r=this.props.data;if(r[0]&&r[0].__source)for(let i=0;i<r.length;i++)r[i].__source.index===e&&this._disablePickingIndex(i);else super.disablePickingIndex(e)}draw({uniforms:e}){let{extruded:r,filled:i,wireframe:n,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:A,polygonTesselator:h}=this.state,g={extruded:!!r,elevationScale:s,isWireframe:!1};A&&n&&(A.setInstanceCount(h.instanceCount-1),A.shaderInputs.setProps({solidPolygon:{...g,isWireframe:!0}}),A.draw(this.context.renderPass)),a&&i&&(a.setInstanceCount(h.instanceCount-1),a.shaderInputs.setProps({solidPolygon:g}),a.draw(this.context.renderPass)),o&&i&&(o.setVertexCount(h.vertexCount),o.shaderInputs.setProps({solidPolygon:g}),o.draw(this.context.renderPass))}updateState(e){super.updateState(e),this.updateGeometry(e);let{props:r,oldProps:i,changeFlags:n}=e,s=this.getAttributeManager();(n.extensionsChanged||r.filled!==i.filled||r.extruded!==i.extruded)&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:r,changeFlags:i}){if(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){let{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:i.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),i.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let{id:e,filled:r,extruded:i}=this.props,n,s,o;if(r){let a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;let A=this.getAttributeManager().getBufferLayouts({isInstanced:!1});n=new je(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:A,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(i){let a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new je(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new ut({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new je(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new ut({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,n].filter(Boolean),topModel:n,sideModel:s,wireframeModel:o}}calculateIndices(e){let{polygonTesselator:r}=this.state;e.startIndices=r.indexStarts,e.value=r.get("indices")}calculatePositions(e){let{polygonTesselator:r}=this.state;e.startIndices=r.vertexStarts,e.value=r.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};Vu.defaultProps=FW;Vu.layerName="SolidPolygonLayer";var ks=Vu;function Jd({data:t,getIndex:e,dataRange:r,replace:i}){let{startRow:n=0,endRow:s=1/0}=r,o=t.length,a=o,A=o;for(let b=0;b<o;b++){let T=e(t[b]);if(a>b&&T>=n&&(a=b),T>=s){A=b;break}}let h=a,_=A-a!==i.length?t.slice(A):void 0;for(let b=0;b<i.length;b++)t[h++]=i[b];if(_){for(let b=0;b<_.length;b++)t[h++]=_[b];t.length=h}return{startRow:a,endRow:a+i.length}}var MM=[0,0,0,255],LW=[0,0,0,255],NW={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:LW},getLineColor:{type:"accessor",value:MM},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},zu=class extends zt{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&me.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){let r=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(r&&Array.isArray(e.dataChanged)){let i=this.state.paths.slice(),n=e.dataChanged.map(s=>Jd({data:i,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:i,pathsDiff:n})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){let{data:r,getPolygon:i,positionFormat:n,_normalize:s}=this.props,o=[],a=n==="XY"?2:3,{startRow:A,endRow:h}=e,{iterable:g,objectInfo:_}=Yt(r,A,h);for(let b of g){_.index++;let T=i(b,_);s&&(T=Yd(T,a));let{holeIndices:v}=T,C=T.positions||T;if(v)for(let S=0;S<=v.length;S++){let P=C.slice(v[S-1]||0,v[S]||C.length);o.push(this.getSubLayerRow({path:P},b,_.index))}else o.push(this.getSubLayerRow({path:C},b,_.index))}return o}renderLayers(){let{data:e,_dataDiff:r,stroked:i,filled:n,extruded:s,wireframe:o,_normalize:a,_windingOrder:A,elevationScale:h,transitions:g,positionFormat:_}=this.props,{lineWidthUnits:b,lineWidthScale:T,lineWidthMinPixels:v,lineWidthMaxPixels:C,lineJointRounded:S,lineMiterLimit:P,lineDashJustified:F}=this.props,{getFillColor:I,getLineColor:k,getLineWidth:W,getLineDashArray:K,getElevation:re,getPolygon:Y,updateTriggers:z,material:L}=this.props,{paths:se,pathsDiff:le}=this.state,ce=this.getSubLayerClass("fill",ks),he=this.getSubLayerClass("stroke",Tn),Re=this.shouldRenderSubLayer("fill",se)&&new ce({_dataDiff:r,extruded:s,elevationScale:h,filled:n,wireframe:o,_normalize:a,_windingOrder:A,getElevation:re,getFillColor:I,getLineColor:s&&o?k:MM,material:L,transitions:g},this.getSubLayerProps({id:"fill",updateTriggers:z&&{getPolygon:z.getPolygon,getElevation:z.getElevation,getFillColor:z.getFillColor,lineColors:s&&o,getLineColor:z.getLineColor}}),{data:e,positionFormat:_,getPolygon:Y}),Ke=!s&&i&&this.shouldRenderSubLayer("stroke",se)&&new he({_dataDiff:le&&(()=>le),widthUnits:b,widthScale:T,widthMinPixels:v,widthMaxPixels:C,jointRounded:S,miterLimit:P,dashJustified:F,_pathType:"loop",transitions:g&&{getWidth:g.getLineWidth,getColor:g.getLineColor,getPath:g.getPolygon},getColor:this.getSubLayerAccessor(k),getWidth:this.getSubLayerAccessor(W),getDashArray:this.getSubLayerAccessor(K)},this.getSubLayerProps({id:"stroke",updateTriggers:z&&{getWidth:z.getLineWidth,getColor:z.getLineColor,getDashArray:z.getLineDashArray}}),{data:se,positionFormat:_,getPath:Ye=>Ye.path});return[!s&&Re,Ke,s&&Re]}};zu.layerName="PolygonLayer";zu.defaultProps=NW;var Us=zu;function PM(t,e){if(!t)return null;let r="startIndices"in t?t.startIndices[e]:e,i=t.featureIds.value[r];return r!==-1?DW(t,i,r):null}function DW(t,e,r){let i={properties:{...t.properties[e]}};for(let n in t.numericProps)i.properties[n]=t.numericProps[n].value[r];return i}function RM(t,e){let r={points:null,lines:null,polygons:null};for(let i in r){let n=t[i].globalFeatureIds.value;r[i]=new Uint8ClampedArray(n.length*4);let s=[];for(let o=0;o<n.length;o++)e(n[o],s),r[i][o*4+0]=s[0],r[i][o*4+1]=s[1],r[i][o*4+2]=s[2],r[i][o*4+3]=255}return r}var IM=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,BM={name:"sdf",vs:IM,fs:IM,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}};var OM=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var by=192/256,FM=[],kW={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},Hu=class extends cc{getShaders(){let e=super.getShaders();return{...e,modules:[...e.modules,BM],fs:OM}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:i,target:n})=>this.encodePickingColor(i,n)}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,{outlineColor:n}=r;n!==i.outlineColor&&(n=n.map(s=>s/255),n[3]=Number.isFinite(n[3])?n[3]:1,this.setState({outlineColor:n})),!r.sdf&&r.outlineWidth&&me.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){let{sdf:r,smoothing:i,outlineWidth:n}=this.props,{outlineColor:s}=this.state,o=n?Math.max(i,by*(1-n)):-1,a=this.state.model,A={buffer:by,outlineBuffer:o,gamma:i,enabled:!!r,outlineColor:s};if(a.shaderInputs.setProps({sdf:A}),super.draw(e),r&&n){let{iconManager:h}=this.state;h.getTexture()&&(a.shaderInputs.setProps({sdf:{...A,outlineBuffer:by}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(r=>super.getInstanceOffset(r)):FM}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(r=>super.getInstanceIconFrame(r)):FM}};Hu.defaultProps=kW;Hu.layerName="MultiIconLayer";var Zd=Hu;var Gu=class{constructor({fontSize:e=24,buffer:r=3,radius:i=8,cutoff:n=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=r,this.cutoff=n,this.radius=i;let A=this.size=e+r*4,h=this._createCanvas(A),g=this.ctx=h.getContext("2d",{willReadFrequently:!0});g.font=`${a} ${o} ${e}px ${s}`,g.textBaseline="alphabetic",g.textAlign="left",g.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(e){let r=document.createElement("canvas");return r.width=r.height=e,r}draw(e){let{width:r,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(i),A=0,h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),g=Math.min(this.size-this.buffer,a+Math.ceil(n)),_=h+2*this.buffer,b=g+2*this.buffer,T=Math.max(_*b,0),v=new Uint8ClampedArray(T),C={data:v,width:_,height:b,glyphWidth:h,glyphHeight:g,glyphTop:a,glyphLeft:A,glyphAdvance:r};if(h===0||g===0)return C;let{ctx:S,buffer:P,gridInner:F,gridOuter:I}=this;S.clearRect(P,P,h,g),S.fillText(e,P,P+a);let k=S.getImageData(P,P,h,g);I.fill(1e20,0,T),F.fill(0,0,T);for(let W=0;W<g;W++)for(let K=0;K<h;K++){let re=k.data[4*(W*h+K)+3]/255;if(re===0)continue;let Y=(W+P)*_+K+P;if(re===1)I[Y]=0,F[Y]=1e20;else{let z=.5-re;I[Y]=z>0?z*z:0,F[Y]=z<0?z*z:0}}LM(I,0,0,_,b,_,this.f,this.v,this.z),LM(F,P,P,h,g,_,this.f,this.v,this.z);for(let W=0;W<T;W++){let K=Math.sqrt(I[W])-Math.sqrt(F[W]);v[W]=Math.round(255-255*(K/this.radius+this.cutoff))}return C}};function LM(t,e,r,i,n,s,o,a,A){for(let h=e;h<e+i;h++)NM(t,r*s+h,s,n,o,a,A);for(let h=r;h<r+n;h++)NM(t,h*s+e,1,i,o,a,A)}function NM(t,e,r,i,n,s,o){s[0]=0,o[0]=-1e20,o[1]=1e20,n[0]=t[e];for(let a=1,A=0,h=0;a<i;a++){n[a]=t[e+a*r];let g=a*a;do{let _=s[A];h=(n[a]-n[_]+g-_*_)/(a-_)/2}while(h<=o[A]&&--A>-1);A++,s[A]=a,o[A]=h,o[A+1]=1e20}for(let a=0,A=0;a<i;a++){for(;o[A+1]<a;)A++;let h=s[A],g=a-h;t[e+a*r]=n[h]+g*g}}var UW=32,VW=[];function zW(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function DM({characterSet:t,getFontWidth:e,fontHeight:r,buffer:i,maxCanvasWidth:n,mapping:s={},xOffset:o=0,yOffset:a=0}){let A=0,h=o,g=r+i*2;for(let _ of t)if(!s[_]){let b=e(_);h+b+i*2>n&&(h=0,A++),s[_]={x:h+i,y:a+A*g+i,width:b,height:g,layoutWidth:b,layoutHeight:r},h+=b+i*2}return{mapping:s,xOffset:h,yOffset:a+A*g,canvasHeight:zW(a+(A+1)*g)}}function kM(t,e,r,i){let n=0;for(let s=e;s<r;s++){let o=t[s];n+=i[o]?.layoutWidth||0}return n}function UM(t,e,r,i,n,s){let o=e,a=0;for(let A=e;A<r;A++){let h=kM(t,A,A+1,n);a+h>i&&(o<A&&s.push(A),o=A,a=0),a+=h}return a}function HW(t,e,r,i,n,s){let o=e,a=e,A=e,h=0;for(let g=e;g<r;g++)if((t[g]===" "||t[g+1]===" "||g+1===r)&&(A=g+1),A>a){let _=kM(t,a,A,n);h+_>i&&(o<a&&(s.push(a),o=a,h=0),_>i&&(_=UM(t,a,A,i,n,s),o=s[s.length-1])),a=A,h+=_}return h}function GW(t,e,r,i,n=0,s){s===void 0&&(s=t.length);let o=[];return e==="break-all"?UM(t,n,s,r,i,o):HW(t,n,s,r,i,o),o}function WW(t,e,r,i,n,s){let o=0,a=0;for(let A=e;A<r;A++){let h=t[A],g=i[h];g?(a||(a=g.layoutHeight),n[A]=o+g.layoutWidth/2,o+=g.layoutWidth):(me.warn(`Missing character: ${h} (${h.codePointAt(0)})`)(),n[A]=o,o+=UW)}s[0]=o,s[1]=a}function VM(t,e,r,i,n){let s=Array.from(t),o=s.length,a=new Array(o),A=new Array(o),h=new Array(o),g=(r==="break-word"||r==="break-all")&&isFinite(i)&&i>0,_=[0,0],b=[0,0],T=0,v=0,C=0;for(let S=0;S<=o;S++){let P=s[S];if((P===`
`||S===o)&&(C=S),C>v){let F=g?GW(s,r,i,n,v,C):VW;for(let I=0;I<=F.length;I++){let k=I===0?v:F[I-1],W=I<F.length?F[I]:C;WW(s,k,W,n,a,b);for(let K=k;K<W;K++){let re=s[K],Y=n[re]?.layoutOffsetY||0;A[K]=T+b[1]/2+Y,h[K]=b[0]}T=T+b[1]*e,_[0]=Math.max(_[0],b[0])}v=C}P===`
`&&(a[v]=0,A[v]=0,h[v]=0,v++)}return _[1]=T,{x:a,y:A,rowWidth:h,size:_}}function zM({value:t,length:e,stride:r,offset:i,startIndices:n,characterSet:s}){let o=t.BYTES_PER_ELEMENT,a=r?r/o:1,A=i?i/o:0,h=n[e]||Math.ceil((t.length-A)/a),g=s&&new Set,_=new Array(e),b=t;if(a>1||A>0){let T=t.constructor;b=new T(h);for(let v=0;v<h;v++)b[v]=t[v*a+A]}for(let T=0;T<e;T++){let v=n[T],C=n[T+1]||h,S=b.subarray(v,C);_[T]=String.fromCodePoint.apply(null,S),g&&S.forEach(g.add,g)}if(g)for(let T of g)s.add(String.fromCodePoint(T));return{texts:_,characterCount:h}}var hc=class{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){let r=this._cache[e];return r&&(this._deleteOrder(e),this._appendOrder(e)),r}set(e,r){this._cache[e]?(this.delete(e),this._cache[e]=r,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=r,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){let r=this._order.indexOf(e);r>=0&&this._order.splice(r,1)}_appendOrder(e){this._order.push(e)}};function jW(){let t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}var Wo={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:jW(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},HM=1024,GM=.9,WM=1.2,XM=3,$d=new hc(XM);function XW(t,e){let r;typeof e=="string"?r=new Set(Array.from(e)):r=new Set(e);let i=$d.get(t);if(!i)return r;for(let n in i.mapping)r.has(n)&&r.delete(n);return r}function YW(t,e){for(let r=0;r<t.length;r++)e.data[4*r+3]=t[r]}function jM(t,e,r,i){t.font=`${i} ${r}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function YM(t){me.assert(Number.isFinite(t)&&t>=XM,"Invalid cache limit"),$d=new hc(t)}var Wu=class{constructor(){this.props={...Wo}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:e,buffer:r}=this.props;return(e*WM+r*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();let r=XW(this._key,this.props.characterSet),i=$d.get(this._key);if(i&&r.size===0){this._atlas!==i&&(this._atlas=i);return}let n=this._generateFontAtlas(r,i);this._atlas=n,$d.set(this._key,n)}_generateFontAtlas(e,r){let{fontFamily:i,fontWeight:n,fontSize:s,buffer:o,sdf:a,radius:A,cutoff:h}=this.props,g=r&&r.data;g||(g=document.createElement("canvas"),g.width=HM);let _=g.getContext("2d",{willReadFrequently:!0});jM(_,i,s,n);let{mapping:b,canvasHeight:T,xOffset:v,yOffset:C}=DM({getFontWidth:S=>_.measureText(S).width,fontHeight:s*WM,buffer:o,characterSet:e,maxCanvasWidth:HM,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(g.height!==T){let S=_.getImageData(0,0,g.width,g.height);g.height=T,_.putImageData(S,0,0)}if(jM(_,i,s,n),a){let S=new Gu({fontSize:s,buffer:o,radius:A,cutoff:h,fontFamily:i,fontWeight:`${n}`});for(let P of e){let{data:F,width:I,height:k,glyphTop:W}=S.draw(P);b[P].width=I,b[P].layoutOffsetY=s*GM-W;let K=_.createImageData(I,k);YW(F,K),_.putImageData(K,b[P].x,b[P].y)}}else for(let S of e)_.fillText(S,b[S].x,b[S].y+o+s*GM);return{xOffset:v,yOffset:C,mapping:b,data:g,width:g.width,height:g.height}}_getKey(){let{fontFamily:e,fontWeight:r,fontSize:i,buffer:n,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${r} ${i} ${n} ${o} ${a}`:`${e} ${r} ${i} ${n}`}};var QM=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,qM={name:"textBackground",vs:QM,fs:QM,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}};var KM=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var JM=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var QW={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},ju=class extends xt{getShaders(){return super.getShaders({vs:KM,fs:JM,modules:[et,Pt,qM]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);let{changeFlags:r}=e;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{billboard:r,sizeScale:i,sizeUnits:n,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props,{padding:A}=this.props;A.length<4&&(A=[A[0],A[1],A[0],A[1]]);let h=this.state.model,g={billboard:r,stroked:!!a,padding:A,sizeUnits:Ut[n],sizeScale:i,sizeMinPixels:s,sizeMaxPixels:o};h.shaderInputs.setProps({textBackground:g}),h.draw(this.context.renderPass)}_getModel(){let e=[0,0,1,0,0,1,1,1];return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ut({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};ju.defaultProps=QW;ju.layerName="TextBackgroundLayer";var ep=ju;var ZM={start:1,middle:0,end:-1},$M={top:1,center:0,bottom:-1},Ty=[0,0,0,255],qW=1,KW={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:Ty},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Wo.characterSet},fontFamily:Wo.fontFamily,fontWeight:Wo.fontWeight,lineHeight:qW,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:Ty},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:Ty},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},Xu=class extends zt{constructor(){super(...arguments),this.getBoundingRect=(e,r)=>{let{size:[i,n]}=this.transformParagraph(e,r),{fontSize:s}=this.state.fontAtlasManager.props;i/=s,n/=s;let{getTextAnchor:o,getAlignmentBaseline:a}=this.props,A=ZM[typeof o=="function"?o(e,r):o],h=$M[typeof a=="function"?a(e,r):a];return[(A-1)*i/2,(h-1)*n/2,i,n]},this.getIconOffsets=(e,r)=>{let{getTextAnchor:i,getAlignmentBaseline:n}=this.props,{x:s,y:o,rowWidth:a,size:[A,h]}=this.transformParagraph(e,r),g=ZM[typeof i=="function"?i(e,r):i],_=$M[typeof n=="function"?n(e,r):n],b=s.length,T=new Array(b*2),v=0;for(let C=0;C<b;C++){let S=(1-g)*(A-a[C])/2;T[v++]=(g-1)*A/2+S+s[C],T[v++]=(_-1)*h/2+o[C]}return T}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Wu},this.props.maxWidth>0&&me.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){let{props:r,oldProps:i,changeFlags:n}=e;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==i.lineHeight||r.wordBreak!==i.wordBreak||r.maxWidth!==i.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){let{fontSettings:e,fontFamily:r,fontWeight:i}=this.props,{fontAtlasManager:n,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:r,fontWeight:i};if(!n.mapping)return n.setProps(o),!0;for(let a in o)if(o[a]!==n.props[a])return n.setProps(o),!0;return!1}_updateText(){let{data:e,characterSet:r}=this.props,i=e.attributes?.getText,{getText:n}=this.props,s=e.startIndices,o,a=r==="auto"&&new Set;if(i&&s){let{texts:A,characterCount:h}=zM({...ArrayBuffer.isView(i)?{value:i}:i,length:e.length,startIndices:s,characterSet:a});o=h,n=(g,{index:_})=>A[_]}else{let{iterable:A,objectInfo:h}=Yt(e);s=[0],o=0;for(let g of A){h.index++;let _=Array.from(n(g,h)||"");a&&_.forEach(a.add,a),o+=_.length,s.push(o)}}this.setState({getText:n,startIndices:s,numInstances:o,characterSet:a||r})}transformParagraph(e,r){let{fontAtlasManager:i}=this.state,n=i.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:A}=this.props,h=s(e,r)||"";return VM(h,a,o,A*i.props.fontSize,n)}renderLayers(){let{startIndices:e,numInstances:r,getText:i,fontAtlasManager:{scale:n,atlas:s,mapping:o},styleVersion:a}=this.state,{data:A,_dataDiff:h,getPosition:g,getColor:_,getSize:b,getAngle:T,getPixelOffset:v,getBackgroundColor:C,getBorderColor:S,getBorderWidth:P,backgroundPadding:F,background:I,billboard:k,fontSettings:W,outlineWidth:K,outlineColor:re,sizeScale:Y,sizeUnits:z,sizeMinPixels:L,sizeMaxPixels:se,transitions:le,updateTriggers:ce}=this.props,he=this.getSubLayerClass("characters",Zd),Re=this.getSubLayerClass("background",ep);return[I&&new Re({getFillColor:C,getLineColor:S,getLineWidth:P,padding:F,getPosition:g,getSize:b,getAngle:T,getPixelOffset:v,billboard:k,sizeScale:Y,sizeUnits:z,sizeMinPixels:L,sizeMaxPixels:se,transitions:le&&{getPosition:le.getPosition,getAngle:le.getAngle,getSize:le.getSize,getFillColor:le.getBackgroundColor,getLineColor:le.getBorderColor,getLineWidth:le.getBorderWidth,getPixelOffset:le.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ce.getPosition,getAngle:ce.getAngle,getSize:ce.getSize,getFillColor:ce.getBackgroundColor,getLineColor:ce.getBorderColor,getLineWidth:ce.getBorderWidth,getPixelOffset:ce.getPixelOffset,getBoundingRect:{getText:ce.getText,getTextAnchor:ce.getTextAnchor,getAlignmentBaseline:ce.getAlignmentBaseline,styleVersion:a}}}),{data:A.attributes&&A.attributes.background?{length:A.length,attributes:A.attributes.background}:A,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new he({sdf:W.sdf,smoothing:Number.isFinite(W.smoothing)?W.smoothing:Wo.smoothing,outlineWidth:K/(W.radius||Wo.radius),outlineColor:re,iconAtlas:s,iconMapping:o,getPosition:g,getColor:_,getSize:b,getAngle:T,getPixelOffset:v,billboard:k,sizeScale:Y*n,sizeUnits:z,sizeMinPixels:L*n,sizeMaxPixels:se*n,transitions:le&&{getPosition:le.getPosition,getAngle:le.getAngle,getColor:le.getColor,getSize:le.getSize,getPixelOffset:le.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ce.getText,getPosition:ce.getPosition,getAngle:ce.getAngle,getColor:ce.getColor,getSize:ce.getSize,getPixelOffset:ce.getPixelOffset,getIconOffsets:{getTextAnchor:ce.getTextAnchor,getAlignmentBaseline:ce.getAlignmentBaseline,styleVersion:a}}}),{data:A,_dataDiff:h,startIndices:e,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:i})]}static set fontAtlasCacheLimit(e){YM(e)}};Xu.defaultProps=KW;Xu.layerName="TextLayer";var tp=Xu;var Yu={circle:{type:Ld,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:cc,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:tp,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Qu={type:Tn,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},rp={type:ks,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function dc({type:t,props:e}){let r={};for(let i in e)r[i]=t.defaultProps[e[i]];return r}function ip(t,e){let{transitions:r,updateTriggers:i}=t.props,n={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(let s in e){let o=e[s],a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),n.updateTriggers[o]=i[s],r&&(n.transitions[o]=r[s])),n[o]=a}return n}function t5(t){if(Array.isArray(t))return t;switch(me.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return me.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function Ey(t,e,r={}){let i={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:n=0,endRow:s=t.length}=r;for(let o=n;o<s;o++){let a=t[o],{geometry:A}=a;if(A)if(A.type==="GeometryCollection"){me.assert(Array.isArray(A.geometries),"GeoJSON does not have geometries array");let{geometries:h}=A;for(let g=0;g<h.length;g++){let _=h[g];e5(_,i,e,a,o)}}else e5(A,i,e,a,o)}return i}function e5(t,e,r,i,n){let{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:A,polygonFeatures:h,polygonOutlineFeatures:g}=e;if(!ZW(s,o)){me.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":a.push(r({geometry:t},i,n));break;case"MultiPoint":o.forEach(_=>{a.push(r({geometry:{type:"Point",coordinates:_}},i,n))});break;case"LineString":A.push(r({geometry:t},i,n));break;case"MultiLineString":o.forEach(_=>{A.push(r({geometry:{type:"LineString",coordinates:_}},i,n))});break;case"Polygon":h.push(r({geometry:t},i,n)),o.forEach(_=>{g.push(r({geometry:{type:"LineString",coordinates:_}},i,n))});break;case"MultiPolygon":o.forEach(_=>{h.push(r({geometry:{type:"Polygon",coordinates:_}},i,n)),_.forEach(b=>{g.push(r({geometry:{type:"LineString",coordinates:b}},i,n))})});break;default:}}var JW={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function ZW(t,e){let r=JW[t];for(me.assert(r,`Unknown GeoJSON type ${t}`);e&&--r>0;)e=e[0];return e&&Number.isFinite(e[0])}function r5(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function np(t){return t.geometry.coordinates}function i5(t,e){let r=r5(),{pointFeatures:i,lineFeatures:n,polygonFeatures:s,polygonOutlineFeatures:o}=t;return r.points.data=i,r.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),r.points.getPosition=np,r.lines.data=n,r.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),r.lines.getPath=np,r.polygons.data=s,r.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),r.polygons.getPolygon=np,r.polygonsOutline.data=o,r.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),r.polygonsOutline.getPath=np,r}function n5(t,e){let r=r5(),{points:i,lines:n,polygons:s}=t,o=RM(t,e);return r.points.data={length:i.positions.value.length/i.positions.size,attributes:{...i.attributes,getPosition:i.positions,instancePickingColors:{size:4,value:o.points}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.lines.data={length:n.pathIndices.value.length-1,startIndices:n.pathIndices.value,attributes:{...n.attributes,getPath:n.positions,instancePickingColors:{size:4,value:o.lines}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines._pathType="open",r.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygons._normalize=!1,s.triangles&&(r.polygons.data.attributes.indices=s.triangles.value),r.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.polygonsOutline._pathType="open",r}var $W=["points","linestrings","polygons"],ej={...dc(Yu.circle),...dc(Yu.icon),...dc(Yu.text),...dc(Qu),...dc(rp),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},qu=class extends zt{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:r}){if(!r.dataChanged)return;let{data:i}=this.props,n=i&&"points"in i&&"polygons"in i&&"lines"in i;this.setState({binary:n}),n?this._updateStateBinary({props:e,changeFlags:r}):this._updateStateJSON({props:e,changeFlags:r})}_updateStateBinary({props:e,changeFlags:r}){let i=n5(e.data,this.encodePickingColor);this.setState({layerProps:i})}_updateStateJSON({props:e,changeFlags:r}){let i=t5(e.data),n=this.getSubLayerRow.bind(this),s={},o={};if(Array.isArray(r.dataChanged)){let A=this.state.features;for(let h in A)s[h]=A[h].slice(),o[h]=[];for(let h of r.dataChanged){let g=Ey(i,n,h);for(let _ in A)o[_].push(Jd({data:s[_],getIndex:b=>b.__source.index,dataRange:h,replace:g[_]}))}}else s=Ey(i,n);let a=i5(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){let r=super.getPickingInfo(e),{index:i,sourceLayer:n}=r;return r.featureType=$W.find(s=>n.id.startsWith(`${this.id}-${s}-`)),i>=0&&n.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[i]),r}_updateAutoHighlight(e){let r=`${this.id}-points-`,i=e.featureType==="points";for(let n of this.getSubLayers())n.id.startsWith(r)===i&&n.updateAutoHighlight(e)}_renderPolygonLayer(){let{extruded:e,wireframe:r}=this.props,{layerProps:i}=this.state,n="polygons-fill",s=this.shouldRenderSubLayer(n,i.polygons?.data)&&this.getSubLayerClass(n,rp.type);if(s){let o=ip(this,rp.props),a=e&&r;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:n,updateTriggers:o.updateTriggers}),i.polygons)}return null}_renderLineLayers(){let{extruded:e,stroked:r}=this.props,{layerProps:i}=this.state,n="polygons-stroke",s="linestrings",o=!e&&r&&this.shouldRenderSubLayer(n,i.polygonsOutline?.data)&&this.getSubLayerClass(n,Qu.type),a=this.shouldRenderSubLayer(s,i.lines?.data)&&this.getSubLayerClass(s,Qu.type);if(o||a){let A=ip(this,Qu.props);return[o&&new o(A,this.getSubLayerProps({id:n,updateTriggers:A.updateTriggers}),i.polygonsOutline),a&&new a(A,this.getSubLayerProps({id:s,updateTriggers:A.updateTriggers}),i.lines)]}return null}_renderPointLayers(){let{pointType:e}=this.props,{layerProps:r,binary:i}=this.state,{highlightedObjectIndex:n}=this.props;!i&&Number.isFinite(n)&&(n=r.points.data.findIndex(a=>a.__source.index===n));let s=new Set(e.split("+")),o=[];for(let a of s){let A=`points-${a}`,h=Yu[a],g=h&&this.shouldRenderSubLayer(A,r.points?.data)&&this.getSubLayerClass(A,h.type);if(g){let _=ip(this,h.props),b=r.points;if(a==="text"&&i){let{instancePickingColors:T,...v}=b.data.attributes;b={...b,data:{...b.data,attributes:v}}}o.push(new g(_,this.getSubLayerProps({id:A,updateTriggers:_.updateTriggers,highlightedObjectIndex:n}),b))}}return o}renderLayers(){let{extruded:e}=this.props,r=this._renderPolygonLayer(),i=this._renderLineLayers(),n=this._renderPointLayers();return[!e&&r,i,n,e&&r]}getSubLayerAccessor(e){let{binary:r}=this.state;return!r||typeof e!="function"?super.getSubLayerAccessor(e):(i,n)=>{let{data:s,index:o}=n,a=PM(s,o);return e(a,n)}}};qu.layerName="GeoJsonLayer";qu.defaultProps=ej;var jo=qu;function s5({pointCount:t,getBinId:e}){let r=new Map;for(let i=0;i<t;i++){let n=e(i);if(n===null)continue;let s=r.get(String(n));s?s.points.push(i):(s={id:n,index:r.size,points:[i]},r.set(String(n),s))}return Array.from(r.values())}function o5({bins:t,dimensions:e,target:r}){let i=t.length*e;(!r||r.length<i)&&(r=new Float32Array(i));for(let n=0;n<t.length;n++){let{id:s}=t[n];Array.isArray(s)?r.set(s,n*e):r[n]=s}return r}var tj=t=>t.length,a5=(t,e)=>{let r=0;for(let i of t)r+=e(i);return r},rj=(t,e)=>t.length===0?NaN:a5(t,e)/t.length,ij=(t,e)=>{let r=1/0;for(let i of t){let n=e(i);n<r&&(r=n)}return r},nj=(t,e)=>{let r=-1/0;for(let i of t){let n=e(i);n>r&&(r=n)}return r},c5={COUNT:tj,SUM:a5,MEAN:rj,MIN:ij,MAX:nj};function l5({bins:t,getValue:e,operation:r,target:i}){(!i||i.length<t.length)&&(i=new Float32Array(t.length));let n=1/0,s=-1/0;for(let o=0;o<t.length;o++){let{points:a}=t[o];i[o]=r(a,e),i[o]<n&&(n=i[o]),i[o]>s&&(s=i[o])}return{value:i,domain:[n,s]}}function vy(t,e,r){let i={};for(let s of t.sources||[]){let o=e[s];if(o)i[s]=sj(o);else throw new Error(`Cannot find attribute ${s}`)}let n={};return s=>{for(let o in i)n[o]=i[o](s);return t.getValue(n,s,r)}}function sj(t){let e=t.value,{offset:r=0,stride:i,size:n}=t.getAccessor(),s=e.BYTES_PER_ELEMENT,o=r/s,a=i?i/s:n;if(n===1)return t.isConstant?()=>e[0]:h=>{let g=o+a*h;return e[g]};let A;return t.isConstant?(A=Array.from(e),()=>A):(A=new Array(n),h=>{let g=o+a*h;for(let _=0;_<n;_++)A[_]=e[g+_];return A})}var Ur=class{constructor(e){this.bins=[],this.binIds=null,this.results=[],this.dimensions=e.dimensions,this.channelCount=e.getValue.length,this.props={...e,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(e)}destroy(){}get binCount(){return this.bins.length}setProps(e){let r=this.props;if(e.binOptions&&(Et(e.binOptions,r.binOptions,2)||this.setNeedsUpdate()),e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==r.operations[i]&&this.setNeedsUpdate(i);if(e.customOperations)for(let i=0;i<this.channelCount;i++)!!e.customOperations[i]!=!!r.customOperations[i]&&this.setNeedsUpdate(i);e.pointCount!==void 0&&e.pointCount!==r.pointCount&&this.setNeedsUpdate(),e.attributes&&(e.attributes={...r.attributes,...e.attributes}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[e]=!0)}update(){if(this.needsUpdate===!0){this.bins=s5({pointCount:this.props.pointCount,getBinId:vy(this.props.getBin,this.props.attributes,this.props.binOptions)});let e=o5({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:e,type:"float32",size:this.dimensions}}for(let e=0;e<this.channelCount;e++)if(this.needsUpdate===!0||this.needsUpdate[e]){let r=this.props.customOperations[e]||c5[this.props.operations[e]],{value:i,domain:n}=l5({bins:this.bins,getValue:vy(this.props.getValue[e],this.props.attributes,void 0),operation:r,target:this.results[e]?.value});this.results[e]={value:i,domain:n,type:"float32",size:1},this.props.onUpdate?.({channel:e})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(e){return this.results[e]}getResultDomain(e){return this.results[e]?.domain??[1/0,-1/0]}getBin(e){let r=this.bins[e];if(!r)return null;let i=new Array(this.channelCount);for(let n=0;n<i.length;n++){let s=this.results[n];i[n]=s?.value[e]}return{id:r.id,value:i,count:r.points.length,pointIndices:r.points}}};function sp(t,e,r){return t.createFramebuffer({width:e,height:r,colorAttachments:[t.createTexture({width:e,height:r,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}var oj=`uniform binSorterUniforms {
  ivec4 binIdRange;
  ivec2 targetSize;
} binSorter;
`,A5={name:"binSorter",vs:oj,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}};var f5=[1,2,4,8],u5=3e38,aj={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Ku=1024,op=class{constructor(e,r){this.binsFBO=null,this.device=e,this.model=lj(e,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(e){if(!this.binsFBO)return null;let r=e%Ku,i=Math.floor(e/Ku),n=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:i,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(n)}setDimensions(e,r){let i=Ku,n=Math.ceil(e/i);this.binsFBO?this.binsFBO.height<n&&this.binsFBO.resize({width:i,height:n}):this.binsFBO=sp(this.device,i,n);let s={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:s})}setModelProps(e){let r=this.model;e.attributes&&r.setAttributes(e.attributes),e.constantAttributes&&r.setConstantAttributes(e.constantAttributes),e.vertexCount!==void 0&&r.setVertexCount(e.vertexCount),e.shaderModuleProps&&r.shaderInputs.setProps(e.shaderModuleProps)}update(e){if(!this.binsFBO)return;let r=cj(e);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(e,r){if(r===0)return;r|=f5[3];let i=this.model,n=this.binsFBO,s=e==="MAX"?-u5:e==="MIN"?u5:0,o=this.device.beginRenderPass({id:`gpu-aggregation-${e}`,framebuffer:n,parameters:{viewport:[0,0,n.width,n.height],colorMask:r},clearColor:[s,s,s,0],clearDepth:!1,clearStencil:!1});i.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:e==="MAX"?"max":e==="MIN"?"min":"add",blendAlphaOperation:"add"}),i.draw(o),o.end()}};function cj(t){let e={...aj};for(let r=0;r<t.length;r++){let i=t[r];i&&(e[i]+=f5[r])}return e}function lj(t,e){let r=e.vs;e.dimensions===2&&(r+=`
void getBin(out int binId) {
  ivec2 binId2;
  getBin(binId2);
  if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
    binId = -1;
  } else {
    binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
  }
}
`);let i=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-vertex

${r}

out vec3 v_Value;

void main() {
  int binIndex;
  getBin(binIndex);
  binIndex = binIndex - binSorter.binIdRange.x;
  if (binIndex < 0) {
    gl_Position = vec4(0.);
    return;
  }
  int row = binIndex / binSorter.targetSize.x;
  int col = binIndex - row * binSorter.targetSize.x;
  vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
  gl_Position = vec4(position, 0.0, 1.0);
  gl_PointSize = 1.0;

#if NUM_CHANNELS == 3
  getValue(v_Value);
#elif NUM_CHANNELS == 2
  getValue(v_Value.xy);
#else
  getValue(v_Value.x);
#endif
}
`,n=`#version 300 es
#define SHADER_NAME gpu-aggregation-sort-bins-fragment

precision highp float;

in vec3 v_Value;
out vec4 fragColor;

void main() {
  fragColor.xyz = v_Value;

  #ifdef MODULE_GEOMETRY
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  #endif

  fragColor.w = 1.0;
}
`;return new je(t,{bufferLayout:e.bufferLayout,modules:[...e.modules||[],A5],defines:{...e.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:e.channelCount},isInstanced:!1,vs:i,fs:n,topology:"point-list",disableWarnings:!0})}var Aj=`uniform aggregatorTransformUniforms {
  ivec4 binIdRange;
  bvec3 isCount;
  bvec3 isMean;
  float naN;
} aggregatorTransform;
`,h5={name:"aggregatorTransform",vs:Aj,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};var wy=3e38,ap=class{constructor(e,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=e,this.channelCount=r.channelCount,this.transform=uj(e,r),this.domainFBO=sp(e,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){let e=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(e);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(e,r){let{model:i,transformFeedback:n}=this.transform;i.setVertexCount(e);let s={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};i.shaderInputs.setProps({aggregatorTransform:s});let o=e*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<o)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:o}),n.setBuffer("binIds",this.binBuffer));let a=e*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<a)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:a}),n.setBuffer("values",this.valueBuffer))}update(e,r){if(!e)return;let i=this.transform,n=this.domainFBO,s=[0,1,2].map(A=>r[A]==="COUNT"?1:0),o=[0,1,2].map(A=>r[A]==="MEAN"?1:0),a={isCount:s,isMean:o,bins:e};i.model.shaderInputs.setProps({aggregatorTransform:a}),i.run({id:"gpu-aggregation-domain",framebuffer:n,parameters:{viewport:[0,0,2,1]},clearColor:[-wy,-wy,-wy,0],clearDepth:!1,clearStencil:!1}),this._domains=null}};function uj(t,e){let r=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-vertex

uniform sampler2D bins;

#if NUM_DIMS == 1
out float binIds;
#else
out vec2 binIds;
#endif

#if NUM_CHANNELS == 1
flat out float values;
#elif NUM_CHANNELS == 2
flat out vec2 values;
#else
flat out vec3 values;
#endif

const float NAN = intBitsToFloat(-1);

void main() {
  int row = gl_VertexID / SAMPLER_WIDTH;
  int col = gl_VertexID - row * SAMPLER_WIDTH;
  vec4 weights = texelFetch(bins, ivec2(col, row), 0);
  vec3 value3 = mix(
    mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
    weights.rgb / max(weights.a, 1.0),
    aggregatorTransform.isMean
  );
  if (weights.a == 0.0) {
    value3 = vec3(NAN);
  }

#if NUM_DIMS == 1
  binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
#else
  int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
  binIds.y = float(y + aggregatorTransform.binIdRange.z);
  binIds.x = float(x + aggregatorTransform.binIdRange.x);
#endif

#if NUM_CHANNELS == 3
  values = value3;
#elif NUM_CHANNELS == 2
  values = value3.xy;
#else
  values = value3.x;
#endif

  gl_Position = vec4(0., 0., 0., 1.);
  // This model renders into a 2x1 texture to obtain min and max simultaneously.
  // See comments in fragment shader
  gl_PointSize = 2.0;
}
`,i=`#version 300 es
#define SHADER_NAME gpu-aggregation-domain-fragment

precision highp float;

#if NUM_CHANNELS == 1
flat in float values;
#elif NUM_CHANNELS == 2
flat in vec2 values;
#else
flat in vec3 values;
#endif

out vec4 fragColor;

void main() {
  vec3 value3;
#if NUM_CHANNELS == 3
  value3 = values;
#elif NUM_CHANNELS == 2
  value3.xy = values;
#else
  value3.x = values;
#endif
  if (isnan(value3.x)) discard;
  // This shader renders into a 2x1 texture with blending=max
  // The left pixel yields the max value of each channel
  // The right pixel yields the min value of each channel
  if (gl_FragCoord.x < 1.0) {
    fragColor = vec4(value3, 1.0);
  } else {
    fragColor = vec4(-value3, 1.0);
  }
}
`;return new fn(t,{vs:r,fs:i,topology:"point-list",modules:[h5],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:e.dimensions,NUM_CHANNELS:e.channelCount,SAMPLER_WIDTH:Ku},varyings:["binIds","values"],disableWarnings:!0})}var Qt=class{static isSupported(e){return e.features.has("float32-renderable-webgl")&&e.features.has("texture-blend-float-webgl")}constructor(e,r){this.binCount=0,this.binIds=null,this.results=[],this.device=e,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new op(e,r),this.aggregationTransform=new ap(e,r),this.setProps(r)}getBins(){let e=this.aggregationTransform.binBuffer;return e?(this.binIds?.buffer!==e&&(this.binIds={buffer:e,type:"float32",size:this.dimensions}),this.binIds):null}getResult(e){let r=this.aggregationTransform.valueBuffer;return!r||e>=this.channelCount?null:(this.results[e]?.buffer!==r&&(this.results[e]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:e*4}),this.results[e])}getResultDomain(e){return this.aggregationTransform.domains[e]}getBin(e){if(e<0||e>=this.binCount)return null;let{binIdRange:r}=this.props,i;if(this.dimensions===1)i=[e+r[0][0]];else{let[[a,A],[h]]=r,g=A-a;i=[e%g+a,Math.floor(e/g)+h]}let n=this.binSorter.getBinValues(e);if(!n)return null;let s=n[3],o=[];for(let a=0;a<this.channelCount;a++){let A=this.props.operations[a];A==="COUNT"?o[a]=s:s===0?o[a]=NaN:o[a]=A==="MEAN"?n[a]/s:n[a]}return{id:i,value:o,count:s}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(e){let r=this.props;if("binIdRange"in e&&!Et(e.binIdRange,r.binIdRange,2)){let i=e.binIdRange;if(me.assert(i.length===this.dimensions),this.dimensions===1){let[[n,s]]=i;this.binCount=s-n}else{let[[n,s],[o,a]]=i;this.binCount=(s-n)*(a-o)}this.binSorter.setDimensions(this.binCount,i),this.aggregationTransform.setDimensions(this.binCount,i),this.setNeedsUpdate()}if(e.operations)for(let i=0;i<this.channelCount;i++)e.operations[i]!==r.operations[i]&&this.setNeedsUpdate(i);if(e.pointCount!==void 0&&e.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:e.pointCount}),this.setNeedsUpdate()),e.binOptions&&(Et(e.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:e.binOptions})),e.attributes){let i={},n={};for(let s of Object.values(e.attributes))for(let[o,a]of Object.entries(s.getValue()))ArrayBuffer.isView(a)?n[o]=a:a&&(i[o]=a);this.binSorter.setModelProps({attributes:i,constantAttributes:n})}e.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:e.shaderModuleProps}),Object.assign(this.props,e)}setNeedsUpdate(e){e===void 0?this.needsUpdate.fill(!0):this.needsUpdate[e]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;let{operations:e}=this.props,r=this.needsUpdate.map((i,n)=>i?e[n]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,e);for(let i=0;i<this.channelCount;i++)this.needsUpdate[i]&&(this.needsUpdate[i]=!1,this.props.onUpdate?.({channel:i}))}};var cp=class extends zt{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(e){super.updateState(e);let r=this.getAggregatorType();if(e.changeFlags.extensionsChanged||this.state.aggregatorType!==r){this.state.aggregator?.destroy();let i=this.createAggregator(r);return i.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:i,aggregatorType:r}),!0}return!1}finalizeState(e){super.finalizeState(e),this.state.aggregator.destroy()}updateAttributes(e){let{aggregator:r}=this.state;r.setProps({attributes:e});for(let i in e)this.onAttributeChange(i);r.update()}draw({shaderModuleProps:e}){let{aggregator:r}=this.state;r.setProps({shaderModuleProps:e}),r.preDraw()}_getAttributeManager(){return new vi(this.context.device,{id:this.props.id,stats:this.context.stats})}};cp.layerName="AggregationLayer";var En=cp;var Vs=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function Cy(t,e=!1,r=Float32Array){let i;if(Number.isFinite(t[0]))i=new r(t);else{i=new r(t.length*4);let n=0;for(let s=0;s<t.length;s++){let o=t[s];i[n++]=o[0],i[n++]=o[1],i[n++]=o[2],i[n++]=Number.isFinite(o[3])?o[3]:255}}if(e)for(let n=0;n<i.length;n++)i[n]/=255;return i}var lp={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function pc(t,e){t.setSampler({minFilter:lp[e],magFilter:lp[e]})}function gc(t,e,r="linear"){let i=Cy(e,!1,Uint8Array);return t.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:lp[r],magFilter:lp[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:i,width:i.length/4,height:1})}var d5=`#version 300 es
#define SHADER_NAME screen-grid-layer-vertex-shader
#define RANGE_COUNT 6
in vec2 positions;
in vec2 instancePositions;
in float instanceWeights;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
if (isnan(instanceWeights)) {
gl_Position = vec4(0.);
return;
}
vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
pos.x = pos.x - 1.0;
pos.y = 1.0 - pos.y;
gl_Position = vec4(pos, 0., 1.);
vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
vColor.a *= layer.opacity;
picking_setPickingColor(instancePickingColors);
}
`;var p5=`#version 300 es
#define SHADER_NAME screen-grid-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var fj=`uniform screenGridUniforms {
  vec2 cellSizeClipspace;
  vec2 gridSizeClipspace;
  vec2 colorDomain;
} screenGrid;
`,g5={name:"screenGrid",vs:fj,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};var Ap=class extends xt{getShaders(){return super.getShaders({vs:d5,fs:p5,modules:[Pt,g5]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e,s=this.state.model;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=gc(this.context.device,r.colorRange,r.colorScaleType);let o={colorRange:this.state.colorTexture};s.shaderInputs.setProps({screenGrid:o})}else i.colorScaleType!==r.colorScaleType&&pc(this.state.colorTexture,r.colorScaleType);if(i.cellMarginPixels!==r.cellMarginPixels||i.cellSizePixels!==r.cellSizePixels||n.viewportChanged){let{width:o,height:a}=this.context.viewport,{cellSizePixels:A,cellMarginPixels:h}=this.props,g=Math.max(A-h,0),_={gridSizeClipspace:[A/o*2,A/a*2],cellSizeClipspace:[g/o*2,g/a*2]};s.shaderInputs.setProps({screenGrid:_})}}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let r=this.props.colorDomain(),i=this.state.model,n={colorDomain:r};i.shaderInputs.setProps({screenGrid:n}),i.draw(this.context.renderPass)}_getModel(){return new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ut({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}};Ap.layerName="ScreenGridCellLayer";var m5=Ap;var hj=`uniform binOptionsUniforms {
  float cellSizePixels;
} binOptions;
`,_5={name:"binOptions",vs:hj,uniformTypes:{cellSizePixels:"f32"}};var dj={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:Vs,colorScaleType:"linear",getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},Ju=class extends En{getAggregatorType(){return this.props.gpuAggregation&&Qt.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"||!Qt.isSupported(this.context.device)?new Ur({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},i,n)=>{let s=this.context.viewport,o=s.project(r),a=n.cellSizePixels;return o[0]<0||o[0]>=s.width||o[1]<0||o[1]>=s.height?null:[Math.floor(o[0]/a),Math.floor(o[1]/a)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new Qt(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[et,_5],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;
  
  void getBin(out ivec2 binId) {
    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
    binId = ivec2(gridCoords);
  }
  void getValue(out float weight) {
    weight = counts;
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{cellSizePixels:o,aggregation:a}=i;if(r||s.dataChanged||s.updateTriggersChanged||s.viewportChanged||a!==n.aggregation||o!==n.cellSizePixels){let{width:A,height:h}=this.context.viewport,{aggregator:g}=this.state;g instanceof Qt&&g.setProps({binIdRange:[[0,Math.ceil(A/o)],[0,Math.ceil(h/o)]]}),g.setProps({pointCount:this.getNumInstances(),operations:[a],binOptions:{cellSizePixels:o}})}return s.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let{aggregator:e}=this.state,r=this.getSubLayerClass("cells",m5),i=e.getBins(),n=e.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:i,getWeight:n}},dataComparator:(s,o)=>s.length===o.length,updateTriggers:{getBin:[i],getWeight:[n]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),s;n&&(s={col:n.id[0],row:n.id[1],value:n.value[0],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(o=>this.props.data[o]):[])),r.object=s}return r}};Ju.layerName="ScreenGridLayer";Ju.defaultProps=dj;var y5=Ju;var zs=class{constructor(e,r){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=e,this.inputLength=r,this.attribute=e}getScalePercentile(){if(!this._percentile){let e=x5(this.input,this.inputLength);this._percentile=gj(e)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){let e=x5(this.input,this.inputLength);this._ordinal=pj(e)}return this._ordinal}getCutoff({scaleType:e,lowerPercentile:r,upperPercentile:i}){if(e==="quantile")return[r,i-1];if(r>0||i<100){let{domain:n}=this.getScalePercentile(),s=n[Math.floor(r)-1]??-1/0,o=n[Math.floor(i)-1]??1/0;if(e==="ordinal"){let{domain:a}=this.getScaleOrdinal();s=a.findIndex(A=>A>=s),o=a.findIndex(A=>A>o)-1,o===-2&&(o=a.length-1)}return[s,o]}return null}update(e){let r=this.props;if(e.scaleType!==r.scaleType)switch(e.scaleType){case"quantile":{let{attribute:i}=this.getScalePercentile();this.attribute=i,this.domain=[0,99];break}case"ordinal":{let{attribute:i,domain:n}=this.getScaleOrdinal();this.attribute=i,this.domain=[0,n.length-1];break}default:this.attribute=this.input,this.domain=null}return(e.scaleType!==r.scaleType||e.lowerPercentile!==r.lowerPercentile||e.upperPercentile!==r.upperPercentile)&&(this.cutoff=this.getCutoff(e)),this.props=e,this}};function pj(t){let e=new Set;for(let n of t)Number.isFinite(n)&&e.add(n);let r=Array.from(e).sort(),i=new Map;for(let n=0;n<r.length;n++)i.set(r[n],n);return{attribute:{value:t.map(n=>Number.isFinite(n)?i.get(n):NaN),type:"float32",size:1},domain:r}}function gj(t,e=100){let r=Array.from(t).filter(Number.isFinite).sort(mj),i=0,n=Math.max(1,e),s=new Array(n-1);for(;++i<n;)s[i-1]=_j(r,i/n);return{attribute:{value:t.map(o=>Number.isFinite(o)?yj(s,o):NaN),type:"float32",size:1},domain:s}}function x5(t,e){let r=(t.stride??4)/4,i=(t.offset??0)/4,n=t.value;if(!n){let o=t.buffer?.readSyncWebGL(0,r*4*e);o&&(n=new Float32Array(o.buffer),t.value=n)}if(r===1)return n.subarray(0,e);let s=new Float32Array(e);for(let o=0;o<e;o++)s[o]=n[o*r+i];return s}function mj(t,e){return t-e}function _j(t,e){let r=t.length;if(e<=0||r<2)return t[0];if(e>=1)return t[r-1];let i=(r-1)*e,n=Math.floor(i),s=t[n],o=t[n+1];return s+(o-s)*(i-n)}function yj(t,e){let r=0,i=t.length;for(;r<i;){let n=r+i>>>1;t[n]>e?i=n:r=n+1}return r}function mc({dataBounds:t,getBinId:e,padding:r=0}){let i=[t[0],t[1],[t[0][0],t[1][1]],[t[1][0],t[0][1]]].map(A=>e(A)),n=Math.min(...i.map(A=>A[0]))-r,s=Math.min(...i.map(A=>A[1]))-r,o=Math.max(...i.map(A=>A[0]))+r+1,a=Math.max(...i.map(A=>A[1]))+r+1;return[[n,o],[s,a]]}var b5=Math.PI/3,up=2*Math.sin(b5),fp=1.5,T5=Array.from({length:6},(t,e)=>{let r=e*b5;return[Math.sin(r),-Math.cos(r)]});function hp([t,e],r){let i=Math.round(e=e/r/fp),n=Math.round(t=t/r/up-(i&1)/2),s=e-i;if(Math.abs(s)*3>1){let o=t-n,a=n+(t<n?-1:1)/2,A=i+(e<i?-1:1),h=t-a,g=e-A;o*o+s*s>h*h+g*g&&(n=a+(i&1?1:-1)/2,i=A)}return[n,i]}var E5=`
const vec2 DIST = vec2(${up}, ${fp});

ivec2 pointToHexbin(vec2 p, float radius) {
  p /= radius * DIST;
  float pj = round(p.y);
  float pjm2 = mod(pj, 2.0);
  p.x -= pjm2 * 0.5;
  float pi = round(p.x);
  vec2 d1 = p - vec2(pi, pj);

  if (abs(d1.y) * 3. > 1.) {
    vec2 v2 = step(0.0, d1) - 0.5;
    v2.y *= 2.0;
    vec2 d2 = d1 - v2;
    if (dot(d1, d1) > dot(d2, d2)) {
      pi += v2.x + pjm2 - 0.5;
      pj += v2.y;
    }
  }
  return ivec2(pi, pj);
}
`;function Sy([t,e],r){return[(t+(e&1)/2)*r*up,e*r*fp]}var v5=`
const vec2 DIST = vec2(${up}, ${fp});

vec2 hexbinCentroid(vec2 binId, float radius) {
  binId.x += fract(binId.y * 0.5);
  return binId * DIST * radius;
}
`;var w5=`#version 300 es
#define SHADER_NAME hexagon-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
${v5}
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < hexagon.colorDomain.z ||
instanceColorValues > hexagon.colorDomain.w ||
instanceElevationValues < hexagon.elevationDomain.z ||
instanceElevationValues > hexagon.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
commonPosition += positions.xy * column.radius * column.coverage;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var xj=`uniform hexagonUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
} hexagon;
`,C5={name:"hexagon",vs:xj,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};var dp=class extends bn{getShaders(){let e=super.getShaders();return e.modules.push(C5),{...e,vs:w5}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=gc(this.context.device,r.colorRange,r.colorScaleType);let s={colorRange:this.state.colorTexture};n.shaderInputs.setProps({hexagon:s})}else i.colorScaleType!==r.colorScaleType&&pc(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}draw({uniforms:e}){let{radius:r,hexOriginCommon:i,elevationRange:n,elevationScale:s,extruded:o,coverage:a,colorDomain:A,elevationDomain:h}=this.props,g=this.props.colorCutoff||[-1/0,1/0],_=this.props.elevationCutoff||[-1/0,1/0],b=this.state.fillModel;b.vertexArray.indexBuffer&&b.setIndexBuffer(null),b.setVertexCount(this.state.fillVertexCount);let T={colorDomain:[Math.max(A[0],g[0]),Math.min(A[1],g[1]),Math.max(A[0]-1,g[0]),Math.min(A[1]+1,g[1])],elevationDomain:[Math.max(h[0],_[0]),Math.min(h[1],_[1]),Math.max(h[0]-1,_[0]),Math.min(h[1]+1,_[1])],elevationRange:[n[0]*s,n[1]*s],originCommon:i};b.shaderInputs.setProps({column:{extruded:o,coverage:a,radius:r},hexagon:T}),b.draw(this.context.renderPass)}};dp.layerName="HexagonCellLayer";var S5=dp;var bj=`uniform binOptionsUniforms {
  vec2 hexOriginCommon;
  float radiusCommon;
} binOptions;
`,M5={name:"binOptions",vs:bj,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function P5(){}var Tj={gpuAggregation:!0,colorDomain:null,colorRange:Vs,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:P5,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:P5,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},Zu=class extends En{getAggregatorType(){let{gpuAggregation:e,hexagonAggregator:r,getColorValue:i,getElevationValue:n}=this.props;return e&&(r||i||n)?(me.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Qt.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{hexagonAggregator:r,radius:i}=this.props;return new Ur({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},s,o)=>{if(r)return r(n,i);let A=this.state.aggregatorViewport.projectPosition(n),{radiusCommon:h,hexOriginCommon:g}=o;return hp([A[0]-g[0],A[1]-g[1]],h)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new Qt(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[et,M5],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;
  
  ${E5}

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:o}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Yt(i.data).iterable)),r||s.dataChanged||i.radius!==n.radius||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{radiusCommon:a,hexOriginCommon:A,binIdRange:h,dataAsArray:g}=this.state;if(o.setProps({binIdRange:h,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{radiusCommon:a,hexOriginCommon:A},onUpdate:this._onAggregationUpdate.bind(this)}),g){let{getColorValue:_,getElevationValue:b}=this.props;o.setProps({customOperations:[_&&(T=>_(T.map(v=>g[v]),{indices:T,data:i.data})),b&&(T=>b(T.map(v=>g[v]),{indices:T,data:i.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),r}_updateBinOptions(){let e=this.getBounds(),r=1,i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{radius:a}=this.props,{unitsPerMeter:A}=s.getDistanceScales(o);r=A[0]*a;let h=hp(s.projectFlat(o),r);o=s.unprojectFlat(Sy(h,r));let g=s.constructor;s=s.isGeospatial?new g({longitude:o[0],latitude:o[1],zoom:12}):new ai({position:[o[0],o[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=mc({dataBounds:e,getBinId:_=>{let b=s.projectFlat(_);return b[0]-=i[0],b[1]-=i[1],hp(b,r)},padding:1})}this.setState({radiusCommon:r,hexOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let r=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new zs(n,i.binCount)}),r.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new zs(n,i.binCount)}),r.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{radiusCommon:i,hexOriginCommon:n,binIdRange:s}=this.state;r.setProps({binIdRange:s,binOptions:{radiusCommon:i,hexOriginCommon:n}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,radiusCommon:r,hexOriginCommon:i}=this.state,{elevationScale:n,colorRange:s,elevationRange:o,extruded:a,coverage:A,material:h,transitions:g,colorScaleType:_,lowerPercentile:b,upperPercentile:T,colorDomain:v,elevationScaleType:C,elevationLowerPercentile:S,elevationUpperPercentile:P,elevationDomain:F}=this.props,I=this.getSubLayerClass("cells",S5),k=e.getBins(),W=this.state.colors?.update({scaleType:_,lowerPercentile:b,upperPercentile:T}),K=this.state.elevations?.update({scaleType:C,lowerPercentile:S,upperPercentile:P});return!W||!K?null:new I(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:k,getColorValue:W.attribute,getElevationValue:K.attribute}},dataComparator:(re,Y)=>re.length===Y.length,updateTriggers:{getBin:[k],getColorValue:[W.attribute],getElevationValue:[K.attribute]},diskResolution:6,vertices:T5,radius:r,hexOriginCommon:i,elevationScale:n,colorRange:s,colorScaleType:_,elevationRange:o,extruded:a,coverage:A,material:h,colorDomain:W.domain||v||e.getResultDomain(0),elevationDomain:K.domain||F||e.getResultDomain(1),colorCutoff:W.cutoff,elevationCutoff:K.cutoff,transitions:g&&{getFillColor:g.getColorValue||g.getColorWeight,getElevation:g.getElevationValue||g.getElevationWeight},extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),s;if(n){let o=Sy(n.id,this.state.radiusCommon),a=this.context.viewport.unprojectFlat(o);s={col:n.id[0],row:n.id[1],position:a,colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(A=>this.props.data[A]):[])}r.object=s}return r}};Zu.layerName="HexagonLayer";Zu.defaultProps=Tj;var R5=Zu;var Ee=.16666666666666666,ee={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},_c=[ee.W,ee.SW,ee.S],yc=[ee.S,ee.SE,ee.E],xc=[ee.E,ee.NE,ee.N],bc=[ee.NW,ee.W,ee.N],Tc=[[-.5,Ee],[-.5,-Ee],[-Ee,-.5],[Ee,-.5]],Ec=[[-Ee,-.5],[Ee,-.5],[.5,-Ee],[.5,Ee]],vc=[[.5,-Ee],[.5,Ee],[Ee,.5],[-Ee,.5]],wc=[[-.5,Ee],[-.5,-Ee],[Ee,.5],[-Ee,.5]],I5=[ee.W,ee.SW,ee.SE,ee.E],B5=[ee.S,ee.SE,ee.NE,ee.N],O5=[ee.NW,ee.W,ee.E,ee.NE],F5=[ee.NW,ee.SW,ee.S,ee.N],L5=[[-.5,Ee],[-.5,-Ee],[.5,-Ee],[.5,Ee]],N5=[[-Ee,-.5],[Ee,-.5],[Ee,.5],[-Ee,.5]],Ej=[ee.NW,ee.SW,ee.SE,ee.NE],D5=[ee.NW,ee.SW,ee.SE,ee.E,ee.N],k5=[ee.W,ee.SW,ee.SE,ee.NE,ee.N],U5=[ee.NW,ee.W,ee.S,ee.SE,ee.NE],V5=[ee.NW,ee.SW,ee.S,ee.E,ee.NE],z5=[ee.NW,ee.W,[.5,-Ee],[.5,Ee],ee.N],H5=[[-Ee,-.5],[Ee,-.5],ee.E,ee.NE,ee.N],G5=[[-.5,Ee],[-.5,-Ee],ee.S,ee.SE,ee.E],W5=[ee.W,ee.SW,ee.S,[Ee,.5],[-Ee,.5]],j5=[ee.NW,ee.W,[-Ee,-.5],[Ee,-.5],ee.N],X5=[[-.5,Ee],[-.5,-Ee],ee.E,ee.NE,ee.N],Y5=[ee.S,ee.SE,ee.E,[Ee,.5],[-Ee,.5]],Q5=[ee.W,ee.SW,ee.S,[.5,-Ee],[.5,Ee]],q5=[ee.W,ee.SW,ee.SE,ee.E,[Ee,.5],[-Ee,.5]],K5=[[-.5,Ee],[-.5,-Ee],ee.S,ee.SE,ee.NE,ee.N],J5=[ee.NW,ee.W,[-Ee,-.5],[Ee,-.5],ee.E,ee.NE],Z5=[ee.NW,ee.SW,ee.S,[.5,-Ee],[.5,Ee],ee.N],Cc=[ee.W,ee.SW,ee.S,ee.E,ee.NE,ee.N],Sc=[ee.NW,ee.W,ee.S,ee.SE,ee.E,ee.N],pp=[[-.5,Ee],[-.5,-Ee],[-Ee,-.5],[Ee,-.5],ee.E,ee.NE,ee.N],gp=[ee.W,ee.SW,ee.S,[.5,-Ee],[.5,Ee],[Ee,.5],[-Ee,.5]],mp=[ee.NW,ee.W,[-Ee,-.5],[Ee,-.5],[.5,-Ee],[.5,Ee],ee.N],_p=[[-.5,Ee],[-.5,-Ee],ee.S,ee.SE,ee.E,[Ee,.5],[-Ee,.5]],$5=[[-.5,Ee],[-.5,-Ee],[-Ee,-.5],[Ee,-.5],[.5,-Ee],[.5,Ee],[Ee,.5],[-Ee,.5]],eP={0:[],1:[[ee.W,ee.S]],2:[[ee.S,ee.E]],3:[[ee.W,ee.E]],4:[[ee.N,ee.E]],5:{0:[[ee.W,ee.S],[ee.N,ee.E]],1:[[ee.W,ee.N],[ee.S,ee.E]]},6:[[ee.N,ee.S]],7:[[ee.W,ee.N]],8:[[ee.W,ee.N]],9:[[ee.N,ee.S]],10:{0:[[ee.W,ee.N],[ee.S,ee.E]],1:[[ee.W,ee.S],[ee.N,ee.E]]},11:[[ee.N,ee.E]],12:[[ee.W,ee.E]],13:[[ee.S,ee.E]],14:[[ee.W,ee.S]],15:[]};function ye(t){return parseInt(t,4)}var tP={[ye("0000")]:[],[ye("2222")]:[],[ye("2221")]:[_c],[ye("2212")]:[yc],[ye("2122")]:[xc],[ye("1222")]:[bc],[ye("0001")]:[_c],[ye("0010")]:[yc],[ye("0100")]:[xc],[ye("1000")]:[bc],[ye("2220")]:[Tc],[ye("2202")]:[Ec],[ye("2022")]:[vc],[ye("0222")]:[wc],[ye("0002")]:[Tc],[ye("0020")]:[Ec],[ye("0200")]:[vc],[ye("2000")]:[wc],[ye("0011")]:[I5],[ye("0110")]:[B5],[ye("1100")]:[O5],[ye("1001")]:[F5],[ye("2211")]:[I5],[ye("2112")]:[B5],[ye("1122")]:[O5],[ye("1221")]:[F5],[ye("2200")]:[L5],[ye("2002")]:[N5],[ye("0022")]:[L5],[ye("0220")]:[N5],[ye("1111")]:[Ej],[ye("1211")]:[D5],[ye("2111")]:[k5],[ye("1112")]:[U5],[ye("1121")]:[V5],[ye("1011")]:[D5],[ye("0111")]:[k5],[ye("1110")]:[U5],[ye("1101")]:[V5],[ye("1200")]:[z5],[ye("0120")]:[H5],[ye("0012")]:[G5],[ye("2001")]:[W5],[ye("1022")]:[z5],[ye("2102")]:[H5],[ye("2210")]:[G5],[ye("0221")]:[W5],[ye("1002")]:[j5],[ye("2100")]:[X5],[ye("0210")]:[Y5],[ye("0021")]:[Q5],[ye("1220")]:[j5],[ye("0122")]:[X5],[ye("2012")]:[Y5],[ye("2201")]:[Q5],[ye("0211")]:[q5],[ye("2110")]:[K5],[ye("1102")]:[J5],[ye("1021")]:[Z5],[ye("2011")]:[q5],[ye("0112")]:[K5],[ye("1120")]:[J5],[ye("1201")]:[Z5],[ye("2101")]:[Cc],[ye("0121")]:[Cc],[ye("1012")]:[Sc],[ye("1210")]:[Sc],[ye("0101")]:{0:[_c,xc],1:[Cc],2:[Cc]},[ye("1010")]:{0:[bc,yc],1:[Sc],2:[Sc]},[ye("2121")]:{0:[Cc],1:[Cc],2:[_c,xc]},[ye("1212")]:{0:[Sc],1:[Sc],2:[bc,yc]},[ye("2120")]:{0:[pp],1:[pp],2:[Tc,xc]},[ye("2021")]:{0:[gp],1:[gp],2:[_c,vc]},[ye("1202")]:{0:[mp],1:[mp],2:[bc,Ec]},[ye("0212")]:{0:[_p],1:[_p],2:[yc,wc]},[ye("0102")]:{0:[Tc,xc],1:[pp],2:[pp]},[ye("0201")]:{0:[_c,vc],1:[gp],2:[gp]},[ye("1020")]:{0:[bc,Ec],1:[mp],2:[mp]},[ye("2010")]:{0:[yc,wc],1:[_p],2:[_p]},[ye("2020")]:{0:[wc,Ec],1:[$5],2:[Tc,vc]},[ye("0202")]:{0:[vc,Tc],1:[$5],2:[wc,Ec]}};function $u(t,e){return Number.isNaN(t)?0:Array.isArray(e)?t<e[0]?0:t<e[1]?1:2:t>=e?1:0}function rP(t){let{x:e,y:r,xRange:i,yRange:n,getValue:s,threshold:o}=t,a=e<i[0],A=e>=i[1]-1,h=r<n[0],g=r>=n[1]-1,_=a||A||h||g,b=0,T,v,C,S;if(a||g)C=0;else{let I=s(e,r+1);C=$u(I,o),b+=I}if(A||g)S=0;else{let I=s(e+1,r+1);S=$u(I,o),b+=I}if(A||h)v=0;else{let I=s(e+1,r);v=$u(I,o),b+=I}if(a||h)T=0;else{let I=s(e,r);T=$u(I,o),b+=I}let P=-1;Number.isFinite(o)&&(P=C<<3|S<<2|v<<1|T),Array.isArray(o)&&(P=C<<6|S<<4|v<<2|T);let F=0;return _||(F=$u(b/4,o)),{code:P,meanCode:F}}function iP(t){let{x:e,y:r,z:i,code:n,meanCode:s}=t,o=tP[n];Array.isArray(o)||(o=o[s]);let a=e+1,A=r+1,h=[];return o.forEach(g=>{let _=[];g.forEach(b=>{let T=a+b[0],v=A+b[1];_.push([T,v,i])}),h.push(_)}),h}function nP(t){let{x:e,y:r,z:i,code:n,meanCode:s}=t,o=eP[n];Array.isArray(o)||(o=o[s]);let a=e+1,A=r+1,h=[];return o.forEach(g=>{g.forEach(_=>{let b=a+_[0],T=A+_[1];h.push([b,T,i])})}),h}function sP({contours:t,getValue:e,xRange:r,yRange:i}){let n=[],s=[],o=0,a=0;for(let A=0;A<t.length;A++){let h=t[A],g=h.zIndex??A,{threshold:_}=h;for(let b=r[0]-1;b<r[1];b++)for(let T=i[0]-1;T<i[1];T++){let{code:v,meanCode:C}=rP({getValue:e,threshold:_,x:b,y:T,xRange:r,yRange:i}),S={x:b,y:T,z:g,code:v,meanCode:C};if(Array.isArray(_)){let P=iP(S);for(let F of P)s[a++]={vertices:F,contour:h}}else{let P=nP(S);P.length>0&&(n[o++]={vertices:P,contour:h})}}}return{lines:n,polygons:s}}function oP(t){let{aggregator:e,binIdRange:r,channel:i}=t;if(e instanceof Qt){let n=e.getResult(i)?.buffer;if(n){let s=new Float32Array(n.readSyncWebGL().buffer);return vj(s,r)}}if(e instanceof Ur){let n=e.getResult(i)?.value,s=e.getBins()?.value;if(s&&n)return wj(n,s,e.binCount)}return null}function vj(t,e){let[[r,i],[n,s]]=e,o=i-r,a=s-n;return(A,h)=>(A-=r,h-=n,A<0||A>=o||h<0||h>=a?NaN:t[h*o+A])}function wj(t,e,r){let i={};for(let n=0;n<r;n++){let s=e[n*2],o=e[n*2+1];i[s]=i[s]||{},i[s][o]=t[n]}return(n,s)=>i[n]?.[s]??NaN}var Cj=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,aP={name:"binOptions",vs:Cj,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};var cP=[255,255,255,255],Sj=1,Mj={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005},ef=class extends En{getAggregatorType(){return this.props.gpuAggregation&&Qt.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return e==="cpu"?new Ur({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},i,n)=>{let o=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:a,cellOriginCommon:A}=n;return[Math.floor((o[0]-A[0])/a[0]),Math.floor((o[1]-A[1])/a[1])]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}],onUpdate:this._onAggregationUpdate.bind(this)}):new Qt(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[et,aP],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float counts;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out float value) {
    value = counts;
  }
  `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:o}=this.state;if(r||s.dataChanged||i.cellSize!==n.cellSize||!Et(i.gridOrigin,n.gridOrigin,1)||i.aggregation!==n.aggregation){this._updateBinOptions();let{cellSizeCommon:a,cellOriginCommon:A,binIdRange:h}=this.state;o.setProps({binIdRange:h,pointCount:this.getNumInstances(),operations:[i.aggregation],binOptions:{cellSizeCommon:a,cellOriginCommon:A}})}return Et(n.contours,i.contours,2)||this.setState({contourData:null}),r}_updateBinOptions(){let e=this.getBounds(),r=[1,1],i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:a,gridOrigin:A}=this.props,{unitsPerMeter:h}=s.getDistanceScales(o);r[0]=h[0]*a,r[1]=h[1]*a;let g=s.projectFlat(o);i=[Math.floor((g[0]-A[0])/r[0])*r[0]+A[0],Math.floor((g[1]-A[1])/r[1])*r[1]+A[1]],o=s.unprojectFlat(i);let _=s.constructor;s=s.isGeospatial?new _({longitude:o[0],latitude:o[1],zoom:12}):new ai({position:[o[0],o[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=mc({dataBounds:e,getBinId:b=>{let T=s.projectFlat(b);return[Math.floor((T[0]-i[0])/r[0]),Math.floor((T[1]-i[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate(){let{aggregator:e,binIdRange:r}=this.state;this.setState({aggregatedValueReader:oP({aggregator:e,binIdRange:r,channel:0}),contourData:null})}_getContours(){let{aggregatedValueReader:e}=this.state;if(!e)return null;if(!this.state.contourData){let{binIdRange:r}=this.state,{contours:i}=this.props,n=sP({contours:i,getValue:e,xRange:r[0],yRange:r[1]});this.state.contourData=n}return this.state.contourData}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:s}=this.state;r.setProps({binIdRange:s,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let e=this._getContours();if(!e)return null;let{lines:r,polygons:i}=e,{zOffset:n}=this.props,{cellOriginCommon:s,cellSizeCommon:o}=this.state,a=this.getSubLayerClass("lines",Tn),A=this.getSubLayerClass("bands",ks),h=new Ce().translate([s[0],s[1],0]).scale([o[0],o[1],n]),g=r&&r.length>0&&new a(this.getSubLayerProps({id:"lines"}),{data:r,coordinateSystem:Se.CARTESIAN,modelMatrix:h,getPath:b=>b.vertices,getColor:b=>b.contour.color??cP,getWidth:b=>b.contour.strokeWidth??Sj,widthUnits:"pixels"}),_=i&&i.length>0&&new A(this.getSubLayerProps({id:"bands"}),{data:i,coordinateSystem:Se.CARTESIAN,modelMatrix:h,getPolygon:b=>b.vertices,getFillColor:b=>b.contour.color??cP});return[g,_]}getPickingInfo(e){let r=e.info,{object:i}=r;return i&&(r.object={contour:i.contour}),r}};ef.layerName="ContourLayer";ef.defaultProps=Mj;var lP=ef;var AP=`#version 300 es
#define SHADER_NAME grid-cell-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec2 instancePositions;
in float instanceElevationValues;
in float instanceColorValues;
in vec3 instancePickingColors;
uniform sampler2D colorRange;
out vec4 vColor;
float interp(float value, vec2 domain, vec2 range) {
float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
return mix(range.x, range.y, r);
}
vec4 interp(float value, vec2 domain, sampler2D range) {
float r = (value - domain.x) / (domain.y - domain.x);
return texture(range, vec2(r, 0.5));
}
void main(void) {
geometry.pickingColor = instancePickingColors;
if (isnan(instanceColorValues) ||
instanceColorValues < grid.colorDomain.z ||
instanceColorValues > grid.colorDomain.w ||
instanceElevationValues < grid.elevationDomain.z ||
instanceElevationValues > grid.elevationDomain.w
) {
gl_Position = vec4(0.);
return;
}
vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
geometry.position = vec4(commonPosition, 0.0, 1.0);
geometry.normal = project_normal(normals);
float elevation = 0.0;
if (column.extruded) {
elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
elevation = project_size(elevation);
geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
}
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
vColor.a *= layer.opacity;
if (column.extruded) {
vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Pj=`uniform gridUniforms {
  vec4 colorDomain;
  vec4 elevationDomain;
  vec2 elevationRange;
  vec2 originCommon;
  vec2 sizeCommon;
} grid;
`,uP={name:"grid",vs:Pj,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};var tf=class extends bn{getShaders(){let e=super.getShaders();return e.modules.push(uP),{...e,vs:AP}}initializeState(){super.initializeState();let e=this.getAttributeManager();e.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),e.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e,n=this.state.fillModel;if(i.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=gc(this.context.device,r.colorRange,r.colorScaleType);let s={colorRange:this.state.colorTexture};n.shaderInputs.setProps({grid:s})}else i.colorScaleType!==r.colorScaleType&&pc(this.state.colorTexture,r.colorScaleType)}finalizeState(e){super.finalizeState(e),this.state.colorTexture?.destroy()}_updateGeometry(){let e=new Bo;this.state.fillModel.setGeometry(e)}draw({uniforms:e}){let{cellOriginCommon:r,cellSizeCommon:i,elevationRange:n,elevationScale:s,extruded:o,coverage:a,colorDomain:A,elevationDomain:h}=this.props,g=this.props.colorCutoff||[-1/0,1/0],_=this.props.elevationCutoff||[-1/0,1/0],b=this.state.fillModel,T={colorDomain:[Math.max(A[0],g[0]),Math.min(A[1],g[1]),Math.max(A[0]-1,g[0]),Math.min(A[1]+1,g[1])],elevationDomain:[Math.max(h[0],_[0]),Math.min(h[1],_[1]),Math.max(h[0]-1,_[0]),Math.min(h[1]+1,_[1])],elevationRange:[n[0]*s,n[1]*s],originCommon:r,sizeCommon:i};b.shaderInputs.setProps({column:{extruded:o,coverage:a},grid:T}),b.draw(this.context.renderPass)}};tf.layerName="GridCellLayer";var Rj=`uniform binOptionsUniforms {
  vec2 cellOriginCommon;
  vec2 cellSizeCommon;
} binOptions;
`,fP={name:"binOptions",vs:Rj,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function hP(){}var Ij={gpuAggregation:!0,colorDomain:null,colorRange:Vs,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:hP,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:hP,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:t=>t.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},rf=class extends En{getAggregatorType(){let{gpuAggregation:e,gridAggregator:r,getColorValue:i,getElevationValue:n}=this.props;return e&&(r||i||n)?(me.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):e&&Qt.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){if(e==="cpu"){let{gridAggregator:r,cellSize:i}=this.props;return new Ur({dimensions:2,getBin:{sources:["positions"],getValue:({positions:n},s,o)=>{if(r)return r(n,i);let A=this.state.aggregatorViewport.projectPosition(n),{cellSizeCommon:h,cellOriginCommon:g}=o;return[Math.floor((A[0]-g[0])/h[0]),Math.floor((A[1]-g[1])/h[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:n})=>n},{sources:["elevationWeights"],getValue:({elevationWeights:n})=>n}]})}return new Qt(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[et,fP],vs:`
  in vec3 positions;
  in vec3 positions64Low;
  in float colorWeights;
  in float elevationWeights;

  void getBin(out ivec2 binId) {
    vec3 positionCommon = project_position(positions, positions64Low);
    vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
    binId = ivec2(gridCoords);
  }
  void getValue(out vec2 value) {
    value = vec2(colorWeights, elevationWeights);
  }
  `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(e){let r=super.updateState(e),{props:i,oldProps:n,changeFlags:s}=e,{aggregator:o}=this.state;if((s.dataChanged||!this.state.dataAsArray)&&(i.getColorValue||i.getElevationValue)&&(this.state.dataAsArray=Array.from(Yt(i.data).iterable)),r||s.dataChanged||i.cellSize!==n.cellSize||i.getColorValue!==n.getColorValue||i.getElevationValue!==n.getElevationValue||i.colorAggregation!==n.colorAggregation||i.elevationAggregation!==n.elevationAggregation){this._updateBinOptions();let{cellSizeCommon:a,cellOriginCommon:A,binIdRange:h,dataAsArray:g}=this.state;if(o.setProps({binIdRange:h,pointCount:this.getNumInstances(),operations:[i.colorAggregation,i.elevationAggregation],binOptions:{cellSizeCommon:a,cellOriginCommon:A},onUpdate:this._onAggregationUpdate.bind(this)}),g){let{getColorValue:_,getElevationValue:b}=this.props;o.setProps({customOperations:[_&&(T=>_(T.map(v=>g[v]),{indices:T,data:i.data})),b&&(T=>b(T.map(v=>g[v]),{indices:T,data:i.data}))]})}}return s.updateTriggersChanged&&s.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),s.updateTriggersChanged&&s.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),r}_updateBinOptions(){let e=this.getBounds(),r=[1,1],i=[0,0],n=[[0,1],[0,1]],s=this.context.viewport;if(e&&Number.isFinite(e[0][0])){let o=[(e[0][0]+e[1][0])/2,(e[0][1]+e[1][1])/2],{cellSize:a}=this.props,{unitsPerMeter:A}=s.getDistanceScales(o);r[0]=A[0]*a,r[1]=A[1]*a;let h=s.projectFlat(o);i=[Math.floor(h[0]/r[0])*r[0],Math.floor(h[1]/r[1])*r[1]],o=s.unprojectFlat(i);let g=s.constructor;s=s.isGeospatial?new g({longitude:o[0],latitude:o[1],zoom:12}):new ai({position:[o[0],o[1],0],zoom:12}),i=[Math.fround(s.center[0]),Math.fround(s.center[1])],n=mc({dataBounds:e,getBinId:_=>{let b=s.projectFlat(_);return[Math.floor((b[0]-i[0])/r[0]),Math.floor((b[1]-i[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:i,binIdRange:n,aggregatorViewport:s})}draw(e){e.shaderModuleProps.project&&(e.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(e)}_onAggregationUpdate({channel:e}){let r=this.getCurrentLayer().props,{aggregator:i}=this.state;if(e===0){let n=i.getResult(0);this.setState({colors:new zs(n,i.binCount)}),r.onSetColorDomain(i.getResultDomain(0))}else if(e===1){let n=i.getResult(1);this.setState({elevations:new zs(n,i.binCount)}),r.onSetElevationDomain(i.getResultDomain(1))}}onAttributeChange(e){let{aggregator:r}=this.state;switch(e){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:i,cellOriginCommon:n,binIdRange:s}=this.state;r.setProps({binIdRange:s,binOptions:{cellSizeCommon:i,cellOriginCommon:n}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:e,cellOriginCommon:r,cellSizeCommon:i}=this.state,{elevationScale:n,colorRange:s,elevationRange:o,extruded:a,coverage:A,material:h,transitions:g,colorScaleType:_,lowerPercentile:b,upperPercentile:T,colorDomain:v,elevationScaleType:C,elevationLowerPercentile:S,elevationUpperPercentile:P,elevationDomain:F}=this.props,I=this.getSubLayerClass("cells",tf),k=e.getBins(),W=this.state.colors?.update({scaleType:_,lowerPercentile:b,upperPercentile:T}),K=this.state.elevations?.update({scaleType:C,lowerPercentile:S,upperPercentile:P});return!W||!K?null:new I(this.getSubLayerProps({id:"cells"}),{data:{length:e.binCount,attributes:{getBin:k,getColorValue:W.attribute,getElevationValue:K.attribute}},dataComparator:(re,Y)=>re.length===Y.length,updateTriggers:{getBin:[k],getColorValue:[W.attribute],getElevationValue:[K.attribute]},cellOriginCommon:r,cellSizeCommon:i,elevationScale:n,colorRange:s,colorScaleType:_,elevationRange:o,extruded:a,coverage:A,material:h,colorDomain:W.domain||v||e.getResultDomain(0),elevationDomain:K.domain||F||e.getResultDomain(1),colorCutoff:W.cutoff,elevationCutoff:K.cutoff,transitions:g&&{getFillColor:g.getColorValue||g.getColorWeight,getElevation:g.getElevationValue||g.getElevationWeight},extensions:[]})}getPickingInfo(e){let r=e.info,{index:i}=r;if(i>=0){let n=this.state.aggregator.getBin(i),s;n&&(s={col:n.id[0],row:n.id[1],colorValue:n.value[0],elevationValue:n.value[1],count:n.count},n.pointIndices&&(s.pointIndices=n.pointIndices,s.points=Array.isArray(this.props.data)?n.pointIndices.map(o=>this.props.data[o]):[])),r.object=s}return r}};rf.layerName="GridLayer";rf.defaultProps=Ij;var dP=rf;function gP(t){let e=t.map(a=>a[0]),r=t.map(a=>a[1]),i=Math.min.apply(null,e),n=Math.max.apply(null,e),s=Math.min.apply(null,r),o=Math.max.apply(null,r);return[i,s,n,o]}function mP(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}var pP=new Float32Array(12);function My(t,e=2){let r=0;for(let i of t)for(let n=0;n<e;n++)pP[r++]=i[n]||0;return pP}function _P(t,e,r){let[i,n,s,o]=t,a=s-i,A=o-n,h=a,g=A;a/A<e/r?h=e/r*A:g=r/e*a,h<e&&(h=e,g=r);let _=(s+i)/2,b=(o+n)/2;return[_-h/2,b-g/2,_+h/2,b+g/2]}function yP(t,e){let[r,i,n,s]=e;return[(t[0]-r)/(n-r),(t[1]-i)/(s-i)]}var xP=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`;var bP=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`;var TP=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,EP={name:"triangle",vs:TP,fs:TP,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};var yp=class extends xt{getShaders(){return super.getShaders({vs:xP,fs:bP,modules:[et,EP]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){let{vertexCount:r,data:i}=this.props;return new je(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){let{model:e}=this.state,{aggregationMode:r,colorDomain:i,intensity:n,threshold:s,colorTexture:o,maxTexture:a,weightsTexture:A}=this.props,h={aggregationMode:r,colorDomain:i,intensity:n,threshold:s,colorTexture:o,maxTexture:a,weightsTexture:A};e.shaderInputs.setProps({triangle:h}),e.draw(this.context.renderPass)}};yp.layerName="TriangleLayer";var vP=yp;function wP(t,e){let r={};for(let i in t)e.includes(i)||(r[i]=t[i]);return r}var xp=class extends zt{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:wP(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);let{changeFlags:r}=e;if(r.extensionsChanged){let i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:e,mousePosition:r,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:r,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,r={}){let{props:i,oldProps:n,changeFlags:s}=e,{compareAll:o=!1,dimension:a}=r,{ignoreProps:A}=this.state,{props:h,accessors:g=[]}=a,{updateTriggersChanged:_}=s;if(s.dataChanged)return!0;if(_){if(_.all)return!0;for(let b of g)if(_[b])return!0}if(o)return s.extensionsChanged?!0:eu({oldProps:n,newProps:i,ignoreProps:A,propTypes:this.constructor._propTypes});for(let b of h)if(i[b]!==n[b])return!0;return!1}isAttributeChanged(e){let{changedAttributes:r}=this.state;return e?r&&r[e]!==void 0:!Bj(r)}_getAttributeManager(){return new vi(this.context.device,{id:this.props.id,stats:this.context.stats})}};xp.layerName="AggregationLayer";var CP=xp;function Bj(t){let e=!0;for(let r in t){e=!1;break}return e}var Py=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`;var Ry=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var SP=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`;var MP=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`;var Oj=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,PP={name:"weight",vs:Oj,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},RP={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}};var Fj=2,Iy={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},IP=[0,0],Lj={SUM:0,MEAN:1},Nj={getPosition:{type:"accessor",value:t=>t.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Vs,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},Dj=["float32-renderable-webgl","texture-blend-float-webgl"],kj={data:{props:["radiusPixels"]}},nf=class extends CP{getShaders(e){let r=[et];return e.modules&&(r=[...r,...e.modules]),super.getShaders({...e,modules:r})}initializeState(){super.initializeAggregationLayer(kj),this.setState({colorDomain:IP}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){let{props:r,oldProps:i}=e,n=this._getChangeFlags(e);(n.dataChanged||n.viewportChanged)&&(n.boundsChanged=this._updateBounds(n.dataChanged),this._updateTextureRenderingBounds()),n.dataChanged||n.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):n.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){let{weightsTexture:e,triPositionBuffer:r,triTexCoordBuffer:i,maxWeightsTexture:n,colorTexture:s,colorDomain:o}=this.state,{updateTriggers:a,intensity:A,threshold:h,aggregation:g}=this.props,_=this.getSubLayerClass("triangle",vP);return new _(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:Se.DEFAULT,data:{attributes:{positions:r,texCoords:i}},vertexCount:4,maxTexture:n,colorTexture:s,aggregationMode:Lj[g]||0,weightsTexture:e,intensity:A,threshold:h,colorDomain:o})}finalizeState(e){super.finalizeState(e);let{weightsTransform:r,weightsTexture:i,maxWeightTransform:n,maxWeightsTexture:s,triPositionBuffer:o,triTexCoordBuffer:a,colorTexture:A,updateTimer:h}=this.state;r?.destroy(),i?.destroy(),n?.destroy(),s?.destroy(),o?.destroy(),a?.destroy(),A?.destroy(),h&&clearTimeout(h)}_getAttributeManager(){return new vi(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){let r={},{dimensions:i}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",r.viewportChanged=e.changeFlags.viewportChanged;let{zoom:n}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==n)&&(r.viewportZoomChanged=!0),r}_createTextures(){let{textureSize:e,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Iy,width:e,height:e,format:r}),maxWeightsTexture:this.context.device.createTexture({...Iy,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:e}=this.context,{weightsTextureSize:r}=this.props,i=Math.min(r,e.limits.maxTextureDimension2D),n=Dj.every(a=>e.features.has(a)),s=n?"rgba32float":"rgba8unorm",o=n?1:1/255;this.setState({textureSize:i,format:s,weightsScale:o}),n||me.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:r}=this.state,{weightsTexture:i}=this.state,n=this.getAttributeManager();r?.destroy(),r=new qa(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:n.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,PP]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();let{device:e}=this.context,{textureSize:r,weightsTexture:i,maxWeightsTexture:n}=this.state,s=this.getShaders({vs:Py,fs:Ry});this._createWeightsTransform(s);let o=this.getShaders({vs:SP,fs:MP,modules:[RP]}),a=new qa(e,{id:`${this.id}-max-weights-transform`,targetTexture:n,...o,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),A={inTexture:i,textureSize:r};a.model.shaderInputs.setProps({maxWeight:A}),this.setState({weightsTexture:i,maxWeightsTexture:n,maxWeightTransform:a,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:Py,fs:Ry,...e})}_updateMaxWeightValue(){let{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){let{viewport:r}=this.context,i=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(a=>a.map(Math.fround)),n=gP(i),s={visibleWorldBounds:n,viewportCorners:i},o=!1;if(e||!this.state.worldBounds||!mP(this.state.worldBounds,n)){let a=this._worldToCommonBounds(n),A=this._commonToWorldBounds(a);this.props.coordinateSystem===Se.LNGLAT&&(A[1]=Math.max(A[1],-85.051129),A[3]=Math.min(A[3],85.051129),A[0]=Math.max(A[0],-360),A[2]=Math.min(A[2],360));let h=this._worldToCommonBounds(A);s.worldBounds=A,s.normalizedCommonBounds=h,o=!0}return this.setState(s),o}_updateTextureRenderingBounds(){let{triPositionBuffer:e,triTexCoordBuffer:r,normalizedCommonBounds:i,viewportCorners:n}=this.state,{viewport:s}=this.context;e.write(My(n,3));let o=n.map(a=>yP(s.projectPosition(a),i));r.write(My(o,2))}_updateColorTexture(e){let{colorRange:r}=e.props,{colorTexture:i}=this.state,n=Cy(r,!1,Uint8Array);i&&i?.width===r.length?i.setTexture2DData({data:n}):(i?.destroy(),i=this.context.device.createTexture({...Iy,data:n,width:r.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){let{radiusPixels:e,colorDomain:r,aggregation:i}=this.props,{worldBounds:n,textureSize:s,weightsScale:o,weightsTexture:a}=this.state,A=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let h=this._worldToCommonBounds(n,{useLayerCoordinateSystem:!0});if(r&&i==="SUM"){let{viewport:I}=this.context,k=I.distanceScales.metersPerUnit[2]*(h[2]-h[0])/s;this.state.colorDomain=r.map(W=>W*k*o)}else this.state.colorDomain=r||IP;let _=this.getAttributeManager().getAttributes(),b=this.getModuleSettings();this._setModelAttributes(A.model,_),A.model.setVertexCount(this.getNumInstances());let T={radiusPixels:e,commonBounds:h,textureWidth:s,weightsScale:o,weightsTexture:a},{viewport:v,devicePixelRatio:C,coordinateSystem:S,coordinateOrigin:P}=b,{modelMatrix:F}=this.props;A.model.shaderInputs.setProps({project:{viewport:v,devicePixelRatio:C,modelMatrix:F,coordinateSystem:S,coordinateOrigin:P},weight:T}),A.run({parameters:{viewport:[0,0,s,s]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:r}=this.state,{debounceTimeout:i}=this.props;e?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:r})}_worldToCommonBounds(e,r={}){let{useLayerCoordinateSystem:i=!1}=r,[n,s,o,a]=e,{viewport:A}=this.context,{textureSize:h}=this.state,{coordinateSystem:g}=this.props,_=i&&(g===Se.LNGLAT_OFFSETS||g===Se.METER_OFFSETS),b=_?A.projectPosition(this.props.coordinateOrigin):[0,0],T=h*Fj/A.scale,v,C;return i&&!_?(v=this.projectPosition([n,s,0]),C=this.projectPosition([o,a,0])):(v=A.projectPosition([n,s,0]),C=A.projectPosition([o,a,0])),_P([v[0]-b[0],v[1]-b[1],C[0]-b[0],C[1]-b[1]],T,T)}_commonToWorldBounds(e){let[r,i,n,s]=e,{viewport:o}=this.context,a=o.unprojectPosition([r,i]),A=o.unprojectPosition([n,s]);return a.slice(0,2).concat(A.slice(0,2))}};nf.layerName="HeatmapLayer";nf.defaultProps=Nj;var BP=nf;function Uj(t){return typeof t=="string"?t.charAt(0).toLowerCase()+t.slice(1):t}function bp(t){if(Array.isArray(t))return t.map(e=>bp(e));if(t&&typeof t=="object"){let e={};for(let[r,i]of Object.entries(t))e[Uj(r)]=bp(i);return e}return t}var fR=_a(uR(),1);function zy(t,e){if(e?._parser&&e._parser!=="fast-xml-parser")throw new Error(e?._parser);let r={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:e?.removeNSPrefix,textNodeName:e?.textNodeName,isArray:(n,s,o,a)=>!!e?.arrayPaths?.some(h=>s===h),...e?._fastXML},i=JX(t,r);return e?.uncapitalizeKeys?bp(i):i}function JX(t,e){return new fR.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...e}).parse(t)}var ZX="4.3.2",Gi={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:ZX,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:$X,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,e)=>zy(new TextDecoder().decode(t),{...Gi.options.xml,...e?.xml}),parseTextSync:(t,e)=>zy(t,{...Gi.options.xml,...e?.xml})};function $X(t){return t.startsWith("<?xml")}function hR(t,e){let r=Gi.parseTextSync?.(t,e),i=r?.ServiceExceptionReport?.ServiceException||r?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof i=="string"?i:i.value||i.code||"Unknown error"}var eY="4.3.2",af={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:eY,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:tY,options:{wms:{throwOnError:!1}},parse:async(t,e)=>Hy(new TextDecoder().decode(t),e),parseSync:(t,e)=>Hy(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>Hy(t,e)};function tY(t){return t.startsWith("<?xml")}function Hy(t,e){let r={...af.options.wms,...e?.wms},i=hR(t,r),n=r.minimalErrors?i:`WMS Service error: ${i}`;if(r.throwOnError)throw new Error(n);return n}function Yo(t){return Array.isArray(t)?t:t?[t]:[]}function cf(t){let e=Yo(t);return e.length>0&&e.every(r=>typeof r=="string")?e:[]}function lf(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseFloat(t);default:return}}function Ep(t,e=void 0){switch(typeof t){case"number":return t;case"string":return parseInt(t,10);default:return}}function Qo(t){switch(t){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function Gy(t,e){let r=Gi.parseTextSync?.(t,e),i=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,n=rY(i);if(e?.inheritedLayerProps)for(let s of n.layers)pR(s,null);return e?.includeRawJSON&&(n.json=i),e?.includeXMLText&&(n.xml=t),n}function rY(t){let e={version:String(t.version||""),name:String(t.Service?.Name||"unnamed"),title:t.Service?.Title?String(t.Service?.Title):void 0,abstract:t.Service?.Abstract?String(t.Service?.Abstract):void 0,keywords:cf(t.Service?.KeywordList?.Keyword),fees:t.Service?.Fees?JSON.stringify(t.Service?.Fees):void 0,accessConstraints:t.Service?.AccessConstraints?JSON.stringify(t.Service?.AccessConstraints):void 0,layerLimit:Ep(t.Service?.LayerLimit),maxWidth:Ep(t.Service?.maxWidth),maxHeight:Ep(t.Service?.maxHeight),layers:[],requests:iY(t.Capability?.Request),exceptions:nY(t.Exception)},r=Yo(t.Capability?.Layer);for(let i of r)e.layers.push(dR(i));for(let[i,n]of Object.entries(e))n===void 0&&delete e[i];return e}function iY(t){let e={};for(let[r,i]of Object.entries(t||{})){let n=cf(i?.Format);e[r]={mimeTypes:n}}return e}function nY(t){if(Yo(t?.Format).length>0)return{mimeTypes:cf(t)}}function dR(t){let e={title:String(t?.Title||""),name:t?.Name&&String(t?.Name),abstract:t?.Name&&String(t?.Abstract),keywords:cf(t.KeywordList?.Keyword)},r=t?.CRS||t?.SRS;r&&Array.isArray(r)&&r.every(h=>typeof h=="string")&&(e.crs=r);let i=t?.EX_GeographicBoundingBox&&sY(t?.EX_GeographicBoundingBox);i&&(e.geographicBoundingBox=i),i=t?.LatLonBoundingBox&&oY(t?.LatLonBoundingBox),i&&(e.geographicBoundingBox=i);let n=t?.BoundingBox&&aY(t?.BoundingBox);n&&n.length>0&&(e.boundingBoxes=n);let o=Yo(t?.Dimension).map(h=>lY(h));o.length&&(e.dimensions=o),t?.opaque&&(e.opaque=Qo(t?.opaque)),t?.cascaded&&(e.cascaded=Qo(t?.cascaded)),t?.queryable&&(e.queryable=Qo(t?.queryable));let a=Yo(t?.Layer),A=[];for(let h of a)A.push(dR(h));A.length>0&&(e.layers=A);for(let[h,g]of Object.entries(e))g===void 0&&delete e[h];return e}function sY(t){let{westBoundLongitude:e,northBoundLatitude:r,eastBoundLongitude:i,southBoundLatitude:n}=t;return[[e,n],[i,r]]}function oY(t){let{minx:e,miny:r,maxx:i,maxy:n}=t;return[[e,r],[i,n]]}function aY(t){return Yo(t).map(r=>cY(r))}function cY(t){let{CRS:e,SRS:r,minx:i,miny:n,maxx:s,maxy:o,resx:a,resy:A}=t,h={crs:e||r,boundingBox:[[lf(i),lf(n)],[lf(s),lf(o)]]};return a&&(h.xResolution=a),A&&(h.yResolution=A),h}function lY(t){let{name:e,units:r,value:i}=t,n={name:e,units:r,extent:i};return t.unitSymbol&&(n.unitSymbol=t.unitSymbol),t.default&&(n.defaultValue=t.default),t.multipleValues&&(n.multipleValues=Qo(t.multipleValues)),t.nearestValue&&(n.nearestValue=Qo(t.nearestValue)),t.current&&(n.current=Qo(t.current)),n}function pR(t,e){e?.geographicBoundingBox&&!t.geographicBoundingBox&&(t.geographicBoundingBox=[...e.geographicBoundingBox]),e?.crs&&!t.crs&&(t.crs=[...e.crs]),e?.boundingBoxes&&!t.boundingBoxes&&(t.boundingBoxes=[...e.boundingBoxes]),e?.dimensions&&!t.dimensions&&(t.dimensions=[...e.dimensions]);for(let r of t.layers||[])pR(r,t)}var AY="4.3.2",Mc={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:AY,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:uY,options:{wms:{}},parse:async(t,e)=>Gy(new TextDecoder().decode(t),e?.wms),parseTextSync:(t,e)=>Gy(t,e?.wms)};function uY(t){return t.startsWith("<?xml")}function Wy(t,e){let i=(Gi.parseTextSync?.(t,e)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(i)?i:[i]).map(s=>fY(s))}}function fY(t){return{attributes:t||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}var gR={...Mc,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(t,e)=>Wy(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>Wy(t,e)};function jy(t,e){return Gi.parseTextSync?.(t,e)}var mR={...Mc,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(t,e)=>jy(new TextDecoder().decode(t),e),parseTextSync:(t,e)=>jy(t,e)};var _R={name:"Web Map Service (OGC WMS)",id:"wms",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{wms:{}},type:"wms",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("wms"),createDataSource:(t,e)=>new Xy(t,e)},Xy=class extends rn{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(e,r){super(r),this.url=e,this.data=e,this.substituteCRS84=r.wms?.substituteCRS84??r.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...r.wmsParameters,...r.wms?.wmsParameters},this.vendorParameters=r.wms?.vendorParameters||r.vendorParameters||{}}async getMetadata(){let e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){let{boundingBox:r,bbox:i,...n}=e,s={bbox:r?[...r[0],...r[1]]:i,...n};return await this.getMap(s)}normalizeMetadata(e){return e}async getCapabilities(e,r){let i=this.getCapabilitiesURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);let o=await Mc.parse(s,this.loadOptions);return this.capabilities=o,o}async getMap(e,r){let i=this.getMapURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);try{return await ps.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}async getFeatureInfo(e,r){let i=this.getFeatureInfoURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),await gR.parse(s,this.loadOptions)}async getFeatureInfoText(e,r){let i=this.getFeatureInfoURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),new TextDecoder().decode(s)}async describeLayer(e,r){let i=this.describeLayerURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();return this._checkResponse(n,s),await mR.parse(s,this.loadOptions)}async getLegendGraphic(e,r){let i=this.getLegendGraphicURL(e,r),n=await this.fetch(i),s=await n.arrayBuffer();this._checkResponse(n,s);try{return await ps.parse(s,this.loadOptions)}catch{throw this._parseError(s)}}getCapabilitiesURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",i,r)}getMapURL(e,r){e=this._getWMS130Parameters(e);let i={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",i,r)}getFeatureInfoURL(e,r){e=this._getWMS130Parameters(e);let{boundingBox:i,bbox:n}=e;e.bbox=i?[...i[0],...i[1]]:n;let s={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",s,r)}describeLayerURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",i,r)}getLegendGraphicURL(e,r){let i={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",i,r)}_parseWMSUrl(e){let[r,i]=e.split("?"),n=i.split("&"),s={};for(let o of n){let[a,A]=o.split("=");s[a]=A}return{url:r,parameters:s}}_getWMSUrl(e,r,i){let n=this.url,s=!0,o={service:"WMS",version:r.version,request:e,...r,...this.vendorParameters,...i},a=["transparent","time","elevation"];for(let[A,h]of Object.entries(o))(!a.includes(A)||h)&&(n+=s?"?":"&",s=!1,n+=this._getURLParameter(A,h,r));return encodeURI(n)}_getWMS130Parameters(e){let r={...e};return r.srs&&(r.crs=r.crs||r.srs,delete r.srs),r}_getURLParameter(e,r,i){switch(e){case"crs":i.version!=="1.3.0"?e="srs":this.substituteCRS84&&r==="EPSG:4326"&&(r="CRS:84");break;case"srs":i.version==="1.3.0"&&(e="crs");break;case"bbox":let n=this._flipBoundingBox(r,i);n&&(r=n);break;case"x":i.version==="1.3.0"&&(e="i");break;case"y":i.version==="1.3.0"&&(e="j");break;default:}return e=e.toUpperCase(),Array.isArray(r)?`${e}=${r.join(",")}`:`${e}=${r?String(r):""}`}_flipBoundingBox(e,r){if(!Array.isArray(e)||e.length!==4)return null;let i=r.version==="1.3.0"&&this.flipCRS.includes(r.crs||"")&&!(this.substituteCRS84&&r.crs==="EPSG:4326"),n=e;return i?[n[1],n[0],n[3],n[2]]:n}async _fetchArrayBuffer(e){let r=await this.fetch(e),i=await r.arrayBuffer();return this._checkResponse(r,i),i}_checkResponse(e,r){let i=e.headers["content-type"];if(!e.ok||af.mimeTypes.includes(i)){let n=ml(this.loadOptions,{wms:{throwOnError:!0}}),s=af.parseSync?.(r,n);throw new Error(s)}}_parseError(e){let r=af.parseSync?.(e,this.loadOptions);return new Error(r)}};var yR={name:"ArcGISImageServer",id:"arcgis-image-server",module:"wms",version:"0.0.0",extensions:[],mimeTypes:[],options:{"arcgis-image-server":{}},type:"arcgis-image-server",fromUrl:!0,fromBlob:!1,testURL:t=>t.toLowerCase().includes("ImageServer"),createDataSource:(t,e)=>new Yy(t,e)},Yy=class extends rn{url;data;constructor(e,r){super(r),this.url=e,this.data=e}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.url}?f=pjson`}exportImageURL(e){let r=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,i=`size=${e.width},${e.height}`,n={...e,bbox:r,size:i};return delete n.width,delete n.height,this.getUrl("exportImage",n)}getUrl(e,r,i){let n=`${this.url}/${e}`,s=!0;for(let[o,a]of Object.entries(r))n+=s?"?":"&",s=!1,Array.isArray(a)?n+=`${o.toUpperCase()}=${a.join(",")}`:n+=`${o.toUpperCase()}=${a?String(a):""}`;return n}async checkResponse(e){if(!e.ok)throw new Error("error")}};var hY=[_R,yR];function Qy(t,e=hY){let{type:r="auto"}=t,i=r==="auto"?pY(t.url,e):dY(r,e);if(!i)throw new Error("Not a valid image source type");return i.createDataSource(t.url,t)}function dY(t,e){for(let r of e)if(r.type===t)return r;return null}function pY(t,e){for(let r of e)if(r.testURL&&r.testURL(t))return r;return null}var xR=6378137*Math.PI;function qy(t){let e=nr(t);return e[0]=(e[0]/256-1)*xR,e[1]=(e[1]/256-1)*xR,e}var gY={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(t,e)=>console.error(e,t)}},Pc=class extends zt{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:e,props:r,oldProps:i}){let{viewport:n}=this.context;e.dataChanged||r.serviceType!==i.serviceType?(this.state.imageSource=this._createImageSource(r),this._loadMetadata(),this.debounce(()=>this.loadImage(n,"image source changed"),0)):Et(r.layers,i.layers,1)?e.viewportChanged&&this.debounce(()=>this.loadImage(n,"viewport changed")):this.debounce(()=>this.loadImage(n,"layers changed"),0)}finalizeState(){}renderLayers(){let{bounds:e,image:r,lastRequestParameters:i}=this.state;return r&&new Od({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:i.srs==="EPSG:4326"?Se.LNGLAT:Se.CARTESIAN,bounds:e,image:r})}async getFeatureInfoText(e,r){let{lastRequestParameters:i}=this.state;return i?await this.state.imageSource.getFeatureInfoText?.({...i,query_layers:i.layers,x:e,y:r,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(e){if(e.data instanceof rn)return e.data;if(typeof e.data=="string")return Qy({url:e.data,loadOptions:e.loadOptions,type:e.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){let{imageSource:e}=this.state;try{this.state.loadCounter++;let r=await e.getMetadata();this.state.imageSource===e&&this.getCurrentLayer()?.props.onMetadataLoad(r)}catch(r){this.getCurrentLayer()?.props.onMetadataLoadError(r)}finally{this.state.loadCounter--}}async loadImage(e,r){let{layers:i,serviceType:n}=this.props;if(n==="wms"&&i.length===0)return;let s=e.getBounds(),{width:o,height:a}=e,A=this.getRequestId(),{srs:h}=this.props;h==="auto"&&(h=e.resolution?"EPSG:4326":"EPSG:3857");let g={width:o,height:a,boundingBox:[[s[0],s[1]],[s[2],s[3]]],layers:i,crs:h};if(h==="EPSG:3857"){let _=qy([s[0],s[1]]),b=qy([s[2],s[3]]);g.boundingBox=[_,b]}try{this.state.loadCounter++,this.props.onImageLoadStart(A);let _=await this.state.imageSource.getImage(g);this.state.lastRequestId<A&&(this.getCurrentLayer()?.props.onImageLoad(A),this.setState({image:_,bounds:s,lastRequestParameters:g,lastRequestId:A}))}catch(_){this.raiseError(_,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(A,_)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(e,r=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>e(),r)}};Pc.layerName="WMSLayer";Pc.defaultProps=gY;var mY={getHeight:{type:"accessor",value:0},greatCircle:!0},Af=class extends Bd{};Af.layerName="GreatCircleLayer";Af.defaultProps=mY;var bR=Af;var _Y={...Us.defaultProps},uf=class extends zt{indexToBounds(){return null}renderLayers(){let{elevationScale:e,extruded:r,wireframe:i,filled:n,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:A,lineWidthMaxPixels:h,lineJointRounded:g,lineMiterLimit:_,lineDashJustified:b,getElevation:T,getFillColor:v,getLineColor:C,getLineWidth:S}=this.props,{updateTriggers:P,material:F,transitions:I}=this.props,k=this.getSubLayerClass("cell",Us),{updateTriggers:W,...K}=this.indexToBounds()||{};return new k({filled:n,wireframe:i,extruded:r,elevationScale:e,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:A,lineWidthMaxPixels:h,lineJointRounded:g,lineMiterLimit:_,lineDashJustified:b,material:F,transitions:I,getElevation:T,getFillColor:v,getLineColor:C,getLineWidth:S},this.getSubLayerProps({id:"cell",updateTriggers:P&&{...W,getElevation:P.getElevation,getFillColor:P.getFillColor,getLineColor:P.getLineColor,getLineWidth:P.getLineWidth}}),K)}};uf.layerName="GeoCellLayer";uf.defaultProps=_Y;var vn=uf;var vp=_a(Ky(),1),yY=3,xY=30,bY=2*xY+1,ER=180/Math.PI;function wR(t,e,r){let i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function vR(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function CR(t){return[vR(t[0]),vR(t[1])]}function SR(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function MR([t,e,r]){let i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*ER,i*ER]}function PR(t){let e=vp.default.fromString(t,!0,10).toString(2);for(;e.length<yY+bY;)e="0"+e;let r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),s=n.length/2,o=vp.default.fromString(i,!0,2).toString(10),a=vp.default.fromString(n,!0,2).toString(4);for(;a.length<s;)a="0"+a;return`${o}/${a}`}function TY(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function RR(t){let e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length,s=[0,0],o;for(let a=n-1;a>=0;a--){o=n-a;let A=i[a],h=0,g=0;A==="1"?g=1:A==="2"?(h=1,g=1):A==="3"&&(h=1);let _=Math.pow(2,o-1);TY(_,s,h,g),s[0]+=_*h,s[1]+=_*g}if(r%2===1){let a=s[0];s[0]=s[1],s[1]=a}return{face:r,ij:s,level:o}}var IR=_a(Ky(),1);function EY(t){let e=t.padEnd(16,"0");return IR.default.fromString(e,16)}var vY=100;function wY({face:t,ij:e,level:r}){let i=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(vY*Math.pow(2,-r))),s=new Float64Array(4*n*2+2),o=0,a=0;for(let A=0;A<4;A++){let h=i[A].slice(0),g=i[A+1],_=(g[0]-h[0])/n,b=(g[1]-h[1])/n;for(let T=0;T<n;T++){h[0]+=_,h[1]+=b;let v=wR(e,r,h),C=CR(v),S=SR(t,C),P=MR(S);Math.abs(P[1])>89.999&&(P[0]=a);let F=P[0]-a;P[0]+=F>180?-360:F<-180?360:0,s[o++]=P[0],s[o++]=P[1],a=P[0]}}return s[o++]=s[0],s[o++]=s[1],s}function CY(t){if(typeof t=="string"){if(t.indexOf("/")>0)return t;t=EY(t)}return PR(t.toString())}function BR(t){let e=CY(t),r=RR(e);return wY(r)}var SY={getS2Token:{type:"accessor",value:t=>t.token}},hf=class extends vn{indexToBounds(){let{data:e,getS2Token:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>BR(r(i,n))}}};hf.layerName="S2Layer";hf.defaultProps=SY;var OR=hf;var Jy=512;function MY(t,e){let r=0,i=0,n=1<<t.length,s=n/Jy;for(let o=0;o<t.length;o++){n>>=1;let a=parseInt(t[o]);a%2&&(r|=n),a>1&&(i|=n)}return[[r/s,Jy-i/s],[(r+e)/s,Jy-(i+e)/s]]}function FR(t,e=1){let[r,i]=MY(t,e),[n,s]=Rr(r),[o,a]=Rr(i);return[o,s,o,a,n,a,n,s,o,s]}var PY={getQuadkey:{type:"accessor",value:t=>t.quadkey}},df=class extends vn{indexToBounds(){let{data:e,extruded:r,getQuadkey:i}=this.props,n=r?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>FR(i(s,o),n),updateTriggers:{getPolygon:n}}}};df.layerName="QuadkeyLayer";df.defaultProps=PY;var LR=df;var qo=class{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:r,onLoad:i,onError:n}){let{index:s,id:o,bbox:a,userData:A,zoom:h}=this,g=this._loaderId;this._abortController=new AbortController;let{signal:_}=this._abortController,b=await r.scheduleRequest(this,C=>C.isSelected?1:-1);if(!b){this._isCancelled=!0;return}if(this._isCancelled){b.done();return}let T=null,v;try{T=await e({index:s,id:o,bbox:a,userData:A,zoom:h,signal:_})}catch(C){v=C||!0}finally{b.done()}if(g===this._loaderId){if(this._loader=void 0,this.content=T,this._isCancelled&&!T){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,v?n(v,this):i(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}};var Kt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var NR=new G,RY=new G,Rc=class t{constructor(e=[0,0,0],r=[0,0,0],i){i=i||NR.copy(e).add(r).scale(.5),this.center=new G(i),this.halfDiagonal=new G(r).subtract(this.center),this.minimum=new G(e),this.maximum=new G(r)}clone(){return new t(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){let{halfDiagonal:r}=this,i=RY.from(e.normal),n=r.x*Math.abs(i.x)+r.y*Math.abs(i.y)+r.z*Math.abs(i.z),s=this.center.dot(i)+e.distance;return s-n>0?Kt.INSIDE:s+n<0?Kt.OUTSIDE:Kt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let r=NR.from(e).subtract(this.center),{halfDiagonal:i}=this,n=0,s;return s=Math.abs(r.x)-i.x,s>0&&(n+=s*s),s=Math.abs(r.y)-i.y,s>0&&(n+=s*s),s=Math.abs(r.z)-i.z,s>0&&(n+=s*s),n}};var pf=new G,DR=new G,wn=class t{constructor(e=[0,0,0],r=0){this.radius=-0,this.center=new G,this.fromCenterRadius(e,r)}fromCenterRadius(e,r){return this.center.from(e),this.radius=r,this}fromCornerPoints(e,r){return r=pf.from(r),this.center=new G().from(e).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new t(this.center,this.radius)}union(e){let r=this.center,i=this.radius,n=e.center,s=e.radius,o=pf.copy(n).subtract(r),a=o.magnitude();if(i>=a+s)return this.clone();if(s>=a+i)return e.clone();let A=(i+a+s)*.5;return DR.copy(o).scale((-i+A)/a).add(r),this.center.copy(DR),this.radius=A,this}expand(e){let i=pf.from(e).subtract(this.center).magnitude();return i>this.radius&&(this.radius=i),this}transform(e){this.center.transform(e);let r=Xt.getScaling(pf,e);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(e){let r=this.distanceTo(e);return r*r}distanceTo(e){let i=pf.from(e).subtract(this.center);return Math.max(0,i.len()-this.radius)}intersectPlane(e){let r=this.center,i=this.radius,s=e.normal.dot(r)+e.distance;return s<-i?Kt.OUTSIDE:s<i?Kt.INTERSECTING:Kt.INSIDE}};var IY=new G,BY=new G,wp=new G,Cp=new G,Sp=new G,OY=new G,FY=new G,Jn={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},Zn=class t{constructor(e=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new G().from(e),this.halfAxes=new yt(r)}get halfSize(){let e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2);return[new G(e).len(),new G(r).len(),new G(i).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),i=this.halfAxes.getColumn(2),n=new G(e).normalize(),s=new G(r).normalize(),o=new G(i).normalize();return new yi().fromMatrix3(new yt([...n,...s,...o]))}fromCenterHalfSizeQuaternion(e,r,i){let n=new yi(i),s=new yt().fromQuaternion(n);return s[0]=s[0]*r[0],s[1]=s[1]*r[0],s[2]=s[2]*r[0],s[3]=s[3]*r[1],s[4]=s[4]*r[1],s[5]=s[5]*r[1],s[6]=s[6]*r[2],s[7]=s[7]*r[2],s[8]=s[8]*r[2],this.center=new G().from(e),this.halfAxes=s,this}clone(){return new t(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new wn){let r=this.halfAxes,i=r.getColumn(0,wp),n=r.getColumn(1,Cp),s=r.getColumn(2,Sp),o=IY.copy(i).add(n).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){let r=this.center,i=e.normal,n=this.halfAxes,s=i.x,o=i.y,a=i.z,A=Math.abs(s*n[Jn.COLUMN0ROW0]+o*n[Jn.COLUMN0ROW1]+a*n[Jn.COLUMN0ROW2])+Math.abs(s*n[Jn.COLUMN1ROW0]+o*n[Jn.COLUMN1ROW1]+a*n[Jn.COLUMN1ROW2])+Math.abs(s*n[Jn.COLUMN2ROW0]+o*n[Jn.COLUMN2ROW1]+a*n[Jn.COLUMN2ROW2]),h=i.dot(r)+e.distance;return h<=-A?Kt.OUTSIDE:h>=A?Kt.INSIDE:Kt.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let r=BY.from(e).subtract(this.center),i=this.halfAxes,n=i.getColumn(0,wp),s=i.getColumn(1,Cp),o=i.getColumn(2,Sp),a=n.magnitude(),A=s.magnitude(),h=o.magnitude();n.normalize(),s.normalize(),o.normalize();let g=0,_;return _=Math.abs(r.dot(n))-a,_>0&&(g+=_*_),_=Math.abs(r.dot(s))-A,_>0&&(g+=_*_),_=Math.abs(r.dot(o))-h,_>0&&(g+=_*_),g}computePlaneDistances(e,r,i=[-0,-0]){let n=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,o=this.center,a=this.halfAxes,A=a.getColumn(0,wp),h=a.getColumn(1,Cp),g=a.getColumn(2,Sp),_=OY.copy(A).add(h).add(g).add(o),b=FY.copy(_).subtract(e),T=r.dot(b);return n=Math.min(T,n),s=Math.max(T,s),_.copy(o).add(A).add(h).subtract(g),b.copy(_).subtract(e),T=r.dot(b),n=Math.min(T,n),s=Math.max(T,s),_.copy(o).add(A).subtract(h).add(g),b.copy(_).subtract(e),T=r.dot(b),n=Math.min(T,n),s=Math.max(T,s),_.copy(o).add(A).subtract(h).subtract(g),b.copy(_).subtract(e),T=r.dot(b),n=Math.min(T,n),s=Math.max(T,s),o.copy(_).subtract(A).add(h).add(g),b.copy(_).subtract(e),T=r.dot(b),n=Math.min(T,n),s=Math.max(T,s),o.copy(_).subtract(A).add(h).subtract(g),b.copy(_).subtract(e),T=r.dot(b),n=Math.min(T,n),s=Math.max(T,s),o.copy(_).subtract(A).subtract(h).add(g),b.copy(_).subtract(e),T=r.dot(b),n=Math.min(T,n),s=Math.max(T,s),o.copy(_).subtract(A).subtract(h).subtract(g),b.copy(_).subtract(e),T=r.dot(b),n=Math.min(T,n),s=Math.max(T,s),i[0]=n,i[1]=s,i}transform(e){this.center.transformAsPoint(e);let r=this.halfAxes.getColumn(0,wp);r.transformAsPoint(e);let i=this.halfAxes.getColumn(1,Cp);i.transformAsPoint(e);let n=this.halfAxes.getColumn(2,Sp);return n.transformAsPoint(e),this.halfAxes=new yt([...r,...i,...n]),this}getTransform(){throw new Error("not implemented")}};var kR=new G,UR=new G,Ir=class t{constructor(e=[0,0,1],r=0){this.normal=new G,this.distance=-0,this.fromNormalDistance(e,r)}fromNormalDistance(e,r){return gr(Number.isFinite(r)),this.normal.from(e).normalize(),this.distance=r,this}fromPointNormal(e,r){e=kR.from(e),this.normal.from(r).normalize();let i=-this.normal.dot(e);return this.distance=i,this}fromCoefficients(e,r,i,n){return this.normal.set(e,r,i),gr(er(this.normal.len(),1)),this.distance=n,this}clone(){return new t(this.normal,this.distance)}equals(e){return er(this.distance,e.distance)&&er(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let r=UR.copy(this.normal).transformAsVector(e).normalize(),i=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(i,r)}projectPointOntoPlane(e,r=[0,0,0]){let i=kR.from(e),n=this.getPointDistance(i),s=UR.copy(this.normal).scale(n);return i.subtract(s).to(r)}};var VR=[new G([1,0,0]),new G([0,1,0]),new G([0,0,1])],zR=new G,LY=new G,zr=class t{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*VR.length;let r=e.center,i=e.radius,n=0;for(let s of VR){let o=this.planes[n],a=this.planes[n+1];o||(o=this.planes[n]=new Ir),a||(a=this.planes[n+1]=new Ir);let A=zR.copy(s).scale(-i).add(r);o.fromPointNormal(A,s);let h=zR.copy(s).scale(i).add(r),g=LY.copy(s).negate();a.fromPointNormal(h,g),n+=2}return this}computeVisibility(e){let r=Kt.INSIDE;for(let i of this.planes)switch(e.intersectPlane(i)){case Kt.OUTSIDE:return Kt.OUTSIDE;case Kt.INTERSECTING:r=Kt.INTERSECTING;break;default:}return r}computeVisibilityWithPlaneMask(e,r){if(gr(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;let i=t.MASK_INSIDE,n=this.planes;for(let s=0;s<this.planes.length;++s){let o=s<31?1<<s:0;if(s<31&&!(r&o))continue;let a=n[s],A=e.intersectPlane(a);if(A===Kt.OUTSIDE)return t.MASK_OUTSIDE;A===Kt.INTERSECTING&&(i|=o)}return i}};zr.MASK_OUTSIDE=4294967295;zr.MASK_INSIDE=0;zr.MASK_INDETERMINATE=2147483647;var pRe=new G,gRe=new G,mRe=new G,_Re=new G,yRe=new G;var wRe=new G,CRe=new G,SRe=new G,MRe=new G,PRe=new G,RRe=new G,IRe=new G,BRe=new G,ORe=new G,FRe=new G,LRe=new G,NRe=new G;var Cn=new yt,DY=new yt,kY=new yt,Mp=new yt,HR=new yt;function e3(t,e={}){let r=Oi.EPSILON20,i=10,n=0,s=0,o=DY,a=kY;o.identity(),a.copy(t);let A=r*UY(a);for(;s<i&&VY(a)>A;)zY(a,Mp),HR.copy(Mp).transpose(),a.multiplyRight(Mp),a.multiplyLeft(HR),o.multiplyRight(Mp),++n>2&&(++s,n=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function UY(t){let e=0;for(let r=0;r<9;++r){let i=t[r];e+=i*i}return Math.sqrt(e)}var Zy=[1,0,0],$y=[2,2,1];function VY(t){let e=0;for(let r=0;r<3;++r){let i=t[Cn.getElementIndex($y[r],Zy[r])];e+=2*i*i}return Math.sqrt(e)}function zY(t,e){let r=Oi.EPSILON15,i=0,n=1;for(let h=0;h<3;++h){let g=Math.abs(t[Cn.getElementIndex($y[h],Zy[h])]);g>i&&(n=h,i=g)}let s=Zy[n],o=$y[n],a=1,A=0;if(Math.abs(t[Cn.getElementIndex(o,s)])>r){let h=t[Cn.getElementIndex(o,o)],g=t[Cn.getElementIndex(s,s)],_=t[Cn.getElementIndex(o,s)],b=(h-g)/2/_,T;b<0?T=-1/(-b+Math.sqrt(1+b*b)):T=1/(b+Math.sqrt(1+b*b)),a=1/Math.sqrt(1+T*T),A=T*a}return yt.IDENTITY.to(e),e[Cn.getElementIndex(s,s)]=e[Cn.getElementIndex(o,o)]=a,e[Cn.getElementIndex(o,s)]=A,e[Cn.getElementIndex(s,o)]=-A,e}var Gs=new G,HY=new G,GY=new G,WY=new G,jY=new G,XY=new yt,YY={diagonal:new yt,unitary:new yt};function gf(t,e=new Zn){if(!t||t.length===0)return e.halfAxes=new yt([0,0,0,0,0,0,0,0,0]),e.center=new G,e;let r=t.length,i=new G(0,0,0);for(let z of t)i.add(z);let n=1/r;i.multiplyByScalar(n);let s=0,o=0,a=0,A=0,h=0,g=0;for(let z of t){let L=Gs.copy(z).subtract(i);s+=L.x*L.x,o+=L.x*L.y,a+=L.x*L.z,A+=L.y*L.y,h+=L.y*L.z,g+=L.z*L.z}s*=n,o*=n,a*=n,A*=n,h*=n,g*=n;let _=XY;_[0]=s,_[1]=o,_[2]=a,_[3]=o,_[4]=A,_[5]=h,_[6]=a,_[7]=h,_[8]=g;let{unitary:b}=e3(_,YY),T=e.halfAxes.copy(b),v=T.getColumn(0,GY),C=T.getColumn(1,WY),S=T.getColumn(2,jY),P=-Number.MAX_VALUE,F=-Number.MAX_VALUE,I=-Number.MAX_VALUE,k=Number.MAX_VALUE,W=Number.MAX_VALUE,K=Number.MAX_VALUE;for(let z of t)Gs.copy(z),P=Math.max(Gs.dot(v),P),F=Math.max(Gs.dot(C),F),I=Math.max(Gs.dot(S),I),k=Math.min(Gs.dot(v),k),W=Math.min(Gs.dot(C),W),K=Math.min(Gs.dot(S),K);v=v.multiplyByScalar(.5*(k+P)),C=C.multiplyByScalar(.5*(W+F)),S=S.multiplyByScalar(.5*(K+I)),e.center.copy(v).add(C).add(S);let re=HY.set(P-k,F-W,I-K).multiplyByScalar(.5),Y=new yt([re[0],0,0,0,re[1],0,0,0,re[2]]);return e.halfAxes.multiplyRight(Y),e}var Ic=512,GR=3,WR=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],jR=WR.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),QY=jR.concat([[.25,.5],[.75,.5]]),t3=class t{constructor(e,r,i){this.x=e,this.y=r,this.z=i}get children(){if(!this._children){let e=this.x*2,r=this.y*2,i=this.z+1;this._children=[new t(e,r,i),new t(e,r+1,i),new t(e+1,r,i),new t(e+1,r+1,i)]}return this._children}update(e){let{viewport:r,cullingVolume:i,elevationBounds:n,minZ:s,maxZ:o,bounds:a,offset:A,project:h}=e,g=this.getBoundingVolume(n,A,h);if(a&&!this.insideBounds(a)||i.computeVisibility(g)<0)return!1;if(!this.childVisible){let{z:b}=this;if(b<o&&b>=s){let T=g.distanceTo(r.cameraPosition)*r.scale/r.height;b+=Math.floor(Math.log2(T))}if(b>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let b of this.children)b.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(let r of this._children)r.getSelected(e);return e}insideBounds([e,r,i,n]){let s=Math.pow(2,this.z),o=Ic/s;return this.x*o<i&&this.y*o<n&&(this.x+1)*o>e&&(this.y+1)*o>r}getBoundingVolume(e,r,i){if(i){let A=this.z<1?QY:this.z<2?jR:WR,h=[];for(let g of A){let _=Pp(this.x+g[0],this.y+g[1],this.z);_[2]=e[0],h.push(i(_)),e[0]!==e[1]&&(_[2]=e[1],h.push(i(_)))}return gf(h)}let n=Math.pow(2,this.z),s=Ic/n,o=this.x*s+r*Ic,a=Ic-(this.y+1)*s;return new Rc([o,a,e[0]],[o+s,a+s,e[1]])}};function XR(t,e,r,i){let n=t instanceof Os&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:T,distance:v})=>new Ir(T.clone().negate(),v)),o=new zr(s),a=t.distanceScales.unitsPerMeter[2],A=r&&r[0]*a||0,h=r&&r[1]*a||0,g=t instanceof un&&t.pitch<=60?e:0;if(i){let[T,v,C,S]=i,P=nr([T,S]),F=nr([C,v]);i=[P[0],Ic-P[1],F[0],Ic-F[1]]}let _=new t3(0,0,0),b={viewport:t,project:n,cullingVolume:o,elevationBounds:[A,h],minZ:g,maxZ:e,bounds:i,offset:0};if(_.update(b),t instanceof un&&t.subViewports&&t.subViewports.length>1){for(b.offset=-1;_.update(b)&&!(--b.offset<-GR););for(b.offset=1;_.update(b)&&!(++b.offset>GR););}return _.getSelected()}var $n=512,qY=[-1/0,-1/0,1/0,1/0],Ws={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(r=>typeof r=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;let r=t.length;if(r!==e.length)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}};function QR(t,e){let r=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...r.map(n=>n[0])),Math.min(...r.map(n=>n[1])),Math.max(...r.map(n=>n[0])),Math.max(...r.map(n=>n[1]))]}function KY(t){return Math.abs(t.split("").reduce((e,r)=>(e<<5)-e+r.charCodeAt(0)|0,0))}function Sn(t,e){if(!t||!t.length)return null;let{index:r,id:i}=e;if(Array.isArray(t)){let s=KY(i)%t.length;t=t[s]}let n=t;for(let s of Object.keys(r)){let o=new RegExp(`{${s}}`,"g");n=n.replace(o,String(r[s]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(n=n.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),n}function JY(t,e,r){let i;if(e&&e.length===2){let[n,s]=e,o=t.getBounds({z:n}),a=t.getBounds({z:s});i=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else i=t.getBounds();return t.isGeospatial?[Math.max(i[0],r[0]),Math.max(i[1],r[1]),Math.min(i[2],r[2]),Math.min(i[3],r[3])]:[Math.max(Math.min(i[0],r[2]),r[0]),Math.max(Math.min(i[1],r[3]),r[1]),Math.min(Math.max(i[2],r[0]),r[2]),Math.min(Math.max(i[3],r[1]),r[3])]}function qR({viewport:t,z:e,cullRect:r}){return(t.subViewports||[t]).map(n=>r3(n,e||0,r))}function r3(t,e,r){if(!Array.isArray(e)){let s=r.x-t.x,o=r.y-t.y,{width:a,height:A}=r,h={targetZ:e},g=t.unproject([s,o],h),_=t.unproject([s+a,o],h),b=t.unproject([s,o+A],h),T=t.unproject([s+a,o+A],h);return[Math.min(g[0],_[0],b[0],T[0]),Math.min(g[1],_[1],b[1],T[1]),Math.max(g[0],_[0],b[0],T[0]),Math.max(g[1],_[1],b[1],T[1])]}let i=r3(t,e[0],r),n=r3(t,e[1],r);return[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[2],n[2]),Math.max(i[3],n[3])]}function ZY(t,e,r){return r?QR(t,r).map(n=>n*e/$n):t.map(i=>i*e/$n)}function i3(t,e){return Math.pow(2,t)*$n/e}function Pp(t,e,r){let i=i3(r,$n),n=t/i*360-180,s=Math.PI-2*Math.PI*e/i,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[n,o]}function YR(t,e,r,i){let n=i3(r,i);return[t/n*$n,e/n*$n]}function n3(t,e,r,i,n=$n){if(t.isGeospatial){let[h,g]=Pp(e,r,i),[_,b]=Pp(e+1,r+1,i);return{west:h,north:g,east:_,south:b}}let[s,o]=YR(e,r,i,n),[a,A]=YR(e+1,r+1,i,n);return{left:s,top:o,right:a,bottom:A}}function $Y(t,e,r,i,n){let s=JY(t,null,i),o=i3(e,r),[a,A,h,g]=ZY(s,o,n),_=[];for(let b=Math.floor(a);b<h;b++)for(let T=Math.floor(A);T<g;T++)_.push({x:b,y:T,z:e});return _}function s3({viewport:t,maxZoom:e,minZoom:r,zRange:i,extent:n,tileSize:s=$n,modelMatrix:o,modelMatrixInverse:a,zoomOffset:A=0}){let h=t.isGeospatial?Math.round(t.zoom+Math.log2($n/s))+A:Math.ceil(t.zoom)+A;if(typeof r=="number"&&Number.isFinite(r)&&h<r){if(!n)return[];h=r}typeof e=="number"&&Number.isFinite(e)&&h>e&&(h=e);let g=n;return o&&a&&n&&!t.isGeospatial&&(g=QR(n,o)),t.isGeospatial?XR(t,h,i,n):$Y(t,h,s,g||qY,a)}function o3(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function a3(t){return Number.isFinite(t.west)&&Number.isFinite(t.north)&&Number.isFinite(t.east)&&Number.isFinite(t.south)}function KR(t){let e={},r;return i=>{for(let n in i)if(!eQ(i[n],e[n])){r=t(i),e=i;break}return r}}function eQ(t,e){if(t===e)return!0;if(Array.isArray(t)){let r=t.length;if(!e||e.length!==r)return!1;for(let i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}return!1}var JR=1,Rp=2,tQ="never",rQ="no-overlap",mf="best-available",iQ=5,nQ={[mf]:oQ,[rQ]:aQ,[tQ]:()=>{}},sQ={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}},Ko=class{constructor(e){this._getCullBounds=KR(qR),this.opts={...sQ,...e},this.setOptions(this.opts),this.onTileLoad=r=>{this.opts.onTileLoad?.(r),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new ds({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Ce,this._modelMatrixInverse=new Ce}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(let e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let e of this._cache.keys()){let r=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(e):r.setNeedsReload()}}update(e,{zRange:r,modelMatrix:i}={zRange:null,modelMatrix:null}){let n=i?new Ce(i):new Ce,s=!n.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!er(this._zRange,r)||s){s&&(this._modelMatrixInverse=n.clone().invert(),this._modelMatrix=n),this._viewport=e,this._zRange=r;let a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(A=>this._getTile(A,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));let o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,r){if(!e.isVisible)return!1;if(r&&this._viewport){let i=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:n}=e;for(let[s,o,a,A]of i){let h;if("west"in n)h=n.west<a&&n.east>s&&n.south<A&&n.north>o;else{let g=Math.min(n.top,n.bottom),_=Math.max(n.top,n.bottom);h=n.left<a&&n.right>s&&g<A&&_>o}if(h)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:r,minZoom:i,zRange:n,modelMatrix:s,modelMatrixInverse:o}){let{tileSize:a,extent:A,zoomOffset:h}=this.opts;return s3({viewport:e,maxZoom:r,minZoom:i,zRange:n,tileSize:a,extent:A,modelMatrix:s,modelMatrixInverse:o,zoomOffset:h})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){let{tileSize:r}=this.opts;return{bbox:n3(this._viewport,e.x,e.y,e.z,r)}}getParentIndex(e){let r=Math.floor(e.x/2),i=Math.floor(e.y/2),n=e.z-1;return{x:r,y:i,z:n}}updateTileStates(){let e=this.opts.refinementStrategy||mf,r=new Array(this._cache.size),i=0;for(let n of this._cache.values())r[i++]=n.isVisible,n.isSelected=!1,n.isVisible=!1;for(let n of this._selectedTiles)n.isSelected=!0,n.isVisible=!0;(typeof e=="function"?e:nQ[e])(Array.from(this._cache.values())),i=0;for(let n of this._cache.values())if(r[i++]!==n.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:e=0}=this.opts,r=[],i=0;for(let n of this._cache.values())n.isLoading&&(i++,!n.isSelected&&!n.isVisible&&r.push(n));for(;e>0&&i>e&&r.length>0;)r.shift().abort(),i--}_rebuildTree(){let{_cache:e}=this;for(let r of e.values())r.parent=null,r.children&&(r.children.length=0);for(let r of e.values()){let i=this._getNearestAncestor(r);r.parent=i,i?.children&&i.children.push(r)}}_resizeCache(){let{_cache:e,opts:r}=this,i=r.maxCacheSize??(r.maxCacheByteSize!==null?1/0:iQ*this.selectedTiles.length),n=r.maxCacheByteSize??1/0;if(e.size>i||this._cacheByteSize>n){for(let[o,a]of e)if(!a.isVisible&&!a.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!==null?a.byteLength:0,e.delete(o),this.opts.onTileUnload?.(a)),e.size<=i&&this._cacheByteSize<=n)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,a)=>o.zoom-a.zoom),this._dirty=!1)}_getTile(e,r){let i=this.getTileId(e),n=this._cache.get(i),s=!1;return!n&&r?(n=new qo(e),Object.assign(n,this.getTileMetadata(n.index)),Object.assign(n,{id:i,zoom:this.getTileZoom(n.index)}),s=!0,this._cache.set(i,n),this._dirty=!0):n&&n.needsReload&&(s=!0),n&&s&&n.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),n}_getNearestAncestor(e){let{_minZoom:r=0}=this,i=e.index;for(;this.getTileZoom(i)>r;){i=this.getParentIndex(i);let n=this._getTile(i);if(n)return n}return null}};function oQ(t){for(let e of t)e.state=0;for(let e of t)e.isSelected&&!ZR(e)&&c3(e);for(let e of t)e.isVisible=!!(e.state&Rp)}function aQ(t){for(let r of t)r.state=0;for(let r of t)r.isSelected&&ZR(r);let e=Array.from(t).sort((r,i)=>r.zoom-i.zoom);for(let r of e)if(r.isVisible=!!(r.state&Rp),r.children&&(r.isVisible||r.state&JR))for(let i of r.children)i.state=JR;else r.isSelected&&c3(r)}function ZR(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Rp,!0;e=e.parent}return!1}function c3(t){for(let e of t.children)e.isLoaded||e.content?e.state|=Rp:c3(e)}var cQ={TilesetClass:Ko,data:{type:"data",value:[]},dataComparator:Ws.equal,renderSubLayers:{type:"function",value:t=>new jo(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:mf,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},_f=class extends zt{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return!!this.state?.tileset?.selectedTiles?.every(e=>e.isLoaded&&e.layers&&e.layers.every(r=>r.isLoaded))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:r}=this.state,i=e.propsOrDataChanged||e.updateTriggersChanged,n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);r?i&&(r.setOptions(this._getTilesetOptions()),n?r.reloadAll():r.tiles.forEach(s=>{s.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){let{tileSize:e,maxCacheSize:r,maxCacheByteSize:i,refinementStrategy:n,extent:s,maxZoom:o,minZoom:a,maxRequests:A,debounceTime:h,zoomOffset:g}=this.props;return{maxCacheSize:r,maxCacheByteSize:i,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:n,extent:s,maxRequests:A,debounceTime:h,zoomOffset:g,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let e=this.state.tileset,{zRange:r,modelMatrix:i}=this.props,n=e.update(this.context.viewport,{zRange:r,modelMatrix:i}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==n;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:n}),this.state.isLoaded=s}_onViewportLoad(){let{tileset:e}=this.state,{onViewportLoad:r}=this.props;r&&r(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,r){this.props.onTileError(e),r.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){let{data:r,getTileData:i,fetch:n}=this.props,{signal:s}=e;return e.url=typeof r=="string"||Array.isArray(r)?Sn(r,e):null,i?i(e):n&&e.url?n(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){let r=e.sourceLayer,i=r.props.tile,n=e.info;return n.picked&&(n.tile=i),n.sourceTile=i,n.sourceTileSubLayer=r,n}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{let r=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)r&&e.layers[0]&&Object.keys(r).some(i=>e.layers[0].props[i]!==r[i])&&(e.layers=e.layers.map(i=>i.clone(r)));else{let i=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=qr(i,Boolean).map(n=>n.clone({tile:e,...r}))}return e.layers})}filterSubLayer({layer:e,cullRect:r}){let{tile:i}=e.props;return this.state.tileset.isTileVisible(i,r)}};_f.defaultProps=cQ;_f.layerName="TileLayer";var Jo=_f;var $R=`uniform tripsUniforms {
  bool fadeTrail;
  float trailLength;
  float currentTime;
} trips;
`,eI={name:"trips",vs:$R,fs:$R,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}};var lQ={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:t=>t.timestamps}},yf=class extends Tn{getShaders(){let e=super.getShaders();return e.inject={"vs:#decl":`in float instanceTimestamps;
in float instanceNextTimestamps;
out float vTime;
`,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
`,"fs:#decl":`in float vTime;
`,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
  discard;
}
`,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
  color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
}
`},e.modules=[...e.modules,eI],e}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(e){let{fadeTrail:r,trailLength:i,currentTime:n}=this.props,s={fadeTrail:r,trailLength:i,currentTime:n};this.state.model.shaderInputs.setProps({trips:s}),super.draw(e)}};yf.layerName="TripsLayer";yf.defaultProps=lQ;var tI=yf;var ft=function(t){t=t||{};var e=typeof t<"u"?t:{},r={},i;for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);var n=[],s="";function o(Z){return e.locateFile?e.locateFile(Z,s):s+Z}var a;typeof document<"u"&&document.currentScript&&(s=document.currentScript.src),s.indexOf("blob:")!==0?s=s.substr(0,s.lastIndexOf("/")+1):s="",a=function(ae,_e,Be){var u=new XMLHttpRequest;u.open("GET",ae,!0),u.responseType="arraybuffer",u.onload=function(){if(u.status==200||u.status==0&&u.response){_e(u.response);return}var pt=jg(ae);if(pt){_e(pt.buffer);return}Be()},u.onerror=Be,u.send(null)};var A=e.print||console.log.bind(console),h=e.printErr||console.warn.bind(console);for(i in r)r.hasOwnProperty(i)&&(e[i]=r[i]);r=null,e.arguments&&(n=e.arguments);var g=0,_=function(Z){g=Z},b=function(){return g},T=8;function v(Z,ae,_e,Be){switch(_e=_e||"i8",_e.charAt(_e.length-1)==="*"&&(_e="i32"),_e){case"i1":he[Z>>0]=ae;break;case"i8":he[Z>>0]=ae;break;case"i16":Ke[Z>>1]=ae;break;case"i32":$e[Z>>2]=ae;break;case"i64":Wr=[ae>>>0,(Vt=ae,+qf(Vt)>=1?Vt>0?(Wg(+Gg(Vt/4294967296),4294967295)|0)>>>0:~~+Kf((Vt-+(~~Vt>>>0))/4294967296)>>>0:0)],$e[Z>>2]=Wr[0],$e[Z+4>>2]=Wr[1];break;case"float":rt[Z>>2]=ae;break;case"double":Ne[Z>>3]=ae;break;default:Zs("invalid type for setValue: "+_e)}}function C(Z,ae,_e){switch(ae=ae||"i8",ae.charAt(ae.length-1)==="*"&&(ae="i32"),ae){case"i1":return he[Z>>0];case"i8":return he[Z>>0];case"i16":return Ke[Z>>1];case"i32":return $e[Z>>2];case"i64":return $e[Z>>2];case"float":return rt[Z>>2];case"double":return Ne[Z>>3];default:Zs("invalid type for getValue: "+ae)}return null}var S=!1;function P(Z,ae){Z||Zs("Assertion failed: "+ae)}function F(Z){var ae=e["_"+Z];return P(ae,"Cannot call unknown function "+Z+", make sure it is exported"),ae}function I(Z,ae,_e,Be,u){var Ct={string:function(lr){var lt=0;if(lr!=null&&lr!==0){var At=(lr.length<<2)+1;lt=ob(At),z(lr,lt,At)}return lt},array:function(lr){var lt=ob(lr.length);return se(lr,lt),lt}};function pt(lr){return ae==="string"?re(lr):ae==="boolean"?!!lr:lr}var B=F(Z),ar=[],jr=0;if(Be)for(var cr=0;cr<Be.length;cr++){var gt=Ct[_e[cr]];gt?(jr===0&&(jr=tO()),ar[cr]=gt(Be[cr])):ar[cr]=Be[cr]}var kt=B.apply(null,ar);return kt=pt(kt),jr!==0&&eO(jr),kt}function k(Z,ae,_e,Be){_e=_e||[];var u=_e.every(function(pt){return pt==="number"}),Ct=ae!=="string";return Ct&&u&&!Be?F(Z):function(){return I(Z,ae,_e,arguments,Be)}}var W=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function K(Z,ae,_e){for(var Be=ae+_e,u=ae;Z[u]&&!(u>=Be);)++u;if(u-ae>16&&Z.subarray&&W)return W.decode(Z.subarray(ae,u));for(var Ct="";ae<u;){var pt=Z[ae++];if(!(pt&128)){Ct+=String.fromCharCode(pt);continue}var B=Z[ae++]&63;if((pt&224)==192){Ct+=String.fromCharCode((pt&31)<<6|B);continue}var ar=Z[ae++]&63;if((pt&240)==224?pt=(pt&15)<<12|B<<6|ar:pt=(pt&7)<<18|B<<12|ar<<6|Z[ae++]&63,pt<65536)Ct+=String.fromCharCode(pt);else{var jr=pt-65536;Ct+=String.fromCharCode(55296|jr>>10,56320|jr&1023)}}return Ct}function re(Z,ae){return Z?K(Re,Z,ae):""}function Y(Z,ae,_e,Be){if(!(Be>0))return 0;for(var u=_e,Ct=_e+Be-1,pt=0;pt<Z.length;++pt){var B=Z.charCodeAt(pt);if(B>=55296&&B<=57343){var ar=Z.charCodeAt(++pt);B=65536+((B&1023)<<10)|ar&1023}if(B<=127){if(_e>=Ct)break;ae[_e++]=B}else if(B<=2047){if(_e+1>=Ct)break;ae[_e++]=192|B>>6,ae[_e++]=128|B&63}else if(B<=65535){if(_e+2>=Ct)break;ae[_e++]=224|B>>12,ae[_e++]=128|B>>6&63,ae[_e++]=128|B&63}else{if(_e+3>=Ct)break;ae[_e++]=240|B>>18,ae[_e++]=128|B>>12&63,ae[_e++]=128|B>>6&63,ae[_e++]=128|B&63}}return ae[_e]=0,_e-u}function z(Z,ae,_e){return Y(Z,Re,ae,_e)}var L=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function se(Z,ae){he.set(Z,ae)}function le(Z,ae){return Z%ae>0&&(Z+=ae-Z%ae),Z}var ce,he,Re,Ke,Ye,$e,nt,rt,Ne;function ir(Z){ce=Z,e.HEAP8=he=new Int8Array(Z),e.HEAP16=Ke=new Int16Array(Z),e.HEAP32=$e=new Int32Array(Z),e.HEAPU8=Re=new Uint8Array(Z),e.HEAPU16=Ye=new Uint16Array(Z),e.HEAPU32=nt=new Uint32Array(Z),e.HEAPF32=rt=new Float32Array(Z),e.HEAPF64=Ne=new Float64Array(Z)}var Pe=5267040,ue=24128,ti=e.TOTAL_MEMORY||33554432;e.buffer?ce=e.buffer:ce=new ArrayBuffer(ti),ti=ce.byteLength,ir(ce),$e[ue>>2]=Pe;function Ri(Z){for(;Z.length>0;){var ae=Z.shift();if(typeof ae=="function"){ae();continue}var _e=ae.func;typeof _e=="number"?ae.arg===void 0?e.dynCall_v(_e):e.dynCall_vi(_e,ae.arg):_e(ae.arg===void 0?null:ae.arg)}}var or=[],Bt=[],Ks=[],ri=[];function os(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)zg(e.preRun.shift());Ri(or)}function Qf(){Ri(Bt)}function Vg(){Ri(Ks)}function fa(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Hg(e.postRun.shift());Ri(ri)}function zg(Z){or.unshift(Z)}function Hg(Z){ri.unshift(Z)}var qf=Math.abs,Kf=Math.ceil,Gg=Math.floor,Wg=Math.min,Rn=0,as=null,In=null;function Jf(Z){Rn++,e.monitorRunDependencies&&e.monitorRunDependencies(Rn)}function Te(Z){if(Rn--,e.monitorRunDependencies&&e.monitorRunDependencies(Rn),Rn==0&&(as!==null&&(clearInterval(as),as=null),In)){var ae=In;In=null,ae()}}e.preloadedImages={},e.preloadedAudios={};var we=null,Fe="data:application/octet-stream;base64,";function Zt(Z){return String.prototype.startsWith?Z.startsWith(Fe):Z.indexOf(Fe)===0}var Vt,Wr;we="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var qi=24144;function Js(Z){return Z}function Bn(Z){var ae=/\b__Z[\w\d_]+/g;return Z.replace(ae,function(_e){var Be=_e;return _e===Be?_e:Be+" ["+_e+"]"})}function sl(){var Z=new Error;if(!Z.stack){try{throw new Error(0)}catch(ae){Z=ae}if(!Z.stack)return"(no stack trace available)"}return Z.stack.toString()}function G8(){var Z=sl();return e.extraStackTrace&&(Z+=`
`+e.extraStackTrace()),Bn(Z)}function W8(Z,ae,_e,Be){Zs("Assertion failed: "+re(Z)+", at: "+[ae?re(ae):"unknown filename",_e,Be?re(Be):"unknown function"])}function nb(){return he.length}function j8(Z,ae,_e){Re.set(Re.subarray(ae,ae+_e),Z)}function X8(Z){return e.___errno_location&&($e[e.___errno_location()>>2]=Z),Z}function Y8(Z){Zs("OOM")}function sb(Z){try{var ae=new ArrayBuffer(Z);return ae.byteLength!=Z?void 0:(new Int8Array(ae).set(he),$8(ae),ir(ae),1)}catch{}}function Q8(Z){var ae=nb(),_e=16777216,Be=2147483648-_e;if(Z>Be)return!1;for(var u=16777216,Ct=Math.max(ae,u);Ct<Z;)Ct<=536870912?Ct=le(2*Ct,_e):Ct=Math.min(le((3*Ct+2147483648)/4,_e),Be);var pt=sb(Ct);return!!pt}var q8=typeof atob=="function"?atob:function(Z){var ae="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_e="",Be,u,Ct,pt,B,ar,jr,cr=0;Z=Z.replace(/[^A-Za-z0-9\+\/\=]/g,"");do pt=ae.indexOf(Z.charAt(cr++)),B=ae.indexOf(Z.charAt(cr++)),ar=ae.indexOf(Z.charAt(cr++)),jr=ae.indexOf(Z.charAt(cr++)),Be=pt<<2|B>>4,u=(B&15)<<4|ar>>2,Ct=(ar&3)<<6|jr,_e=_e+String.fromCharCode(Be),ar!==64&&(_e=_e+String.fromCharCode(u)),jr!==64&&(_e=_e+String.fromCharCode(Ct));while(cr<Z.length);return _e};function K8(Z){try{for(var ae=q8(Z),_e=new Uint8Array(ae.length),Be=0;Be<ae.length;++Be)_e[Be]=ae.charCodeAt(Be);return _e}catch{throw new Error("Converting base64 string to bytes failed.")}}function jg(Z){if(Zt(Z))return K8(Z.slice(Fe.length))}var J8={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},Z8={a:Zs,b:_,c:b,d:W8,e:X8,f:nb,g:j8,h:Q8,i:Y8,j:Js,k:Bn,l:sb,m:sl,n:G8,o:qi,p:ue},fe=function(Z,ae,_e){"almost asm";var Be=new Z.Int8Array(_e),u=new Z.Int32Array(_e),Ct=new Z.Uint8Array(_e),pt=new Z.Float32Array(_e),B=new Z.Float64Array(_e),ar=ae.o|0,jr=ae.p|0,cr=Z.Math.floor,gt=Z.Math.abs,kt=Z.Math.sqrt,lr=Z.Math.pow,lt=Z.Math.cos,At=Z.Math.sin,ol=Z.Math.tan,rO=Z.Math.acos,iO=Z.Math.asin,Qg=Z.Math.atan,ui=Z.Math.atan2,ha=Z.Math.ceil,Ki=Z.Math.imul,qg=Z.Math.min,nO=Z.Math.max,$s=Z.Math.clz32,Qe=ae.b,D=ae.c,Oe=ae.d,Ab=ae.e,sO=ae.f,oO=ae.g,aO=ae.h,cO=ae.i,R=24160;function lO(l){return Be=new Int8Array(l),Ct=new Uint8Array(l),u=new Int32Array(l),pt=new Float32Array(l),B=new Float64Array(l),_e=l,!0}function AO(l){l=l|0;var c=0;return c=R,R=R+l|0,R=R+15&-16,c|0}function uO(){return R|0}function fO(l){l=l|0,R=l}function hO(l,c){l=l|0,c=c|0,R=l}function dO(l,c){l=l|0,c=c|0;var f=0,d=0,p=0;return(l|0)<0?(c=2,c|0):(l|0)>13780509?(c=Am(15,c)|0,c|0):(f=((l|0)<0)<<31>>31,p=Cr(l|0,f|0,3,0)|0,d=D()|0,f=Je(l|0,f|0,1,0)|0,f=Cr(p|0,d|0,f|0,D()|0)|0,f=Je(f|0,D()|0,1,0)|0,l=D()|0,u[c>>2]=f,u[c+4>>2]=l,c=0,c|0)}function ub(l,c,f,d){return l=l|0,c=c|0,f=f|0,d=d|0,fb(l,c,f,d,0)|0}function fb(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0;if(E=R,R=R+16|0,y=E,!(hb(l,c,f,d,p)|0))return d=0,R=E,d|0;do if((f|0)>=0){if((f|0)>13780509){if(m=Am(15,y)|0,m|0)break;x=y,y=u[x>>2]|0,x=u[x+4>>2]|0}else m=((f|0)<0)<<31>>31,w=Cr(f|0,m|0,3,0)|0,x=D()|0,m=Je(f|0,m|0,1,0)|0,m=Cr(w|0,x|0,m|0,D()|0)|0,m=Je(m|0,D()|0,1,0)|0,x=D()|0,u[y>>2]=m,u[y+4>>2]=x,y=m;if(so(d|0,0,y<<3|0)|0,p|0){so(p|0,0,y<<2|0)|0,m=On(l,c,f,d,p,y,x,0)|0;break}m=Zi(y,4)|0,m?(w=On(l,c,f,d,m,y,x,0)|0,De(m),m=w):m=13}else m=2;while(!1);return w=m,R=E,w|0}function hb(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0;if(q=R,R=R+16|0,H=q,U=q+8|0,V=H,u[V>>2]=l,u[V+4>>2]=c,(f|0)<0)return U=2,R=q,U|0;if(m=d,u[m>>2]=l,u[m+4>>2]=c,m=(p|0)!=0,m&&(u[p>>2]=0),Ft(l,c)|0)return U=9,R=q,U|0;u[U>>2]=0;e:do if((f|0)>=1)if(m)for(M=1,w=0,O=0,V=1,m=l;;){if(!(w|O)){if(m=Ar(m,c,4,U,H)|0,m|0)break e;if(c=H,m=u[c>>2]|0,c=u[c+4>>2]|0,Ft(m,c)|0){m=9;break e}}if(m=Ar(m,c,u[22384+(O<<2)>>2]|0,U,H)|0,m|0)break e;if(c=H,m=u[c>>2]|0,c=u[c+4>>2]|0,l=d+(M<<3)|0,u[l>>2]=m,u[l+4>>2]=c,u[p+(M<<2)>>2]=V,l=w+1|0,y=(l|0)==(V|0),x=O+1|0,E=(x|0)==6,Ft(m,c)|0){m=9;break e}if(V=V+(E&y&1)|0,(V|0)>(f|0)){m=0;break}else M=M+1|0,w=y?0:l,O=y?E?0:x:O}else for(M=1,w=0,O=0,V=1,m=l;;){if(!(w|O)){if(m=Ar(m,c,4,U,H)|0,m|0)break e;if(c=H,m=u[c>>2]|0,c=u[c+4>>2]|0,Ft(m,c)|0){m=9;break e}}if(m=Ar(m,c,u[22384+(O<<2)>>2]|0,U,H)|0,m|0)break e;if(c=H,m=u[c>>2]|0,c=u[c+4>>2]|0,l=d+(M<<3)|0,u[l>>2]=m,u[l+4>>2]=c,l=w+1|0,y=(l|0)==(V|0),x=O+1|0,E=(x|0)==6,Ft(m,c)|0){m=9;break e}if(V=V+(E&y&1)|0,(V|0)>(f|0)){m=0;break}else M=M+1|0,w=y?0:l,O=y?E?0:x:O}else m=0;while(!1);return U=m,R=q,U|0}function On(l,c,f,d,p,m,y,x){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0,m=m|0,y=y|0,x=x|0;var E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0;if(q=R,R=R+16|0,H=q+8|0,U=q,E=ma(l|0,c|0,m|0,y|0)|0,M=D()|0,O=d+(E<<3)|0,ne=O,ie=u[ne>>2]|0,ne=u[ne+4>>2]|0,w=(ie|0)==(l|0)&(ne|0)==(c|0),!((ie|0)==0&(ne|0)==0|w))do E=Je(E|0,M|0,1,0)|0,E=nh(E|0,D()|0,m|0,y|0)|0,M=D()|0,O=d+(E<<3)|0,ie=O,ne=u[ie>>2]|0,ie=u[ie+4>>2]|0,w=(ne|0)==(l|0)&(ie|0)==(c|0);while(!((ne|0)==0&(ie|0)==0|w));if(E=p+(E<<2)|0,w&&(u[E>>2]|0)<=(x|0)||(ie=O,u[ie>>2]=l,u[ie+4>>2]=c,u[E>>2]=x,(x|0)>=(f|0)))return ie=0,R=q,ie|0;switch(w=x+1|0,u[H>>2]=0,E=Ar(l,c,2,H,U)|0,E|0){case 9:{V=9;break}case 0:{E=U,E=On(u[E>>2]|0,u[E+4>>2]|0,f,d,p,m,y,w)|0,E||(V=9);break}default:}e:do if((V|0)==9){switch(u[H>>2]=0,E=Ar(l,c,3,H,U)|0,E|0){case 9:break;case 0:{if(E=U,E=On(u[E>>2]|0,u[E+4>>2]|0,f,d,p,m,y,w)|0,E|0)break e;break}default:break e}switch(u[H>>2]=0,E=Ar(l,c,1,H,U)|0,E|0){case 9:break;case 0:{if(E=U,E=On(u[E>>2]|0,u[E+4>>2]|0,f,d,p,m,y,w)|0,E|0)break e;break}default:break e}switch(u[H>>2]=0,E=Ar(l,c,5,H,U)|0,E|0){case 9:break;case 0:{if(E=U,E=On(u[E>>2]|0,u[E+4>>2]|0,f,d,p,m,y,w)|0,E|0)break e;break}default:break e}switch(u[H>>2]=0,E=Ar(l,c,4,H,U)|0,E|0){case 9:break;case 0:{if(E=U,E=On(u[E>>2]|0,u[E+4>>2]|0,f,d,p,m,y,w)|0,E|0)break e;break}default:break e}switch(u[H>>2]=0,E=Ar(l,c,6,H,U)|0,E|0){case 9:break;case 0:{if(E=U,E=On(u[E>>2]|0,u[E+4>>2]|0,f,d,p,m,y,w)|0,E|0)break e;break}default:break e}return ie=0,R=q,ie|0}while(!1);return ie=E,R=q,ie|0}function Ar(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0;if(f>>>0>6)return p=1,p|0;if(O=(u[d>>2]|0)%6|0,u[d>>2]=O,(O|0)>0){m=0;do f=ro(f)|0,m=m+1|0;while((m|0)<(u[d>>2]|0))}if(O=Ae(l|0,c|0,45)|0,D()|0,M=O&127,M>>>0>121)return p=5,p|0;E=Xr(l,c)|0,m=Ae(l|0,c|0,52)|0,D()|0,m=m&15;e:do if(!m)w=8;else{for(;;){if(y=(15-m|0)*3|0,x=Ae(l|0,c|0,y|0)|0,D()|0,x=x&7,(x|0)==7){c=5;break}if(U=(fi(m)|0)==0,m=m+-1|0,V=ge(7,0,y|0)|0,c=c&~(D()|0),H=ge(u[(U?432:16)+(x*28|0)+(f<<2)>>2]|0,0,y|0)|0,y=D()|0,f=u[(U?640:224)+(x*28|0)+(f<<2)>>2]|0,l=H|l&~V,c=y|c,!f){f=0;break e}if(!m){w=8;break e}}return c|0}while(!1);(w|0)==8&&(U=u[848+(M*28|0)+(f<<2)>>2]|0,H=ge(U|0,0,45)|0,l=H|l,c=D()|0|c&-1040385,f=u[4272+(M*28|0)+(f<<2)>>2]|0,(U&127|0)==127&&(U=ge(u[848+(M*28|0)+20>>2]|0,0,45)|0,c=D()|0|c&-1040385,f=u[4272+(M*28|0)+20>>2]|0,l=io(U|l,c)|0,c=D()|0,u[d>>2]=(u[d>>2]|0)+1)),x=Ae(l|0,c|0,45)|0,D()|0,x=x&127;e:do if(Ot(x)|0){t:do if((Xr(l,c)|0)==1){if((M|0)!=(x|0))if(gb(x,u[7696+(M*28|0)>>2]|0)|0){l=am(l,c)|0,y=1,c=D()|0;break}else Oe(23313,22416,436,22424);switch(E|0){case 3:{l=io(l,c)|0,c=D()|0,u[d>>2]=(u[d>>2]|0)+1,y=0;break t}case 5:{l=am(l,c)|0,c=D()|0,u[d>>2]=(u[d>>2]|0)+5,y=0;break t}case 0:return U=9,U|0;default:return U=1,U|0}}else y=0;while(!1);if((f|0)>0){m=0;do l=om(l,c)|0,c=D()|0,m=m+1|0;while((m|0)!=(f|0))}if((M|0)!=(x|0)){if(!(Jg(x)|0)){if((y|0)!=0|(Xr(l,c)|0)!=5)break;u[d>>2]=(u[d>>2]|0)+1;break}switch(O&127){case 8:case 118:break e;default:}(Xr(l,c)|0)!=3&&(u[d>>2]=(u[d>>2]|0)+1)}}else if((f|0)>0){m=0;do l=io(l,c)|0,c=D()|0,m=m+1|0;while((m|0)!=(f|0))}while(!1);return u[d>>2]=((u[d>>2]|0)+f|0)%6|0,U=p,u[U>>2]=l,u[U+4>>2]=c,U=0,U|0}function Kg(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0;for(x=R,R=R+16|0,m=x,y=x+8|0,p=(Ft(l,c)|0)==0,p=p?1:2;;){if(u[y>>2]=0,w=(Ar(l,c,p,y,m)|0)==0,E=m,w&((u[E>>2]|0)==(f|0)?(u[E+4>>2]|0)==(d|0):0)){l=4;break}if(p=p+1|0,p>>>0>=7){p=7,l=4;break}}return(l|0)==4?(R=x,p|0):0}function pO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0;if(U=R,R=R+16|0,V=U,H=U+8|0,O=V,u[O>>2]=l,u[O+4>>2]=c,!f)return H=d,u[H>>2]=l,u[H+4>>2]=c,H=0,R=U,H|0;u[H>>2]=0;e:do if(Ft(l,c)|0)l=9;else{if(m=(f|0)>0,m){p=0,O=l;do{if(l=Ar(O,c,4,H,V)|0,l|0)break e;if(c=V,O=u[c>>2]|0,c=u[c+4>>2]|0,p=p+1|0,Ft(O,c)|0){l=9;break e}}while((p|0)<(f|0));if(M=d,u[M>>2]=O,u[M+4>>2]=c,M=f+-1|0,m){w=0,l=1;do{if(p=22384+(w<<2)|0,(w|0)==5)for(y=u[p>>2]|0,m=0,p=l;;){if(l=V,l=Ar(u[l>>2]|0,u[l+4>>2]|0,y,H,V)|0,l|0)break e;if((m|0)!=(M|0))if(E=V,x=u[E>>2]|0,E=u[E+4>>2]|0,l=d+(p<<3)|0,u[l>>2]=x,u[l+4>>2]=E,!(Ft(x,E)|0))l=p+1|0;else{l=9;break e}else l=p;if(m=m+1|0,(m|0)>=(f|0))break;p=l}else for(y=V,E=u[p>>2]|0,x=0,p=l,m=u[y>>2]|0,y=u[y+4>>2]|0;;){if(l=Ar(m,y,E,H,V)|0,l|0)break e;if(y=V,m=u[y>>2]|0,y=u[y+4>>2]|0,l=d+(p<<3)|0,u[l>>2]=m,u[l+4>>2]=y,l=p+1|0,Ft(m,y)|0){l=9;break e}if(x=x+1|0,(x|0)>=(f|0))break;p=l}w=w+1|0}while(w>>>0<6);l=V,y=O,p=u[l>>2]|0,m=c,l=u[l+4>>2]|0}else y=O,p=O,m=c,l=c}else y=d,u[y>>2]=l,u[y+4>>2]=c,y=l,p=l,m=c,l=c;l=(y|0)==(p|0)&(m|0)==(l|0)?0:9}while(!1);return H=l,R=U,H|0}function gO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0;if(x=R,R=R+48|0,p=x+16|0,m=x+8|0,y=x,f|0)return y=15,R=x,y|0;if(w=l,E=u[w+4>>2]|0,f=m,u[f>>2]=u[w>>2],u[f+4>>2]=E,Ub(m,p),c=yb(p,c,y)|0,!c){if(f=u[m>>2]|0,m=u[l+8>>2]|0,(m|0)>0){p=u[l+12>>2]|0,c=0;do f=(u[p+(c<<3)>>2]|0)+f|0,c=c+1|0;while((c|0)<(m|0))}c=y,p=u[c>>2]|0,c=u[c+4>>2]|0,m=((f|0)<0)<<31>>31,(c|0)<(m|0)|(c|0)==(m|0)&p>>>0<f>>>0?(c=y,u[c>>2]=f,u[c+4>>2]=m,c=m):f=p,E=Je(f|0,c|0,12,0)|0,w=D()|0,c=y,u[c>>2]=E,u[c+4>>2]=w,c=d,u[c>>2]=E,u[c+4>>2]=w,c=0}return w=c,R=x,w|0}function db(l,c,f,d,p,m,y){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0,m=m|0,y=y|0;var x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0,be=0,mt=0,ot=0,at=0,Ge=0,ze=0,We=0,vt=0,ke=0,Rt=0,Dr=0,Kb=0;if(vt=R,R=R+64|0,at=vt+48|0,Ge=vt+32|0,ze=vt+24|0,xe=vt+8|0,ve=vt,E=u[l>>2]|0,(E|0)<=0)return We=0,R=vt,We|0;for(pe=l+4|0,be=at+8|0,mt=Ge+8|0,ot=xe+8|0,x=0,te=0;;){w=u[pe>>2]|0,$=w+(te<<4)|0,u[at>>2]=u[$>>2],u[at+4>>2]=u[$+4>>2],u[at+8>>2]=u[$+8>>2],u[at+12>>2]=u[$+12>>2],(te|0)==(E+-1|0)?(u[Ge>>2]=u[w>>2],u[Ge+4>>2]=u[w+4>>2],u[Ge+8>>2]=u[w+8>>2],u[Ge+12>>2]=u[w+12>>2]):($=w+(te+1<<4)|0,u[Ge>>2]=u[$>>2],u[Ge+4>>2]=u[$+4>>2],u[Ge+8>>2]=u[$+8>>2],u[Ge+12>>2]=u[$+12>>2]),E=wO(at,Ge,d,ze)|0;e:do if(E)w=0,x=E;else if(w=ze,E=u[w>>2]|0,w=u[w+4>>2]|0,(w|0)>0|(w|0)==0&E>>>0>0){ie=0,$=0;t:for(;;){if(Kb=+B[at>>3],ne=wr(E|0,w|0,ie|0,$|0)|0,Dr=+(ne>>>0)+4294967296*+(D()|0),ke=+(E>>>0)+4294967296*+(w|0),Rt=+(ie>>>0)+4294967296*+($|0),B[xe>>3]=Kb*Dr/ke+ +B[Ge>>3]*Rt/ke,B[ot>>3]=+B[be>>3]*Dr/ke+ +B[mt>>3]*Rt/ke,E=Rb(xe,d,ve)|0,E|0){x=E;break}ne=ve,q=u[ne>>2]|0,ne=u[ne+4>>2]|0,V=ma(q|0,ne|0,c|0,f|0)|0,M=D()|0,E=y+(V<<3)|0,O=E,w=u[O>>2]|0,O=u[O+4>>2]|0;r:do if((w|0)==0&(O|0)==0)Q=E,We=16;else for(H=0,U=0;;){if((H|0)>(f|0)|(H|0)==(f|0)&U>>>0>c>>>0){x=1;break t}if((w|0)==(q|0)&(O|0)==(ne|0))break r;if(E=Je(V|0,M|0,1,0)|0,V=nh(E|0,D()|0,c|0,f|0)|0,M=D()|0,U=Je(U|0,H|0,1,0)|0,H=D()|0,E=y+(V<<3)|0,O=E,w=u[O>>2]|0,O=u[O+4>>2]|0,(w|0)==0&(O|0)==0){Q=E,We=16;break}}while(!1);if((We|0)==16&&(We=0,!((q|0)==0&(ne|0)==0))&&(U=Q,u[U>>2]=q,u[U+4>>2]=ne,U=m+(u[p>>2]<<3)|0,u[U>>2]=q,u[U+4>>2]=ne,U=p,U=Je(u[U>>2]|0,u[U+4>>2]|0,1,0)|0,q=D()|0,ne=p,u[ne>>2]=U,u[ne+4>>2]=q),ie=Je(ie|0,$|0,1,0)|0,$=D()|0,w=ze,E=u[w>>2]|0,w=u[w+4>>2]|0,!((w|0)>($|0)|(w|0)==($|0)&E>>>0>ie>>>0)){w=1;break e}}w=0}else w=1;while(!1);if(te=te+1|0,!w){We=21;break}if(E=u[l>>2]|0,(te|0)>=(E|0)){x=0,We=21;break}}return(We|0)==21?(R=vt,x|0):0}function mO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0,be=0,mt=0,ot=0,at=0,Ge=0,ze=0,We=0,vt=0,ke=0,Rt=0,Dr=0;if(Dr=R,R=R+112|0,We=Dr+80|0,E=Dr+72|0,vt=Dr,ke=Dr+56|0,f|0)return Rt=15,R=Dr,Rt|0;if(w=l+8|0,Rt=Ji((u[w>>2]<<5)+32|0)|0,!Rt)return Rt=13,R=Dr,Rt|0;if(SF(l,Rt),Ge=l,ze=u[Ge+4>>2]|0,f=E,u[f>>2]=u[Ge>>2],u[f+4>>2]=ze,Ub(E,We),f=yb(We,c,vt)|0,f)Ge=0,ze=0;else{if(f=u[E>>2]|0,m=u[w>>2]|0,(m|0)>0){y=u[l+12>>2]|0,p=0;do f=(u[y+(p<<3)>>2]|0)+f|0,p=p+1|0;while((p|0)!=(m|0));p=f}else p=f;f=vt,m=u[f>>2]|0,f=u[f+4>>2]|0,y=((p|0)<0)<<31>>31,(f|0)<(y|0)|(f|0)==(y|0)&m>>>0<p>>>0?(f=vt,u[f>>2]=p,u[f+4>>2]=y,f=y):p=m,Ge=Je(p|0,f|0,12,0)|0,ze=D()|0,f=vt,u[f>>2]=Ge,u[f+4>>2]=ze,f=0}if(f|0)return De(Rt),Rt=f,R=Dr,Rt|0;if(p=Zi(Ge,8)|0,!p)return De(Rt),Rt=13,R=Dr,Rt|0;if(x=Zi(Ge,8)|0,!x)return De(Rt),De(p),Rt=13,R=Dr,Rt|0;ot=We,u[ot>>2]=0,u[ot+4>>2]=0,ot=l,at=u[ot+4>>2]|0,f=E,u[f>>2]=u[ot>>2],u[f+4>>2]=at,f=db(E,Ge,ze,c,We,p,x)|0;e:do if(f)De(p),De(x),De(Rt);else{t:do if((u[w>>2]|0)>0){for(y=l+12|0,m=0;f=db((u[y>>2]|0)+(m<<3)|0,Ge,ze,c,We,p,x)|0,m=m+1|0,!(f|0);)if((m|0)>=(u[w>>2]|0))break t;De(p),De(x),De(Rt);break e}while(!1);(ze|0)>0|(ze|0)==0&Ge>>>0>0&&so(x|0,0,Ge<<3|0)|0,at=We,ot=u[at+4>>2]|0;t:do if((ot|0)>0|(ot|0)==0&(u[at>>2]|0)>>>0>0){pe=p,be=x,mt=p,ot=x,at=p,f=p,Q=p,xe=x,ve=x,p=x;r:for(;;){for(ne=0,ie=0,$=0,te=0,m=0,y=0;;){x=vt,E=x+56|0;do u[x>>2]=0,x=x+4|0;while((x|0)<(E|0));if(c=pe+(ne<<3)|0,w=u[c>>2]|0,c=u[c+4>>2]|0,hb(w,c,1,vt,0)|0){x=vt,E=x+56|0;do u[x>>2]=0,x=x+4|0;while((x|0)<(E|0));x=Zi(7,4)|0,x|0&&(On(w,c,1,vt,x,7,0,0)|0,De(x))}for(q=0;;){U=vt+(q<<3)|0,H=u[U>>2]|0,U=u[U+4>>2]|0;i:do if((H|0)==0&(U|0)==0)x=m,E=y;else{if(M=ma(H|0,U|0,Ge|0,ze|0)|0,w=D()|0,x=d+(M<<3)|0,c=x,E=u[c>>2]|0,c=u[c+4>>2]|0,!((E|0)==0&(c|0)==0)){O=0,V=0;do{if((O|0)>(ze|0)|(O|0)==(ze|0)&V>>>0>Ge>>>0)break r;if((E|0)==(H|0)&(c|0)==(U|0)){x=m,E=y;break i}x=Je(M|0,w|0,1,0)|0,M=nh(x|0,D()|0,Ge|0,ze|0)|0,w=D()|0,V=Je(V|0,O|0,1,0)|0,O=D()|0,x=d+(M<<3)|0,c=x,E=u[c>>2]|0,c=u[c+4>>2]|0}while(!((E|0)==0&(c|0)==0))}(H|0)==0&(U|0)==0?(x=m,E=y):(cl(H,U,ke)|0,MF(l,Rt,ke)|0&&(V=Je(m|0,y|0,1,0)|0,y=D()|0,O=x,u[O>>2]=H,u[O+4>>2]=U,m=be+(m<<3)|0,u[m>>2]=H,u[m+4>>2]=U,m=V),x=m,E=y)}while(!1);if(q=q+1|0,q>>>0>=7)break;m=x,y=E}if(ne=Je(ne|0,ie|0,1,0)|0,ie=D()|0,$=Je($|0,te|0,1,0)|0,te=D()|0,y=We,m=u[y>>2]|0,y=u[y+4>>2]|0,(te|0)<(y|0)|(te|0)==(y|0)&$>>>0<m>>>0)m=x,y=E;else break}if((y|0)>0|(y|0)==0&m>>>0>0){m=0,y=0;do te=pe+(m<<3)|0,u[te>>2]=0,u[te+4>>2]=0,m=Je(m|0,y|0,1,0)|0,y=D()|0,te=We,$=u[te+4>>2]|0;while((y|0)<($|0)|((y|0)==($|0)?m>>>0<(u[te>>2]|0)>>>0:0))}if(te=We,u[te>>2]=x,u[te+4>>2]=E,(E|0)>0|(E|0)==0&x>>>0>0)q=p,ne=ve,ie=at,$=xe,te=be,p=Q,ve=f,xe=mt,Q=q,f=ne,at=ot,ot=ie,mt=$,be=pe,pe=te;else break t}De(mt),De(ot),De(Rt),f=1;break e}else f=x;while(!1);De(Rt),De(p),De(f),f=0}while(!1);return Rt=f,R=Dr,Rt|0}function _O(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0;if(M=R,R=R+176|0,E=M,(c|0)<1)return Hb(f,0,0),w=0,R=M,w|0;for(x=l,x=Ae(u[x>>2]|0,u[x+4>>2]|0,52)|0,D()|0,Hb(f,(c|0)>6?c:6,x&15),x=0;d=l+(x<<3)|0,d=ll(u[d>>2]|0,u[d+4>>2]|0,E)|0,!(d|0);){if(d=u[E>>2]|0,(d|0)>0){y=0;do m=E+8+(y<<4)|0,y=y+1|0,d=E+8+(((y|0)%(d|0)|0)<<4)|0,p=WF(f,d,m)|0,p?jb(f,p)|0:GF(f,m,d)|0,d=u[E>>2]|0;while((y|0)<(d|0))}if(x=x+1|0,(x|0)>=(c|0)){d=0,w=13;break}}return(w|0)==13?(R=M,d|0):(Gb(f),w=d,R=M,w|0)}function yO(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0;if(m=R,R=R+32|0,d=m,p=m+16|0,l=_O(l,c,p)|0,l|0)return f=l,R=m,f|0;if(u[f>>2]=0,u[f+4>>2]=0,u[f+8>>2]=0,l=Wb(p)|0,l|0)do{c=yF(f)|0;do xF(c,l)|0,y=l+16|0,u[d>>2]=u[y>>2],u[d+4>>2]=u[y+4>>2],u[d+8>>2]=u[y+8>>2],u[d+12>>2]=u[y+12>>2],jb(p,l)|0,l=jF(p,d)|0;while(l|0);l=Wb(p)|0}while(l|0);return Gb(p),l=bF(f)|0,l?(Lb(f),y=l,R=m,y|0):(y=0,R=m,y|0)}function Ot(l){return l=l|0,l>>>0>121?(l=0,l|0):(l=u[7696+(l*28|0)+16>>2]|0,l|0)}function Jg(l){return l=l|0,(l|0)==4|(l|0)==117|0}function pb(l){return l=l|0,u[11120+((u[l>>2]|0)*216|0)+((u[l+4>>2]|0)*72|0)+((u[l+8>>2]|0)*24|0)+(u[l+12>>2]<<3)>>2]|0}function xO(l){return l=l|0,u[11120+((u[l>>2]|0)*216|0)+((u[l+4>>2]|0)*72|0)+((u[l+8>>2]|0)*24|0)+(u[l+12>>2]<<3)+4>>2]|0}function bO(l,c){l=l|0,c=c|0,l=7696+(l*28|0)|0,u[c>>2]=u[l>>2],u[c+4>>2]=u[l+4>>2],u[c+8>>2]=u[l+8>>2],u[c+12>>2]=u[l+12>>2]}function TO(l,c){l=l|0,c=c|0;var f=0,d=0;if(c>>>0>20)return c=-1,c|0;do if((u[11120+(c*216|0)>>2]|0)!=(l|0))if((u[11120+(c*216|0)+8>>2]|0)!=(l|0))if((u[11120+(c*216|0)+16>>2]|0)!=(l|0))if((u[11120+(c*216|0)+24>>2]|0)!=(l|0))if((u[11120+(c*216|0)+32>>2]|0)!=(l|0))if((u[11120+(c*216|0)+40>>2]|0)!=(l|0))if((u[11120+(c*216|0)+48>>2]|0)!=(l|0))if((u[11120+(c*216|0)+56>>2]|0)!=(l|0))if((u[11120+(c*216|0)+64>>2]|0)!=(l|0))if((u[11120+(c*216|0)+72>>2]|0)!=(l|0))if((u[11120+(c*216|0)+80>>2]|0)!=(l|0))if((u[11120+(c*216|0)+88>>2]|0)!=(l|0))if((u[11120+(c*216|0)+96>>2]|0)!=(l|0))if((u[11120+(c*216|0)+104>>2]|0)!=(l|0))if((u[11120+(c*216|0)+112>>2]|0)!=(l|0))if((u[11120+(c*216|0)+120>>2]|0)!=(l|0))if((u[11120+(c*216|0)+128>>2]|0)!=(l|0))if((u[11120+(c*216|0)+136>>2]|0)==(l|0))l=2,f=1,d=2;else{if((u[11120+(c*216|0)+144>>2]|0)==(l|0)){l=0,f=2,d=0;break}if((u[11120+(c*216|0)+152>>2]|0)==(l|0)){l=0,f=2,d=1;break}if((u[11120+(c*216|0)+160>>2]|0)==(l|0)){l=0,f=2,d=2;break}if((u[11120+(c*216|0)+168>>2]|0)==(l|0)){l=1,f=2,d=0;break}if((u[11120+(c*216|0)+176>>2]|0)==(l|0)){l=1,f=2,d=1;break}if((u[11120+(c*216|0)+184>>2]|0)==(l|0)){l=1,f=2,d=2;break}if((u[11120+(c*216|0)+192>>2]|0)==(l|0)){l=2,f=2,d=0;break}if((u[11120+(c*216|0)+200>>2]|0)==(l|0)){l=2,f=2,d=1;break}if((u[11120+(c*216|0)+208>>2]|0)==(l|0)){l=2,f=2,d=2;break}else l=-1;return l|0}else l=2,f=1,d=1;else l=2,f=1,d=0;else l=1,f=1,d=2;else l=1,f=1,d=1;else l=1,f=1,d=0;else l=0,f=1,d=2;else l=0,f=1,d=1;else l=0,f=1,d=0;else l=2,f=0,d=2;else l=2,f=0,d=1;else l=2,f=0,d=0;else l=1,f=0,d=2;else l=1,f=0,d=1;else l=1,f=0,d=0;else l=0,f=0,d=2;else l=0,f=0,d=1;else l=0,f=0,d=0;while(!1);return c=u[11120+(c*216|0)+(f*72|0)+(l*24|0)+(d<<3)+4>>2]|0,c|0}function gb(l,c){return l=l|0,c=c|0,(u[7696+(l*28|0)+20>>2]|0)==(c|0)?(c=1,c|0):(c=(u[7696+(l*28|0)+24>>2]|0)==(c|0),c|0)}function Zg(l,c){return l=l|0,c=c|0,u[848+(l*28|0)+(c<<2)>>2]|0}function $g(l,c){return l=l|0,c=c|0,(u[848+(l*28|0)>>2]|0)==(c|0)?(c=0,c|0):(u[848+(l*28|0)+4>>2]|0)==(c|0)?(c=1,c|0):(u[848+(l*28|0)+8>>2]|0)==(c|0)?(c=2,c|0):(u[848+(l*28|0)+12>>2]|0)==(c|0)?(c=3,c|0):(u[848+(l*28|0)+16>>2]|0)==(c|0)?(c=4,c|0):(u[848+(l*28|0)+20>>2]|0)==(c|0)?(c=5,c|0):((u[848+(l*28|0)+24>>2]|0)==(c|0)?6:7)|0}function EO(){return 122}function vO(l){l=l|0;var c=0,f=0,d=0;c=0;do ge(c|0,0,45)|0,d=D()|0|134225919,f=l+(c<<3)|0,u[f>>2]=-1,u[f+4>>2]=d,c=c+1|0;while((c|0)!=122);return 0}function mb(l){return l=l|0,+B[l+16>>3]<+B[l+24>>3]|0}function _b(l,c){l=l|0,c=c|0;var f=0,d=0,p=0;return f=+B[c>>3],!(f>=+B[l+8>>3])||!(f<=+B[l>>3])?(c=0,c|0):(d=+B[l+16>>3],f=+B[l+24>>3],p=+B[c+8>>3],c=p>=f,l=p<=d&1,d<f?c&&(l=1):c||(l=0),c=(l|0)!=0,c|0)}function yb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0;U=R,R=R+288|0,M=U+264|0,O=U+96|0,w=U,x=w,E=x+96|0;do u[x>>2]=0,x=x+4|0;while((x|0)<(E|0));return c=lm(c,w)|0,c|0?(H=c,R=U,H|0):(E=w,w=u[E>>2]|0,E=u[E+4>>2]|0,cl(w,E,M)|0,ll(w,E,O)|0,y=+ul(M,O+8|0),B[M>>3]=+B[l>>3],E=M+8|0,B[E>>3]=+B[l+16>>3],B[O>>3]=+B[l+8>>3],w=O+8|0,B[w>>3]=+B[l+24>>3],p=+ul(M,O),ne=+B[E>>3]-+B[w>>3],m=+gt(+ne),q=+B[M>>3]-+B[O>>3],d=+gt(+q),!(ne==0|q==0)&&(ne=+Qb(+m,+d),ne=+ha(+(p*p/+hm(+(ne/+hm(+m,+d)),3)/(y*(y*2.59807621135)*.8))),B[ar>>3]=ne,V=~~ne>>>0,H=+gt(ne)>=1?ne>0?~~+qg(+cr(ne/4294967296),4294967295)>>>0:~~+ha((ne-+(~~ne>>>0))/4294967296)>>>0:0,(u[ar+4>>2]&2146435072|0)!=2146435072)?(O=(V|0)==0&(H|0)==0,c=f,u[c>>2]=O?1:V,u[c+4>>2]=O?0:H,c=0):c=1,H=c,R=U,H|0)}function wO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0;w=R,R=R+288|0,y=w+264|0,x=w+96|0,E=w,p=E,m=p+96|0;do u[p>>2]=0,p=p+4|0;while((p|0)<(m|0));return f=lm(f,E)|0,f|0?(d=f,R=w,d|0):(f=E,p=u[f>>2]|0,f=u[f+4>>2]|0,cl(p,f,y)|0,ll(p,f,x)|0,M=+ul(y,x+8|0),M=+ha(+(+ul(l,c)/(M*2))),B[ar>>3]=M,f=~~M>>>0,p=+gt(M)>=1?M>0?~~+qg(+cr(M/4294967296),4294967295)>>>0:~~+ha((M-+(~~M>>>0))/4294967296)>>>0:0,(u[ar+4>>2]&2146435072|0)==2146435072?(d=1,R=w,d|0):(E=(f|0)==0&(p|0)==0,u[d>>2]=E?1:f,u[d+4>>2]=E?0:p,d=0,R=w,d|0))}function CO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0,u[l>>2]=c,u[l+4>>2]=f,u[l+8>>2]=d}function SO(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0;O=c+8|0,u[O>>2]=0,E=+B[l>>3],y=+gt(+E),w=+B[l+8>>3],x=+gt(+w)/.8660254037844386,y=y+x*.5,f=~~y,l=~~x,y=y-+(f|0),x=x-+(l|0);do if(y<.5)if(y<.3333333333333333)if(u[c>>2]=f,x<(y+1)*.5){u[c+4>>2]=l;break}else{l=l+1|0,u[c+4>>2]=l;break}else if(V=1-y,l=(!(x<V)&1)+l|0,u[c+4>>2]=l,V<=x&x<y*2){f=f+1|0,u[c>>2]=f;break}else{u[c>>2]=f;break}else{if(!(y<.6666666666666666))if(f=f+1|0,u[c>>2]=f,x<y*.5){u[c+4>>2]=l;break}else{l=l+1|0,u[c+4>>2]=l;break}if(x<1-y){if(u[c+4>>2]=l,y*2+-1<x){u[c>>2]=f;break}}else l=l+1|0,u[c+4>>2]=l;f=f+1|0,u[c>>2]=f}while(!1);do if(E<0)if(l&1){M=(l+1|0)/2|0,M=wr(f|0,((f|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-((+(M>>>0)+4294967296*+(D()|0))*2+1)),u[c>>2]=f;break}else{M=(l|0)/2|0,M=wr(f|0,((f|0)<0)<<31>>31|0,M|0,((M|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-(+(M>>>0)+4294967296*+(D()|0))*2),u[c>>2]=f;break}while(!1);M=c+4|0,w<0&&(f=f-((l<<1|1|0)/2|0)|0,u[c>>2]=f,l=0-l|0,u[M>>2]=l),d=l-f|0,(f|0)<0?(p=0-f|0,u[M>>2]=d,u[O>>2]=p,u[c>>2]=0,l=d,f=0):p=0,(l|0)<0&&(f=f-l|0,u[c>>2]=f,p=p-l|0,u[O>>2]=p,u[M>>2]=0,l=0),m=f-p|0,d=l-p|0,(p|0)<0&&(u[c>>2]=m,u[M>>2]=d,u[O>>2]=0,l=d,f=m,p=0),d=(l|0)<(f|0)?l:f,d=(p|0)<(d|0)?p:d,!((d|0)<=0)&&(u[c>>2]=f-d,u[M>>2]=l-d,u[O>>2]=p-d)}function vr(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0;c=u[l>>2]|0,y=l+4|0,f=u[y>>2]|0,(c|0)<0&&(f=f-c|0,u[y>>2]=f,m=l+8|0,u[m>>2]=(u[m>>2]|0)-c,u[l>>2]=0,c=0),(f|0)<0?(c=c-f|0,u[l>>2]=c,m=l+8|0,p=(u[m>>2]|0)-f|0,u[m>>2]=p,u[y>>2]=0,f=0):(p=l+8|0,m=p,p=u[p>>2]|0),(p|0)<0&&(c=c-p|0,u[l>>2]=c,f=f-p|0,u[y>>2]=f,u[m>>2]=0,p=0),d=(f|0)<(c|0)?f:c,d=(p|0)<(d|0)?p:d,!((d|0)<=0)&&(u[l>>2]=c-d,u[y>>2]=f-d,u[m>>2]=p-d)}function eo(l,c){l=l|0,c=c|0;var f=0,d=0;d=u[l+8>>2]|0,f=+((u[l+4>>2]|0)-d|0),B[c>>3]=+((u[l>>2]|0)-d|0)-f*.5,B[c+8>>3]=f*.8660254037844386}function Nr(l,c,f){l=l|0,c=c|0,f=f|0,u[f>>2]=(u[c>>2]|0)+(u[l>>2]|0),u[f+4>>2]=(u[c+4>>2]|0)+(u[l+4>>2]|0),u[f+8>>2]=(u[c+8>>2]|0)+(u[l+8>>2]|0)}function em(l,c,f){l=l|0,c=c|0,f=f|0,u[f>>2]=(u[l>>2]|0)-(u[c>>2]|0),u[f+4>>2]=(u[l+4>>2]|0)-(u[c+4>>2]|0),u[f+8>>2]=(u[l+8>>2]|0)-(u[c+8>>2]|0)}function xb(l,c){l=l|0,c=c|0;var f=0,d=0;f=Ki(u[l>>2]|0,c)|0,u[l>>2]=f,f=l+4|0,d=Ki(u[f>>2]|0,c)|0,u[f>>2]=d,l=l+8|0,c=Ki(u[l>>2]|0,c)|0,u[l>>2]=c}function $f(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;y=u[l>>2]|0,x=(y|0)<0,d=(u[l+4>>2]|0)-(x?y:0)|0,m=(d|0)<0,p=(m?0-d|0:0)+((u[l+8>>2]|0)-(x?y:0))|0,f=(p|0)<0,l=f?0:p,c=(m?0:d)-(f?p:0)|0,p=(x?0:y)-(m?d:0)-(f?p:0)|0,f=(c|0)<(p|0)?c:p,f=(l|0)<(f|0)?l:f,d=(f|0)>0,l=l-(d?f:0)|0,c=c-(d?f:0)|0;e:do switch(p-(d?f:0)|0){case 0:switch(c|0){case 0:return x=l|0?(l|0)==1?1:7:0,x|0;case 1:return x=l|0?(l|0)==1?3:7:2,x|0;default:break e}case 1:switch(c|0){case 0:return x=l|0?(l|0)==1?5:7:4,x|0;case 1:{if(!l)l=6;else break e;return l|0}default:break e}default:}while(!1);return x=7,x|0}function MO(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;y=l+8|0,p=u[y>>2]|0,m=(u[l>>2]|0)-p|0,x=l+4|0,p=(u[x>>2]|0)-p|0;do if(m>>>0>715827881|p>>>0>715827881){if(f=(m|0)>0,f){if((2147483647-m|0)<(m|0)||(2147483647-(m<<1)|0)<(m|0))return x=1,x|0}else if((-2147483648-m|0)>(m|0)||(-2147483648-(m<<1)|0)>(m|0))return x=1,x|0;if(c=m*3|0,(p|0)>0){if((2147483647-p|0)<(p|0))return x=1,x|0}else if((-2147483648-p|0)>(p|0))return x=1,x|0;if(d=p<<1,(m|0)>-1){if((c|-2147483648|0)>=(p|0))return x=1,x|0}else if((c^-2147483648|0)<(p|0))return x=1,x|0;if(f){if((2147483647-m|0)<(d|0))c=1;else{f=d;break}return c|0}else{if((-2147483648-m|0)>(d|0))c=1;else{f=d;break}return c|0}}else f=p<<1,c=m*3|0;while(!1);d=As(+(c-p|0)/7)|0,u[l>>2]=d,p=As(+(f+m|0)/7)|0,u[x>>2]=p,u[y>>2]=0,f=(p|0)<(d|0),c=f?d:p,f=f?p:d;do if((f|0)<0){if((c|0)>0){if((c|-2147483648|0)<(f|0)&((f|0)!=-2147483648&(2147483647-c|0)>=(f|0)))break;Oe(23313,22444,355,22455)}if((f|0)==-2147483648|(-2147483648-c|0)>(f|0)&&Oe(23313,22444,355,22455),(c|0)>-1){if((c|-2147483648|0)<(f|0))break;Oe(23313,22444,355,22455)}else{if((c^-2147483648|0)>=(f|0))break;Oe(23313,22444,355,22455)}}while(!1);return c=p-d|0,(d|0)<0?(f=0-d|0,u[x>>2]=c,u[y>>2]=f,u[l>>2]=0,d=0):(c=p,f=0),(c|0)<0&&(d=d-c|0,u[l>>2]=d,f=f-c|0,u[y>>2]=f,u[x>>2]=0,c=0),m=d-f|0,p=c-f|0,(f|0)<0?(u[l>>2]=m,u[x>>2]=p,u[y>>2]=0,c=p,p=m,f=0):p=d,d=(c|0)<(p|0)?c:p,d=(f|0)<(d|0)?f:d,(d|0)<=0?(x=0,x|0):(u[l>>2]=p-d,u[x>>2]=c-d,u[y>>2]=f-d,x=0,x|0)}function PO(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;y=l+8|0,p=u[y>>2]|0,m=(u[l>>2]|0)-p|0,x=l+4|0,p=(u[x>>2]|0)-p|0;do if(m>>>0>715827881|p>>>0>715827881){if(f=(m|0)>0,f){if((2147483647-m|0)<(m|0))return x=1,x|0}else if((-2147483648-m|0)>(m|0))return x=1,x|0;if(c=m<<1,(p|0)>0){if((2147483647-p|0)<(p|0)||(2147483647-(p<<1)|0)<(p|0))return x=1,x|0}else if((-2147483648-p|0)>(p|0)||(-2147483648-(p<<1)|0)>(p|0))return x=1,x|0;if(d=p*3|0,f){if((2147483647-c|0)<(p|0))return x=1,x|0}else if((-2147483648-c|0)>(p|0))return x=1,x|0;if((p|0)>-1){if((d|-2147483648|0)<(m|0)){f=d;break}else c=1;return c|0}else{if((d^-2147483648|0)<(m|0))c=1;else{f=d;break}return c|0}}else f=p*3|0,c=m<<1;while(!1);d=As(+(c+p|0)/7)|0,u[l>>2]=d,p=As(+(f-m|0)/7)|0,u[x>>2]=p,u[y>>2]=0,f=(p|0)<(d|0),c=f?d:p,f=f?p:d;do if((f|0)<0){if((c|0)>0){if((c|-2147483648|0)<(f|0)&((f|0)!=-2147483648&(2147483647-c|0)>=(f|0)))break;Oe(23313,22444,404,22469)}if((f|0)==-2147483648|(-2147483648-c|0)>(f|0)&&Oe(23313,22444,404,22469),(c|0)>-1){if((c|-2147483648|0)<(f|0))break;Oe(23313,22444,404,22469)}else{if((c^-2147483648|0)>=(f|0))break;Oe(23313,22444,404,22469)}}while(!1);return c=p-d|0,(d|0)<0?(f=0-d|0,u[x>>2]=c,u[y>>2]=f,u[l>>2]=0,d=0):(c=p,f=0),(c|0)<0&&(d=d-c|0,u[l>>2]=d,f=f-c|0,u[y>>2]=f,u[x>>2]=0,c=0),m=d-f|0,p=c-f|0,(f|0)<0?(u[l>>2]=m,u[x>>2]=p,u[y>>2]=0,c=p,p=m,f=0):p=d,d=(c|0)<(p|0)?c:p,d=(f|0)<(d|0)?f:d,(d|0)<=0?(x=0,x|0):(u[l>>2]=p-d,u[x>>2]=c-d,u[y>>2]=f-d,x=0,x|0)}function RO(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;y=l+8|0,f=u[y>>2]|0,c=(u[l>>2]|0)-f|0,x=l+4|0,f=(u[x>>2]|0)-f|0,d=As(+((c*3|0)-f|0)/7)|0,u[l>>2]=d,c=As(+((f<<1)+c|0)/7)|0,u[x>>2]=c,u[y>>2]=0,f=c-d|0,(d|0)<0?(m=0-d|0,u[x>>2]=f,u[y>>2]=m,u[l>>2]=0,c=f,d=0,f=m):f=0,(c|0)<0&&(d=d-c|0,u[l>>2]=d,f=f-c|0,u[y>>2]=f,u[x>>2]=0,c=0),m=d-f|0,p=c-f|0,(f|0)<0?(u[l>>2]=m,u[x>>2]=p,u[y>>2]=0,c=p,p=m,f=0):p=d,d=(c|0)<(p|0)?c:p,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(u[l>>2]=p-d,u[x>>2]=c-d,u[y>>2]=f-d)}function bb(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;y=l+8|0,f=u[y>>2]|0,c=(u[l>>2]|0)-f|0,x=l+4|0,f=(u[x>>2]|0)-f|0,d=As(+((c<<1)+f|0)/7)|0,u[l>>2]=d,c=As(+((f*3|0)-c|0)/7)|0,u[x>>2]=c,u[y>>2]=0,f=c-d|0,(d|0)<0?(m=0-d|0,u[x>>2]=f,u[y>>2]=m,u[l>>2]=0,c=f,d=0,f=m):f=0,(c|0)<0&&(d=d-c|0,u[l>>2]=d,f=f-c|0,u[y>>2]=f,u[x>>2]=0,c=0),m=d-f|0,p=c-f|0,(f|0)<0?(u[l>>2]=m,u[x>>2]=p,u[y>>2]=0,c=p,p=m,f=0):p=d,d=(c|0)<(p|0)?c:p,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(u[l>>2]=p-d,u[x>>2]=c-d,u[y>>2]=f-d)}function eh(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;c=u[l>>2]|0,y=l+4|0,f=u[y>>2]|0,x=l+8|0,d=u[x>>2]|0,p=f+(c*3|0)|0,u[l>>2]=p,f=d+(f*3|0)|0,u[y>>2]=f,c=(d*3|0)+c|0,u[x>>2]=c,d=f-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=d,u[x>>2]=c,u[l>>2]=0,f=d,d=0):d=p,(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[x>>2]=c,u[y>>2]=0,f=0),m=d-c|0,p=f-c|0,(c|0)<0?(u[l>>2]=m,u[y>>2]=p,u[x>>2]=0,d=m,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[y>>2]=p-f,u[x>>2]=c-f)}function to(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;p=u[l>>2]|0,y=l+4|0,c=u[y>>2]|0,x=l+8|0,f=u[x>>2]|0,d=(c*3|0)+p|0,p=f+(p*3|0)|0,u[l>>2]=p,u[y>>2]=d,c=(f*3|0)+c|0,u[x>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=f,u[x>>2]=c,u[l>>2]=0,p=0):f=d,(f|0)<0&&(p=p-f|0,u[l>>2]=p,c=c-f|0,u[x>>2]=c,u[y>>2]=0,f=0),m=p-c|0,d=f-c|0,(c|0)<0?(u[l>>2]=m,u[y>>2]=d,u[x>>2]=0,p=m,c=0):d=f,f=(d|0)<(p|0)?d:p,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=p-f,u[y>>2]=d-f,u[x>>2]=c-f)}function Tb(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0;(c+-1|0)>>>0>=6||(p=(u[15440+(c*12|0)>>2]|0)+(u[l>>2]|0)|0,u[l>>2]=p,x=l+4|0,d=(u[15440+(c*12|0)+4>>2]|0)+(u[x>>2]|0)|0,u[x>>2]=d,y=l+8|0,c=(u[15440+(c*12|0)+8>>2]|0)+(u[y>>2]|0)|0,u[y>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[x>>2]=f,u[y>>2]=c,u[l>>2]=0,d=0):(f=d,d=p),(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[y>>2]=c,u[x>>2]=0,f=0),m=d-c|0,p=f-c|0,(c|0)<0?(u[l>>2]=m,u[x>>2]=p,u[y>>2]=0,d=m,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[x>>2]=p-f,u[y>>2]=c-f))}function Eb(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;p=u[l>>2]|0,y=l+4|0,c=u[y>>2]|0,x=l+8|0,f=u[x>>2]|0,d=c+p|0,p=f+p|0,u[l>>2]=p,u[y>>2]=d,c=f+c|0,u[x>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=f,u[x>>2]=c,u[l>>2]=0,d=0):(f=d,d=p),(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[x>>2]=c,u[y>>2]=0,f=0),m=d-c|0,p=f-c|0,(c|0)<0?(u[l>>2]=m,u[y>>2]=p,u[x>>2]=0,d=m,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[y>>2]=p-f,u[x>>2]=c-f)}function th(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;c=u[l>>2]|0,y=l+4|0,d=u[y>>2]|0,x=l+8|0,f=u[x>>2]|0,p=d+c|0,u[l>>2]=p,d=f+d|0,u[y>>2]=d,c=f+c|0,u[x>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=f,u[x>>2]=c,u[l>>2]=0,d=0):(f=d,d=p),(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[x>>2]=c,u[y>>2]=0,f=0),m=d-c|0,p=f-c|0,(c|0)<0?(u[l>>2]=m,u[y>>2]=p,u[x>>2]=0,d=m,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[y>>2]=p-f,u[x>>2]=c-f)}function ro(l){switch(l=l|0,l|0){case 1:{l=5;break}case 5:{l=4;break}case 4:{l=6;break}case 6:{l=2;break}case 2:{l=3;break}case 3:{l=1;break}default:}return l|0}function cs(l){switch(l=l|0,l|0){case 1:{l=3;break}case 3:{l=2;break}case 2:{l=6;break}case 6:{l=4;break}case 4:{l=5;break}case 5:{l=1;break}default:}return l|0}function vb(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;c=u[l>>2]|0,y=l+4|0,f=u[y>>2]|0,x=l+8|0,d=u[x>>2]|0,p=f+(c<<1)|0,u[l>>2]=p,f=d+(f<<1)|0,u[y>>2]=f,c=(d<<1)+c|0,u[x>>2]=c,d=f-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=d,u[x>>2]=c,u[l>>2]=0,f=d,d=0):d=p,(f|0)<0&&(d=d-f|0,u[l>>2]=d,c=c-f|0,u[x>>2]=c,u[y>>2]=0,f=0),m=d-c|0,p=f-c|0,(c|0)<0?(u[l>>2]=m,u[y>>2]=p,u[x>>2]=0,d=m,c=0):p=f,f=(p|0)<(d|0)?p:d,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=d-f,u[y>>2]=p-f,u[x>>2]=c-f)}function wb(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;p=u[l>>2]|0,y=l+4|0,c=u[y>>2]|0,x=l+8|0,f=u[x>>2]|0,d=(c<<1)+p|0,p=f+(p<<1)|0,u[l>>2]=p,u[y>>2]=d,c=(f<<1)+c|0,u[x>>2]=c,f=d-p|0,(p|0)<0?(c=c-p|0,u[y>>2]=f,u[x>>2]=c,u[l>>2]=0,p=0):f=d,(f|0)<0&&(p=p-f|0,u[l>>2]=p,c=c-f|0,u[x>>2]=c,u[y>>2]=0,f=0),m=p-c|0,d=f-c|0,(c|0)<0?(u[l>>2]=m,u[y>>2]=d,u[x>>2]=0,p=m,c=0):d=f,f=(d|0)<(p|0)?d:p,f=(c|0)<(f|0)?c:f,!((f|0)<=0)&&(u[l>>2]=p-f,u[y>>2]=d-f,u[x>>2]=c-f)}function tm(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0;return y=(u[l>>2]|0)-(u[c>>2]|0)|0,x=(y|0)<0,d=(u[l+4>>2]|0)-(u[c+4>>2]|0)-(x?y:0)|0,m=(d|0)<0,p=(x?0-y|0:0)+(u[l+8>>2]|0)-(u[c+8>>2]|0)+(m?0-d|0:0)|0,l=(p|0)<0,c=l?0:p,f=(m?0:d)-(l?p:0)|0,p=(x?0:y)-(m?d:0)-(l?p:0)|0,l=(f|0)<(p|0)?f:p,l=(c|0)<(l|0)?c:l,d=(l|0)>0,c=c-(d?l:0)|0,f=f-(d?l:0)|0,l=p-(d?l:0)|0,l=(l|0)>-1?l:0-l|0,f=(f|0)>-1?f:0-f|0,c=(c|0)>-1?c:0-c|0,c=(f|0)>(c|0)?f:c,((l|0)>(c|0)?l:c)|0}function IO(l,c){l=l|0,c=c|0;var f=0;f=u[l+8>>2]|0,u[c>>2]=(u[l>>2]|0)-f,u[c+4>>2]=(u[l+4>>2]|0)-f}function BO(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0;d=u[l>>2]|0,u[c>>2]=d,p=u[l+4>>2]|0,y=c+4|0,u[y>>2]=p,x=c+8|0,u[x>>2]=0,f=(p|0)<(d|0),l=f?d:p,f=f?p:d;do if((f|0)<0){if((l|0)>0){if((l|-2147483648|0)<(f|0)&((f|0)!=-2147483648&(2147483647-l|0)>=(f|0)))break;return l=1,l|0}if((f|0)==-2147483648|(-2147483648-l|0)>(f|0))return c=1,c|0;if((l|0)>-1){if((l|-2147483648|0)<(f|0))break;return l=1,l|0}else{if((l^-2147483648|0)<(f|0))l=1;else break;return l|0}}while(!1);return l=p-d|0,(d|0)<0?(f=0-d|0,u[y>>2]=l,u[x>>2]=f,u[c>>2]=0,d=0):(l=p,f=0),(l|0)<0&&(d=d-l|0,u[c>>2]=d,f=f-l|0,u[x>>2]=f,u[y>>2]=0,l=0),m=d-f|0,p=l-f|0,(f|0)<0?(u[c>>2]=m,u[y>>2]=p,u[x>>2]=0,l=p,p=m,f=0):p=d,d=(l|0)<(p|0)?l:p,d=(f|0)<(d|0)?f:d,(d|0)<=0?(c=0,c|0):(u[c>>2]=p-d,u[y>>2]=l-d,u[x>>2]=f-d,c=0,c|0)}function Cb(l){l=l|0;var c=0,f=0,d=0,p=0;c=l+8|0,p=u[c>>2]|0,f=p-(u[l>>2]|0)|0,u[l>>2]=f,d=l+4|0,l=(u[d>>2]|0)-p|0,u[d>>2]=l,u[c>>2]=0-(l+f)}function OO(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;f=u[l>>2]|0,c=0-f|0,u[l>>2]=c,y=l+8|0,u[y>>2]=0,x=l+4|0,d=u[x>>2]|0,p=d+f|0,(f|0)>0?(u[x>>2]=p,u[y>>2]=f,u[l>>2]=0,c=0,d=p):f=0,(d|0)<0?(m=c-d|0,u[l>>2]=m,f=f-d|0,u[y>>2]=f,u[x>>2]=0,p=m-f|0,c=0-f|0,(f|0)<0?(u[l>>2]=p,u[x>>2]=c,u[y>>2]=0,d=c,f=0):(d=0,p=m)):p=c,c=(d|0)<(p|0)?d:p,c=(f|0)<(c|0)?f:c,!((c|0)<=0)&&(u[l>>2]=p-c,u[x>>2]=d-c,u[y>>2]=f-c)}function FO(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0;if(O=R,R=R+64|0,M=O,x=O+56|0,!(!0&(c&2013265920|0)==134217728&(!0&(d&2013265920|0)==134217728)))return p=5,R=O,p|0;if((l|0)==(f|0)&(c|0)==(d|0))return u[p>>2]=0,p=0,R=O,p|0;if(y=Ae(l|0,c|0,52)|0,D()|0,y=y&15,w=Ae(f|0,d|0,52)|0,D()|0,(y|0)!=(w&15|0))return p=12,R=O,p|0;if(m=y+-1|0,y>>>0>1){sm(l,c,m,M)|0,sm(f,d,m,x)|0,w=M,E=u[w>>2]|0,w=u[w+4>>2]|0;e:do if((E|0)==(u[x>>2]|0)&&(w|0)==(u[x+4>>2]|0)){y=(y^15)*3|0,m=Ae(l|0,c|0,y|0)|0,D()|0,m=m&7,y=Ae(f|0,d|0,y|0)|0,D()|0,y=y&7;do if((m|0)==0|(y|0)==0)u[p>>2]=1,m=0;else if((m|0)==7)m=5;else{if((m|0)==1|(y|0)==1&&Ft(E,w)|0){m=5;break}if((u[15536+(m<<2)>>2]|0)!=(y|0)&&(u[15568+(m<<2)>>2]|0)!=(y|0))break e;u[p>>2]=1,m=0}while(!1);return p=m,R=O,p|0}while(!1)}m=M,y=m+56|0;do u[m>>2]=0,m=m+4|0;while((m|0)<(y|0));return ub(l,c,1,M)|0,c=M,!((u[c>>2]|0)==(f|0)&&(u[c+4>>2]|0)==(d|0))&&(c=M+8|0,!((u[c>>2]|0)==(f|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=M+16|0,!((u[c>>2]|0)==(f|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=M+24|0,!((u[c>>2]|0)==(f|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=M+32|0,!((u[c>>2]|0)==(f|0)&&(u[c+4>>2]|0)==(d|0)))&&(c=M+40|0,!((u[c>>2]|0)==(f|0)&&(u[c+4>>2]|0)==(d|0)))?(m=M+48|0,m=((u[m>>2]|0)==(f|0)?(u[m+4>>2]|0)==(d|0):0)&1):m=1,u[p>>2]=m,p=0,R=O,p|0}function LO(l,c,f,d,p){return l=l|0,c=c|0,f=f|0,d=d|0,p=p|0,f=Kg(l,c,f,d)|0,(f|0)==7?(p=11,p|0):(d=ge(f|0,0,56)|0,c=c&-2130706433|(D()|0)|268435456,u[p>>2]=l|d,u[p+4>>2]=c,p=0,p|0)}function NO(l,c,f){return l=l|0,c=c|0,f=f|0,!0&(c&2013265920|0)==268435456?(u[f>>2]=l,u[f+4>>2]=c&-2130706433|134217728,f=0,f|0):(f=6,f|0)}function DO(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;return p=R,R=R+16|0,d=p,u[d>>2]=0,!0&(c&2013265920|0)==268435456?(m=Ae(l|0,c|0,56)|0,D()|0,d=Ar(l,c&-2130706433|134217728,m&7,d,f)|0,R=p,d|0):(d=6,R=p,d|0)}function kO(l,c){l=l|0,c=c|0;var f=0;switch(f=Ae(l|0,c|0,56)|0,D()|0,f&7){case 0:case 7:return f=0,f|0;default:}return f=c&-2130706433|134217728,!(!0&(c&2013265920|0)==268435456)||!0&(c&117440512|0)==16777216&(Ft(l,f)|0)!=0?(f=0,f|0):(f=nm(l,f)|0,f|0)}function UO(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0;return p=R,R=R+16|0,d=p,!0&(c&2013265920|0)==268435456?(m=c&-2130706433|134217728,y=f,u[y>>2]=l,u[y+4>>2]=m,u[d>>2]=0,c=Ae(l|0,c|0,56)|0,D()|0,d=Ar(l,m,c&7,d,f+8|0)|0,R=p,d|0):(d=6,R=p,d|0)}function VO(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0;return p=(Ft(l,c)|0)==0,c=c&-2130706433,d=f,u[d>>2]=p?l:0,u[d+4>>2]=p?c|285212672:0,d=f+8|0,u[d>>2]=l,u[d+4>>2]=c|301989888,d=f+16|0,u[d>>2]=l,u[d+4>>2]=c|318767104,d=f+24|0,u[d>>2]=l,u[d+4>>2]=c|335544320,d=f+32|0,u[d>>2]=l,u[d+4>>2]=c|352321536,f=f+40|0,u[f>>2]=l,u[f+4>>2]=c|369098752,0}function rh(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0;return y=R,R=R+16|0,p=y,m=c&-2130706433|134217728,!0&(c&2013265920|0)==268435456?(d=Ae(l|0,c|0,56)|0,D()|0,d=UF(l,m,d&7)|0,(d|0)==-1?(u[f>>2]=0,m=6,R=y,m|0):(pa(l,m,p)|0&&Oe(23313,22484,282,22499),c=Ae(l|0,c|0,52)|0,D()|0,c=c&15,Ft(l,m)|0?rm(p,c,d,2,f):im(p,c,d,2,f),m=0,R=y,m|0)):(m=6,R=y,m|0)}function zO(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0;d=R,R=R+16|0,p=d,HO(l,c,f,p),SO(p,f+4|0),R=d}function HO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0;if(x=R,R=R+16|0,E=x,GO(l,f,E),m=+rO(+(1-+B[E>>3]*.5)),m<1e-16){u[d>>2]=0,u[d+4>>2]=0,u[d+8>>2]=0,u[d+12>>2]=0,R=x;return}if(E=u[f>>2]|0,p=+B[15920+(E*24|0)>>3],p=+Al(p-+Al(+cF(15600+(E<<4)|0,l))),fi(c)|0?y=+Al(p+-.3334731722518321):y=p,p=+ol(+m)/.381966011250105,(c|0)>0){l=0;do p=p*2.6457513110645907,l=l+1|0;while((l|0)!=(c|0))}m=+lt(+y)*p,B[d>>3]=m,y=+At(+y)*p,B[d+8>>3]=y,R=x}function GO(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;if(m=R,R=R+32|0,p=m,kF(l,p),u[c>>2]=0,B[f>>3]=5,d=+$t(16400,p),d<+B[f>>3]&&(u[c>>2]=0,B[f>>3]=d),d=+$t(16424,p),d<+B[f>>3]&&(u[c>>2]=1,B[f>>3]=d),d=+$t(16448,p),d<+B[f>>3]&&(u[c>>2]=2,B[f>>3]=d),d=+$t(16472,p),d<+B[f>>3]&&(u[c>>2]=3,B[f>>3]=d),d=+$t(16496,p),d<+B[f>>3]&&(u[c>>2]=4,B[f>>3]=d),d=+$t(16520,p),d<+B[f>>3]&&(u[c>>2]=5,B[f>>3]=d),d=+$t(16544,p),d<+B[f>>3]&&(u[c>>2]=6,B[f>>3]=d),d=+$t(16568,p),d<+B[f>>3]&&(u[c>>2]=7,B[f>>3]=d),d=+$t(16592,p),d<+B[f>>3]&&(u[c>>2]=8,B[f>>3]=d),d=+$t(16616,p),d<+B[f>>3]&&(u[c>>2]=9,B[f>>3]=d),d=+$t(16640,p),d<+B[f>>3]&&(u[c>>2]=10,B[f>>3]=d),d=+$t(16664,p),d<+B[f>>3]&&(u[c>>2]=11,B[f>>3]=d),d=+$t(16688,p),d<+B[f>>3]&&(u[c>>2]=12,B[f>>3]=d),d=+$t(16712,p),d<+B[f>>3]&&(u[c>>2]=13,B[f>>3]=d),d=+$t(16736,p),d<+B[f>>3]&&(u[c>>2]=14,B[f>>3]=d),d=+$t(16760,p),d<+B[f>>3]&&(u[c>>2]=15,B[f>>3]=d),d=+$t(16784,p),d<+B[f>>3]&&(u[c>>2]=16,B[f>>3]=d),d=+$t(16808,p),d<+B[f>>3]&&(u[c>>2]=17,B[f>>3]=d),d=+$t(16832,p),d<+B[f>>3]&&(u[c>>2]=18,B[f>>3]=d),d=+$t(16856,p),!(d<+B[f>>3])){R=m;return}u[c>>2]=19,B[f>>3]=d,R=m}function al(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0;if(m=+DF(l),m<1e-16){c=15600+(c<<4)|0,u[p>>2]=u[c>>2],u[p+4>>2]=u[c+4>>2],u[p+8>>2]=u[c+8>>2],u[p+12>>2]=u[c+12>>2];return}if(y=+ui(+ +B[l+8>>3],+ +B[l>>3]),(f|0)>0){l=0;do m=m/2.6457513110645907,l=l+1|0;while((l|0)!=(f|0))}d?(m=m/3,f=(fi(f)|0)==0,m=+Qg(+((f?m:m/2.6457513110645907)*.381966011250105))):(m=+Qg(+(m*.381966011250105)),fi(f)|0&&(y=+Al(y+.3334731722518321))),lF(15600+(c<<4)|0,+Al(+B[15920+(c*24|0)>>3]-y),m,p)}function WO(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0;d=R,R=R+16|0,p=d,eo(l+4|0,p),al(p,u[l>>2]|0,c,0,f),R=d}function rm(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0,be=0,mt=0,ot=0,at=0,Ge=0,ze=0,We=0,vt=0,ke=0;if(We=R,R=R+272|0,m=We+256|0,$=We+240|0,at=We,Ge=We+224|0,ze=We+208|0,te=We+176|0,Q=We+160|0,xe=We+192|0,ve=We+144|0,pe=We+128|0,be=We+112|0,mt=We+96|0,ot=We+80|0,u[m>>2]=c,u[$>>2]=u[l>>2],u[$+4>>2]=u[l+4>>2],u[$+8>>2]=u[l+8>>2],u[$+12>>2]=u[l+12>>2],Sb($,m,at),u[p>>2]=0,$=d+f+((d|0)==5&1)|0,($|0)<=(f|0)){R=We;return}E=u[m>>2]|0,w=Ge+4|0,M=te+4|0,O=f+5|0,V=16880+(E<<2)|0,H=16960+(E<<2)|0,U=pe+8|0,q=be+8|0,ne=mt+8|0,ie=ze+4|0,x=f;e:for(;;){y=at+(((x|0)%5|0)<<4)|0,u[ze>>2]=u[y>>2],u[ze+4>>2]=u[y+4>>2],u[ze+8>>2]=u[y+8>>2],u[ze+12>>2]=u[y+12>>2];do;while((da(ze,E,0,1)|0)==2);if((x|0)>(f|0)&(fi(c)|0)!=0){if(u[te>>2]=u[ze>>2],u[te+4>>2]=u[ze+4>>2],u[te+8>>2]=u[ze+8>>2],u[te+12>>2]=u[ze+12>>2],eo(w,Q),d=u[te>>2]|0,m=u[17040+(d*80|0)+(u[Ge>>2]<<2)>>2]|0,u[te>>2]=u[18640+(d*80|0)+(m*20|0)>>2],y=u[18640+(d*80|0)+(m*20|0)+16>>2]|0,(y|0)>0){l=0;do Eb(M),l=l+1|0;while((l|0)<(y|0))}switch(y=18640+(d*80|0)+(m*20|0)+4|0,u[xe>>2]=u[y>>2],u[xe+4>>2]=u[y+4>>2],u[xe+8>>2]=u[y+8>>2],xb(xe,(u[V>>2]|0)*3|0),Nr(M,xe,M),vr(M),eo(M,ve),vt=+(u[H>>2]|0),B[pe>>3]=vt*3,B[U>>3]=0,ke=vt*-1.5,B[be>>3]=ke,B[q>>3]=vt*2.598076211353316,B[mt>>3]=ke,B[ne>>3]=vt*-2.598076211353316,u[17040+((u[te>>2]|0)*80|0)+(u[ze>>2]<<2)>>2]|0){case 1:{l=be,d=pe;break}case 3:{l=mt,d=be;break}case 2:{l=pe,d=mt;break}default:{l=12;break e}}Vb(Q,ve,d,l,ot),al(ot,u[te>>2]|0,E,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1}if((x|0)<(O|0)&&(eo(ie,te),al(te,u[ze>>2]|0,E,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1),u[Ge>>2]=u[ze>>2],u[Ge+4>>2]=u[ze+4>>2],u[Ge+8>>2]=u[ze+8>>2],u[Ge+12>>2]=u[ze+12>>2],x=x+1|0,(x|0)>=($|0)){l=3;break}}if((l|0)==3){R=We;return}else(l|0)==12&&Oe(22522,22569,571,22579)}function Sb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0;E=R,R=R+128|0,d=E+64|0,p=E,m=d,y=20240,x=m+60|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(x|0));m=p,y=20304,x=m+60|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(x|0));x=(fi(u[c>>2]|0)|0)==0,d=x?d:p,p=l+4|0,vb(p),wb(p),fi(u[c>>2]|0)|0&&(to(p),u[c>>2]=(u[c>>2]|0)+1),u[f>>2]=u[l>>2],c=f+4|0,Nr(p,d,c),vr(c),u[f+16>>2]=u[l>>2],c=f+20|0,Nr(p,d+12|0,c),vr(c),u[f+32>>2]=u[l>>2],c=f+36|0,Nr(p,d+24|0,c),vr(c),u[f+48>>2]=u[l>>2],c=f+52|0,Nr(p,d+36|0,c),vr(c),u[f+64>>2]=u[l>>2],f=f+68|0,Nr(p,d+48|0,f),vr(f),R=E}function da(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0;if(U=R,R=R+32|0,V=U+12|0,x=U,H=l+4|0,O=u[16960+(c<<2)>>2]|0,M=(d|0)!=0,O=M?O*3|0:O,p=u[H>>2]|0,w=l+8|0,y=u[w>>2]|0,M){if(m=l+12|0,d=u[m>>2]|0,p=y+p+d|0,(p|0)==(O|0))return H=1,R=U,H|0;E=m}else E=l+12|0,d=u[E>>2]|0,p=y+p+d|0;if((p|0)<=(O|0))return H=0,R=U,H|0;do if((d|0)>0){if(d=u[l>>2]|0,(y|0)>0){m=18640+(d*80|0)+60|0,d=l;break}d=18640+(d*80|0)+40|0,f?(CO(V,O,0,0),em(H,V,x),th(x),Nr(x,V,H),m=d,d=l):(m=d,d=l)}else m=18640+((u[l>>2]|0)*80|0)+20|0,d=l;while(!1);if(u[d>>2]=u[m>>2],p=m+16|0,(u[p>>2]|0)>0){d=0;do Eb(H),d=d+1|0;while((d|0)<(u[p>>2]|0))}return l=m+4|0,u[V>>2]=u[l>>2],u[V+4>>2]=u[l+4>>2],u[V+8>>2]=u[l+8>>2],c=u[16880+(c<<2)>>2]|0,xb(V,M?c*3|0:c),Nr(H,V,H),vr(H),M?d=((u[w>>2]|0)+(u[H>>2]|0)+(u[E>>2]|0)|0)==(O|0)?1:2:d=2,H=d,R=U,H|0}function jO(l,c){l=l|0,c=c|0;var f=0;do f=da(l,c,0,1)|0;while((f|0)==2);return f|0}function im(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0,be=0,mt=0,ot=0,at=0;if(mt=R,R=R+240|0,m=mt+224|0,xe=mt+208|0,ve=mt,pe=mt+192|0,be=mt+176|0,ne=mt+160|0,ie=mt+144|0,$=mt+128|0,te=mt+112|0,Q=mt+96|0,u[m>>2]=c,u[xe>>2]=u[l>>2],u[xe+4>>2]=u[l+4>>2],u[xe+8>>2]=u[l+8>>2],u[xe+12>>2]=u[l+12>>2],Mb(xe,m,ve),u[p>>2]=0,q=d+f+((d|0)==6&1)|0,(q|0)<=(f|0)){R=mt;return}E=u[m>>2]|0,w=f+6|0,M=16960+(E<<2)|0,O=ie+8|0,V=$+8|0,H=te+8|0,U=pe+4|0,y=0,x=f,d=-1;e:for(;;){if(m=(x|0)%6|0,l=ve+(m<<4)|0,u[pe>>2]=u[l>>2],u[pe+4>>2]=u[l+4>>2],u[pe+8>>2]=u[l+8>>2],u[pe+12>>2]=u[l+12>>2],l=y,y=da(pe,E,0,1)|0,(x|0)>(f|0)&(fi(c)|0)!=0&&(l|0)!=1&&(u[pe>>2]|0)!=(d|0)){switch(eo(ve+(((m+5|0)%6|0)<<4)+4|0,be),eo(ve+(m<<4)+4|0,ne),ot=+(u[M>>2]|0),B[ie>>3]=ot*3,B[O>>3]=0,at=ot*-1.5,B[$>>3]=at,B[V>>3]=ot*2.598076211353316,B[te>>3]=at,B[H>>3]=ot*-2.598076211353316,m=u[xe>>2]|0,u[17040+(m*80|0)+(((d|0)==(m|0)?u[pe>>2]|0:d)<<2)>>2]|0){case 1:{l=$,d=ie;break}case 3:{l=te,d=$;break}case 2:{l=ie,d=te;break}default:{l=8;break e}}Vb(be,ne,d,l,Q),!(zb(be,Q)|0)&&!(zb(ne,Q)|0)&&(al(Q,u[xe>>2]|0,E,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1)}if((x|0)<(w|0)&&(eo(U,be),al(be,u[pe>>2]|0,E,1,p+8+(u[p>>2]<<4)|0),u[p>>2]=(u[p>>2]|0)+1),x=x+1|0,(x|0)>=(q|0)){l=3;break}else d=u[pe>>2]|0}if((l|0)==3){R=mt;return}else(l|0)==8&&Oe(22606,22569,736,22651)}function Mb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0;E=R,R=R+160|0,d=E+80|0,p=E,m=d,y=20368,x=m+72|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(x|0));m=p,y=20448,x=m+72|0;do u[m>>2]=u[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(x|0));x=(fi(u[c>>2]|0)|0)==0,d=x?d:p,p=l+4|0,vb(p),wb(p),fi(u[c>>2]|0)|0&&(to(p),u[c>>2]=(u[c>>2]|0)+1),u[f>>2]=u[l>>2],c=f+4|0,Nr(p,d,c),vr(c),u[f+16>>2]=u[l>>2],c=f+20|0,Nr(p,d+12|0,c),vr(c),u[f+32>>2]=u[l>>2],c=f+36|0,Nr(p,d+24|0,c),vr(c),u[f+48>>2]=u[l>>2],c=f+52|0,Nr(p,d+36|0,c),vr(c),u[f+64>>2]=u[l>>2],c=f+68|0,Nr(p,d+48|0,c),vr(c),u[f+80>>2]=u[l>>2],f=f+84|0,Nr(p,d+60|0,f),vr(f),R=E}function XO(l,c){return l=l|0,c=c|0,c=Ae(l|0,c|0,52)|0,D()|0,c&15|0}function Pb(l,c){return l=l|0,c=c|0,c=Ae(l|0,c|0,45)|0,D()|0,c&127|0}function nm(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0;if(!(!0&(c&-16777216|0)==134217728)||(y=Ae(l|0,c|0,45)|0,D()|0,y=y&127,y>>>0>121))return c=0,c|0;f=Ae(l|0,c|0,52)|0,D()|0,f=f&15;do if(f|0){for(p=1,d=0;;){if(m=Ae(l|0,c|0,(15-p|0)*3|0)|0,D()|0,m=m&7,(m|0)!=0&(d^1))if((m|0)==1&(Ot(y)|0)!=0){x=0,d=13;break}else d=1;if((m|0)==7){x=0,d=13;break}if(p>>>0<f>>>0)p=p+1|0;else{d=9;break}}if((d|0)==9){if((f|0)==15)x=1;else break;return x|0}else if((d|0)==13)return x|0}while(!1);for(;;){if(x=Ae(l|0,c|0,(14-f|0)*3|0)|0,D()|0,!((x&7|0)==7&!0)){x=0,d=13;break}if(f>>>0<14)f=f+1|0;else{x=1,d=13;break}}return(d|0)==13?x|0:0}function sm(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0;if(m=Ae(l|0,c|0,52)|0,D()|0,m=m&15,f>>>0>15)return d=4,d|0;if((m|0)<(f|0))return d=12,d|0;if((m|0)==(f|0))return u[d>>2]=l,u[d+4>>2]=c,d=0,d|0;if(p=ge(f|0,0,52)|0,p=p|l,l=D()|0|c&-15728641,(m|0)>(f|0))do c=ge(7,0,(14-f|0)*3|0)|0,f=f+1|0,p=c|p,l=D()|0|l;while((f|0)<(m|0));return u[d>>2]=p,u[d+4>>2]=l,d=0,d|0}function ih(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0;if(m=Ae(l|0,c|0,52)|0,D()|0,m=m&15,!((f|0)<16&(m|0)<=(f|0)))return d=4,d|0;p=f-m|0,f=Ae(l|0,c|0,45)|0,D()|0;e:do if(!(Ot(f&127)|0))f=ls(7,0,p,((p|0)<0)<<31>>31)|0,p=D()|0;else{t:do if(m|0){for(f=1;y=ge(7,0,(15-f|0)*3|0)|0,!!((y&l|0)==0&((D()|0)&c|0)==0);)if(f>>>0<m>>>0)f=f+1|0;else break t;f=ls(7,0,p,((p|0)<0)<<31>>31)|0,p=D()|0;break e}while(!1);f=ls(7,0,p,((p|0)<0)<<31>>31)|0,f=Cr(f|0,D()|0,5,0)|0,f=Je(f|0,D()|0,-5,-1)|0,f=no(f|0,D()|0,6,0)|0,f=Je(f|0,D()|0,1,0)|0,p=D()|0}while(!1);return y=d,u[y>>2]=f,u[y+4>>2]=p,y=0,y|0}function Ft(l,c){l=l|0,c=c|0;var f=0,d=0,p=0;if(p=Ae(l|0,c|0,45)|0,D()|0,!(Ot(p&127)|0))return p=0,p|0;p=Ae(l|0,c|0,52)|0,D()|0,p=p&15;e:do if(!p)f=0;else for(d=1;;){if(f=Ae(l|0,c|0,(15-d|0)*3|0)|0,D()|0,f=f&7,f|0)break e;if(d>>>0<p>>>0)d=d+1|0;else{f=0;break}}while(!1);return p=(f|0)==0&1,p|0}function YO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0;if(y=R,R=R+16|0,m=y,Bb(m,l,c,f),c=m,l=u[c>>2]|0,c=u[c+4>>2]|0,(l|0)==0&(c|0)==0)return R=y,0;p=0,f=0;do x=d+(p<<3)|0,u[x>>2]=l,u[x+4>>2]=c,p=Je(p|0,f|0,1,0)|0,f=D()|0,Ob(m),x=m,l=u[x>>2]|0,c=u[x+4>>2]|0;while(!((l|0)==0&(c|0)==0));return R=y,0}function QO(l,c,f,d){return l=l|0,c=c|0,f=f|0,d=d|0,(d|0)<(f|0)?(f=c,d=l,Qe(f|0),d|0):(f=ge(-1,-1,((d-f|0)*3|0)+3|0)|0,d=ge(~f|0,~(D()|0)|0,(15-d|0)*3|0)|0,f=~(D()|0)&c,d=~d&l,Qe(f|0),d|0)}function qO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0;return p=Ae(l|0,c|0,52)|0,D()|0,p=p&15,(f|0)<16&(p|0)<=(f|0)?((p|0)<(f|0)&&(p=ge(-1,-1,((f+-1-p|0)*3|0)+3|0)|0,p=ge(~p|0,~(D()|0)|0,(15-f|0)*3|0)|0,c=~(D()|0)&c,l=~p&l),p=ge(f|0,0,52)|0,f=c&-15728641|(D()|0),u[d>>2]=l|p,u[d+4>>2]=f,d=0,d|0):(d=4,d|0)}function KO(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0,be=0;if((f|0)==0&(d|0)==0)return pe=0,pe|0;if(p=l,m=u[p>>2]|0,p=u[p+4>>2]|0,!0&(p&15728640|0)==0){if(!((d|0)>0|(d|0)==0&f>>>0>0)||(pe=c,u[pe>>2]=m,u[pe+4>>2]=p,(f|0)==1&(d|0)==0))return pe=0,pe|0;p=1;do xe=l+(p<<3)|0,ve=u[xe+4>>2]|0,pe=c+(p<<3)|0,u[pe>>2]=u[xe>>2],u[pe+4>>2]=ve,p=p+1|0;while(0<(d|0)|(d|0)==0&p>>>0<f>>>0);return p=0,p|0}if(Q=f<<3,ve=Ji(Q)|0,!ve)return pe=13,pe|0;if(oh(ve|0,l|0,Q|0)|0,xe=Zi(f,8)|0,!xe)return De(ve),pe=13,pe|0;e:do if(f|0){t:for(;;){p=ve,ie=u[p>>2]|0,p=u[p+4>>2]|0,$=Ae(ie|0,p|0,52)|0,D()|0,$=$&15,te=$+-1|0,ne=(f|0)>0;r:do if(($|0)!=0&ne){if(H=((f|0)<0)<<31>>31,U=ge(te|0,0,52)|0,q=D()|0,te>>>0>15){if(!((ie|0)==0&(p|0)==0)){pe=17;break t}for(m=0;;){if(m=m+1|0,(m|0)>=(f|0))break r;if(d=ve+(m<<3)|0,q=u[d>>2]|0,d=u[d+4>>2]|0,!((q|0)==0&(d|0)==0)){p=d,pe=17;break t}}}for(m=0,l=ie,d=p;;){if(!((l|0)==0&(d|0)==0)){if(!(!0&(d&117440512|0)==0)){pe=22;break t}if(x=Ae(l|0,d|0,52)|0,D()|0,x=x&15,(x|0)<(te|0)){p=12,pe=28;break t}if((x|0)!=(te|0)&&(l=l|U,d=d&-15728641|q,x>>>0>=$>>>0)){y=te;do V=ge(7,0,(14-y|0)*3|0)|0,y=y+1|0,l=V|l,d=D()|0|d;while(y>>>0<x>>>0)}if(y=ma(l|0,d|0,f|0,H|0)|0,D()|0,w=xe+(y<<3)|0,x=w,E=u[x>>2]|0,x=u[x+4>>2]|0,(E|0)==0&(x|0)==0)y=w;else for(V=0;;){if((V|0)>(f|0)){pe=32;break t}if((E|0)==(l|0)&(x&-117440513|0)==(d|0)){M=Ae(E|0,x|0,56)|0,D()|0,M=M&7,O=M+1|0,be=Ae(E|0,x|0,45)|0,D()|0;i:do if(!(Ot(be&127)|0))x=7;else{if(E=Ae(E|0,x|0,52)|0,D()|0,E=E&15,!E){x=6;break}for(x=1;;){if(be=ge(7,0,(15-x|0)*3|0)|0,!((be&l|0)==0&((D()|0)&d|0)==0)){x=7;break i}if(x>>>0<E>>>0)x=x+1|0;else{x=6;break}}}while(!1);if((M+2|0)>>>0>x>>>0){pe=42;break t}be=ge(O|0,0,56)|0,d=D()|0|d&-117440513,O=w,u[O>>2]=0,u[O+4>>2]=0,l=be|l}else y=(y+1|0)%(f|0)|0;if(w=xe+(y<<3)|0,x=w,E=u[x>>2]|0,x=u[x+4>>2]|0,(E|0)==0&(x|0)==0){y=w;break}else V=V+1|0}be=y,u[be>>2]=l,u[be+4>>2]=d}if(m=m+1|0,(m|0)>=(f|0))break r;d=ve+(m<<3)|0,l=u[d>>2]|0,d=u[d+4>>2]|0}}while(!1);if((f+5|0)>>>0<11){pe=85;break}if(q=Zi((f|0)/6|0,8)|0,!q){pe=49;break}r:do if(ne){V=0,O=0;do{if(x=xe+(V<<3)|0,d=x,m=u[d>>2]|0,d=u[d+4>>2]|0,!((m|0)==0&(d|0)==0)){E=Ae(m|0,d|0,56)|0,D()|0,E=E&7,l=E+1|0,w=d&-117440513,be=Ae(m|0,d|0,45)|0,D()|0;i:do if(Ot(be&127)|0){if(M=Ae(m|0,d|0,52)|0,D()|0,M=M&15,M|0)for(y=1;;){if(be=ge(7,0,(15-y|0)*3|0)|0,!((m&be|0)==0&(w&(D()|0)|0)==0))break i;if(y>>>0<M>>>0)y=y+1|0;else break}d=ge(l|0,0,56)|0,m=d|m,d=D()|0|w,l=x,u[l>>2]=m,u[l+4>>2]=d,l=E+2|0}while(!1);(l|0)==7&&(be=q+(O<<3)|0,u[be>>2]=m,u[be+4>>2]=d&-117440513,O=O+1|0)}V=V+1|0}while((V|0)!=(f|0));if(ne){if(V=((f|0)<0)<<31>>31,H=ge(te|0,0,52)|0,U=D()|0,te>>>0>15){if(!((ie|0)==0&(p|0)==0)){p=4,pe=84;break t}for(p=0;;){if(p=p+1|0,(p|0)>=(f|0)){m=0,p=O;break r}if(be=ve+(p<<3)|0,!((u[be>>2]|0)==0&(u[be+4>>2]|0)==0)){p=4,pe=84;break t}}}for(M=0,m=0,w=ie;;){do if(!((w|0)==0&(p|0)==0)){if(x=Ae(w|0,p|0,52)|0,D()|0,x=x&15,(x|0)<(te|0)){p=12,pe=84;break t}do if((x|0)==(te|0))d=w,x=p;else{if(d=w|H,l=p&-15728641|U,x>>>0<$>>>0){x=l;break}y=te;do be=ge(7,0,(14-y|0)*3|0)|0,y=y+1|0,d=be|d,l=D()|0|l;while(y>>>0<x>>>0);x=l}while(!1);for(y=ma(d|0,x|0,f|0,V|0)|0,D()|0,l=0;;){if((l|0)>(f|0)){pe=77;break t}if(be=xe+(y<<3)|0,E=u[be+4>>2]|0,(E&-117440513|0)==(x|0)&&(u[be>>2]|0)==(d|0)){pe=79;break}if(y=(y+1|0)%(f|0)|0,be=xe+(y<<3)|0,(u[be>>2]|0)==(d|0)&&(u[be+4>>2]|0)==(x|0))break;l=l+1|0}if((pe|0)==79&&(pe=0,!0&(E&117440512|0)==100663296))break;be=c+(m<<3)|0,u[be>>2]=w,u[be+4>>2]=p,m=m+1|0}while(!1);if(p=M+1|0,(p|0)>=(f|0)){p=O;break r}be=ve+(p<<3)|0,M=p,w=u[be>>2]|0,p=u[be+4>>2]|0}}else m=0,p=O}else m=0,p=0;while(!1);if(so(xe|0,0,Q|0)|0,oh(ve|0,q|0,p<<3|0)|0,De(q),p)c=c+(m<<3)|0,f=p;else break e}if((pe|0)==17)!0&(p&117440512|0)==0?(p=4,pe=28):pe=22;else if((pe|0)==32)Oe(23313,22674,362,22684);else{if((pe|0)==42)return De(ve),De(xe),be=10,be|0;if((pe|0)==49)return De(ve),De(xe),be=13,be|0;if((pe|0)==77)Oe(23313,22674,462,22684);else{if((pe|0)==84)return De(q),De(ve),De(xe),be=p,be|0;if((pe|0)==85){oh(c|0,ve|0,f<<3|0)|0;break}}}if((pe|0)==22)return De(ve),De(xe),be=5,be|0;if((pe|0)==28)return De(ve),De(xe),be=p,be|0}while(!1);return De(ve),De(xe),be=0,be|0}function JO(l,c,f,d,p,m,y){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0,m=m|0,y=y|0;var x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0;if(q=R,R=R+16|0,U=q,!((f|0)>0|(f|0)==0&c>>>0>0))return U=0,R=q,U|0;if((y|0)>=16)return U=12,R=q,U|0;V=0,H=0,O=0,x=0;e:for(;;){if(w=l+(V<<3)|0,E=u[w>>2]|0,w=u[w+4>>2]|0,M=Ae(E|0,w|0,52)|0,D()|0,(M&15|0)>(y|0)){x=12,E=11;break}if(Bb(U,E,w,y),M=U,w=u[M>>2]|0,M=u[M+4>>2]|0,(w|0)==0&(M|0)==0)E=O;else{E=O;do{if(!((x|0)<(m|0)|(x|0)==(m|0)&E>>>0<p>>>0)){E=10;break e}O=d+(E<<3)|0,u[O>>2]=w,u[O+4>>2]=M,E=Je(E|0,x|0,1,0)|0,x=D()|0,Ob(U),O=U,w=u[O>>2]|0,M=u[O+4>>2]|0}while(!((w|0)==0&(M|0)==0))}if(V=Je(V|0,H|0,1,0)|0,H=D()|0,(H|0)<(f|0)|(H|0)==(f|0)&V>>>0<c>>>0)O=E;else{x=0,E=11;break}}return(E|0)==10?(U=14,R=q,U|0):(E|0)==11?(R=q,x|0):0}function ZO(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0;V=R,R=R+16|0,O=V;e:do if((f|0)>0|(f|0)==0&c>>>0>0){for(w=0,y=0,m=0,M=0;;){if(E=l+(w<<3)|0,x=u[E>>2]|0,E=u[E+4>>2]|0,!((x|0)==0&(E|0)==0)&&(E=(ih(x,E,d,O)|0)==0,x=O,y=Je(u[x>>2]|0,u[x+4>>2]|0,y|0,m|0)|0,m=D()|0,!E)){m=12;break}if(w=Je(w|0,M|0,1,0)|0,M=D()|0,!((M|0)<(f|0)|(M|0)==(f|0)&w>>>0<c>>>0))break e}return R=V,m|0}else y=0,m=0;while(!1);return u[p>>2]=y,u[p+4>>2]=m,p=0,R=V,p|0}function $O(l,c){return l=l|0,c=c|0,c=Ae(l|0,c|0,52)|0,D()|0,c&1|0}function Xr(l,c){l=l|0,c=c|0;var f=0,d=0,p=0;if(p=Ae(l|0,c|0,52)|0,D()|0,p=p&15,!p)return p=0,p|0;for(d=1;;){if(f=Ae(l|0,c|0,(15-d|0)*3|0)|0,D()|0,f=f&7,f|0){d=5;break}if(d>>>0<p>>>0)d=d+1|0;else{f=0,d=5;break}}return(d|0)==5?f|0:0}function om(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0,E=0;if(E=Ae(l|0,c|0,52)|0,D()|0,E=E&15,!E)return x=c,E=l,Qe(x|0),E|0;for(x=1,f=0;;){m=(15-x|0)*3|0,d=ge(7,0,m|0)|0,p=D()|0,y=Ae(l|0,c|0,m|0)|0,D()|0,m=ge(ro(y&7)|0,0,m|0)|0,y=D()|0,l=m|l&~d,c=y|c&~p;e:do if(!f)if((m&d|0)==0&(y&p|0)==0)f=0;else if(d=Ae(l|0,c|0,52)|0,D()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(y=Ae(l|0,c|0,(15-f|0)*3|0)|0,D()|0,y&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(y=(15-f|0)*3|0,p=Ae(l|0,c|0,y|0)|0,D()|0,m=ge(7,0,y|0)|0,c=c&~(D()|0),y=ge(ro(p&7)|0,0,y|0)|0,l=l&~m|y,c=c|(D()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(!1);if(x>>>0<E>>>0)x=x+1|0;else break}return Qe(c|0),l|0}function io(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0;if(d=Ae(l|0,c|0,52)|0,D()|0,d=d&15,!d)return f=c,d=l,Qe(f|0),d|0;for(f=1;m=(15-f|0)*3|0,y=Ae(l|0,c|0,m|0)|0,D()|0,p=ge(7,0,m|0)|0,c=c&~(D()|0),m=ge(ro(y&7)|0,0,m|0)|0,l=m|l&~p,c=D()|0|c,f>>>0<d>>>0;)f=f+1|0;return Qe(c|0),l|0}function eF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0,E=0;if(E=Ae(l|0,c|0,52)|0,D()|0,E=E&15,!E)return x=c,E=l,Qe(x|0),E|0;for(x=1,f=0;;){m=(15-x|0)*3|0,d=ge(7,0,m|0)|0,p=D()|0,y=Ae(l|0,c|0,m|0)|0,D()|0,m=ge(cs(y&7)|0,0,m|0)|0,y=D()|0,l=m|l&~d,c=y|c&~p;e:do if(!f)if((m&d|0)==0&(y&p|0)==0)f=0;else if(d=Ae(l|0,c|0,52)|0,D()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(y=Ae(l|0,c|0,(15-f|0)*3|0)|0,D()|0,y&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(p=(15-f|0)*3|0,m=ge(7,0,p|0)|0,y=c&~(D()|0),c=Ae(l|0,c|0,p|0)|0,D()|0,c=ge(cs(c&7)|0,0,p|0)|0,l=l&~m|c,c=y|(D()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(!1);if(x>>>0<E>>>0)x=x+1|0;else break}return Qe(c|0),l|0}function am(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0;if(d=Ae(l|0,c|0,52)|0,D()|0,d=d&15,!d)return f=c,d=l,Qe(f|0),d|0;for(f=1;y=(15-f|0)*3|0,m=ge(7,0,y|0)|0,p=c&~(D()|0),c=Ae(l|0,c|0,y|0)|0,D()|0,c=ge(cs(c&7)|0,0,y|0)|0,l=c|l&~m,c=D()|0|p,f>>>0<d>>>0;)f=f+1|0;return Qe(c|0),l|0}function tF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0;if(E=R,R=R+64|0,x=E+40|0,d=E+24|0,p=E+12|0,m=E,ge(c|0,0,52)|0,f=D()|0|134225919,!c)return(u[l+4>>2]|0)>2||(u[l+8>>2]|0)>2||(u[l+12>>2]|0)>2?(y=0,x=0,Qe(y|0),R=E,x|0):(ge(pb(l)|0,0,45)|0,y=D()|0|f,x=-1,Qe(y|0),R=E,x|0);if(u[x>>2]=u[l>>2],u[x+4>>2]=u[l+4>>2],u[x+8>>2]=u[l+8>>2],u[x+12>>2]=u[l+12>>2],y=x+4|0,(c|0)>0)for(l=-1;u[d>>2]=u[y>>2],u[d+4>>2]=u[y+4>>2],u[d+8>>2]=u[y+8>>2],c&1?(RO(y),u[p>>2]=u[y>>2],u[p+4>>2]=u[y+4>>2],u[p+8>>2]=u[y+8>>2],eh(p)):(bb(y),u[p>>2]=u[y>>2],u[p+4>>2]=u[y+4>>2],u[p+8>>2]=u[y+8>>2],to(p)),em(d,p,m),vr(m),M=(15-c|0)*3|0,w=ge(7,0,M|0)|0,f=f&~(D()|0),M=ge($f(m)|0,0,M|0)|0,l=M|l&~w,f=D()|0|f,(c|0)>1;)c=c+-1|0;else l=-1;e:do if((u[y>>2]|0)<=2&&(u[x+8>>2]|0)<=2&&(u[x+12>>2]|0)<=2){if(d=pb(x)|0,c=ge(d|0,0,45)|0,c=c|l,l=D()|0|f&-1040385,m=xO(x)|0,!(Ot(d)|0)){if((m|0)<=0)break;for(p=0;;){if(d=Ae(c|0,l|0,52)|0,D()|0,d=d&15,d)for(f=1;M=(15-f|0)*3|0,x=Ae(c|0,l|0,M|0)|0,D()|0,w=ge(7,0,M|0)|0,l=l&~(D()|0),M=ge(ro(x&7)|0,0,M|0)|0,c=c&~w|M,l=l|(D()|0),f>>>0<d>>>0;)f=f+1|0;if(p=p+1|0,(p|0)==(m|0))break e}}p=Ae(c|0,l|0,52)|0,D()|0,p=p&15;t:do if(p){f=1;r:for(;;){switch(M=Ae(c|0,l|0,(15-f|0)*3|0)|0,D()|0,M&7){case 1:break r;case 0:break;default:break t}if(f>>>0<p>>>0)f=f+1|0;else break t}if(gb(d,u[x>>2]|0)|0)for(f=1;x=(15-f|0)*3|0,w=ge(7,0,x|0)|0,M=l&~(D()|0),l=Ae(c|0,l|0,x|0)|0,D()|0,l=ge(cs(l&7)|0,0,x|0)|0,c=c&~w|l,l=M|(D()|0),f>>>0<p>>>0;)f=f+1|0;else for(f=1;M=(15-f|0)*3|0,x=Ae(c|0,l|0,M|0)|0,D()|0,w=ge(7,0,M|0)|0,l=l&~(D()|0),M=ge(ro(x&7)|0,0,M|0)|0,c=c&~w|M,l=l|(D()|0),f>>>0<p>>>0;)f=f+1|0}while(!1);if((m|0)>0){f=0;do c=om(c,l)|0,l=D()|0,f=f+1|0;while((f|0)!=(m|0))}}else c=0,l=0;while(!1);return w=l,M=c,Qe(w|0),R=E,M|0}function fi(l){return l=l|0,(l|0)%2|0|0}function Rb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0;return p=R,R=R+16|0,d=p,c>>>0>15?(d=4,R=p,d|0):(u[l+4>>2]&2146435072|0)==2146435072||(u[l+8+4>>2]&2146435072|0)==2146435072?(d=3,R=p,d|0):(zO(l,c,d),c=tF(d,c)|0,d=D()|0,u[f>>2]=c,u[f+4>>2]=d,(c|0)==0&(d|0)==0&&Oe(23313,22674,786,22697),d=0,R=p,d|0)}function cm(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0;if(p=f+4|0,m=Ae(l|0,c|0,52)|0,D()|0,m=m&15,y=Ae(l|0,c|0,45)|0,D()|0,d=(m|0)==0,Ot(y&127)|0){if(d)return y=1,y|0;d=1}else{if(d)return y=0,y|0;!(u[p>>2]|0)&&!(u[f+8>>2]|0)?d=(u[f+12>>2]|0)!=0&1:d=1}for(f=1;f&1?eh(p):to(p),y=Ae(l|0,c|0,(15-f|0)*3|0)|0,D()|0,Tb(p,y&7),f>>>0<m>>>0;)f=f+1|0;return d|0}function pa(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0;if(M=R,R=R+16|0,E=M,w=Ae(l|0,c|0,45)|0,D()|0,w=w&127,w>>>0>121)return u[f>>2]=0,u[f+4>>2]=0,u[f+8>>2]=0,u[f+12>>2]=0,w=5,R=M,w|0;e:do if(Ot(w)|0&&(m=Ae(l|0,c|0,52)|0,D()|0,m=m&15,(m|0)!=0)){d=1;t:for(;;){switch(x=Ae(l|0,c|0,(15-d|0)*3|0)|0,D()|0,x&7){case 5:break t;case 0:break;default:{d=c;break e}}if(d>>>0<m>>>0)d=d+1|0;else{d=c;break e}}for(p=1,d=c;c=(15-p|0)*3|0,y=ge(7,0,c|0)|0,x=d&~(D()|0),d=Ae(l|0,d|0,c|0)|0,D()|0,d=ge(cs(d&7)|0,0,c|0)|0,l=l&~y|d,d=x|(D()|0),p>>>0<m>>>0;)p=p+1|0}else d=c;while(!1);if(x=7696+(w*28|0)|0,u[f>>2]=u[x>>2],u[f+4>>2]=u[x+4>>2],u[f+8>>2]=u[x+8>>2],u[f+12>>2]=u[x+12>>2],!(cm(l,d,f)|0))return w=0,R=M,w|0;if(y=f+4|0,u[E>>2]=u[y>>2],u[E+4>>2]=u[y+4>>2],u[E+8>>2]=u[y+8>>2],m=Ae(l|0,d|0,52)|0,D()|0,x=m&15,m&1?(to(y),m=x+1|0):m=x,!(Ot(w)|0))d=0;else{e:do if(!x)d=0;else for(c=1;;){if(p=Ae(l|0,d|0,(15-c|0)*3|0)|0,D()|0,p=p&7,p|0){d=p;break e}if(c>>>0<x>>>0)c=c+1|0;else{d=0;break}}while(!1);d=(d|0)==4&1}if(!(da(f,m,d,0)|0))(m|0)!=(x|0)&&(u[y>>2]=u[E>>2],u[y+4>>2]=u[E+4>>2],u[y+8>>2]=u[E+8>>2]);else{if(Ot(w)|0)do;while(da(f,m,0,0)|0);(m|0)!=(x|0)&&bb(y)}return w=0,R=M,w|0}function cl(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;return m=R,R=R+16|0,d=m,p=pa(l,c,d)|0,p|0?(R=m,p|0):(p=Ae(l|0,c|0,52)|0,D()|0,WO(d,p&15,f),p=0,R=m,p|0)}function ll(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0;if(y=R,R=R+16|0,m=y,d=pa(l,c,m)|0,d|0)return m=d,R=y,m|0;d=Ae(l|0,c|0,45)|0,D()|0,d=(Ot(d&127)|0)==0,p=Ae(l|0,c|0,52)|0,D()|0,p=p&15;e:do if(!d){if(p|0)for(d=1;;){if(x=ge(7,0,(15-d|0)*3|0)|0,!((x&l|0)==0&((D()|0)&c|0)==0))break e;if(d>>>0<p>>>0)d=d+1|0;else break}return rm(m,p,0,5,f),x=0,R=y,x|0}while(!1);return im(m,p,0,6,f),x=0,R=y,x|0}function rF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;if(p=Ae(l|0,c|0,45)|0,D()|0,!(Ot(p&127)|0))return p=2,u[f>>2]=p,0;if(p=Ae(l|0,c|0,52)|0,D()|0,p=p&15,!p)return p=5,u[f>>2]=p,0;for(d=1;;){if(m=ge(7,0,(15-d|0)*3|0)|0,!((m&l|0)==0&((D()|0)&c|0)==0)){d=2,l=6;break}if(d>>>0<p>>>0)d=d+1|0;else{d=5,l=6;break}}return(l|0)==6&&(u[f>>2]=d),0}function Ib(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0;O=R,R=R+128|0,w=O+112|0,m=O+96|0,M=O,p=Ae(l|0,c|0,52)|0,D()|0,x=p&15,u[w>>2]=x,y=Ae(l|0,c|0,45)|0,D()|0,y=y&127;e:do if(Ot(y)|0){if(x|0)for(d=1;;){if(E=ge(7,0,(15-d|0)*3|0)|0,!((E&l|0)==0&((D()|0)&c|0)==0)){p=0;break e}if(d>>>0<x>>>0)d=d+1|0;else break}if(p&1)p=1;else return E=ge(x+1|0,0,52)|0,M=D()|0|c&-15728641,w=ge(7,0,(14-x|0)*3|0)|0,M=Ib((E|l)&~w,M&~(D()|0),f)|0,R=O,M|0}else p=0;while(!1);if(d=pa(l,c,m)|0,!d){p?(Sb(m,w,M),E=5):(Mb(m,w,M),E=6);e:do if(Ot(y)|0)if(!x)l=5;else for(d=1;;){if(y=ge(7,0,(15-d|0)*3|0)|0,!((y&l|0)==0&((D()|0)&c|0)==0)){l=2;break e}if(d>>>0<x>>>0)d=d+1|0;else{l=5;break}}else l=2;while(!1);so(f|0,-1,l<<2|0)|0;e:do if(p)for(m=0;;){if(y=M+(m<<4)|0,jO(y,u[w>>2]|0)|0,y=u[y>>2]|0,x=u[f>>2]|0,(x|0)==-1|(x|0)==(y|0))d=f;else{p=0;do{if(p=p+1|0,p>>>0>=l>>>0){d=1;break e}d=f+(p<<2)|0,x=u[d>>2]|0}while(!((x|0)==-1|(x|0)==(y|0)))}if(u[d>>2]=y,m=m+1|0,m>>>0>=E>>>0){d=0;break}}else for(m=0;;){if(y=M+(m<<4)|0,da(y,u[w>>2]|0,0,1)|0,y=u[y>>2]|0,x=u[f>>2]|0,(x|0)==-1|(x|0)==(y|0))d=f;else{p=0;do{if(p=p+1|0,p>>>0>=l>>>0){d=1;break e}d=f+(p<<2)|0,x=u[d>>2]|0}while(!((x|0)==-1|(x|0)==(y|0)))}if(u[d>>2]=y,m=m+1|0,m>>>0>=E>>>0){d=0;break}}while(!1)}return M=d,R=O,M|0}function iF(){return 12}function lm(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0,E=0;if(l>>>0>15)return x=4,x|0;if(ge(l|0,0,52)|0,x=D()|0|134225919,!l){f=0,d=0;do Ot(d)|0&&(ge(d|0,0,45)|0,y=x|(D()|0),l=c+(f<<3)|0,u[l>>2]=-1,u[l+4>>2]=y,f=f+1|0),d=d+1|0;while((d|0)!=122);return f=0,f|0}f=0,y=0;do{if(Ot(y)|0){for(ge(y|0,0,45)|0,d=1,p=-1,m=x|(D()|0);E=ge(7,0,(15-d|0)*3|0)|0,p=p&~E,m=m&~(D()|0),(d|0)!=(l|0);)d=d+1|0;E=c+(f<<3)|0,u[E>>2]=p,u[E+4>>2]=m,f=f+1|0}y=y+1|0}while((y|0)!=122);return f=0,f|0}function nF(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0;if($=R,R=R+16|0,ne=$,ie=Ae(l|0,c|0,52)|0,D()|0,ie=ie&15,f>>>0>15)return ie=4,R=$,ie|0;if((ie|0)<(f|0))return ie=12,R=$,ie|0;if((ie|0)!=(f|0))if(m=ge(f|0,0,52)|0,m=m|l,x=D()|0|c&-15728641,(ie|0)>(f|0)){E=f;do q=ge(7,0,(14-E|0)*3|0)|0,E=E+1|0,m=q|m,x=D()|0|x;while((E|0)<(ie|0));q=m}else q=m;else q=l,x=c;U=Ae(q|0,x|0,45)|0,D()|0;e:do if(Ot(U&127)|0){if(E=Ae(q|0,x|0,52)|0,D()|0,E=E&15,E|0)for(m=1;;){if(U=ge(7,0,(15-m|0)*3|0)|0,!((U&q|0)==0&((D()|0)&x|0)==0)){w=33;break e}if(m>>>0<E>>>0)m=m+1|0;else break}if(U=d,u[U>>2]=0,u[U+4>>2]=0,(ie|0)>(f|0)){for(U=c&-15728641,H=ie;;){if(V=H,H=H+-1|0,H>>>0>15|(ie|0)<(H|0)){w=19;break}if((ie|0)!=(H|0))if(m=ge(H|0,0,52)|0,m=m|l,E=D()|0|U,(ie|0)<(V|0))O=m;else{w=H;do O=ge(7,0,(14-w|0)*3|0)|0,w=w+1|0,m=O|m,E=D()|0|E;while((w|0)<(ie|0));O=m}else O=l,E=c;if(M=Ae(O|0,E|0,45)|0,D()|0,!(Ot(M&127)|0))m=0;else{M=Ae(O|0,E|0,52)|0,D()|0,M=M&15;t:do if(!M)m=0;else for(w=1;;){if(m=Ae(O|0,E|0,(15-w|0)*3|0)|0,D()|0,m=m&7,m|0)break t;if(w>>>0<M>>>0)w=w+1|0;else{m=0;break}}while(!1);m=(m|0)==0&1}if(E=Ae(l|0,c|0,(15-V|0)*3|0)|0,D()|0,E=E&7,(E|0)==7){p=5,w=42;break}if(m=(m|0)!=0,(E|0)==1&m){p=5,w=42;break}if(O=E+(((E|0)!=0&m)<<31>>31)|0,O|0&&(w=ie-V|0,w=ls(7,0,w,((w|0)<0)<<31>>31)|0,M=D()|0,m?(m=Cr(w|0,M|0,5,0)|0,m=Je(m|0,D()|0,-5,-1)|0,m=no(m|0,D()|0,6,0)|0,m=Je(m|0,D()|0,1,0)|0,E=D()|0):(m=w,E=M),V=O+-1|0,V=Cr(w|0,M|0,V|0,((V|0)<0)<<31>>31|0)|0,V=Je(m|0,E|0,V|0,D()|0)|0,O=D()|0,M=d,M=Je(V|0,O|0,u[M>>2]|0,u[M+4>>2]|0)|0,O=D()|0,V=d,u[V>>2]=M,u[V+4>>2]=O),(H|0)<=(f|0)){w=37;break}}if((w|0)==19)Oe(23313,22674,1099,22710);else if((w|0)==37){y=d,p=u[y+4>>2]|0,y=u[y>>2]|0;break}else if((w|0)==42)return R=$,p|0}else p=0,y=0}else w=33;while(!1);e:do if((w|0)==33)if(U=d,u[U>>2]=0,u[U+4>>2]=0,(ie|0)>(f|0)){for(m=ie;;){if(p=Ae(l|0,c|0,(15-m|0)*3|0)|0,D()|0,p=p&7,(p|0)==7){p=5;break}if(y=ie-m|0,y=ls(7,0,y,((y|0)<0)<<31>>31)|0,p=Cr(y|0,D()|0,p|0,0)|0,y=D()|0,U=d,y=Je(u[U>>2]|0,u[U+4>>2]|0,p|0,y|0)|0,p=D()|0,U=d,u[U>>2]=y,u[U+4>>2]=p,m=m+-1|0,(m|0)<=(f|0))break e}return R=$,p|0}else p=0,y=0;while(!1);return ih(q,x,ie,ne)|0&&Oe(23313,22674,1063,22725),ie=ne,ne=u[ie+4>>2]|0,((p|0)>-1|(p|0)==-1&y>>>0>4294967295)&((ne|0)>(p|0)|((ne|0)==(p|0)?(u[ie>>2]|0)>>>0>y>>>0:0))?(ie=0,R=$,ie|0):(Oe(23313,22674,1139,22710),0)}function sF(l,c,f,d,p,m){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0,m=m|0;var y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0;if(O=R,R=R+16|0,y=O,p>>>0>15)return m=4,R=O,m|0;if(x=Ae(f|0,d|0,52)|0,D()|0,x=x&15,(x|0)>(p|0))return m=12,R=O,m|0;if(ih(f,d,p,y)|0&&Oe(23313,22674,1063,22725),M=y,w=u[M+4>>2]|0,!(((c|0)>-1|(c|0)==-1&l>>>0>4294967295)&((w|0)>(c|0)|((w|0)==(c|0)?(u[M>>2]|0)>>>0>l>>>0:0))))return m=2,R=O,m|0;M=p-x|0,p=ge(p|0,0,52)|0,E=D()|0|d&-15728641,w=m,u[w>>2]=p|f,u[w+4>>2]=E,w=Ae(f|0,d|0,45)|0,D()|0;e:do if(Ot(w&127)|0){if(x|0)for(y=1;;){if(w=ge(7,0,(15-y|0)*3|0)|0,!((w&f|0)==0&((D()|0)&d|0)==0))break e;if(y>>>0<x>>>0)y=y+1|0;else break}if((M|0)<1)return m=0,R=O,m|0;for(w=x^15,d=-1,E=1,y=1;;){x=M-E|0,x=ls(7,0,x,((x|0)<0)<<31>>31)|0,f=D()|0;do if(y)if(y=Cr(x|0,f|0,5,0)|0,y=Je(y|0,D()|0,-5,-1)|0,y=no(y|0,D()|0,6,0)|0,p=D()|0,(c|0)>(p|0)|(c|0)==(p|0)&l>>>0>y>>>0){c=Je(l|0,c|0,-1,-1)|0,c=wr(c|0,D()|0,y|0,p|0)|0,y=D()|0,V=m,U=u[V>>2]|0,V=u[V+4>>2]|0,q=(w+d|0)*3|0,H=ge(7,0,q|0)|0,V=V&~(D()|0),d=no(c|0,y|0,x|0,f|0)|0,l=D()|0,p=Je(d|0,l|0,2,0)|0,q=ge(p|0,D()|0,q|0)|0,V=D()|0|V,p=m,u[p>>2]=q|U&~H,u[p+4>>2]=V,l=Cr(d|0,l|0,x|0,f|0)|0,l=wr(c|0,y|0,l|0,D()|0)|0,y=0,c=D()|0;break}else{q=m,H=u[q>>2]|0,q=u[q+4>>2]|0,U=ge(7,0,(w+d|0)*3|0)|0,q=q&~(D()|0),y=m,u[y>>2]=H&~U,u[y+4>>2]=q,y=1;break}else H=m,p=u[H>>2]|0,H=u[H+4>>2]|0,d=(w+d|0)*3|0,V=ge(7,0,d|0)|0,H=H&~(D()|0),q=no(l|0,c|0,x|0,f|0)|0,y=D()|0,d=ge(q|0,y|0,d|0)|0,H=D()|0|H,U=m,u[U>>2]=d|p&~V,u[U+4>>2]=H,y=Cr(q|0,y|0,x|0,f|0)|0,l=wr(l|0,c|0,y|0,D()|0)|0,y=0,c=D()|0;while(!1);if((M|0)>(E|0))d=~E,E=E+1|0;else{c=0;break}}return R=O,c|0}while(!1);if((M|0)<1)return q=0,R=O,q|0;for(p=x^15,y=1;;)if(U=M-y|0,U=ls(7,0,U,((U|0)<0)<<31>>31)|0,q=D()|0,E=m,f=u[E>>2]|0,E=u[E+4>>2]|0,x=(p-y|0)*3|0,d=ge(7,0,x|0)|0,E=E&~(D()|0),V=no(l|0,c|0,U|0,q|0)|0,H=D()|0,x=ge(V|0,H|0,x|0)|0,E=D()|0|E,w=m,u[w>>2]=x|f&~d,u[w+4>>2]=E,q=Cr(V|0,H|0,U|0,q|0)|0,l=wr(l|0,c|0,q|0,D()|0)|0,c=D()|0,(M|0)<=(y|0)){c=0;break}else y=y+1|0;return R=O,c|0}function Bb(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0;p=Ae(c|0,f|0,52)|0,D()|0,p=p&15,(c|0)==0&(f|0)==0|((d|0)>15|(p|0)>(d|0))?(d=-1,p=-1,c=0,f=0):(m=QO(c,f,p+1|0,d)|0,f=(D()|0)&-15728641,c=ge(d|0,0,52)|0,c=m|c,f=f|(D()|0),m=(Ft(c,f)|0)==0,d=m?-1:d),m=l,u[m>>2]=c,u[m+4>>2]=f,u[l+8>>2]=p,u[l+12>>2]=d}function Ob(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0,E=0,w=0;if(f=l,c=u[f>>2]|0,f=u[f+4>>2]|0,!((c|0)==0&(f|0)==0)&&(d=Ae(c|0,f|0,52)|0,D()|0,d=d&15,x=ge(1,0,(d^15)*3|0)|0,c=Je(x|0,D()|0,c|0,f|0)|0,f=D()|0,x=l,u[x>>2]=c,u[x+4>>2]=f,x=l+8|0,y=u[x>>2]|0,!((d|0)<(y|0)))){for(E=l+12|0,m=d;;){if((m|0)==(y|0)){d=5;break}if(w=(m|0)==(u[E>>2]|0),p=(15-m|0)*3|0,d=Ae(c|0,f|0,p|0)|0,D()|0,d=d&7,w&((d|0)==1&!0)){d=7;break}if(!((d|0)==7&!0)){d=10;break}if(w=ge(1,0,p|0)|0,c=Je(c|0,f|0,w|0,D()|0)|0,f=D()|0,w=l,u[w>>2]=c,u[w+4>>2]=f,(m|0)>(y|0))m=m+-1|0;else{d=10;break}}if((d|0)==5){w=l,u[w>>2]=0,u[w+4>>2]=0,u[x>>2]=-1,u[E>>2]=-1;return}else if((d|0)==7){y=ge(1,0,p|0)|0,y=Je(c|0,f|0,y|0,D()|0)|0,x=D()|0,w=l,u[w>>2]=y,u[w+4>>2]=x,u[E>>2]=m+-1;return}else if((d|0)==10)return}}function Al(l){l=+l;var c=0;return c=l<0?l+6.283185307179586:l,+(l>=6.283185307179586?c+-6.283185307179586:c)}function ga(l,c){return l=l|0,c=c|0,+gt(+(+B[l>>3]-+B[c>>3]))<17453292519943298e-27?(c=+gt(+(+B[l+8>>3]-+B[c+8>>3]))<17453292519943298e-27,c|0):(c=0,c|0)}function oF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0;return p=+B[c>>3],d=+B[l>>3],m=+At(+((p-d)*.5)),f=+At(+((+B[c+8>>3]-+B[l+8>>3])*.5)),f=m*m+f*(+lt(+p)*+lt(+d)*f),+(+ui(+ +kt(+f),+ +kt(+(1-f)))*2)}function ul(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0;return p=+B[c>>3],d=+B[l>>3],m=+At(+((p-d)*.5)),f=+At(+((+B[c+8>>3]-+B[l+8>>3])*.5)),f=m*m+f*(+lt(+p)*+lt(+d)*f),+(+ui(+ +kt(+f),+ +kt(+(1-f)))*2*6371.007180918475)}function aF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0;return p=+B[c>>3],d=+B[l>>3],m=+At(+((p-d)*.5)),f=+At(+((+B[c+8>>3]-+B[l+8>>3])*.5)),f=m*m+f*(+lt(+p)*+lt(+d)*f),+(+ui(+ +kt(+f),+ +kt(+(1-f)))*2*6371.007180918475*1e3)}function cF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0;return m=+B[c>>3],d=+lt(+m),p=+B[c+8>>3]-+B[l+8>>3],y=d*+At(+p),f=+B[l>>3],+ +ui(+y,+(+At(+m)*+lt(+f)-+lt(+p)*(d*+At(+f))))}function lF(l,c,f,d){l=l|0,c=+c,f=+f,d=d|0;var p=0,m=0,y=0,x=0;if(f<1e-16){u[d>>2]=u[l>>2],u[d+4>>2]=u[l+4>>2],u[d+8>>2]=u[l+8>>2],u[d+12>>2]=u[l+12>>2];return}m=c<0?c+6.283185307179586:c,m=c>=6.283185307179586?m+-6.283185307179586:m;do if(m<1e-16)c=+B[l>>3]+f,B[d>>3]=c,p=d;else{if(p=+gt(+(m+-3.141592653589793))<1e-16,c=+B[l>>3],p){c=c-f,B[d>>3]=c,p=d;break}if(y=+lt(+f),f=+At(+f),c=y*+At(+c)+ +lt(+m)*(f*+lt(+c)),c=c>1?1:c,c=+iO(+(c<-1?-1:c)),B[d>>3]=c,+gt(+(c+-1.5707963267948966))<1e-16){B[d>>3]=1.5707963267948966,B[d+8>>3]=0;return}if(+gt(+(c+1.5707963267948966))<1e-16){B[d>>3]=-1.5707963267948966,B[d+8>>3]=0;return}if(x=+lt(+c),m=f*+At(+m)/x,f=+B[l>>3],c=(y-+At(+c)*+At(+f))/+lt(+f)/x,y=m>1?1:m,c=c>1?1:c,c=+B[l+8>>3]+ +ui(+(y<-1?-1:y),+(c<-1?-1:c)),c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);B[d+8>>3]=c;return}while(!1);if(+gt(+(c+-1.5707963267948966))<1e-16){B[p>>3]=1.5707963267948966,B[d+8>>3]=0;return}if(+gt(+(c+1.5707963267948966))<1e-16){B[p>>3]=-1.5707963267948966,B[d+8>>3]=0;return}if(c=+B[l+8>>3],c>3.141592653589793)do c=c+-6.283185307179586;while(c>3.141592653589793);if(c<-3.141592653589793)do c=c+6.283185307179586;while(c<-3.141592653589793);B[d+8>>3]=c}function AF(l,c){return l=l|0,c=c|0,l>>>0>15?(c=4,c|0):(B[c>>3]=+B[20528+(l<<3)>>3],c=0,c|0)}function uF(l,c){return l=l|0,c=c|0,l>>>0>15?(c=4,c|0):(B[c>>3]=+B[20656+(l<<3)>>3],c=0,c|0)}function fF(l,c){return l=l|0,c=c|0,l>>>0>15?(c=4,c|0):(B[c>>3]=+B[20784+(l<<3)>>3],c=0,c|0)}function hF(l,c){return l=l|0,c=c|0,l>>>0>15?(c=4,c|0):(B[c>>3]=+B[20912+(l<<3)>>3],c=0,c|0)}function Am(l,c){l=l|0,c=c|0;var f=0;return l>>>0>15?(c=4,c|0):(f=ls(7,0,l,((l|0)<0)<<31>>31)|0,f=Cr(f|0,D()|0,120,0)|0,l=D()|0,u[c>>2]=f|2,u[c+4>>2]=l,c=0,c|0)}function Fb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0;return V=+B[c>>3],M=+B[l>>3],E=+At(+((V-M)*.5)),m=+B[c+8>>3],w=+B[l+8>>3],y=+At(+((m-w)*.5)),x=+lt(+M),O=+lt(+V),y=E*E+y*(O*x*y),y=+ui(+ +kt(+y),+ +kt(+(1-y)))*2,E=+B[f>>3],V=+At(+((E-V)*.5)),d=+B[f+8>>3],m=+At(+((d-m)*.5)),p=+lt(+E),m=V*V+m*(O*p*m),m=+ui(+ +kt(+m),+ +kt(+(1-m)))*2,E=+At(+((M-E)*.5)),d=+At(+((w-d)*.5)),d=E*E+d*(x*p*d),d=+ui(+ +kt(+d),+ +kt(+(1-d)))*2,p=(y+m+d)*.5,+(+Qg(+ +kt(+(+ol(+(p*.5))*+ol(+((p-y)*.5))*+ol(+((p-m)*.5))*+ol(+((p-d)*.5)))))*4)}function um(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0;if(x=R,R=R+192|0,m=x+168|0,y=x,p=cl(l,c,m)|0,p|0)return f=p,R=x,f|0;if(ll(l,c,y)|0&&Oe(23313,22742,386,22751),c=u[y>>2]|0,(c|0)>0){if(d=+Fb(y+8|0,y+8+(((c|0)!=1&1)<<4)|0,m)+0,(c|0)!=1){l=1;do p=l,l=l+1|0,d=d+ +Fb(y+8+(p<<4)|0,y+8+(((l|0)%(c|0)|0)<<4)|0,m);while((l|0)<(c|0))}}else d=0;return B[f>>3]=d,f=0,R=x,f|0}function dF(l,c,f){return l=l|0,c=c|0,f=f|0,l=um(l,c,f)|0,l|0||(B[f>>3]=+B[f>>3]*6371.007180918475*6371.007180918475),l|0}function pF(l,c,f){return l=l|0,c=c|0,f=f|0,l=um(l,c,f)|0,l|0||(B[f>>3]=+B[f>>3]*6371.007180918475*6371.007180918475*1e3*1e3),l|0}function gF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0;if(x=R,R=R+176|0,y=x,l=rh(l,c,y)|0,l|0)return y=l,R=x,y|0;if(B[f>>3]=0,l=u[y>>2]|0,(l|0)<=1)return y=0,R=x,y|0;c=l+-1|0,l=0,d=+B[y+8>>3],p=+B[y+16>>3],m=0;do l=l+1|0,w=d,d=+B[y+8+(l<<4)>>3],M=+At(+((d-w)*.5)),E=p,p=+B[y+8+(l<<4)+8>>3],E=+At(+((p-E)*.5)),E=M*M+E*(+lt(+d)*+lt(+w)*E),m=m+ +ui(+ +kt(+E),+ +kt(+(1-E)))*2;while((l|0)<(c|0));return B[f>>3]=m,y=0,R=x,y|0}function mF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0;if(x=R,R=R+176|0,y=x,l=rh(l,c,y)|0,l|0)return y=l,m=+B[f>>3],m=m*6371.007180918475,B[f>>3]=m,R=x,y|0;if(B[f>>3]=0,l=u[y>>2]|0,(l|0)<=1)return y=0,m=0,m=m*6371.007180918475,B[f>>3]=m,R=x,y|0;c=l+-1|0,l=0,d=+B[y+8>>3],p=+B[y+16>>3],m=0;do l=l+1|0,w=d,d=+B[y+8+(l<<4)>>3],M=+At(+((d-w)*.5)),E=p,p=+B[y+8+(l<<4)+8>>3],E=+At(+((p-E)*.5)),E=M*M+E*(+lt(+w)*+lt(+d)*E),m=m+ +ui(+ +kt(+E),+ +kt(+(1-E)))*2;while((l|0)!=(c|0));return B[f>>3]=m,y=0,M=m,M=M*6371.007180918475,B[f>>3]=M,R=x,y|0}function _F(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0;if(x=R,R=R+176|0,y=x,l=rh(l,c,y)|0,l|0)return y=l,m=+B[f>>3],m=m*6371.007180918475,m=m*1e3,B[f>>3]=m,R=x,y|0;if(B[f>>3]=0,l=u[y>>2]|0,(l|0)<=1)return y=0,m=0,m=m*6371.007180918475,m=m*1e3,B[f>>3]=m,R=x,y|0;c=l+-1|0,l=0,d=+B[y+8>>3],p=+B[y+16>>3],m=0;do l=l+1|0,w=d,d=+B[y+8+(l<<4)>>3],M=+At(+((d-w)*.5)),E=p,p=+B[y+8+(l<<4)+8>>3],E=+At(+((p-E)*.5)),E=M*M+E*(+lt(+w)*+lt(+d)*E),m=m+ +ui(+ +kt(+E),+ +kt(+(1-E)))*2;while((l|0)!=(c|0));return B[f>>3]=m,y=0,M=m,M=M*6371.007180918475,M=M*1e3,B[f>>3]=M,R=x,y|0}function yF(l){l=l|0;var c=0,f=0,d=0;return c=Zi(1,12)|0,c||Oe(22832,22787,49,22845),f=l+4|0,d=u[f>>2]|0,d|0?(d=d+8|0,u[d>>2]=c,u[f>>2]=c,c|0):(u[l>>2]|0&&Oe(22862,22787,61,22885),d=l,u[d>>2]=c,u[f>>2]=c,c|0)}function xF(l,c){l=l|0,c=c|0;var f=0,d=0;return d=Ji(24)|0,d||Oe(22899,22787,78,22913),u[d>>2]=u[c>>2],u[d+4>>2]=u[c+4>>2],u[d+8>>2]=u[c+8>>2],u[d+12>>2]=u[c+12>>2],u[d+16>>2]=0,c=l+4|0,f=u[c>>2]|0,f|0?(u[f+16>>2]=d,u[c>>2]=d,d|0):(u[l>>2]|0&&Oe(22928,22787,82,22913),u[l>>2]=d,u[c>>2]=d,d|0)}function Lb(l){l=l|0;var c=0,f=0,d=0,p=0;if(l)for(d=1;;){if(c=u[l>>2]|0,c|0)do{if(f=u[c>>2]|0,f|0)do p=f,f=u[f+16>>2]|0,De(p);while(f|0);p=c,c=u[c+8>>2]|0,De(p)}while(c|0);if(c=l,l=u[l+8>>2]|0,d||De(c),l)d=0;else break}}function bF(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0,be=0,mt=0,ot=0,at=0,Ge=0,ze=0,We=0,vt=0,ke=0;if(p=l+8|0,u[p>>2]|0)return ke=1,ke|0;if(d=u[l>>2]|0,!d)return ke=0,ke|0;c=d,f=0;do f=f+1|0,c=u[c+8>>2]|0;while(c|0);if(f>>>0<2)return ke=0,ke|0;We=Ji(f<<2)|0,We||Oe(22948,22787,317,22967),ze=Ji(f<<5)|0,ze||Oe(22989,22787,321,22967),u[l>>2]=0,ve=l+4|0,u[ve>>2]=0,u[p>>2]=0,f=0,Ge=0,xe=0,O=0;e:for(;;){if(M=u[d>>2]|0,M){m=0,y=M;do{if(E=+B[y+8>>3],c=y,y=u[y+16>>2]|0,w=(y|0)==0,p=w?M:y,x=+B[p+8>>3],+gt(+(E-x))>3.141592653589793){ke=14;break}m=m+(x-E)*(+B[c>>3]+ +B[p>>3])}while(!w);if((ke|0)==14){ke=0,m=0,c=M;do Q=+B[c+8>>3],at=c+16|0,ot=u[at>>2]|0,ot=ot|0?ot:M,te=+B[ot+8>>3],m=m+(+B[c>>3]+ +B[ot>>3])*((te<0?te+6.283185307179586:te)-(Q<0?Q+6.283185307179586:Q)),c=u[(c|0?at:d)>>2]|0;while(c|0)}m>0?(u[We+(Ge<<2)>>2]=d,Ge=Ge+1|0,p=xe,c=O):ke=19}else ke=19;if((ke|0)==19){ke=0;do if(f){if(c=f+8|0,u[c>>2]|0){ke=21;break e}if(f=Zi(1,12)|0,!f){ke=23;break e}u[c>>2]=f,p=f+4|0,y=f,c=O}else if(O){p=ve,y=O+8|0,c=d,f=l;break}else if(u[l>>2]|0){ke=27;break e}else{p=ve,y=l,c=d,f=l;break}while(!1);if(u[y>>2]=d,u[p>>2]=d,y=ze+(xe<<5)|0,w=u[d>>2]|0,w){for(M=ze+(xe<<5)+8|0,B[M>>3]=17976931348623157e292,O=ze+(xe<<5)+24|0,B[O>>3]=17976931348623157e292,B[y>>3]=-17976931348623157e292,V=ze+(xe<<5)+16|0,B[V>>3]=-17976931348623157e292,ie=17976931348623157e292,$=-17976931348623157e292,p=0,H=w,E=17976931348623157e292,q=17976931348623157e292,ne=-17976931348623157e292,x=-17976931348623157e292;m=+B[H>>3],Q=+B[H+8>>3],H=u[H+16>>2]|0,U=(H|0)==0,te=+B[(U?w:H)+8>>3],m<E&&(B[M>>3]=m,E=m),Q<q&&(B[O>>3]=Q,q=Q),m>ne?B[y>>3]=m:m=ne,Q>x&&(B[V>>3]=Q,x=Q),ie=Q>0&Q<ie?Q:ie,$=Q<0&Q>$?Q:$,p=p|+gt(+(Q-te))>3.141592653589793,!U;)ne=m;p&&(B[V>>3]=$,B[O>>3]=ie)}else u[y>>2]=0,u[y+4>>2]=0,u[y+8>>2]=0,u[y+12>>2]=0,u[y+16>>2]=0,u[y+20>>2]=0,u[y+24>>2]=0,u[y+28>>2]=0;p=xe+1|0}if(at=d+8|0,d=u[at>>2]|0,u[at>>2]=0,d)xe=p,O=c;else{ke=45;break}}if((ke|0)==21)Oe(22765,22787,35,22799);else if((ke|0)==23)Oe(22819,22787,37,22799);else if((ke|0)==27)Oe(22862,22787,61,22885);else if((ke|0)==45){e:do if((Ge|0)>0){for(at=(p|0)==0,mt=p<<2,ot=(l|0)==0,be=0,c=0;;){if(pe=u[We+(be<<2)>>2]|0,at)ke=73;else{if(xe=Ji(mt)|0,!xe){ke=50;break}if(ve=Ji(mt)|0,!ve){ke=52;break}t:do if(ot)f=0;else{for(p=0,f=0,y=l;d=ze+(p<<5)|0,Nb(u[y>>2]|0,d,u[pe>>2]|0)|0?(u[xe+(f<<2)>>2]=y,u[ve+(f<<2)>>2]=d,U=f+1|0):U=f,y=u[y+8>>2]|0,y;)p=p+1|0,f=U;if((U|0)>0)if(d=u[xe>>2]|0,(U|0)==1)f=d;else for(V=0,H=-1,f=d,O=d;;){for(w=u[O>>2]|0,d=0,y=0;p=u[u[xe+(y<<2)>>2]>>2]|0,(p|0)==(w|0)?M=d:M=d+((Nb(p,u[ve+(y<<2)>>2]|0,u[w>>2]|0)|0)&1)|0,y=y+1|0,(y|0)!=(U|0);)d=M;if(p=(M|0)>(H|0),f=p?O:f,d=V+1|0,(d|0)==(U|0))break t;V=d,H=p?M:H,O=u[xe+(d<<2)>>2]|0}else f=0}while(!1);if(De(xe),De(ve),f){if(p=f+4|0,d=u[p>>2]|0,d)f=d+8|0;else if(u[f>>2]|0){ke=70;break}u[f>>2]=pe,u[p>>2]=pe}else ke=73}if((ke|0)==73){if(ke=0,c=u[pe>>2]|0,c|0)do ve=c,c=u[c+16>>2]|0,De(ve);while(c|0);De(pe),c=1}if(be=be+1|0,(be|0)>=(Ge|0)){vt=c;break e}}(ke|0)==50?Oe(23004,22787,249,23023):(ke|0)==52?Oe(23042,22787,252,23023):(ke|0)==70&&Oe(22862,22787,61,22885)}else vt=0;while(!1);return De(We),De(ze),ke=vt,ke|0}return 0}function Nb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0;if(!(_b(c,f)|0)||(c=mb(c)|0,d=+B[f>>3],p=+B[f+8>>3],p=c&p<0?p+6.283185307179586:p,l=u[l>>2]|0,!l))return l=0,l|0;if(c){c=0,w=p,f=l;e:for(;;){for(;y=+B[f>>3],p=+B[f+8>>3],f=f+16|0,M=u[f>>2]|0,M=M|0?M:l,m=+B[M>>3],x=+B[M+8>>3],y>m?(E=y,y=x):(E=m,m=y,y=p,p=x),d=d==m|d==E?d+2220446049250313e-31:d,!!(d<m|d>E);)if(f=u[f>>2]|0,!f){f=22;break e}if(x=y<0?y+6.283185307179586:y,y=p<0?p+6.283185307179586:p,w=x==w|y==w?w+-2220446049250313e-31:w,E=x+(y-x)*((d-m)/(E-m)),(E<0?E+6.283185307179586:E)>w&&(c=c^1),f=u[f>>2]|0,!f){f=22;break}}if((f|0)==22)return c|0}else{c=0,w=p,f=l;e:for(;;){for(;y=+B[f>>3],p=+B[f+8>>3],f=f+16|0,M=u[f>>2]|0,M=M|0?M:l,m=+B[M>>3],x=+B[M+8>>3],y>m?(E=y,y=x):(E=m,m=y,y=p,p=x),d=d==m|d==E?d+2220446049250313e-31:d,!!(d<m|d>E);)if(f=u[f>>2]|0,!f){f=22;break e}if(w=y==w|p==w?w+-2220446049250313e-31:w,y+(p-y)*((d-m)/(E-m))>w&&(c=c^1),f=u[f>>2]|0,!f){f=22;break}}if((f|0)==22)return c|0}return 0}function Fn(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0;if($=R,R=R+32|0,ie=$+16|0,ne=$,m=Ae(l|0,c|0,52)|0,D()|0,m=m&15,H=Ae(f|0,d|0,52)|0,D()|0,(m|0)!=(H&15|0))return ie=12,R=$,ie|0;if(w=Ae(l|0,c|0,45)|0,D()|0,w=w&127,M=Ae(f|0,d|0,45)|0,D()|0,M=M&127,w>>>0>121|M>>>0>121)return ie=5,R=$,ie|0;if(H=(w|0)!=(M|0),H){if(x=$g(w,M)|0,(x|0)==7)return ie=1,R=$,ie|0;E=$g(M,w)|0,(E|0)==7?Oe(23066,23090,161,23100):(U=x,y=E)}else U=0,y=0;O=Ot(w)|0,V=Ot(M)|0,u[ie>>2]=0,u[ie+4>>2]=0,u[ie+8>>2]=0,u[ie+12>>2]=0;do if(U){if(M=u[4272+(w*28|0)+(U<<2)>>2]|0,x=(M|0)>0,V)if(x){w=0,E=f,x=d;do E=eF(E,x)|0,x=D()|0,y=cs(y)|0,(y|0)==1&&(y=cs(1)|0),w=w+1|0;while((w|0)!=(M|0));M=y,w=E,E=x}else M=y,w=f,E=d;else if(x){w=0,E=f,x=d;do E=am(E,x)|0,x=D()|0,y=cs(y)|0,w=w+1|0;while((w|0)!=(M|0));M=y,w=E,E=x}else M=y,w=f,E=d;if(cm(w,E,ie)|0,H||Oe(23115,23090,191,23100),x=(O|0)!=0,y=(V|0)!=0,x&y&&Oe(23142,23090,192,23100),x){if(y=Xr(l,c)|0,(y|0)==7){m=5;break}if(Be[21872+(y*7|0)+U>>0]|0){m=1;break}E=u[21040+(y*28|0)+(U<<2)>>2]|0,w=E}else if(y){if(y=Xr(w,E)|0,(y|0)==7){m=5;break}if(Be[21872+(y*7|0)+M>>0]|0){m=1;break}w=0,E=u[21040+(M*28|0)+(y<<2)>>2]|0}else w=0,E=0;if((w|E|0)<0)m=5;else{if((E|0)>0){x=ie+4|0,y=0;do th(x),y=y+1|0;while((y|0)!=(E|0))}if(u[ne>>2]=0,u[ne+4>>2]=0,u[ne+8>>2]=0,Tb(ne,U),m|0)for(;fi(m)|0?eh(ne):to(ne),(m|0)>1;)m=m+-1|0;if((w|0)>0){m=0;do th(ne),m=m+1|0;while((m|0)!=(w|0))}q=ie+4|0,Nr(q,ne,q),vr(q),q=51}}else if(cm(f,d,ie)|0,(O|0)!=0&(V|0)!=0)if((M|0)!=(w|0)&&Oe(23173,23090,261,23100),y=Xr(l,c)|0,m=Xr(f,d)|0,(y|0)==7|(m|0)==7)m=5;else if(Be[21872+(y*7|0)+m>>0]|0)m=1;else if(y=u[21040+(y*28|0)+(m<<2)>>2]|0,(y|0)>0){x=ie+4|0,m=0;do th(x),m=m+1|0;while((m|0)!=(y|0));q=51}else q=51;else q=51;while(!1);return(q|0)==51&&(m=ie+4|0,u[p>>2]=u[m>>2],u[p+4>>2]=u[m+4>>2],u[p+8>>2]=u[m+8>>2],m=0),ie=m,R=$,ie|0}function Db(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0;if(q=R,R=R+48|0,w=q+36|0,y=q+24|0,x=q+12|0,E=q,p=Ae(l|0,c|0,52)|0,D()|0,p=p&15,V=Ae(l|0,c|0,45)|0,D()|0,V=V&127,V>>>0>121)return d=5,R=q,d|0;if(M=Ot(V)|0,ge(p|0,0,52)|0,ne=D()|0|134225919,m=d,u[m>>2]=-1,u[m+4>>2]=ne,!p)return p=$f(f)|0,(p|0)==7||(p=Zg(V,p)|0,(p|0)==127)?(ne=1,R=q,ne|0):(H=ge(p|0,0,45)|0,U=D()|0,V=d,U=u[V+4>>2]&-1040385|U,ne=d,u[ne>>2]=u[V>>2]|H,u[ne+4>>2]=U,ne=0,R=q,ne|0);for(u[w>>2]=u[f>>2],u[w+4>>2]=u[f+4>>2],u[w+8>>2]=u[f+8>>2],f=p;;){if(m=f,f=f+-1|0,u[y>>2]=u[w>>2],u[y+4>>2]=u[w+4>>2],u[y+8>>2]=u[w+8>>2],fi(m)|0){if(p=MO(w)|0,p|0){f=13;break}u[x>>2]=u[w>>2],u[x+4>>2]=u[w+4>>2],u[x+8>>2]=u[w+8>>2],eh(x)}else{if(p=PO(w)|0,p|0){f=13;break}u[x>>2]=u[w>>2],u[x+4>>2]=u[w+4>>2],u[x+8>>2]=u[w+8>>2],to(x)}if(em(y,x,E),vr(E),p=d,$=u[p>>2]|0,p=u[p+4>>2]|0,te=(15-m|0)*3|0,ie=ge(7,0,te|0)|0,p=p&~(D()|0),te=ge($f(E)|0,0,te|0)|0,p=D()|0|p,ne=d,u[ne>>2]=te|$&~ie,u[ne+4>>2]=p,(m|0)<=1){f=14;break}}e:do if((f|0)!=13&&(f|0)==14)if((u[w>>2]|0)<=1&&(u[w+4>>2]|0)<=1&&(u[w+8>>2]|0)<=1){f=$f(w)|0,p=Zg(V,f)|0,(p|0)==127?E=0:E=Ot(p)|0;t:do if(f){if(M){if(p=Xr(l,c)|0,(p|0)==7){p=5;break e}if(m=u[21248+(p*28|0)+(f<<2)>>2]|0,(m|0)>0){p=f,f=0;do p=ro(p)|0,f=f+1|0;while((f|0)!=(m|0))}else p=f;if((p|0)==1){p=9;break e}f=Zg(V,p)|0,(f|0)==127&&Oe(23200,23090,411,23230),Ot(f)|0?Oe(23245,23090,412,23230):(U=f,H=m,O=p)}else U=p,H=0,O=f;if(x=u[4272+(V*28|0)+(O<<2)>>2]|0,(x|0)<=-1&&Oe(23276,23090,419,23230),!E){if((H|0)<0){p=5;break e}if(H|0){m=d,p=0,f=u[m>>2]|0,m=u[m+4>>2]|0;do f=io(f,m)|0,m=D()|0,te=d,u[te>>2]=f,u[te+4>>2]=m,p=p+1|0;while((p|0)<(H|0))}if((x|0)<=0){p=U,f=58;break}for(m=d,p=0,f=u[m>>2]|0,m=u[m+4>>2]|0;;)if(f=io(f,m)|0,m=D()|0,te=d,u[te>>2]=f,u[te+4>>2]=m,p=p+1|0,(p|0)==(x|0)){p=U,f=58;break t}}if(y=$g(U,V)|0,(y|0)==7&&Oe(23066,23090,428,23230),p=d,f=u[p>>2]|0,p=u[p+4>>2]|0,(x|0)>0){m=0;do f=io(f,p)|0,p=D()|0,te=d,u[te>>2]=f,u[te+4>>2]=p,m=m+1|0;while((m|0)!=(x|0))}if(p=Xr(f,p)|0,(p|0)==7&&Oe(23313,23090,440,23230),f=Jg(U)|0,f=u[(f?21664:21456)+(y*28|0)+(p<<2)>>2]|0,(f|0)<0&&Oe(23313,23090,454,23230),!f)p=U,f=58;else{y=d,p=0,m=u[y>>2]|0,y=u[y+4>>2]|0;do m=om(m,y)|0,y=D()|0,te=d,u[te>>2]=m,u[te+4>>2]=y,p=p+1|0;while((p|0)<(f|0));p=U,f=58}}else if((M|0)!=0&(E|0)!=0){if(f=Xr(l,c)|0,m=d,m=Xr(u[m>>2]|0,u[m+4>>2]|0)|0,(f|0)==7|(m|0)==7){p=5;break e}if(m=u[21248+(f*28|0)+(m<<2)>>2]|0,(m|0)<0){p=5;break e}if(!m)f=59;else{x=d,f=0,y=u[x>>2]|0,x=u[x+4>>2]|0;do y=io(y,x)|0,x=D()|0,te=d,u[te>>2]=y,u[te+4>>2]=x,f=f+1|0;while((f|0)<(m|0));f=58}}else f=58;while(!1);if((f|0)==58&&E&&(f=59),(f|0)==59&&(te=d,(Xr(u[te>>2]|0,u[te+4>>2]|0)|0)==1)){p=9;break}te=d,ie=u[te>>2]|0,te=u[te+4>>2]&-1040385,$=ge(p|0,0,45)|0,te=te|(D()|0),p=d,u[p>>2]=ie|$,u[p+4>>2]=te,p=0}else p=1;while(!1);return te=p,R=q,te|0}function TF(l,c,f,d,p,m){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0,m=m|0;var y=0,x=0;return x=R,R=R+16|0,y=x,p?l=15:(l=Fn(l,c,f,d,y)|0,l||(IO(y,m),l=0)),R=x,l|0}function EF(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0;return y=R,R=R+16|0,m=y,d?f=15:(f=BO(f,m)|0,f||(f=Db(l,c,m,p)|0)),R=y,f|0}function vF(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0;return E=R,R=R+32|0,y=E+12|0,x=E,m=Fn(l,c,l,c,y)|0,m|0?(x=m,R=E,x|0):(l=Fn(l,c,f,d,x)|0,l|0?(x=l,R=E,x|0):(y=tm(y,x)|0,x=p,u[x>>2]=y,u[x+4>>2]=((y|0)<0)<<31>>31,x=0,R=E,x|0))}function wF(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0;return E=R,R=R+32|0,y=E+12|0,x=E,m=Fn(l,c,l,c,y)|0,!m&&(m=Fn(l,c,f,d,x)|0,!m)?(d=tm(y,x)|0,d=Je(d|0,((d|0)<0)<<31>>31|0,1,0)|0,y=D()|0,x=p,u[x>>2]=d,u[x+4>>2]=y,x=0,R=E,x|0):(x=m,R=E,x|0)}function CF(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0,be=0;if(pe=R,R=R+48|0,y=pe+24|0,x=pe+12|0,ve=pe,m=Fn(l,c,l,c,y)|0,!m&&(m=Fn(l,c,f,d,x)|0,!m)){Q=tm(y,x)|0,xe=((Q|0)<0)<<31>>31,u[y>>2]=0,u[y+4>>2]=0,u[y+8>>2]=0,u[x>>2]=0,u[x+4>>2]=0,u[x+8>>2]=0,Fn(l,c,l,c,y)|0&&Oe(23313,23090,691,23299),Fn(l,c,f,d,x)|0&&Oe(23313,23090,696,23299),Cb(y),Cb(x),Q?(O=u[y>>2]|0,U=+(Q|0),ie=y+4|0,V=u[ie>>2]|0,$=y+8|0,H=u[$>>2]|0,te=y,d=O,m=V,f=H,q=+((u[x>>2]|0)-O|0)/U,ne=+((u[x+4>>2]|0)-V|0)/U,U=+((u[x+8>>2]|0)-H|0)/U):(m=y+4|0,f=y+8|0,ie=m,$=f,te=y,d=u[y>>2]|0,m=u[m>>2]|0,f=u[f>>2]|0,q=0,ne=0,U=0),u[ve>>2]=d,H=ve+4|0,u[H>>2]=m,V=ve+8|0,u[V>>2]=f;e:do if((Q|0)<0)m=0;else for(M=0,O=0,m=d;;){w=+(O>>>0)+4294967296*+(M|0),be=q*w+ +(m|0),E=ne*w+ +(u[ie>>2]|0),w=U*w+ +(u[$>>2]|0),f=~~+sh(+be),y=~~+sh(+E),m=~~+sh(+w),be=+gt(+(+(f|0)-be)),E=+gt(+(+(y|0)-E)),w=+gt(+(+(m|0)-w));do if(be>E&be>w)f=0-(y+m)|0,d=y;else if(x=0-f|0,E>w){d=x-m|0;break}else{d=y,m=x-y|0;break}while(!1);if(u[ve>>2]=f,u[H>>2]=d,u[V>>2]=m,OO(ve),m=Db(l,c,ve,p+(O<<3)|0)|0,m|0)break e;if(!((M|0)<(xe|0)|(M|0)==(xe|0)&O>>>0<Q>>>0)){m=0;break e}m=Je(O|0,M|0,1,0)|0,x=D()|0,M=x,O=m,m=u[te>>2]|0}while(!1);return ve=m,R=pe,ve|0}return ve=m,R=pe,ve|0}function ls(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0;if((f|0)==0&(d|0)==0)return p=0,m=1,Qe(p|0),m|0;m=l,p=c,l=1,c=0;do y=(f&1|0)==0&!0,l=Cr((y?1:m)|0,(y?0:p)|0,l|0,c|0)|0,c=D()|0,f=Yb(f|0,d|0,1)|0,d=D()|0,m=Cr(m|0,p|0,m|0,p|0)|0,p=D()|0;while(!((f|0)==0&(d|0)==0));return Qe(c|0),l|0}function kb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0;if(!(_b(c,f)|0)||(c=mb(c)|0,d=+B[f>>3],p=+B[f+8>>3],p=c&p<0?p+6.283185307179586:p,V=u[l>>2]|0,(V|0)<=0))return V=0,V|0;if(O=u[l+4>>2]|0,c){c=0,M=p,f=-1,l=0;e:for(;;){for(w=l;y=+B[O+(w<<4)>>3],p=+B[O+(w<<4)+8>>3],l=(f+2|0)%(V|0)|0,m=+B[O+(l<<4)>>3],x=+B[O+(l<<4)+8>>3],y>m?(E=y,y=x):(E=m,m=y,y=p,p=x),d=d==m|d==E?d+2220446049250313e-31:d,!!(d<m|d>E);)if(f=w+1|0,(f|0)>=(V|0)){f=22;break e}else l=w,w=f,f=l;if(x=y<0?y+6.283185307179586:y,y=p<0?p+6.283185307179586:p,M=x==M|y==M?M+-2220446049250313e-31:M,E=x+(y-x)*((d-m)/(E-m)),(E<0?E+6.283185307179586:E)>M&&(c=c^1),l=w+1|0,(l|0)>=(V|0)){f=22;break}else f=w}if((f|0)==22)return c|0}else{c=0,M=p,f=-1,l=0;e:for(;;){for(w=l;y=+B[O+(w<<4)>>3],p=+B[O+(w<<4)+8>>3],l=(f+2|0)%(V|0)|0,m=+B[O+(l<<4)>>3],x=+B[O+(l<<4)+8>>3],y>m?(E=y,y=x):(E=m,m=y,y=p,p=x),d=d==m|d==E?d+2220446049250313e-31:d,!!(d<m|d>E);)if(f=w+1|0,(f|0)>=(V|0)){f=22;break e}else l=w,w=f,f=l;if(M=y==M|p==M?M+-2220446049250313e-31:M,y+(p-y)*((d-m)/(E-m))>M&&(c=c^1),l=w+1|0,(l|0)>=(V|0)){f=22;break}else f=w}if((f|0)==22)return c|0}return 0}function Ub(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0;if(U=u[l>>2]|0,!U){u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;return}if(q=c+8|0,B[q>>3]=17976931348623157e292,ne=c+24|0,B[ne>>3]=17976931348623157e292,B[c>>3]=-17976931348623157e292,ie=c+16|0,B[ie>>3]=-17976931348623157e292,!((U|0)<=0)){for(V=u[l+4>>2]|0,w=17976931348623157e292,M=-17976931348623157e292,O=0,l=-1,m=17976931348623157e292,y=17976931348623157e292,E=-17976931348623157e292,d=-17976931348623157e292,H=0;f=+B[V+(H<<4)>>3],x=+B[V+(H<<4)+8>>3],l=l+2|0,p=+B[V+(((l|0)==(U|0)?0:l)<<4)+8>>3],f<m&&(B[q>>3]=f,m=f),x<y&&(B[ne>>3]=x,y=x),f>E?B[c>>3]=f:f=E,x>d&&(B[ie>>3]=x,d=x),w=x>0&x<w?x:w,M=x<0&x>M?x:M,O=O|+gt(+(x-p))>3.141592653589793,l=H+1|0,(l|0)!=(U|0);)$=H,E=f,H=l,l=$;O&&(B[ie>>3]=M,B[ne>>3]=w)}}function SF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0,ve=0,pe=0;if(U=u[l>>2]|0,U){if(q=c+8|0,B[q>>3]=17976931348623157e292,ne=c+24|0,B[ne>>3]=17976931348623157e292,B[c>>3]=-17976931348623157e292,ie=c+16|0,B[ie>>3]=-17976931348623157e292,(U|0)>0){for(p=u[l+4>>2]|0,V=17976931348623157e292,H=-17976931348623157e292,d=0,f=-1,E=17976931348623157e292,w=17976931348623157e292,O=-17976931348623157e292,y=-17976931348623157e292,$=0;m=+B[p+($<<4)>>3],M=+B[p+($<<4)+8>>3],ve=f+2|0,x=+B[p+(((ve|0)==(U|0)?0:ve)<<4)+8>>3],m<E&&(B[q>>3]=m,E=m),M<w&&(B[ne>>3]=M,w=M),m>O?B[c>>3]=m:m=O,M>y&&(B[ie>>3]=M,y=M),V=M>0&M<V?M:V,H=M<0&M>H?M:H,d=d|+gt(+(M-x))>3.141592653589793,f=$+1|0,(f|0)!=(U|0);)ve=$,O=m,$=f,f=ve;d&&(B[ie>>3]=H,B[ne>>3]=V)}}else u[c>>2]=0,u[c+4>>2]=0,u[c+8>>2]=0,u[c+12>>2]=0,u[c+16>>2]=0,u[c+20>>2]=0,u[c+24>>2]=0,u[c+28>>2]=0;if(ve=l+8|0,f=u[ve>>2]|0,!((f|0)<=0)){xe=l+12|0,Q=0;do if(p=u[xe>>2]|0,d=Q,Q=Q+1|0,ne=c+(Q<<5)|0,ie=u[p+(d<<3)>>2]|0,ie){if($=c+(Q<<5)+8|0,B[$>>3]=17976931348623157e292,l=c+(Q<<5)+24|0,B[l>>3]=17976931348623157e292,B[ne>>3]=-17976931348623157e292,te=c+(Q<<5)+16|0,B[te>>3]=-17976931348623157e292,(ie|0)>0){for(U=u[p+(d<<3)+4>>2]|0,V=17976931348623157e292,H=-17976931348623157e292,p=0,d=-1,q=0,E=17976931348623157e292,w=17976931348623157e292,M=-17976931348623157e292,y=-17976931348623157e292;m=+B[U+(q<<4)>>3],O=+B[U+(q<<4)+8>>3],d=d+2|0,x=+B[U+(((d|0)==(ie|0)?0:d)<<4)+8>>3],m<E&&(B[$>>3]=m,E=m),O<w&&(B[l>>3]=O,w=O),m>M?B[ne>>3]=m:m=M,O>y&&(B[te>>3]=O,y=O),V=O>0&O<V?O:V,H=O<0&O>H?O:H,p=p|+gt(+(O-x))>3.141592653589793,d=q+1|0,(d|0)!=(ie|0);)pe=q,q=d,M=m,d=pe;p&&(B[te>>3]=H,B[l>>3]=V)}}else u[ne>>2]=0,u[ne+4>>2]=0,u[ne+8>>2]=0,u[ne+12>>2]=0,u[ne+16>>2]=0,u[ne+20>>2]=0,u[ne+24>>2]=0,u[ne+28>>2]=0,f=u[ve>>2]|0;while((Q|0)<(f|0))}}function MF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;if(!(kb(l,c,f)|0))return p=0,p|0;if(p=l+8|0,(u[p>>2]|0)<=0)return p=1,p|0;for(d=l+12|0,l=0;;){if(m=l,l=l+1|0,kb((u[d>>2]|0)+(m<<3)|0,c+(l<<5)|0,f)|0){l=0,d=6;break}if((l|0)>=(u[p>>2]|0)){l=1,d=6;break}}return(d|0)==6?l|0:0}function PF(){return 8}function RF(){return 16}function IF(){return 168}function BF(){return 8}function OF(){return 16}function FF(){return 12}function LF(){return 8}function NF(l){return l=l|0,+(+((u[l>>2]|0)>>>0)+4294967296*+(u[l+4>>2]|0))}function DF(l){l=l|0;var c=0,f=0;return f=+B[l>>3],c=+B[l+8>>3],+ +kt(+(f*f+c*c))}function Vb(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0;w=+B[l>>3],E=+B[c>>3]-w,x=+B[l+8>>3],y=+B[c+8>>3]-x,O=+B[f>>3],m=+B[d>>3]-O,V=+B[f+8>>3],M=+B[d+8>>3]-V,m=(m*(x-V)-(w-O)*M)/(E*M-y*m),B[p>>3]=w+E*m,B[p+8>>3]=x+y*m}function zb(l,c){return l=l|0,c=c|0,+gt(+(+B[l>>3]-+B[c>>3]))<11920928955078125e-23?(c=+gt(+(+B[l+8>>3]-+B[c+8>>3]))<11920928955078125e-23,c|0):(c=0,c|0)}function $t(l,c){l=l|0,c=c|0;var f=0,d=0,p=0;return p=+B[l>>3]-+B[c>>3],d=+B[l+8>>3]-+B[c+8>>3],f=+B[l+16>>3]-+B[c+16>>3],+(p*p+d*d+f*f)}function kF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0;f=+B[l>>3],d=+lt(+f),f=+At(+f),B[c+16>>3]=f,f=+B[l+8>>3],p=d*+lt(+f),B[c>>3]=p,f=d*+At(+f),B[c+8>>3]=f}function UF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;if(m=R,R=R+16|0,p=m,d=Ft(l,c)|0,(f+-1|0)>>>0>5||(d=(d|0)!=0,(f|0)==1&d))return p=-1,R=m,p|0;do if(fl(l,c,p)|0)d=-1;else if(d){d=((u[21936+(f<<2)>>2]|0)+5-(u[p>>2]|0)|0)%5|0;break}else{d=((u[21968+(f<<2)>>2]|0)+6-(u[p>>2]|0)|0)%6|0;break}while(!1);return p=d,R=m,p|0}function fl(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0,w=0;if(w=R,R=R+32|0,y=w+16|0,x=w,d=pa(l,c,y)|0,d|0)return f=d,R=w,f|0;m=Pb(l,c)|0,E=Xr(l,c)|0,bO(m,x),d=TO(m,u[y>>2]|0)|0;e:do if(Ot(m)|0){do switch(m|0){case 4:{l=0;break}case 14:{l=1;break}case 24:{l=2;break}case 38:{l=3;break}case 49:{l=4;break}case 58:{l=5;break}case 63:{l=6;break}case 72:{l=7;break}case 83:{l=8;break}case 97:{l=9;break}case 107:{l=10;break}case 117:{l=11;break}default:{d=1;break e}}while(!1);if(p=u[22e3+(l*24|0)+8>>2]|0,c=u[22e3+(l*24|0)+16>>2]|0,l=u[y>>2]|0,(l|0)!=(u[x>>2]|0)&&(x=Jg(m)|0,l=u[y>>2]|0,x|(l|0)==(c|0)&&(d=(d+1|0)%6|0)),(E|0)==3&(l|0)==(c|0)){d=(d+5|0)%6|0,p=22;break}(E|0)==5&(l|0)==(p|0)&&(d=(d+1|0)%6|0),p=22}else p=22;while(!1);return(p|0)==22&&(u[f>>2]=d,d=0),f=d,R=w,f|0}function hi(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0;if(te=R,R=R+32|0,$=te+24|0,ne=te+20|0,U=te+8|0,H=te+16|0,V=te,E=(Ft(l,c)|0)==0,E=E?6:5,M=Ae(l|0,c|0,52)|0,D()|0,M=M&15,E>>>0<=f>>>0)return d=2,R=te,d|0;O=(M|0)==0,!O&&(q=ge(7,0,(M^15)*3|0)|0,(q&l|0)==0&((D()|0)&c|0)==0)?p=f:m=4;e:do if((m|0)==4){if(p=(Ft(l,c)|0)!=0,((p?4:5)|0)<(f|0)||fl(l,c,$)|0||(m=(u[$>>2]|0)+f|0,p?p=22288+(((m|0)%5|0)<<2)|0:p=22320+(((m|0)%6|0)<<2)|0,q=u[p>>2]|0,(q|0)==7))return d=1,R=te,d|0;u[ne>>2]=0,p=Ar(l,c,q,ne,U)|0;do if(!p){if(x=U,w=u[x>>2]|0,x=u[x+4>>2]|0,y=x>>>0<c>>>0|(x|0)==(c|0)&w>>>0<l>>>0,m=y?w:l,y=y?x:c,!O&&(O=ge(7,0,(M^15)*3|0)|0,(w&O|0)==0&(x&(D()|0)|0)==0))p=f;else{if(x=(f+-1+E|0)%(E|0)|0,p=Ft(l,c)|0,(x|0)<0&&Oe(23313,23315,245,23324),E=(p|0)!=0,((E?4:5)|0)<(x|0)&&Oe(23313,23315,245,23324),fl(l,c,$)|0&&Oe(23313,23315,245,23324),p=(u[$>>2]|0)+x|0,E?p=22288+(((p|0)%5|0)<<2)|0:p=22320+(((p|0)%6|0)<<2)|0,x=u[p>>2]|0,(x|0)==7&&Oe(23313,23315,245,23324),u[H>>2]=0,p=Ar(l,c,x,H,V)|0,p|0)break;w=V,E=u[w>>2]|0,w=u[w+4>>2]|0;do if(w>>>0<y>>>0|(w|0)==(y|0)&E>>>0<m>>>0){if(Ft(E,w)|0?m=Kg(E,w,l,c)|0:m=u[22384+((((u[H>>2]|0)+(u[22352+(x<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,p=Ft(E,w)|0,(m+-1|0)>>>0>5){p=-1,m=E,y=w;break}if(p=(p|0)!=0,(m|0)==1&p){p=-1,m=E,y=w;break}do if(fl(E,w,$)|0)p=-1;else if(p){p=((u[21936+(m<<2)>>2]|0)+5-(u[$>>2]|0)|0)%5|0;break}else{p=((u[21968+(m<<2)>>2]|0)+6-(u[$>>2]|0)|0)%6|0;break}while(!1);m=E,y=w}else p=f;while(!1);x=U,w=u[x>>2]|0,x=u[x+4>>2]|0}if((m|0)==(w|0)&(y|0)==(x|0)){if(E=(Ft(w,x)|0)!=0,E?l=Kg(w,x,l,c)|0:l=u[22384+((((u[ne>>2]|0)+(u[22352+(q<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,p=Ft(w,x)|0,(l+-1|0)>>>0<=5&&(ie=(p|0)!=0,!((l|0)==1&ie)))do if(fl(w,x,$)|0)p=-1;else if(ie){p=((u[21936+(l<<2)>>2]|0)+5-(u[$>>2]|0)|0)%5|0;break}else{p=((u[21968+(l<<2)>>2]|0)+6-(u[$>>2]|0)|0)%6|0;break}while(!1);else p=-1;p=p+1|0,p=(p|0)==6|E&(p|0)==5?0:p}c=y,l=m;break e}while(!1);return d=p,R=te,d|0}while(!1);return ie=ge(p|0,0,56)|0,$=D()|0|c&-2130706433|536870912,u[d>>2]=ie|l,u[d+4>>2]=$,d=0,R=te,d|0}function VF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;return m=(Ft(l,c)|0)==0,d=hi(l,c,0,f)|0,p=(d|0)==0,m?!p||(d=hi(l,c,1,f+8|0)|0,d|0)||(d=hi(l,c,2,f+16|0)|0,d|0)||(d=hi(l,c,3,f+24|0)|0,d|0)||(d=hi(l,c,4,f+32|0)|0,d)?(m=d,m|0):hi(l,c,5,f+40|0)|0:!p||(d=hi(l,c,1,f+8|0)|0,d|0)||(d=hi(l,c,2,f+16|0)|0,d|0)||(d=hi(l,c,3,f+24|0)|0,d|0)||(d=hi(l,c,4,f+32|0)|0,d|0)?(m=d,m|0):(m=f+40|0,u[m>>2]=0,u[m+4>>2]=0,m=0,m|0)}function zF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0,x=0,E=0;return E=R,R=R+192|0,p=E,m=E+168|0,y=Ae(l|0,c|0,56)|0,D()|0,y=y&7,x=c&-2130706433|134217728,d=pa(l,x,m)|0,d|0?(x=d,R=E,x|0):(c=Ae(l|0,c|0,52)|0,D()|0,c=c&15,Ft(l,x)|0?rm(m,c,y,1,p):im(m,c,y,1,p),x=p+8|0,u[f>>2]=u[x>>2],u[f+4>>2]=u[x+4>>2],u[f+8>>2]=u[x+8>>2],u[f+12>>2]=u[x+12>>2],x=0,R=E,x|0)}function HF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0;return p=R,R=R+16|0,f=p,!(!0&(c&2013265920|0)==536870912)||(d=c&-2130706433|134217728,!(nm(l,d)|0))?(d=0,R=p,d|0):(m=Ae(l|0,c|0,56)|0,D()|0,m=(hi(l,d,m&7,f)|0)==0,d=f,d=m&((u[d>>2]|0)==(l|0)?(u[d+4>>2]|0)==(c|0):0)&1,R=p,d|0)}function Hb(l,c,f){l=l|0,c=c|0,f=f|0;var d=0;(c|0)>0?(d=Zi(c,4)|0,u[l>>2]=d,d||Oe(23337,23360,40,23374)):u[l>>2]=0,u[l+4>>2]=c,u[l+8>>2]=0,u[l+12>>2]=f}function Gb(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0;p=l+4|0,m=l+12|0,y=l+8|0;e:for(;;){for(f=u[p>>2]|0,c=0;;){if((c|0)>=(f|0))break e;if(d=u[l>>2]|0,x=u[d+(c<<2)>>2]|0,!x)c=c+1|0;else break}c=d+(~~(+gt(+(+lr(10,+ +(15-(u[m>>2]|0)|0))*(+B[x>>3]+ +B[x+8>>3])))%+(f|0))>>>0<<2)|0,f=u[c>>2]|0;t:do if(f|0){if(d=x+32|0,(f|0)==(x|0))u[c>>2]=u[d>>2];else{if(f=f+32|0,c=u[f>>2]|0,!c)break;for(;(c|0)!=(x|0);)if(f=c+32|0,c=u[f>>2]|0,!c)break t;u[f>>2]=u[d>>2]}De(x),u[y>>2]=(u[y>>2]|0)+-1}while(!1)}De(u[l>>2]|0)}function Wb(l){l=l|0;var c=0,f=0,d=0;for(d=u[l+4>>2]|0,f=0;;){if((f|0)>=(d|0)){c=0,f=4;break}if(c=u[(u[l>>2]|0)+(f<<2)>>2]|0,!c)f=f+1|0;else{f=4;break}}return(f|0)==4?c|0:0}function jb(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0;if(f=~~(+gt(+(+lr(10,+ +(15-(u[l+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[l+4>>2]|0))>>>0,f=(u[l>>2]|0)+(f<<2)|0,d=u[f>>2]|0,!d)return m=1,m|0;m=c+32|0;do if((d|0)!=(c|0)){if(f=u[d+32>>2]|0,!f)return m=1,m|0;for(p=f;;){if((p|0)==(c|0)){p=8;break}if(f=u[p+32>>2]|0,f)d=p,p=f;else{f=1,p=10;break}}if((p|0)==8){u[d+32>>2]=u[m>>2];break}else if((p|0)==10)return f|0}else u[f>>2]=u[m>>2];while(!1);return De(c),m=l+8|0,u[m>>2]=(u[m>>2]|0)+-1,m=0,m|0}function GF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0;m=Ji(40)|0,m||Oe(23390,23360,98,23403),u[m>>2]=u[c>>2],u[m+4>>2]=u[c+4>>2],u[m+8>>2]=u[c+8>>2],u[m+12>>2]=u[c+12>>2],p=m+16|0,u[p>>2]=u[f>>2],u[p+4>>2]=u[f+4>>2],u[p+8>>2]=u[f+8>>2],u[p+12>>2]=u[f+12>>2],u[m+32>>2]=0,p=~~(+gt(+(+lr(10,+ +(15-(u[l+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[l+4>>2]|0))>>>0,p=(u[l>>2]|0)+(p<<2)|0,d=u[p>>2]|0;do if(!d)u[p>>2]=m;else{for(;!(ga(d,c)|0&&ga(d+16|0,f)|0);)if(p=u[d+32>>2]|0,d=p|0?p:d,!(u[d+32>>2]|0)){y=10;break}if((y|0)==10){u[d+32>>2]=m;break}return De(m),y=d,y|0}while(!1);return y=l+8|0,u[y>>2]=(u[y>>2]|0)+1,y=m,y|0}function WF(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0;if(p=~~(+gt(+(+lr(10,+ +(15-(u[l+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[l+4>>2]|0))>>>0,p=u[(u[l>>2]|0)+(p<<2)>>2]|0,!p)return f=0,f|0;if(!f){for(l=p;;){if(ga(l,c)|0){d=10;break}if(l=u[l+32>>2]|0,!l){l=0,d=10;break}}if((d|0)==10)return l|0}for(l=p;;){if(ga(l,c)|0&&ga(l+16|0,f)|0){d=10;break}if(l=u[l+32>>2]|0,!l){l=0,d=10;break}}return(d|0)==10?l|0:0}function jF(l,c){l=l|0,c=c|0;var f=0;if(f=~~(+gt(+(+lr(10,+ +(15-(u[l+12>>2]|0)|0))*(+B[c>>3]+ +B[c+8>>3])))%+(u[l+4>>2]|0))>>>0,l=u[(u[l>>2]|0)+(f<<2)>>2]|0,!l)return f=0,f|0;for(;;){if(ga(l,c)|0){c=5;break}if(l=u[l+32>>2]|0,!l){l=0,c=5;break}}return(c|0)==5?l|0:0}function XF(){return 23424}function YF(l){return l=+l,+ +qb(+l)}function As(l){return l=+l,~~+YF(l)|0}function Ji(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0,q=0,ne=0,ie=0,$=0,te=0,Q=0,xe=0;xe=R,R=R+16|0,V=xe;do if(l>>>0<245){if(w=l>>>0<11?16:l+11&-8,l=w>>>3,O=u[5857]|0,f=O>>>l,f&3|0)return c=(f&1^1)+l|0,l=23468+(c<<1<<2)|0,f=l+8|0,d=u[f>>2]|0,p=d+8|0,m=u[p>>2]|0,(m|0)==(l|0)?u[5857]=O&~(1<<c):(u[m+12>>2]=l,u[f>>2]=m),Q=c<<3,u[d+4>>2]=Q|3,Q=d+Q+4|0,u[Q>>2]=u[Q>>2]|1,Q=p,R=xe,Q|0;if(M=u[5859]|0,w>>>0>M>>>0){if(f|0)return c=2<<l,c=f<<l&(c|0-c),c=(c&0-c)+-1|0,x=c>>>12&16,c=c>>>x,f=c>>>5&8,c=c>>>f,m=c>>>2&4,c=c>>>m,l=c>>>1&2,c=c>>>l,d=c>>>1&1,d=(f|x|m|l|d)+(c>>>d)|0,c=23468+(d<<1<<2)|0,l=c+8|0,m=u[l>>2]|0,x=m+8|0,f=u[x>>2]|0,(f|0)==(c|0)?(l=O&~(1<<d),u[5857]=l):(u[f+12>>2]=c,u[l>>2]=f,l=O),Q=d<<3,y=Q-w|0,u[m+4>>2]=w|3,p=m+w|0,u[p+4>>2]=y|1,u[m+Q>>2]=y,M|0&&(d=u[5862]|0,c=M>>>3,f=23468+(c<<1<<2)|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5857]=l|c,c=f,l=f+8|0),u[l>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=f),u[5859]=y,u[5862]=p,Q=x,R=xe,Q|0;if(m=u[5858]|0,m){for(f=(m&0-m)+-1|0,p=f>>>12&16,f=f>>>p,d=f>>>5&8,f=f>>>d,y=f>>>2&4,f=f>>>y,x=f>>>1&2,f=f>>>x,E=f>>>1&1,E=u[23732+((d|p|y|x|E)+(f>>>E)<<2)>>2]|0,f=E,x=E,E=(u[E+4>>2]&-8)-w|0;l=u[f+16>>2]|0,!(!l&&(l=u[f+20>>2]|0,!l));)y=(u[l+4>>2]&-8)-w|0,p=y>>>0<E>>>0,f=l,x=p?l:x,E=p?y:E;if(y=x+w|0,y>>>0>x>>>0){p=u[x+24>>2]|0,c=u[x+12>>2]|0;do if((c|0)==(x|0)){if(l=x+20|0,c=u[l>>2]|0,!c&&(l=x+16|0,c=u[l>>2]|0,!c)){f=0;break}for(;;)if(d=c+20|0,f=u[d>>2]|0,f)c=f,l=d;else if(d=c+16|0,f=u[d>>2]|0,f)c=f,l=d;else break;u[l>>2]=0,f=c}else f=u[x+8>>2]|0,u[f+12>>2]=c,u[c+8>>2]=f,f=c;while(!1);do if(p|0){if(c=u[x+28>>2]|0,l=23732+(c<<2)|0,(x|0)==(u[l>>2]|0)){if(u[l>>2]=f,!f){u[5858]=m&~(1<<c);break}}else if(Q=p+16|0,u[((u[Q>>2]|0)==(x|0)?Q:p+20|0)>>2]=f,!f)break;u[f+24>>2]=p,c=u[x+16>>2]|0,c|0&&(u[f+16>>2]=c,u[c+24>>2]=f),c=u[x+20>>2]|0,c|0&&(u[f+20>>2]=c,u[c+24>>2]=f)}while(!1);return E>>>0<16?(Q=E+w|0,u[x+4>>2]=Q|3,Q=x+Q+4|0,u[Q>>2]=u[Q>>2]|1):(u[x+4>>2]=w|3,u[y+4>>2]=E|1,u[y+E>>2]=E,M|0&&(d=u[5862]|0,c=M>>>3,f=23468+(c<<1<<2)|0,c=1<<c,c&O?(l=f+8|0,c=u[l>>2]|0):(u[5857]=c|O,c=f,l=f+8|0),u[l>>2]=d,u[c+12>>2]=d,u[d+8>>2]=c,u[d+12>>2]=f),u[5859]=E,u[5862]=y),Q=x+8|0,R=xe,Q|0}else O=w}else O=w}else O=w}else if(l>>>0<=4294967231)if(l=l+11|0,w=l&-8,d=u[5858]|0,d){p=0-w|0,l=l>>>8,l?w>>>0>16777215?E=31:(O=(l+1048320|0)>>>16&8,q=l<<O,x=(q+520192|0)>>>16&4,q=q<<x,E=(q+245760|0)>>>16&2,E=14-(x|O|E)+(q<<E>>>15)|0,E=w>>>(E+7|0)&1|E<<1):E=0,f=u[23732+(E<<2)>>2]|0;e:do if(!f)f=0,l=0,q=61;else for(l=0,x=w<<((E|0)==31?0:25-(E>>>1)|0),m=0;;){if(y=(u[f+4>>2]&-8)-w|0,y>>>0<p>>>0)if(y)l=f,p=y;else{l=f,p=0,q=65;break e}if(q=u[f+20>>2]|0,f=u[f+16+(x>>>31<<2)>>2]|0,m=(q|0)==0|(q|0)==(f|0)?m:q,f)x=x<<1;else{f=m,q=61;break}}while(!1);if((q|0)==61){if((f|0)==0&(l|0)==0){if(l=2<<E,l=(l|0-l)&d,!l){O=w;break}O=(l&0-l)+-1|0,y=O>>>12&16,O=O>>>y,m=O>>>5&8,O=O>>>m,x=O>>>2&4,O=O>>>x,E=O>>>1&2,O=O>>>E,f=O>>>1&1,l=0,f=u[23732+((m|y|x|E|f)+(O>>>f)<<2)>>2]|0}f?q=65:(x=l,y=p)}if((q|0)==65)for(m=f;;)if(O=(u[m+4>>2]&-8)-w|0,f=O>>>0<p>>>0,p=f?O:p,l=f?m:l,f=u[m+16>>2]|0,f||(f=u[m+20>>2]|0),f)m=f;else{x=l,y=p;break}if(x|0&&y>>>0<((u[5859]|0)-w|0)>>>0&&(M=x+w|0,M>>>0>x>>>0)){m=u[x+24>>2]|0,c=u[x+12>>2]|0;do if((c|0)==(x|0)){if(l=x+20|0,c=u[l>>2]|0,!c&&(l=x+16|0,c=u[l>>2]|0,!c)){c=0;break}for(;;)if(p=c+20|0,f=u[p>>2]|0,f)c=f,l=p;else if(p=c+16|0,f=u[p>>2]|0,f)c=f,l=p;else break;u[l>>2]=0}else Q=u[x+8>>2]|0,u[Q+12>>2]=c,u[c+8>>2]=Q;while(!1);do if(m){if(l=u[x+28>>2]|0,f=23732+(l<<2)|0,(x|0)==(u[f>>2]|0)){if(u[f>>2]=c,!c){d=d&~(1<<l),u[5858]=d;break}}else if(Q=m+16|0,u[((u[Q>>2]|0)==(x|0)?Q:m+20|0)>>2]=c,!c)break;u[c+24>>2]=m,l=u[x+16>>2]|0,l|0&&(u[c+16>>2]=l,u[l+24>>2]=c),l=u[x+20>>2]|0,l&&(u[c+20>>2]=l,u[l+24>>2]=c)}while(!1);e:do if(y>>>0<16)Q=y+w|0,u[x+4>>2]=Q|3,Q=x+Q+4|0,u[Q>>2]=u[Q>>2]|1;else{if(u[x+4>>2]=w|3,u[M+4>>2]=y|1,u[M+y>>2]=y,c=y>>>3,y>>>0<256){f=23468+(c<<1<<2)|0,l=u[5857]|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5857]=l|c,c=f,l=f+8|0),u[l>>2]=M,u[c+12>>2]=M,u[M+8>>2]=c,u[M+12>>2]=f;break}if(c=y>>>8,c?y>>>0>16777215?f=31:(te=(c+1048320|0)>>>16&8,Q=c<<te,$=(Q+520192|0)>>>16&4,Q=Q<<$,f=(Q+245760|0)>>>16&2,f=14-($|te|f)+(Q<<f>>>15)|0,f=y>>>(f+7|0)&1|f<<1):f=0,c=23732+(f<<2)|0,u[M+28>>2]=f,l=M+16|0,u[l+4>>2]=0,u[l>>2]=0,l=1<<f,!(d&l)){u[5858]=d|l,u[c>>2]=M,u[M+24>>2]=c,u[M+12>>2]=M,u[M+8>>2]=M;break}c=u[c>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(y|0)){for(d=y<<((f|0)==31?0:25-(f>>>1)|0);f=c+16+(d>>>31<<2)|0,l=u[f>>2]|0,!!l;)if((u[l+4>>2]&-8|0)==(y|0)){c=l;break t}else d=d<<1,c=l;u[f>>2]=M,u[M+24>>2]=c,u[M+12>>2]=M,u[M+8>>2]=M;break e}while(!1);te=c+8|0,Q=u[te>>2]|0,u[Q+12>>2]=M,u[te>>2]=M,u[M+8>>2]=Q,u[M+12>>2]=c,u[M+24>>2]=0}while(!1);return Q=x+8|0,R=xe,Q|0}else O=w}else O=w;else O=-1;while(!1);if(f=u[5859]|0,f>>>0>=O>>>0)return c=f-O|0,l=u[5862]|0,c>>>0>15?(Q=l+O|0,u[5862]=Q,u[5859]=c,u[Q+4>>2]=c|1,u[l+f>>2]=c,u[l+4>>2]=O|3):(u[5859]=0,u[5862]=0,u[l+4>>2]=f|3,Q=l+f+4|0,u[Q>>2]=u[Q>>2]|1),Q=l+8|0,R=xe,Q|0;if(y=u[5860]|0,y>>>0>O>>>0)return $=y-O|0,u[5860]=$,Q=u[5863]|0,te=Q+O|0,u[5863]=te,u[te+4>>2]=$|1,u[Q+4>>2]=O|3,Q=Q+8|0,R=xe,Q|0;if(u[5975]|0?l=u[5977]|0:(u[5977]=4096,u[5976]=4096,u[5978]=-1,u[5979]=-1,u[5980]=0,u[5968]=0,u[5975]=V&-16^1431655768,l=4096),x=O+48|0,E=O+47|0,m=l+E|0,p=0-l|0,w=m&p,w>>>0<=O>>>0||(l=u[5967]|0,l|0&&(M=u[5965]|0,V=M+w|0,V>>>0<=M>>>0|V>>>0>l>>>0)))return Q=0,R=xe,Q|0;e:do if(u[5968]&4)c=0,q=143;else{f=u[5863]|0;t:do if(f){for(d=23876;V=u[d>>2]|0,!(V>>>0<=f>>>0&&(V+(u[d+4>>2]|0)|0)>>>0>f>>>0);)if(l=u[d+8>>2]|0,l)d=l;else{q=128;break t}if(c=m-y&p,c>>>0<2147483647)if(l=us(c|0)|0,(l|0)==((u[d>>2]|0)+(u[d+4>>2]|0)|0)){if((l|0)!=-1){y=c,m=l,q=145;break e}}else d=l,q=136;else c=0}else q=128;while(!1);do if((q|0)==128)if(f=us(0)|0,(f|0)!=-1&&(c=f,H=u[5976]|0,U=H+-1|0,c=(U&c|0?(U+c&0-H)-c|0:0)+w|0,H=u[5965]|0,U=c+H|0,c>>>0>O>>>0&c>>>0<2147483647)){if(V=u[5967]|0,V|0&&U>>>0<=H>>>0|U>>>0>V>>>0){c=0;break}if(l=us(c|0)|0,(l|0)==(f|0)){y=c,m=f,q=145;break e}else d=l,q=136}else c=0;while(!1);do if((q|0)==136){if(f=0-c|0,!(x>>>0>c>>>0&(c>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){c=0;break}else{y=c,m=d,q=145;break e}if(l=u[5977]|0,l=E-c+l&0-l,l>>>0>=2147483647){y=c,m=d,q=145;break e}if((us(l|0)|0)==-1){us(f|0)|0,c=0;break}else{y=l+c|0,m=d,q=145;break e}}while(!1);u[5968]=u[5968]|4,q=143}while(!1);if((q|0)==143&&w>>>0<2147483647&&($=us(w|0)|0,U=us(0)|0,ne=U-$|0,ie=ne>>>0>(O+40|0)>>>0,!(($|0)==-1|ie^1|$>>>0<U>>>0&(($|0)!=-1&(U|0)!=-1)^1))&&(y=ie?ne:c,m=$,q=145),(q|0)==145){c=(u[5965]|0)+y|0,u[5965]=c,c>>>0>(u[5966]|0)>>>0&&(u[5966]=c),E=u[5863]|0;e:do if(E){for(c=23876;;){if(l=u[c>>2]|0,f=u[c+4>>2]|0,(m|0)==(l+f|0)){q=154;break}if(d=u[c+8>>2]|0,d)c=d;else break}if((q|0)==154&&(te=c+4|0,(u[c+12>>2]&8|0)==0)&&m>>>0>E>>>0&l>>>0<=E>>>0){u[te>>2]=f+y,Q=(u[5860]|0)+y|0,$=E+8|0,$=$&7|0?0-$&7:0,te=E+$|0,$=Q-$|0,u[5863]=te,u[5860]=$,u[te+4>>2]=$|1,u[E+Q+4>>2]=40,u[5864]=u[5979];break}for(m>>>0<(u[5861]|0)>>>0&&(u[5861]=m),f=m+y|0,c=23876;;){if((u[c>>2]|0)==(f|0)){q=162;break}if(l=u[c+8>>2]|0,l)c=l;else break}if((q|0)==162&&!(u[c+12>>2]&8|0)){u[c>>2]=m,M=c+4|0,u[M>>2]=(u[M>>2]|0)+y,M=m+8|0,M=m+(M&7|0?0-M&7:0)|0,c=f+8|0,c=f+(c&7|0?0-c&7:0)|0,w=M+O|0,x=c-M-O|0,u[M+4>>2]=O|3;t:do if((E|0)==(c|0))Q=(u[5860]|0)+x|0,u[5860]=Q,u[5863]=w,u[w+4>>2]=Q|1;else{if((u[5862]|0)==(c|0)){Q=(u[5859]|0)+x|0,u[5859]=Q,u[5862]=w,u[w+4>>2]=Q|1,u[w+Q>>2]=Q;break}if(l=u[c+4>>2]|0,(l&3|0)==1){y=l&-8,d=l>>>3;r:do if(l>>>0<256)if(l=u[c+8>>2]|0,f=u[c+12>>2]|0,(f|0)==(l|0)){u[5857]=u[5857]&~(1<<d);break}else{u[l+12>>2]=f,u[f+8>>2]=l;break}else{m=u[c+24>>2]|0,l=u[c+12>>2]|0;do if((l|0)==(c|0)){if(f=c+16|0,d=f+4|0,l=u[d>>2]|0,l)f=d;else if(l=u[f>>2]|0,!l){l=0;break}for(;;)if(p=l+20|0,d=u[p>>2]|0,d)l=d,f=p;else if(p=l+16|0,d=u[p>>2]|0,d)l=d,f=p;else break;u[f>>2]=0}else Q=u[c+8>>2]|0,u[Q+12>>2]=l,u[l+8>>2]=Q;while(!1);if(!m)break;f=u[c+28>>2]|0,d=23732+(f<<2)|0;do if((u[d>>2]|0)!=(c|0)){if(Q=m+16|0,u[((u[Q>>2]|0)==(c|0)?Q:m+20|0)>>2]=l,!l)break r}else{if(u[d>>2]=l,l|0)break;u[5858]=u[5858]&~(1<<f);break r}while(!1);if(u[l+24>>2]=m,f=c+16|0,d=u[f>>2]|0,d|0&&(u[l+16>>2]=d,u[d+24>>2]=l),f=u[f+4>>2]|0,!f)break;u[l+20>>2]=f,u[f+24>>2]=l}while(!1);c=c+y|0,p=y+x|0}else p=x;if(c=c+4|0,u[c>>2]=u[c>>2]&-2,u[w+4>>2]=p|1,u[w+p>>2]=p,c=p>>>3,p>>>0<256){f=23468+(c<<1<<2)|0,l=u[5857]|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5857]=l|c,c=f,l=f+8|0),u[l>>2]=w,u[c+12>>2]=w,u[w+8>>2]=c,u[w+12>>2]=f;break}c=p>>>8;do if(!c)d=0;else{if(p>>>0>16777215){d=31;break}te=(c+1048320|0)>>>16&8,Q=c<<te,$=(Q+520192|0)>>>16&4,Q=Q<<$,d=(Q+245760|0)>>>16&2,d=14-($|te|d)+(Q<<d>>>15)|0,d=p>>>(d+7|0)&1|d<<1}while(!1);if(c=23732+(d<<2)|0,u[w+28>>2]=d,l=w+16|0,u[l+4>>2]=0,u[l>>2]=0,l=u[5858]|0,f=1<<d,!(l&f)){u[5858]=l|f,u[c>>2]=w,u[w+24>>2]=c,u[w+12>>2]=w,u[w+8>>2]=w;break}c=u[c>>2]|0;r:do if((u[c+4>>2]&-8|0)!=(p|0)){for(d=p<<((d|0)==31?0:25-(d>>>1)|0);f=c+16+(d>>>31<<2)|0,l=u[f>>2]|0,!!l;)if((u[l+4>>2]&-8|0)==(p|0)){c=l;break r}else d=d<<1,c=l;u[f>>2]=w,u[w+24>>2]=c,u[w+12>>2]=w,u[w+8>>2]=w;break t}while(!1);te=c+8|0,Q=u[te>>2]|0,u[Q+12>>2]=w,u[te>>2]=w,u[w+8>>2]=Q,u[w+12>>2]=c,u[w+24>>2]=0}while(!1);return Q=M+8|0,R=xe,Q|0}for(c=23876;l=u[c>>2]|0,!(l>>>0<=E>>>0&&(Q=l+(u[c+4>>2]|0)|0,Q>>>0>E>>>0));)c=u[c+8>>2]|0;p=Q+-47|0,l=p+8|0,l=p+(l&7|0?0-l&7:0)|0,p=E+16|0,l=l>>>0<p>>>0?E:l,c=l+8|0,f=y+-40|0,$=m+8|0,$=$&7|0?0-$&7:0,te=m+$|0,$=f-$|0,u[5863]=te,u[5860]=$,u[te+4>>2]=$|1,u[m+f+4>>2]=40,u[5864]=u[5979],f=l+4|0,u[f>>2]=27,u[c>>2]=u[5969],u[c+4>>2]=u[5970],u[c+8>>2]=u[5971],u[c+12>>2]=u[5972],u[5969]=m,u[5970]=y,u[5972]=0,u[5971]=c,c=l+24|0;do te=c,c=c+4|0,u[c>>2]=7;while((te+8|0)>>>0<Q>>>0);if((l|0)!=(E|0)){if(m=l-E|0,u[f>>2]=u[f>>2]&-2,u[E+4>>2]=m|1,u[l>>2]=m,c=m>>>3,m>>>0<256){f=23468+(c<<1<<2)|0,l=u[5857]|0,c=1<<c,l&c?(l=f+8|0,c=u[l>>2]|0):(u[5857]=l|c,c=f,l=f+8|0),u[l>>2]=E,u[c+12>>2]=E,u[E+8>>2]=c,u[E+12>>2]=f;break}if(c=m>>>8,c?m>>>0>16777215?d=31:(te=(c+1048320|0)>>>16&8,Q=c<<te,$=(Q+520192|0)>>>16&4,Q=Q<<$,d=(Q+245760|0)>>>16&2,d=14-($|te|d)+(Q<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1):d=0,f=23732+(d<<2)|0,u[E+28>>2]=d,u[E+20>>2]=0,u[p>>2]=0,c=u[5858]|0,l=1<<d,!(c&l)){u[5858]=c|l,u[f>>2]=E,u[E+24>>2]=f,u[E+12>>2]=E,u[E+8>>2]=E;break}c=u[f>>2]|0;t:do if((u[c+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);f=c+16+(d>>>31<<2)|0,l=u[f>>2]|0,!!l;)if((u[l+4>>2]&-8|0)==(m|0)){c=l;break t}else d=d<<1,c=l;u[f>>2]=E,u[E+24>>2]=c,u[E+12>>2]=E,u[E+8>>2]=E;break e}while(!1);te=c+8|0,Q=u[te>>2]|0,u[Q+12>>2]=E,u[te>>2]=E,u[E+8>>2]=Q,u[E+12>>2]=c,u[E+24>>2]=0}}else Q=u[5861]|0,(Q|0)==0|m>>>0<Q>>>0&&(u[5861]=m),u[5969]=m,u[5970]=y,u[5972]=0,u[5866]=u[5975],u[5865]=-1,u[5870]=23468,u[5869]=23468,u[5872]=23476,u[5871]=23476,u[5874]=23484,u[5873]=23484,u[5876]=23492,u[5875]=23492,u[5878]=23500,u[5877]=23500,u[5880]=23508,u[5879]=23508,u[5882]=23516,u[5881]=23516,u[5884]=23524,u[5883]=23524,u[5886]=23532,u[5885]=23532,u[5888]=23540,u[5887]=23540,u[5890]=23548,u[5889]=23548,u[5892]=23556,u[5891]=23556,u[5894]=23564,u[5893]=23564,u[5896]=23572,u[5895]=23572,u[5898]=23580,u[5897]=23580,u[5900]=23588,u[5899]=23588,u[5902]=23596,u[5901]=23596,u[5904]=23604,u[5903]=23604,u[5906]=23612,u[5905]=23612,u[5908]=23620,u[5907]=23620,u[5910]=23628,u[5909]=23628,u[5912]=23636,u[5911]=23636,u[5914]=23644,u[5913]=23644,u[5916]=23652,u[5915]=23652,u[5918]=23660,u[5917]=23660,u[5920]=23668,u[5919]=23668,u[5922]=23676,u[5921]=23676,u[5924]=23684,u[5923]=23684,u[5926]=23692,u[5925]=23692,u[5928]=23700,u[5927]=23700,u[5930]=23708,u[5929]=23708,u[5932]=23716,u[5931]=23716,Q=y+-40|0,$=m+8|0,$=$&7|0?0-$&7:0,te=m+$|0,$=Q-$|0,u[5863]=te,u[5860]=$,u[te+4>>2]=$|1,u[m+Q+4>>2]=40,u[5864]=u[5979];while(!1);if(c=u[5860]|0,c>>>0>O>>>0)return $=c-O|0,u[5860]=$,Q=u[5863]|0,te=Q+O|0,u[5863]=te,u[te+4>>2]=$|1,u[Q+4>>2]=O|3,Q=Q+8|0,R=xe,Q|0}return Q=XF()|0,u[Q>>2]=12,Q=0,R=xe,Q|0}function De(l){l=l|0;var c=0,f=0,d=0,p=0,m=0,y=0,x=0,E=0;if(l){f=l+-8|0,p=u[5861]|0,l=u[l+-4>>2]|0,c=l&-8,E=f+c|0;do if(l&1)x=f,y=f;else{if(d=u[f>>2]|0,!(l&3)||(y=f+(0-d)|0,m=d+c|0,y>>>0<p>>>0))return;if((u[5862]|0)==(y|0)){if(l=E+4|0,c=u[l>>2]|0,(c&3|0)!=3){x=y,c=m;break}u[5859]=m,u[l>>2]=c&-2,u[y+4>>2]=m|1,u[y+m>>2]=m;return}if(f=d>>>3,d>>>0<256)if(l=u[y+8>>2]|0,c=u[y+12>>2]|0,(c|0)==(l|0)){u[5857]=u[5857]&~(1<<f),x=y,c=m;break}else{u[l+12>>2]=c,u[c+8>>2]=l,x=y,c=m;break}p=u[y+24>>2]|0,l=u[y+12>>2]|0;do if((l|0)==(y|0)){if(c=y+16|0,f=c+4|0,l=u[f>>2]|0,l)c=f;else if(l=u[c>>2]|0,!l){l=0;break}for(;;)if(d=l+20|0,f=u[d>>2]|0,f)l=f,c=d;else if(d=l+16|0,f=u[d>>2]|0,f)l=f,c=d;else break;u[c>>2]=0}else x=u[y+8>>2]|0,u[x+12>>2]=l,u[l+8>>2]=x;while(!1);if(p){if(c=u[y+28>>2]|0,f=23732+(c<<2)|0,(u[f>>2]|0)==(y|0)){if(u[f>>2]=l,!l){u[5858]=u[5858]&~(1<<c),x=y,c=m;break}}else if(x=p+16|0,u[((u[x>>2]|0)==(y|0)?x:p+20|0)>>2]=l,!l){x=y,c=m;break}u[l+24>>2]=p,c=y+16|0,f=u[c>>2]|0,f|0&&(u[l+16>>2]=f,u[f+24>>2]=l),c=u[c+4>>2]|0,c?(u[l+20>>2]=c,u[c+24>>2]=l,x=y,c=m):(x=y,c=m)}else x=y,c=m}while(!1);if(!(y>>>0>=E>>>0)&&(l=E+4|0,d=u[l>>2]|0,!!(d&1))){if(d&2)u[l>>2]=d&-2,u[x+4>>2]=c|1,u[y+c>>2]=c,p=c;else{if((u[5863]|0)==(E|0)){if(E=(u[5860]|0)+c|0,u[5860]=E,u[5863]=x,u[x+4>>2]=E|1,(x|0)!=(u[5862]|0))return;u[5862]=0,u[5859]=0;return}if((u[5862]|0)==(E|0)){E=(u[5859]|0)+c|0,u[5859]=E,u[5862]=y,u[x+4>>2]=E|1,u[y+E>>2]=E;return}p=(d&-8)+c|0,f=d>>>3;do if(d>>>0<256)if(c=u[E+8>>2]|0,l=u[E+12>>2]|0,(l|0)==(c|0)){u[5857]=u[5857]&~(1<<f);break}else{u[c+12>>2]=l,u[l+8>>2]=c;break}else{m=u[E+24>>2]|0,l=u[E+12>>2]|0;do if((l|0)==(E|0)){if(c=E+16|0,f=c+4|0,l=u[f>>2]|0,l)c=f;else if(l=u[c>>2]|0,!l){f=0;break}for(;;)if(d=l+20|0,f=u[d>>2]|0,f)l=f,c=d;else if(d=l+16|0,f=u[d>>2]|0,f)l=f,c=d;else break;u[c>>2]=0,f=l}else f=u[E+8>>2]|0,u[f+12>>2]=l,u[l+8>>2]=f,f=l;while(!1);if(m|0){if(l=u[E+28>>2]|0,c=23732+(l<<2)|0,(u[c>>2]|0)==(E|0)){if(u[c>>2]=f,!f){u[5858]=u[5858]&~(1<<l);break}}else if(d=m+16|0,u[((u[d>>2]|0)==(E|0)?d:m+20|0)>>2]=f,!f)break;u[f+24>>2]=m,l=E+16|0,c=u[l>>2]|0,c|0&&(u[f+16>>2]=c,u[c+24>>2]=f),l=u[l+4>>2]|0,l|0&&(u[f+20>>2]=l,u[l+24>>2]=f)}}while(!1);if(u[x+4>>2]=p|1,u[y+p>>2]=p,(x|0)==(u[5862]|0)){u[5859]=p;return}}if(l=p>>>3,p>>>0<256){f=23468+(l<<1<<2)|0,c=u[5857]|0,l=1<<l,c&l?(c=f+8|0,l=u[c>>2]|0):(u[5857]=c|l,l=f,c=f+8|0),u[c>>2]=x,u[l+12>>2]=x,u[x+8>>2]=l,u[x+12>>2]=f;return}l=p>>>8,l?p>>>0>16777215?d=31:(y=(l+1048320|0)>>>16&8,E=l<<y,m=(E+520192|0)>>>16&4,E=E<<m,d=(E+245760|0)>>>16&2,d=14-(m|y|d)+(E<<d>>>15)|0,d=p>>>(d+7|0)&1|d<<1):d=0,l=23732+(d<<2)|0,u[x+28>>2]=d,u[x+20>>2]=0,u[x+16>>2]=0,c=u[5858]|0,f=1<<d;e:do if(!(c&f))u[5858]=c|f,u[l>>2]=x,u[x+24>>2]=l,u[x+12>>2]=x,u[x+8>>2]=x;else{l=u[l>>2]|0;t:do if((u[l+4>>2]&-8|0)!=(p|0)){for(d=p<<((d|0)==31?0:25-(d>>>1)|0);f=l+16+(d>>>31<<2)|0,c=u[f>>2]|0,!!c;)if((u[c+4>>2]&-8|0)==(p|0)){l=c;break t}else d=d<<1,l=c;u[f>>2]=x,u[x+24>>2]=l,u[x+12>>2]=x,u[x+8>>2]=x;break e}while(!1);y=l+8|0,E=u[y>>2]|0,u[E+12>>2]=x,u[y>>2]=x,u[x+8>>2]=E,u[x+12>>2]=l,u[x+24>>2]=0}while(!1);if(E=(u[5865]|0)+-1|0,u[5865]=E,!(E|0)){for(l=23884;l=u[l>>2]|0,l;)l=l+8|0;u[5865]=-1}}}}function Zi(l,c){l=l|0,c=c|0;var f=0;return l?(f=Ki(c,l)|0,(c|l)>>>0>65535&&(f=((f>>>0)/(l>>>0)|0|0)==(c|0)?f:-1)):f=0,l=Ji(f)|0,!l||!(u[l+-4>>2]&3)||so(l|0,0,f|0)|0,l|0}function Je(l,c,f,d){return l=l|0,c=c|0,f=f|0,d=d|0,f=l+f>>>0,Qe(c+d+(f>>>0<l>>>0|0)>>>0|0),f|0|0}function wr(l,c,f,d){return l=l|0,c=c|0,f=f|0,d=d|0,d=c-d-(f>>>0>l>>>0|0)>>>0,Qe(d|0),l-f>>>0|0|0}function Xb(l){return l=l|0,(l?31-($s(l^l-1)|0)|0:32)|0}function fm(l,c,f,d,p){l=l|0,c=c|0,f=f|0,d=d|0,p=p|0;var m=0,y=0,x=0,E=0,w=0,M=0,O=0,V=0,H=0,U=0;if(M=l,E=c,w=E,y=f,V=d,x=V,!w)return m=(p|0)!=0,x?m?(u[p>>2]=l|0,u[p+4>>2]=c&0,V=0,p=0,Qe(V|0),p|0):(V=0,p=0,Qe(V|0),p|0):(m&&(u[p>>2]=(M>>>0)%(y>>>0),u[p+4>>2]=0),V=0,p=(M>>>0)/(y>>>0)>>>0,Qe(V|0),p|0);m=(x|0)==0;do if(y){if(!m){if(m=($s(x|0)|0)-($s(w|0)|0)|0,m>>>0<=31){O=m+1|0,x=31-m|0,c=m-31>>31,y=O,l=M>>>(O>>>0)&c|w<<x,c=w>>>(O>>>0)&c,m=0,x=M<<x;break}return p?(u[p>>2]=l|0,u[p+4>>2]=E|c&0,V=0,p=0,Qe(V|0),p|0):(V=0,p=0,Qe(V|0),p|0)}if(m=y-1|0,m&y|0){x=($s(y|0)|0)+33-($s(w|0)|0)|0,U=64-x|0,O=32-x|0,E=O>>31,H=x-32|0,c=H>>31,y=x,l=O-1>>31&w>>>(H>>>0)|(w<<O|M>>>(x>>>0))&c,c=c&w>>>(x>>>0),m=M<<U&E,x=(w<<U|M>>>(H>>>0))&E|M<<O&x-33>>31;break}return p|0&&(u[p>>2]=m&M,u[p+4>>2]=0),(y|0)==1?(H=E|c&0,U=l|0|0,Qe(H|0),U|0):(U=Xb(y|0)|0,H=w>>>(U>>>0)|0,U=w<<32-U|M>>>(U>>>0)|0,Qe(H|0),U|0)}else{if(m)return p|0&&(u[p>>2]=(w>>>0)%(y>>>0),u[p+4>>2]=0),H=0,U=(w>>>0)/(y>>>0)>>>0,Qe(H|0),U|0;if(!M)return p|0&&(u[p>>2]=0,u[p+4>>2]=(w>>>0)%(x>>>0)),H=0,U=(w>>>0)/(x>>>0)>>>0,Qe(H|0),U|0;if(m=x-1|0,!(m&x))return p|0&&(u[p>>2]=l|0,u[p+4>>2]=m&w|c&0),H=0,U=w>>>((Xb(x|0)|0)>>>0),Qe(H|0),U|0;if(m=($s(x|0)|0)-($s(w|0)|0)|0,m>>>0<=30){c=m+1|0,x=31-m|0,y=c,l=w<<x|M>>>(c>>>0),c=w>>>(c>>>0),m=0,x=M<<x;break}return p?(u[p>>2]=l|0,u[p+4>>2]=E|c&0,H=0,U=0,Qe(H|0),U|0):(H=0,U=0,Qe(H|0),U|0)}while(!1);if(!y)w=x,E=0,x=0;else{O=f|0|0,M=V|d&0,w=Je(O|0,M|0,-1,-1)|0,f=D()|0,E=x,x=0;do d=E,E=m>>>31|E<<1,m=x|m<<1,d=l<<1|d>>>31|0,V=l>>>31|c<<1|0,wr(w|0,f|0,d|0,V|0)|0,U=D()|0,H=U>>31|((U|0)<0?-1:0)<<1,x=H&1,l=wr(d|0,V|0,H&O|0,(((U|0)<0?-1:0)>>31|((U|0)<0?-1:0)<<1)&M|0)|0,c=D()|0,y=y-1|0;while(y|0);w=E,E=0}return y=0,p|0&&(u[p>>2]=l,u[p+4>>2]=c),H=(m|0)>>>31|(w|y)<<1|(y<<1|m>>>31)&0|E,U=(m<<1|0)&-2|x,Qe(H|0),U|0}function no(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0;return w=c>>31|((c|0)<0?-1:0)<<1,E=((c|0)<0?-1:0)>>31|((c|0)<0?-1:0)<<1,m=d>>31|((d|0)<0?-1:0)<<1,p=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,x=wr(w^l|0,E^c|0,w|0,E|0)|0,y=D()|0,l=m^w,c=p^E,wr((fm(x,y,wr(m^f|0,p^d|0,m|0,p|0)|0,D()|0,0)|0)^l|0,(D()|0)^c|0,l|0,c|0)|0}function QF(l,c){l=l|0,c=c|0;var f=0,d=0,p=0,m=0;return m=l&65535,p=c&65535,f=Ki(p,m)|0,d=l>>>16,l=(f>>>16)+(Ki(p,d)|0)|0,p=c>>>16,c=Ki(p,m)|0,Qe((l>>>16)+(Ki(p,d)|0)+(((l&65535)+c|0)>>>16)|0),l+c<<16|f&65535|0|0}function Cr(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0;return p=l,m=f,f=QF(p,m)|0,l=D()|0,Qe((Ki(c,m)|0)+(Ki(d,p)|0)+l|l&0|0),f|0|0|0}function nh(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0,y=0,x=0,E=0,w=0;return p=R,R=R+16|0,x=p|0,y=c>>31|((c|0)<0?-1:0)<<1,m=((c|0)<0?-1:0)>>31|((c|0)<0?-1:0)<<1,w=d>>31|((d|0)<0?-1:0)<<1,E=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,l=wr(y^l|0,m^c|0,y|0,m|0)|0,c=D()|0,fm(l,c,wr(w^f|0,E^d|0,w|0,E|0)|0,D()|0,x)|0,d=wr(u[x>>2]^y|0,u[x+4>>2]^m|0,y|0,m|0)|0,f=D()|0,R=p,Qe(f|0),d|0}function ma(l,c,f,d){l=l|0,c=c|0,f=f|0,d=d|0;var p=0,m=0;return m=R,R=R+16|0,p=m|0,fm(l,c,f,d,p)|0,R=m,Qe(u[p+4>>2]|0),u[p>>2]|0|0}function Yb(l,c,f){return l=l|0,c=c|0,f=f|0,(f|0)<32?(Qe(c>>f|0),l>>>f|(c&(1<<f)-1)<<32-f):(Qe(((c|0)<0?-1:0)|0),c>>f-32|0)}function Ae(l,c,f){return l=l|0,c=c|0,f=f|0,(f|0)<32?(Qe(c>>>f|0),l>>>f|(c&(1<<f)-1)<<32-f):(Qe(0),c>>>f-32|0)}function ge(l,c,f){return l=l|0,c=c|0,f=f|0,(f|0)<32?(Qe(c<<f|(l&(1<<f)-1<<32-f)>>>32-f|0),l<<f):(Qe(l<<f-32|0),0)}function Qb(l,c){return l=+l,c=+c,l!=l?+c:c!=c?+l:+nO(+l,+c)}function hm(l,c){return l=+l,c=+c,l!=l?+c:c!=c?+l:+qg(+l,+c)}function sh(l){return l=+l,l>=0?+cr(l+.5):+ha(l-.5)}function oh(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0;if((f|0)>=8192)return oO(l|0,c|0,f|0)|0,l|0;if(m=l|0,p=l+f|0,(l&3)==(c&3)){for(;l&3;){if(!f)return m|0;Be[l>>0]=Be[c>>0]|0,l=l+1|0,c=c+1|0,f=f-1|0}for(f=p&-4|0,d=f-64|0;(l|0)<=(d|0);)u[l>>2]=u[c>>2],u[l+4>>2]=u[c+4>>2],u[l+8>>2]=u[c+8>>2],u[l+12>>2]=u[c+12>>2],u[l+16>>2]=u[c+16>>2],u[l+20>>2]=u[c+20>>2],u[l+24>>2]=u[c+24>>2],u[l+28>>2]=u[c+28>>2],u[l+32>>2]=u[c+32>>2],u[l+36>>2]=u[c+36>>2],u[l+40>>2]=u[c+40>>2],u[l+44>>2]=u[c+44>>2],u[l+48>>2]=u[c+48>>2],u[l+52>>2]=u[c+52>>2],u[l+56>>2]=u[c+56>>2],u[l+60>>2]=u[c+60>>2],l=l+64|0,c=c+64|0;for(;(l|0)<(f|0);)u[l>>2]=u[c>>2],l=l+4|0,c=c+4|0}else for(f=p-4|0;(l|0)<(f|0);)Be[l>>0]=Be[c>>0]|0,Be[l+1>>0]=Be[c+1>>0]|0,Be[l+2>>0]=Be[c+2>>0]|0,Be[l+3>>0]=Be[c+3>>0]|0,l=l+4|0,c=c+4|0;for(;(l|0)<(p|0);)Be[l>>0]=Be[c>>0]|0,l=l+1|0,c=c+1|0;return m|0}function so(l,c,f){l=l|0,c=c|0,f=f|0;var d=0,p=0,m=0,y=0;if(m=l+f|0,c=c&255,(f|0)>=67){for(;l&3;)Be[l>>0]=c,l=l+1|0;for(d=m&-4|0,y=c|c<<8|c<<16|c<<24,p=d-64|0;(l|0)<=(p|0);)u[l>>2]=y,u[l+4>>2]=y,u[l+8>>2]=y,u[l+12>>2]=y,u[l+16>>2]=y,u[l+20>>2]=y,u[l+24>>2]=y,u[l+28>>2]=y,u[l+32>>2]=y,u[l+36>>2]=y,u[l+40>>2]=y,u[l+44>>2]=y,u[l+48>>2]=y,u[l+52>>2]=y,u[l+56>>2]=y,u[l+60>>2]=y,l=l+64|0;for(;(l|0)<(d|0);)u[l>>2]=y,l=l+4|0}for(;(l|0)<(m|0);)Be[l>>0]=c,l=l+1|0;return m-f|0}function qb(l){return l=+l,l>=0?+cr(l+.5):+ha(l-.5)}function us(l){l=l|0;var c=0,f=0,d=0;return d=sO()|0,f=u[jr>>2]|0,c=f+l|0,(l|0)>0&(c|0)<(f|0)|(c|0)<0?(cO(c|0)|0,Ab(12),-1):(c|0)>(d|0)&&!(aO(c|0)|0)?(Ab(12),-1):(u[jr>>2]=c,f|0)}return{___divdi3:no,___muldi3:Cr,___remdi3:nh,___uremdi3:ma,_areNeighborCells:FO,_bitshift64Ashr:Yb,_bitshift64Lshr:Ae,_bitshift64Shl:ge,_calloc:Zi,_cellAreaKm2:dF,_cellAreaM2:pF,_cellAreaRads2:um,_cellToBoundary:ll,_cellToCenterChild:qO,_cellToChildPos:nF,_cellToChildren:YO,_cellToChildrenSize:ih,_cellToLatLng:cl,_cellToLocalIj:TF,_cellToParent:sm,_cellToVertex:hi,_cellToVertexes:VF,_cellsToDirectedEdge:LO,_cellsToLinkedMultiPolygon:yO,_childPosToCell:sF,_compactCells:KO,_destroyLinkedMultiPolygon:Lb,_directedEdgeToBoundary:rh,_directedEdgeToCells:UO,_edgeLengthKm:mF,_edgeLengthM:_F,_edgeLengthRads:gF,_emscripten_replace_memory:lO,_free:De,_getBaseCellNumber:Pb,_getDirectedEdgeDestination:DO,_getDirectedEdgeOrigin:NO,_getHexagonAreaAvgKm2:AF,_getHexagonAreaAvgM2:uF,_getHexagonEdgeLengthAvgKm:fF,_getHexagonEdgeLengthAvgM:hF,_getIcosahedronFaces:Ib,_getNumCells:Am,_getPentagons:lm,_getRes0Cells:vO,_getResolution:XO,_greatCircleDistanceKm:ul,_greatCircleDistanceM:aF,_greatCircleDistanceRads:oF,_gridDisk:ub,_gridDiskDistances:fb,_gridDistance:vF,_gridPathCells:CF,_gridPathCellsSize:wF,_gridRingUnsafe:pO,_i64Add:Je,_i64Subtract:wr,_isPentagon:Ft,_isResClassIII:$O,_isValidCell:nm,_isValidDirectedEdge:kO,_isValidVertex:HF,_latLngToCell:Rb,_llvm_maxnum_f64:Qb,_llvm_minnum_f64:hm,_llvm_round_f64:sh,_localIjToCell:EF,_malloc:Ji,_maxFaceCount:rF,_maxGridDiskSize:dO,_maxPolygonToCellsSize:gO,_memcpy:oh,_memset:so,_originToDirectedEdges:VO,_pentagonCount:iF,_polygonToCells:mO,_readInt64AsDoubleFromPointer:NF,_res0CellCount:EO,_round:qb,_sbrk:us,_sizeOfCellBoundary:IF,_sizeOfCoordIJ:LF,_sizeOfGeoLoop:BF,_sizeOfGeoPolygon:OF,_sizeOfH3Index:PF,_sizeOfLatLng:RF,_sizeOfLinkedGeoPolygon:FF,_uncompactCells:JO,_uncompactCellsSize:ZO,_vertexToLatLng:zF,establishStackSpace:hO,stackAlloc:AO,stackRestore:fO,stackSave:uO}}(J8,Z8,ce),Mte=e.___divdi3=fe.___divdi3,Pte=e.___muldi3=fe.___muldi3,Rte=e.___remdi3=fe.___remdi3,Ite=e.___uremdi3=fe.___uremdi3,Bte=e._areNeighborCells=fe._areNeighborCells,Ote=e._bitshift64Ashr=fe._bitshift64Ashr,Fte=e._bitshift64Lshr=fe._bitshift64Lshr,Lte=e._bitshift64Shl=fe._bitshift64Shl,Nte=e._calloc=fe._calloc,Dte=e._cellAreaKm2=fe._cellAreaKm2,kte=e._cellAreaM2=fe._cellAreaM2,Ute=e._cellAreaRads2=fe._cellAreaRads2,Vte=e._cellToBoundary=fe._cellToBoundary,zte=e._cellToCenterChild=fe._cellToCenterChild,Hte=e._cellToChildPos=fe._cellToChildPos,Gte=e._cellToChildren=fe._cellToChildren,Wte=e._cellToChildrenSize=fe._cellToChildrenSize,jte=e._cellToLatLng=fe._cellToLatLng,Xte=e._cellToLocalIj=fe._cellToLocalIj,Yte=e._cellToParent=fe._cellToParent,Qte=e._cellToVertex=fe._cellToVertex,qte=e._cellToVertexes=fe._cellToVertexes,Kte=e._cellsToDirectedEdge=fe._cellsToDirectedEdge,Jte=e._cellsToLinkedMultiPolygon=fe._cellsToLinkedMultiPolygon,Zte=e._childPosToCell=fe._childPosToCell,$te=e._compactCells=fe._compactCells,ere=e._destroyLinkedMultiPolygon=fe._destroyLinkedMultiPolygon,tre=e._directedEdgeToBoundary=fe._directedEdgeToBoundary,rre=e._directedEdgeToCells=fe._directedEdgeToCells,ire=e._edgeLengthKm=fe._edgeLengthKm,nre=e._edgeLengthM=fe._edgeLengthM,sre=e._edgeLengthRads=fe._edgeLengthRads,$8=e._emscripten_replace_memory=fe._emscripten_replace_memory,ore=e._free=fe._free,are=e._getBaseCellNumber=fe._getBaseCellNumber,cre=e._getDirectedEdgeDestination=fe._getDirectedEdgeDestination,lre=e._getDirectedEdgeOrigin=fe._getDirectedEdgeOrigin,Are=e._getHexagonAreaAvgKm2=fe._getHexagonAreaAvgKm2,ure=e._getHexagonAreaAvgM2=fe._getHexagonAreaAvgM2,fre=e._getHexagonEdgeLengthAvgKm=fe._getHexagonEdgeLengthAvgKm,hre=e._getHexagonEdgeLengthAvgM=fe._getHexagonEdgeLengthAvgM,dre=e._getIcosahedronFaces=fe._getIcosahedronFaces,pre=e._getNumCells=fe._getNumCells,gre=e._getPentagons=fe._getPentagons,mre=e._getRes0Cells=fe._getRes0Cells,_re=e._getResolution=fe._getResolution,yre=e._greatCircleDistanceKm=fe._greatCircleDistanceKm,xre=e._greatCircleDistanceM=fe._greatCircleDistanceM,bre=e._greatCircleDistanceRads=fe._greatCircleDistanceRads,Tre=e._gridDisk=fe._gridDisk,Ere=e._gridDiskDistances=fe._gridDiskDistances,vre=e._gridDistance=fe._gridDistance,wre=e._gridPathCells=fe._gridPathCells,Cre=e._gridPathCellsSize=fe._gridPathCellsSize,Sre=e._gridRingUnsafe=fe._gridRingUnsafe,Mre=e._i64Add=fe._i64Add,Pre=e._i64Subtract=fe._i64Subtract,Rre=e._isPentagon=fe._isPentagon,Ire=e._isResClassIII=fe._isResClassIII,Bre=e._isValidCell=fe._isValidCell,Ore=e._isValidDirectedEdge=fe._isValidDirectedEdge,Fre=e._isValidVertex=fe._isValidVertex,Lre=e._latLngToCell=fe._latLngToCell,Nre=e._llvm_maxnum_f64=fe._llvm_maxnum_f64,Dre=e._llvm_minnum_f64=fe._llvm_minnum_f64,kre=e._llvm_round_f64=fe._llvm_round_f64,Ure=e._localIjToCell=fe._localIjToCell,Vre=e._malloc=fe._malloc,zre=e._maxFaceCount=fe._maxFaceCount,Hre=e._maxGridDiskSize=fe._maxGridDiskSize,Gre=e._maxPolygonToCellsSize=fe._maxPolygonToCellsSize,Wre=e._memcpy=fe._memcpy,jre=e._memset=fe._memset,Xre=e._originToDirectedEdges=fe._originToDirectedEdges,Yre=e._pentagonCount=fe._pentagonCount,Qre=e._polygonToCells=fe._polygonToCells,qre=e._readInt64AsDoubleFromPointer=fe._readInt64AsDoubleFromPointer,Kre=e._res0CellCount=fe._res0CellCount,Jre=e._round=fe._round,Zre=e._sbrk=fe._sbrk,$re=e._sizeOfCellBoundary=fe._sizeOfCellBoundary,eie=e._sizeOfCoordIJ=fe._sizeOfCoordIJ,tie=e._sizeOfGeoLoop=fe._sizeOfGeoLoop,rie=e._sizeOfGeoPolygon=fe._sizeOfGeoPolygon,iie=e._sizeOfH3Index=fe._sizeOfH3Index,nie=e._sizeOfLatLng=fe._sizeOfLatLng,sie=e._sizeOfLinkedGeoPolygon=fe._sizeOfLinkedGeoPolygon,oie=e._uncompactCells=fe._uncompactCells,aie=e._uncompactCellsSize=fe._uncompactCellsSize,cie=e._vertexToLatLng=fe._vertexToLatLng,lie=e.establishStackSpace=fe.establishStackSpace,ob=e.stackAlloc=fe.stackAlloc,eO=e.stackRestore=fe.stackRestore,tO=e.stackSave=fe.stackSave;if(e.asm=fe,e.cwrap=k,e.setValue=v,e.getValue=C,we){Zt(we)||(we=o(we));{Jf("memory initializer");var Xg=function(Z){Z.byteLength&&(Z=new Uint8Array(Z)),Re.set(Z,T),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,Te("memory initializer")},ab=function(){a(we,Xg,function(){throw"could not load memory initializer "+we})},cb=jg(we);if(cb)Xg(cb.buffer);else if(e.memoryInitializerRequest){var lb=function(){var Z=e.memoryInitializerRequest,ae=Z.response;if(Z.status!==200&&Z.status!==0){var _e=jg(e.memoryInitializerRequestURL);if(_e)ae=_e.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+Z.status+", retrying "+we),ab();return}}Xg(ae)};e.memoryInitializerRequest.response?setTimeout(lb,0):e.memoryInitializerRequest.addEventListener("load",lb)}else ab()}}var Zf;In=function Z(){Zf||Yg(),Zf||(In=Z)};function Yg(Z){if(Z=Z||n,Rn>0||(os(),Rn>0))return;function ae(){Zf||(Zf=!0,!S&&(Qf(),Vg(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),fa()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),ae()},1)):ae()}e.run=Yg;function Zs(Z){throw e.onAbort&&e.onAbort(Z),Z+="",A(Z),h(Z),S=!0,"abort("+Z+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Zs,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Yg(),t}(typeof ft=="object"?ft:{}),Xe="number",Le=Xe,xf=Xe,Ue=Xe,Ve=Xe,Br=Xe,Me=Xe,AQ=[["sizeOfH3Index",Xe],["sizeOfLatLng",Xe],["sizeOfCellBoundary",Xe],["sizeOfGeoLoop",Xe],["sizeOfGeoPolygon",Xe],["sizeOfLinkedGeoPolygon",Xe],["sizeOfCoordIJ",Xe],["readInt64AsDoubleFromPointer",Xe],["isValidCell",xf,[Ue,Ve]],["latLngToCell",Le,[Xe,Xe,Br,Me]],["cellToLatLng",Le,[Ue,Ve,Me]],["cellToBoundary",Le,[Ue,Ve,Me]],["maxGridDiskSize",Le,[Xe,Me]],["gridDisk",Le,[Ue,Ve,Xe,Me]],["gridDiskDistances",Le,[Ue,Ve,Xe,Me,Me]],["gridRingUnsafe",Le,[Ue,Ve,Xe,Me]],["maxPolygonToCellsSize",Le,[Me,Br,Xe,Me]],["polygonToCells",Le,[Me,Br,Xe,Me]],["cellsToLinkedMultiPolygon",Le,[Me,Xe,Me]],["destroyLinkedMultiPolygon",null,[Me]],["compactCells",Le,[Me,Me,Xe,Xe]],["uncompactCells",Le,[Me,Xe,Xe,Me,Xe,Br]],["uncompactCellsSize",Le,[Me,Xe,Xe,Br,Me]],["isPentagon",xf,[Ue,Ve]],["isResClassIII",xf,[Ue,Ve]],["getBaseCellNumber",Xe,[Ue,Ve]],["getResolution",Xe,[Ue,Ve]],["maxFaceCount",Le,[Ue,Ve,Me]],["getIcosahedronFaces",Le,[Ue,Ve,Me]],["cellToParent",Le,[Ue,Ve,Br,Me]],["cellToChildren",Le,[Ue,Ve,Br,Me]],["cellToCenterChild",Le,[Ue,Ve,Br,Me]],["cellToChildrenSize",Le,[Ue,Ve,Br,Me]],["cellToChildPos",Le,[Ue,Ve,Br,Me]],["childPosToCell",Le,[Xe,Xe,Ue,Ve,Br,Me]],["areNeighborCells",Le,[Ue,Ve,Ue,Ve,Me]],["cellsToDirectedEdge",Le,[Ue,Ve,Ue,Ve,Me]],["getDirectedEdgeOrigin",Le,[Ue,Ve,Me]],["getDirectedEdgeDestination",Le,[Ue,Ve,Me]],["isValidDirectedEdge",xf,[Ue,Ve]],["directedEdgeToCells",Le,[Ue,Ve,Me]],["originToDirectedEdges",Le,[Ue,Ve,Me]],["directedEdgeToBoundary",Le,[Ue,Ve,Me]],["gridDistance",Le,[Ue,Ve,Ue,Ve,Me]],["gridPathCells",Le,[Ue,Ve,Ue,Ve,Me]],["gridPathCellsSize",Le,[Ue,Ve,Ue,Ve,Me]],["cellToLocalIj",Le,[Ue,Ve,Ue,Ve,Xe,Me]],["localIjToCell",Le,[Ue,Ve,Me,Xe,Me]],["getHexagonAreaAvgM2",Le,[Br,Me]],["getHexagonAreaAvgKm2",Le,[Br,Me]],["getHexagonEdgeLengthAvgM",Le,[Br,Me]],["getHexagonEdgeLengthAvgKm",Le,[Br,Me]],["greatCircleDistanceM",Xe,[Me,Me]],["greatCircleDistanceKm",Xe,[Me,Me]],["greatCircleDistanceRads",Xe,[Me,Me]],["cellAreaM2",Le,[Ue,Ve,Me]],["cellAreaKm2",Le,[Ue,Ve,Me]],["cellAreaRads2",Le,[Ue,Ve,Me]],["edgeLengthM",Le,[Ue,Ve,Me]],["edgeLengthKm",Le,[Ue,Ve,Me]],["edgeLengthRads",Le,[Ue,Ve,Me]],["getNumCells",Le,[Br,Me]],["getRes0Cells",Le,[Me]],["res0CellCount",Xe],["getPentagons",Le,[Xe,Me]],["pentagonCount",Xe],["cellToVertex",Le,[Ue,Ve,Xe,Me]],["cellToVertexes",Le,[Ue,Ve,Me]],["vertexToLatLng",Le,[Ue,Ve,Me]],["isValidVertex",xf,[Ue,Ve]]],uQ=0,fQ=1,hQ=2,dQ=3,sI=4,pQ=5,gQ=6,mQ=7,_Q=8,yQ=9,xQ=10,bQ=11,TQ=12,EQ=13,vQ=14,wQ=15,Er={};Er[uQ]="Success";Er[fQ]="The operation failed but a more specific error is not available";Er[hQ]="Argument was outside of acceptable range";Er[dQ]="Latitude or longitude arguments were outside of acceptable range";Er[sI]="Resolution argument was outside of acceptable range";Er[pQ]="Cell argument was not valid";Er[gQ]="Directed edge argument was not valid";Er[mQ]="Undirected edge argument was not valid";Er[_Q]="Vertex argument was not valid";Er[yQ]="Pentagon distortion was encountered";Er[xQ]="Duplicate input";Er[bQ]="Cell arguments were not neighbors";Er[TQ]="Cell arguments had incompatible resolutions";Er[EQ]="Memory allocation failed";Er[vQ]="Bounds of provided memory were insufficient";Er[wQ]="Mode or flags argument was not valid";var oI=1e3,CQ=1001,aI=1002,Op={};Op[oI]="Unknown unit";Op[CQ]="Array length out of bounds";Op[aI]="Got unexpected null value for H3 index";var SQ="Unknown error";function cI(t,e,r){var i=r&&"value"in r,n=new Error((t[e]||SQ)+" (code: "+e+(i?", value: "+r.value:"")+")");return n.code=e,n}function lI(t,e){var r=arguments.length===2?{value:e}:{};return cI(Er,t,r)}function AI(t,e){var r=arguments.length===2?{value:e}:{};return cI(Op,t,r)}function Zo(t){if(t!==0)throw lI(t)}var rr={};AQ.forEach(function(e){rr[e[0]]=ft.cwrap.apply(ft,e)});var Bc=16;var uI=4,rI=4,js=8,MQ=8,Ip=rr.sizeOfH3Index(),fI=rr.sizeOfLatLng(),PQ=rr.sizeOfCellBoundary(),OIe=rr.sizeOfGeoPolygon(),FIe=rr.sizeOfGeoLoop(),RQ=rr.sizeOfLinkedGeoPolygon(),LIe=rr.sizeOfCoordIJ(),iI={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function IQ(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw lI(sI,t);return t}function BQ(t){if(!t)throw AI(aI);return t}var NIe=Math.pow(2,32)-1;var OQ=/[^0-9a-fA-F]/;function $o(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||OQ.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),Bc),r=parseInt(t.substring(t.length-8),Bc);return[r,e]}function nI(t){if(t>=0)return t.toString(Bc);t=t&2147483647;var e=hI(8,t.toString(Bc)),r=(parseInt(e[0],Bc)+8).toString(Bc);return e=r+e.substring(1),e}function FQ(t,e){return nI(e)+hI(8,nI(t))}function hI(t,e){for(var r=t-e.length,i="",n=0;n<r;n++)i+="0";return i=i+e,i}var DIe=Math.pow(2,32);function LQ(t,e){e===void 0&&(e=0);var r=ft.getValue(t+Ip*e,"i32"),i=ft.getValue(t+Ip*e+uI,"i32");return i?FQ(r,i):null}function NQ(t,e){return e===void 0&&(e=0),ft.getValue(t+js*e,"double")}function DQ(t){return rr.readInt64AsDoubleFromPointer(t)}function kQ(t,e,r){ft.HEAPU32.set($o(t),e/uI+2*r)}function UQ(t,e){for(var r=e.length,i=0;i<r;i++)kQ(e[i],t,i)}function Bp(t){return GQ(ft.getValue(t,"double"))}function l3(t){return[Bp(t),Bp(t+js)]}function dI(t){return[Bp(t+js),Bp(t)]}function VQ(t,e,r){for(var i=ft.getValue(t,"i32"),n=t+js,s=[],o=e?dI:l3,a=0;a<i*2;a+=2)s.push(o(n+js*a));return r&&s.push(s[0]),s}function zQ(t,e){for(var r=[],i=e?dI:l3,n,s,o,a;t;){for(r.push(n=[]),s=ft.getValue(t,"i8*");s;){for(n.push(o=[]),a=ft.getValue(s,"i8*");a;)o.push(i(a)),a=ft.getValue(a+js*2,"i8*");e&&o.push(o[0]),s=ft.getValue(s+rI*2,"i8*")}t=ft.getValue(t+rI*2,"i8*")}return r}function pI(t){var e=$o(t),r=e[0],i=e[1];return!!rr.isPentagon(r,i)}function gI(t){var e=$o(t),r=e[0],i=e[1];return rr.isValidCell(r,i)?rr.getResolution(r,i):-1}function mI(t,e,r){var i=ft._malloc(fI);ft.HEAPF64.set([t,e].map(HQ),i/js);var n=ft._malloc(Ip);try{return Zo(rr.latLngToCell(i,r,n)),BQ(LQ(n))}finally{ft._free(n),ft._free(i)}}function bf(t){var e=ft._malloc(fI),r=$o(t),i=r[0],n=r[1];try{return Zo(rr.cellToLatLng(i,n,e)),l3(e)}finally{ft._free(e)}}function _I(t,e){var r=ft._malloc(PQ),i=$o(t),n=i[0],s=i[1];try{return Zo(rr.cellToBoundary(n,s,r)),VQ(r,e,e)}finally{ft._free(r)}}function yI(t,e){if(!t||!t.length)return[];var r=t.length,i=ft._calloc(r,Ip);UQ(i,t);var n=ft._calloc(RQ);try{return Zo(rr.cellsToLinkedMultiPolygon(i,r,n)),zQ(n,e)}finally{rr.destroyLinkedMultiPolygon(n),ft._free(n),ft._free(i)}}function xI(t,e){var r=$o(t),i=r[0],n=r[1],s=$o(e),o=s[0],a=s[1],A=ft._malloc(MQ);try{return Zo(rr.gridDistance(i,n,o,a,A)),DQ(A)}finally{ft._free(A)}}function bI(t,e){IQ(t);var r=ft._malloc(js);try{switch(e){case iI.m:Zo(rr.getHexagonEdgeLengthAvgM(t,r));break;case iI.km:Zo(rr.getHexagonEdgeLengthAvgKm(t,r));break;default:throw AI(oI,e)}return NQ(r)}finally{ft._free(r)}}function HQ(t){return t*Math.PI/180}function GQ(t){return t*180/Math.PI}function Fp(t,e){e=e===void 0?t[0][0]:e;for(let r of t){let i=r[0]-e;i>180?r[0]-=360:i<-180&&(r[0]+=360)}}function WQ(t,e,r){let[i,n]=bf(t),s=e.length;Fp(e,n);let o=e[0]===e[s-1]?s-1:s;for(let a=0;a<o;a++)e[a][0]=br(n,e[a][0],r),e[a][1]=br(i,e[a][1],r)}function TI(t,e,r){let i=t(e,r),[n,s]=bf(i);return[s,n]}function A3(t,e=1){let r=_I(t,!0);return e!==1?WQ(t,r,e):Fp(r),r}function EI(t){let e=new Float64Array(t.length*2),r=0;for(let i of t)e[r++]=i[0],e[r++]=i[1];return e}var jQ=10;function XQ(t,e){let r;return t==null?r=e:typeof t=="object"?r={...t,coverage:e}:r={getHexagon:t,coverage:e},r}var YQ={...Us.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0},Oc=class t extends zt{initializeState(){t._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:r}){if(e.highPrecision!==!0&&(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagon)){let i=this._calculateH3DataProps();this.setState(i)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,r=!1,i=!1,{iterable:n,objectInfo:s}=Yt(this.props.data);for(let o of n){s.index++;let a=this.props.getHexagon(o,s),A=gI(a);if(e<0){if(e=A,!this.props.highPrecision)break}else if(e!==A){i=!0;break}if(pI(a)){r=!0;break}}return{resolution:e,edgeLengthKM:e>=0?bI(e,"km"):0,hasMultipleRes:i,hasPentagon:r}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){let{resolution:e,hasPentagon:r,hasMultipleRes:i}=this.state,{viewport:n}=this.context;return!!n?.resolution||i||r||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;let{resolution:r,edgeLengthKM:i,centerHex:n}=this.state;if(r<0)return;let s=this.props.centerHexagon||mI(e.latitude,e.longitude,r);if(n===s)return;if(n)try{if(xI(n,s)*i<jQ)return}catch{}let{unitsPerMeter:o}=e.distanceScales,a=A3(s),[A,h]=bf(s),[g,_]=e.projectFlat([h,A]);a=a.map(b=>{let T=e.projectFlat(b);return[(T[0]-g)/o[0],(T[1]-_)/o[1]]}),this.setState({centerHex:s,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){let{elevationScale:e,material:r,coverage:i,extruded:n,wireframe:s,stroked:o,filled:a,lineWidthUnits:A,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:_,getFillColor:b,getElevation:T,getLineColor:v,getLineWidth:C,transitions:S,updateTriggers:P}=this.props;return{elevationScale:e,extruded:n,coverage:i,wireframe:s,stroked:o,filled:a,lineWidthUnits:A,lineWidthScale:h,lineWidthMinPixels:g,lineWidthMaxPixels:_,material:r,getElevation:T,getFillColor:b,getLineColor:v,getLineWidth:C,transitions:S,updateTriggers:{getFillColor:P.getFillColor,getElevation:P.getElevation,getLineColor:P.getLineColor,getLineWidth:P.getLineWidth}}}_renderPolygonLayer(){let{data:e,getHexagon:r,updateTriggers:i,coverage:n}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",Us),o=this._getForwardProps();return o.updateTriggers.getPolygon=XQ(i.getHexagon,n),new s(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(a,A)=>{let h=r(a,A);return EI(A3(h,n))}})}_renderColumnLayer(){let{data:e,getHexagon:r,updateTriggers:i}=this.props,n=this.getSubLayerClass("hexagon-cell",bn),s=this._getForwardProps();return s.updateTriggers.getPosition=i.getHexagon,new n(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:TI.bind(null,r)})}};Oc.defaultProps=YQ;Oc.layerName="H3HexagonLayer";Oc._checkH3Lib=()=>{};var Lp=Oc;var QQ={getHexagons:{type:"accessor",value:t=>t.hexagons}},Tf=class extends vn{initializeState(){Lp._checkH3Lib()}updateState({props:e,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagons){let{data:i,getHexagons:n}=e,s=[],{iterable:o,objectInfo:a}=Yt(i);for(let A of o){a.index++;let h=n(A,a),g=yI(h,!0);for(let _ of g){for(let b of _)Fp(b);s.push(this.getSubLayerRow({polygon:_},A,a.index))}}this.setState({polygons:s})}}indexToBounds(){let{getElevation:e,getFillColor:r,getLineColor:i,getLineWidth:n}=this.props;return{data:this.state.polygons,getPolygon:s=>s.polygon,getElevation:this.getSubLayerAccessor(e),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(i),getLineWidth:this.getSubLayerAccessor(n)}}};Tf.layerName="H3ClusterLayer";Tf.defaultProps=QQ;var vI=Tf;var u3=Math.PI/180,Np=new Float32Array(16),wI=new Float32Array(12);function CI(t,e,r){let i=e[0]*u3,n=e[1]*u3,s=e[2]*u3,o=Math.sin(s),a=Math.sin(i),A=Math.sin(n),h=Math.cos(s),g=Math.cos(i),_=Math.cos(n),b=r[0],T=r[1],v=r[2];t[0]=b*_*g,t[1]=b*A*g,t[2]=b*-a,t[3]=T*(-A*h+_*a*o),t[4]=T*(_*h+A*a*o),t[5]=T*g*o,t[6]=v*(A*o+_*a*h),t[7]=v*(-_*o+A*a*h),t[8]=v*g*h}function SI(t){return t[0]=t[0],t[1]=t[1],t[2]=t[2],t[3]=t[4],t[4]=t[5],t[5]=t[6],t[6]=t[8],t[7]=t[9],t[8]=t[10],t[9]=t[12],t[10]=t[13],t[11]=t[14],t.subarray(0,12)}var Dp={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(t,{startRow:e,endRow:r}){let{data:i,getOrientation:n,getScale:s,getTranslation:o,getTransformMatrix:a}=this.props,A=Array.isArray(a),h=A&&a.length===16,g=Array.isArray(s),_=Array.isArray(n),b=Array.isArray(o),T=h||!A&&!!a(i[0]);T?t.constant=h:t.constant=_&&g&&b;let v=t.value;if(t.constant){let C;T?(Np.set(a),C=SI(Np)):(C=wI,CI(C,n,s),C.set(o,9)),t.value=new Float32Array(C)}else{let C=e*t.size,{iterable:S,objectInfo:P}=Yt(i,e,r);for(let F of S){P.index++;let I;if(T)Np.set(h?a:a(F,P)),I=SI(Np);else{I=wI;let k=_?n:n(F,P),W=g?s:s(F,P);CI(I,k,W),I.set(b?o:o(F,P),9)}v[C++]=I[0],v[C++]=I[1],v[C++]=I[2],v[C++]=I[3],v[C++]=I[4],v[C++]=I[5],v[C++]=I[6],v[C++]=I[7],v[C++]=I[8],v[C++]=I[9],v[C++]=I[10],v[C++]=I[11]}}}};function kp(t,e){return e===Se.CARTESIAN||e===Se.METER_OFFSETS||e===Se.DEFAULT&&!t.isGeospatial}var MI=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,PI={name:"simpleMesh",vs:MI,fs:MI,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}};var RI=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var II=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function f3(t){let e=t.positions||t.POSITION;me.assert(e,'no "postions" or "POSITION" attribute in mesh');let r=e.value.length/e.size,i=t.COLOR_0||t.colors;i||(i={size:3,value:new Float32Array(r*3).fill(1)});let n=t.NORMAL||t.normals;n||(n={size:3,value:new Float32Array(r*3).fill(0)});let s=t.TEXCOORD_0||t.texCoords;return s||(s={size:2,value:new Float32Array(r*2).fill(0)}),{positions:e,colors:i,normals:n,texCoords:s}}function BI(t){return t instanceof ut?(t.attributes=f3(t.attributes),t):t.attributes?new ut({...t,topology:"triangle-list",attributes:f3(t.attributes)}):new ut({topology:"triangle-list",attributes:f3(t)})}var qQ=[0,0,0,255],KQ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:qQ},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},Ef=class extends xt{getShaders(){return super.getShaders({vs:RI,fs:II,modules:[et,Da,Pt,PI]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;let{mesh:r}=this.props;if(!r)return null;if(e=r.header?.boundingBox,!e){let{attributes:i}=BI(r);i.POSITION=i.POSITION||i.positions,e=Nn(i)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Dp}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);let{props:r,oldProps:i,changeFlags:n}=e;if(r.mesh!==i.mesh||n.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);let s=r.mesh.attributes||r.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==i.texture&&r.texture instanceof _t&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){let{model:r}=this.state;if(!r)return;let{viewport:i,renderPass:n}=this.context,{sizeScale:s,coordinateSystem:o,_instanced:a}=this.props,A={sizeScale:s,composeModelMatrix:!a||kp(i,o),flatShading:!this.state.hasNormals};r.shaderInputs.setProps({simpleMesh:A}),r.draw(n)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){let r=new je(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:BI(e),isInstanced:!0}),{texture:i}=this.props,{emptyTexture:n}=this.state,s={sampler:i||n,hasTexture:!!i};return r.shaderInputs.setProps({simpleMesh:s}),r}setTexture(e){let{emptyTexture:r,model:i}=this.state;if(i){let n={sampler:e||r,hasTexture:!!e};i.shaderInputs.setProps({simpleMesh:n})}}};Ef.defaultProps=KQ;Ef.layerName="SimpleMeshLayer";var Fc=Ef;var Wi;(function(t){t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.LINEAR=9729]="LINEAR",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Wi||(Wi={}));function wf(t,e,r,i){let n={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};n.defines.USE_TEX_LOD=1;let{imageBasedLightingEnvironment:s}=i;return s&&(n.bindings.pbr_diffuseEnvSampler=s.diffuseEnvSampler.texture,n.bindings.pbr_specularEnvSampler=s.specularEnvSampler.texture,n.bindings.pbr_BrdfLUT=s.brdfLutTexture.texture,n.uniforms.scaleIBLAmbient=[1,1]),i?.pbrDebug&&(n.defines.PBR_DEBUG=1,n.uniforms.scaleDiffBaseMR=[0,0,0,0],n.uniforms.scaleFGDSpec=[0,0,0,0]),r.NORMAL&&(n.defines.HAS_NORMALS=1),r.TANGENT&&i?.useTangents&&(n.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(n.defines.HAS_UV=1),i?.imageBasedLightingEnvironment&&(n.defines.USE_IBL=1),i?.lights&&(n.defines.USE_LIGHTS=1),e&&JQ(t,e,n),n}function JQ(t,e,r){if(r.uniforms.unlit=!!e.unlit,e.pbrMetallicRoughness&&ZQ(t,e.pbrMetallicRoughness,r),e.normalTexture){vf(t,e.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",r);let{scale:i=1}=e.normalTexture;r.uniforms.normalScale=i}if(e.occlusionTexture){vf(t,e.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",r);let{strength:i=1}=e.occlusionTexture;r.uniforms.occlusionStrength=i}switch(e.emissiveTexture&&(vf(t,e.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.emissiveFactor=e.emissiveFactor||[0,0,0]),e.alphaMode){case"MASK":let{alphaCutoff:i=.5}=e;r.defines.ALPHA_CUTOFF=1,r.uniforms.alphaCutoff=i;break;case"BLEND":oe.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=Wi.FUNC_ADD,r.glParameters.blendFunc=[Wi.SRC_ALPHA,Wi.ONE_MINUS_SRC_ALPHA,Wi.ONE,Wi.ONE_MINUS_SRC_ALPHA];break}}function ZQ(t,e,r){e.baseColorTexture&&vf(t,e.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.baseColorFactor=e.baseColorFactor||[1,1,1,1],e.metallicRoughnessTexture&&vf(t,e.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);let{metallicFactor:i=1,roughnessFactor:n=1}=e;r.uniforms.metallicRoughnessValues=[i,n]}function vf(t,e,r,i=null,n){let s=e?.texture?.sampler?.parameters||{},o=e.texture.source.image,a,A={};o.compressed?(a=o,A={[Wi.TEXTURE_MIN_FILTER]:o.data.length>1?Wi.LINEAR_MIPMAP_NEAREST:Wi.LINEAR}):a={data:o};let h=t.createTexture({id:e.uniformName||e.id,parameters:{...s,...A},pixelStore:{[Wi.UNPACK_FLIP_Y_WEBGL]:!1},...a});n.bindings[r]=h,i&&(n.defines[i]=1),n.generatedTextures.push(h)}var OI="4.3.2";var Up={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"},FI;async function d3(t){ym(t.modules);let e=xm("basis");return e||(FI||=$Q(t),await FI)}async function $Q(t){let e=null,r=null;return[e,r]=await Promise.all([await tn(Up.TRANSCODER,"textures",t),await tn(Up.TRANSCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await eq(e,r)}function eq(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{let{BasisFile:s,initializeBasis:o}=n;o(),i({BasisFile:s})})})}var h3;async function p3(t){let e=t.modules||{};return e.basisEncoder?e.basisEncoder:(h3=h3||tq(t),await h3)}async function tq(t){let e=null,r=null;return[e,r]=await Promise.all([await tn(Up.ENCODER,"textures",t),await tn(Up.ENCODER_WASM,"textures",t)]),e=e||globalThis.BASIS,await rq(e,r)}function rq(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t(r).then(n=>{let{BasisFile:s,KTX2File:o,initializeBasis:a,BasisEncoder:A}=n;a(),i({BasisFile:s,KTX2File:o,BasisEncoder:A})})})}var ea={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};var iq=["","WEBKIT_","MOZ_"],LI={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},Vp=null;function NI(t){if(!Vp){t=t||nq()||void 0,Vp=new Set;for(let e of iq)for(let r in LI)if(t&&t.getExtension(`${e}${r}`)){let i=LI[r];Vp.add(i)}}return Vp}function nq(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var Ai=[171,75,84,88,32,50,48,187,13,10,26,10];function DI(t){let e=new Uint8Array(t);return!(e.byteLength<Ai.length||e[0]!==Ai[0]||e[1]!==Ai[1]||e[2]!==Ai[2]||e[3]!==Ai[3]||e[4]!==Ai[4]||e[5]!==Ai[5]||e[6]!==Ai[6]||e[7]!==Ai[7]||e[8]!==Ai[8]||e[9]!==Ai[9]||e[10]!==Ai[10]||e[11]!==Ai[11])}var sq={etc1:{basisFormat:0,compressed:!0,format:ea.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:ea.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:ea.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:ea.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:ea.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:ea.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function UI(t,e){if(e.basis.containerFormat==="auto"){if(DI(t)){let i=await p3(e);return kI(i.KTX2File,t,e)}let{BasisFile:r}=await d3(e);return g3(r,t,e)}switch(e.basis.module){case"encoder":let r=await p3(e);switch(e.basis.containerFormat){case"ktx2":return kI(r.KTX2File,t,e);case"basis":default:return g3(r.BasisFile,t,e)}case"transcoder":default:let{BasisFile:i}=await d3(e);return g3(i,t,e)}}function g3(t,e,r){let i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");let n=i.getNumImages(),s=[];for(let o=0;o<n;o++){let a=i.getNumLevels(o),A=[];for(let h=0;h<a;h++)A.push(oq(i,o,h,r));s.push(A)}return s}finally{i.close(),i.delete()}}function oq(t,e,r,i){let n=t.getImageWidth(e,r),s=t.getImageHeight(e,r),o=t.getHasAlpha(),{compressed:a,format:A,basisFormat:h}=VI(i,o),g=t.getImageTranscodedSizeInBytes(e,r,h),_=new Uint8Array(g);if(!t.transcodeImage(_,e,r,h,0,0))throw new Error("failed to start Basis transcoding");return{width:n,height:s,data:_,compressed:a,format:A,hasAlpha:o}}function kI(t,e,r){let i=new t(new Uint8Array(e));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");let n=i.getLevels(),s=[];for(let o=0;o<n;o++)s.push(aq(i,o,r));return[s]}finally{i.close(),i.delete()}}function aq(t,e,r){let{alphaFlag:i,height:n,width:s}=t.getImageLevelInfo(e,0,0),{compressed:o,format:a,basisFormat:A}=VI(r,i),h=t.getImageTranscodedSizeInBytes(e,0,0,A),g=new Uint8Array(h);if(!t.transcodeImage(g,e,0,0,A,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:s,height:n,data:g,compressed:o,levelSize:h,hasAlpha:i,format:a}}function VI(t,e){let r=t&&t.basis&&t.basis.format;return r==="auto"&&(r=zp()),typeof r=="object"&&(r=e?r.alpha:r.noAlpha),r=r.toLowerCase(),sq[r]}function zp(){let t=NI();return t.has("astc")?"astc-4x4":t.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:t.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:t.has("etc1")?"etc1":t.has("etc2")?"etc2":"rgb565"}var zI={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:OI,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},m3={...zI,parse:UI};var cq={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lq={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},y3=class{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;let i=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:n,target:s,path:o})=>{pq(i,n,s,o),uq(s,s._node)})}},Hp=class{animations;constructor(e){this.animations=e.animations.map((r,i)=>{let n=r.name||`Animation-${i}`,s=r.samplers.map(({input:a,interpolation:A="LINEAR",output:h})=>({input:HI(e.accessors[a]),interpolation:A,output:HI(e.accessors[h])})),o=r.channels.map(({sampler:a,target:A})=>({sampler:s[a],target:e.nodes[A.node],path:A.path}));return new y3({name:n,channels:o})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(r=>r.animate(e))}getAnimations(){return this.animations}};function HI(t){if(!t._animation){let e=lq[t.componentType],r=cq[t.type],i=r*t.count,{buffer:n,byteOffset:s}=t.bufferView.data,o=new e(n,s+(t.byteOffset||0),i);if(r===1)t._animation=Array.from(o);else{let a=[];for(let A=0;A<o.length;A+=r)a.push(Array.from(o.slice(A,A+r)));t._animation=a}}return t._animation}var Aq=new Ce;function uq(t,e){if(e.matrix.identity(),t.translation&&e.matrix.translate(t.translation),t.rotation){let r=Aq.fromQuaternion(t.rotation);e.matrix.multiplyRight(r)}t.scale&&e.matrix.scale(t.scale)}var _3=new yi;function fq(t,e,r,i,n){if(e==="rotation"){_3.slerp({start:r,target:i,ratio:n});for(let s=0;s<_3.length;s++)t[e][s]=_3[s]}else for(let s=0;s<r.length;s++)t[e][s]=n*i[s]+(1-n)*r[s]}function hq(t,e,{p0:r,outTangent0:i,inTangent1:n,p1:s,tDiff:o,ratio:a}){for(let A=0;A<t[e].length;A++){let h=i[A]*o,g=n[A]*o;t[e][A]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*r[A]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*h+(-2*Math.pow(a,3)+3*Math.pow(a,2))*s[A]+(Math.pow(a,3)-Math.pow(a,2))*g}}function dq(t,e,r){for(let i=0;i<r.length;i++)t[e][i]=r[i]}function pq(t,{input:e,interpolation:r,output:i},n,s){let o=e[e.length-1],a=t%o,A=e.findIndex(b=>b>=a),h=Math.max(0,A-1);if(!Array.isArray(n[s]))switch(s){case"translation":n[s]=[0,0,0];break;case"rotation":n[s]=[0,0,0,1];break;case"scale":n[s]=[1,1,1];break;default:oe.warn(`Bad animation path ${s}`)()}let g=e[h],_=e[A];switch(r){case"STEP":dq(n,s,i[h]);break;case"LINEAR":if(_>g){let b=(a-g)/(_-g);fq(n,s,i[h],i[A],b)}break;case"CUBICSPLINE":if(_>g){let b=(a-g)/(_-g),T=_-g,v=i[3*h+1],C=i[3*h+2],S=i[3*A+0],P=i[3*A+1];hq(n,s,{p0:v,outTangent0:C,inTangent1:S,p1:P,tDiff:T,ratio:b})}break;default:oe.warn(`Interpolation ${r} not supported`)();break}}var gq=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,mq=`#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,_q=`#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;function GI(t,e){let{id:r,geometry:i,material:n,vertexCount:s,materialOptions:o,modelOptions:a}=e,A=wf(t,n,i.attributes,o);oe.info(4,"createGLTFModel defines: ",A.defines)();let h=[],g={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},_={id:r,source:gq,vs:mq,fs:_q,geometry:i,topology:i.topology,vertexCount:s,modules:[wo],...a,defines:{...A.defines,...a.defines},parameters:{...g,...A.parameters,...a.parameters}},b=new je(t,_),{camera:T,...v}={...A.uniforms,...a.uniforms,...A.bindings,...a.bindings};return b.shaderInputs.setProps({pbrMaterial:v,pbrProjection:{camera:T}}),new Ss({managedResources:h,model:b})}var ta;(function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(ta||(ta={}));function WI(t){switch(t){case ta.POINTS:return"point-list";case ta.LINES:return"line-list";case ta.LINE_STRIP:return"line-strip";case ta.TRIANGLES:return"triangle-list";case ta.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(t))}}var yq={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},Gp=class{device;options;gltf;constructor(e,r={}){this.device=e,this.options={...yq,...r}}instantiate(e){return this.gltf=x3(e),(this.gltf.scenes||[]).map(i=>this.createScene(i))}createAnimator(){return Array.isArray(this.gltf.animations)?new Hp(this.gltf):null}createScene(e){let i=(e.nodes||[]).map(s=>this.createNode(s));return new jn({id:e.name||e.id,children:i})}createNode(e){if(!e._node){let n=(e.children||[]).map(o=>this.createNode(o));e.mesh&&n.push(this.createMesh(e.mesh));let s=new jn({id:e.name||e.id,children:n});if(e.matrix)s.setMatrix(e.matrix);else{if(s.matrix.identity(),e.translation&&s.matrix.translate(e.translation),e.rotation){let o=new Ce().fromQuaternion(e.rotation);s.matrix.multiplyRight(o)}e.scale&&s.matrix.scale(e.scale)}e._node=s}let r=this.gltf.nodes.find(i=>i.id===e.id);return r._node=e._node,e._node}createMesh(e){if(!e._mesh){let i=(e.primitives||[]).map((s,o)=>this.createPrimitive(s,o,e)),n=new jn({id:e.name||e.id,children:i});e._mesh=n}return e._mesh}createPrimitive(e,r,i){let n=e.name||`${i.name||i.id}-primitive-${r}`,s=WI(e.mode||4),o=e.indices?e.indices.count:this.getVertexCount(e.attributes),a=GI(this.device,{id:n,geometry:this.createGeometry(n,e,s),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return a.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],a}getVertexCount(e){throw new Error("getVertexCount not implemented")}createGeometry(e,r,i){let n={};for(let[s,o]of Object.entries(r.attributes)){let{components:a,size:A,value:h}=o;n[s]={size:A??a,value:h}}return new ut({id:e,topology:i,indices:r.indices.value,attributes:n})}createBuffer(e,r){e.bufferView||(e.bufferView={});let{bufferView:i}=e;return i.lumaBuffers||(i.lumaBuffers={}),i.lumaBuffers[r]||(i.lumaBuffers[r]=this.device.createBuffer({id:`from-${i.id}`,data:i.data||e.value})),i.lumaBuffers[r]}createSampler(e){return e}needsPOT(){return!1}};function x3(t){if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof ImageBitmap)return t;if(Array.isArray(t))return t.map(x3);if(t&&typeof t=="object"){let e={};for(let r in t)e[r]=x3(t[r]);return e}return t}function b3(t,e,r){let i=new Gp(t,r),n=i.instantiate(e),s=i.createAnimator();return{scenes:n,animator:s}}var T3={};fr(T3,{createExtMeshFeatures:()=>Nq,decode:()=>Iq,encode:()=>Bq,name:()=>Rq});function sr(t,e){if(!t)throw new Error(e||"assert failed: gltf")}var Wp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},jp={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};var xq=1.33,jI=["SCALAR","VEC2","VEC3","VEC4"],bq=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Tq=new Map(bq),Eq={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},vq={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wq={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Xp(t){return jI[t-1]||jI[0]}function Xs(t){let e=Tq.get(t.constructor);if(!e)throw new Error("Illegal typed array");return e}function Lc(t,e){let r=wq[t.componentType],i=Eq[t.type],n=vq[t.componentType],s=t.count*i,o=t.count*i*n;sr(o>=0&&o<=e.byteLength);let a=jp[t.componentType],A=Wp[t.type];return{ArrayType:r,length:s,byteLength:o,componentByteSize:a,numberOfComponentsInElement:A}}function Cf(t){let{images:e,bufferViews:r}=t;e=e||[],r=r||[];let i=e.map(o=>o.bufferView);r=r.filter(o=>!i.includes(o));let n=r.reduce((o,a)=>o+a.byteLength,0),s=e.reduce((o,a)=>{let{width:A,height:h}=a.image;return o+A*h},0);return n+Math.ceil(4*s*xq)}function XI(t,e,r){let i=t.bufferViews[r];sr(i);let n=i.buffer,s=e[n];sr(s);let o=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,o,i.byteLength)}function YI(t,e,r){let i=typeof r=="number"?t.accessors?.[r]:r;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);let n=t.bufferViews?.[i.bufferView||0];if(!n)throw new Error(`No gltf buffer view for accessor ${n}`);let{arrayBuffer:s,byteOffset:o}=e[n.buffer],a=(o||0)+(i.byteOffset||0)+(n.byteOffset||0),{ArrayType:A,length:h,componentByteSize:g,numberOfComponentsInElement:_}=Lc(i,n),b=g*_,T=n.byteStride||b;if(typeof n.byteStride>"u"||n.byteStride===b)return new A(s,a,h);let v=new A(h);for(let C=0;C<i.count;C++){let S=new A(s,a+C*T,_);v.set(S,C*_)}return v}function Cq(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}var ht=class{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||Cq(),buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){let r=this.getUsedExtensions().find(n=>n===e),i=this.getRequiredExtensions().find(n=>n===e);return typeof r=="string"||typeof i=="string"}getExtension(e){let r=this.getUsedExtensions().find(n=>n===e),i=this.json.extensions||{};return r?i[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(i=>i===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,r){return(e.extensions||{})[r]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,r){if(typeof r=="object")return r;let i=this.json[e]&&this.json[e][r];if(!i)throw new Error(`glTF file error: Could not find ${e}[${r}]`);return i}getTypedArrayForBufferView(e){e=this.getBufferView(e);let r=e.buffer,i=this.gltf.buffers[r];sr(i);let n=(e.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,n,e.byteLength)}getTypedArrayForAccessor(e){let r=this.getAccessor(e);return YI(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(e){e=this.getAccessor(e);let r=this.getBufferView(e.bufferView),n=this.getBuffer(r.buffer).data,s=r.byteOffset||0;return new Uint8Array(n,s,r.byteLength)}addApplicationData(e,r){return this.json[e]=r,this}addExtraData(e,r){return this.json.extras=this.json.extras||{},this.json.extras[e]=r,this}addObjectExtension(e,r,i){return e.extensions=e.extensions||{},e.extensions[r]=i,this.registerUsedExtension(r),this}setObjectExtension(e,r,i){let n=e.extensions||{};n[r]=i}removeObjectExtension(e,r){let i=e?.extensions||{};if(i[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let n=this.json.extensionsRemoved;n.includes(r)||n.push(r)}delete i[r]}addExtension(e,r={}){return sr(r),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=r,this.registerUsedExtension(e),r}addRequiredExtension(e,r={}){return sr(r),this.addExtension(e,r),this.registerRequiredExtension(e),r}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){let{nodeIndices:r}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(e){let{meshIndex:r,matrix:i}=e;this.json.nodes=this.json.nodes||[];let n={mesh:r};return i&&(n.matrix=i),this.json.nodes.push(n),this.json.nodes.length-1}addMesh(e){let{attributes:r,indices:i,material:n,mode:s=4}=e,a={primitives:[{attributes:this._addAttributes(r),mode:s}]};if(i){let A=this._addIndices(i);a.primitives[0].indices=A}return Number.isFinite(n)&&(a.primitives[0].material=n),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(e){let i={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(i),this.json.meshes.length-1}addImage(e,r){let i=fo(e),n=r||i?.mimeType,o={bufferView:this.addBufferView(e),mimeType:n};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(e,r=0,i=this.byteLength){let n=e.byteLength;sr(Number.isFinite(n)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);let s={buffer:r,byteOffset:i,byteLength:n};return this.byteLength+=hs(n,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(s),this.json.bufferViews.length-1}addAccessor(e,r){let i={bufferView:e,type:Xp(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(i),this.json.accessors.length-1}addBinaryBuffer(e,r={size:3}){let i=this.addBufferView(e),n={min:r.min,max:r.max};(!n.min||!n.max)&&(n=this._getAccessorMinMax(e,r.size));let s={size:r.size,componentType:Xs(e),count:Math.round(e.length/r.size),min:n.min,max:n.max};return this.addAccessor(i,Object.assign(s,r))}addTexture(e){let{imageIndex:r}=e,i={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(i),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){let e=this.byteLength,r=new ArrayBuffer(e),i=new Uint8Array(r),n=0;for(let s of this.sourceBuffers||[])n=Bm(s,i,n);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=r,this.sourceBuffers=[r],this.gltf.buffers=[{arrayBuffer:r,byteOffset:0,byteLength:r.byteLength}]}_removeStringFromArray(e,r){let i=!0;for(;i;){let n=e.indexOf(r);n>-1?e.splice(n,1):i=!1}}_addAttributes(e={}){let r={};for(let i in e){let n=e[i],s=this._getGltfAttributeName(i),o=this.addBinaryBuffer(n.value,n);r[s]=o}return r}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,r){let i={min:null,max:null};if(e.length<r)return i;i.min=[],i.max=[];let n=e.subarray(0,r);for(let s of n)i.min.push(s),i.max.push(s);for(let s=r;s<e.length;s+=r)for(let o=0;o<r;o++)i.min[0+o]=Math.min(i.min[0+o],e[s+o]),i.max[0+o]=Math.max(i.max[0+o],e[s+o]);return i}};function QI(t){return(t%1+1)%1}var qI={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Sq={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},KI={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Sf(t,e){return KI[e]*qI[t]}function Nc(t,e,r,i){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;let n=t.getTypedArrayForBufferView(e),s=Dc(n,"SCALAR",r,i+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function Dc(t,e,r,i=1){let n=qI[e],s=Sq[r],o=KI[r],a=i*n,A=a*o,h=t.buffer,g=t.byteOffset;return g%o!==0&&(h=new Uint8Array(h).slice(g,g+A).buffer,g=0),new s(h,g,a)}function kc(t,e,r){let i=`TEXCOORD_${e.texCoord||0}`,n=r.attributes[i],s=t.getTypedArrayForAccessor(n),o=t.gltf.json,a=e.index,A=o.textures?.[a]?.source;if(typeof A<"u"){let h=o.images?.[A]?.mimeType,g=t.gltf.images?.[A];if(g&&typeof g.width<"u"){let _=[];for(let b=0;b<s.length;b+=2){let T=Mq(g,h,s,b,e.channels);_.push(T)}return _}}return[]}function Yp(t,e,r,i,n){if(!r?.length)return;let s=[];for(let g of r){let _=i.findIndex(b=>b===g);_===-1&&(_=i.push(g)-1),s.push(_)}let o=new Uint32Array(s),a=t.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,A=t.addBufferView(o,a,0),h=t.addAccessor(A,{size:1,componentType:Xs(o),count:o.length});n.attributes[e]=h}function Mq(t,e,r,i,n=[0]){let s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=r[i],a=r[i+1],A=1;e&&(e.indexOf("image/jpeg")!==-1||e.indexOf("image/png")!==-1)&&(A=4);let h=Pq(o,a,t,A),g=0;for(let _ of n){let b=typeof _=="number"?Object.values(s)[_]:s[_],T=h+b.offset,v=Rl(t);if(v.data.length<=T)throw new Error(`${v.data.length} <= ${T}`);let C=v.data[T];g|=C<<b.shift}return g}function Pq(t,e,r,i=1){let n=r.width,s=QI(t)*(n-1),o=Math.round(s),a=r.height,A=QI(e)*(a-1),h=Math.round(A),g=r.components?r.components:i;return(h*n+o)*g}function Qp(t,e,r,i,n){let s=[];for(let o=0;o<e;o++){let a=r[o],A=r[o+1]-r[o];if(A+a>i)break;let h=a/n,g=A/n;s.push(t.slice(h,h+g))}return s}function qp(t,e,r){let i=[];for(let n=0;n<e;n++){let s=n*r;i.push(t.slice(s,s+r))}return i}function Kp(t,e,r,i){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){let n=[],s=new TextDecoder("utf8"),o=0;for(let a=0;a<t;a++){let A=i[a+1]-i[a];if(A+o<=e.length){let h=e.subarray(o,A+o),g=s.decode(h);n.push(g),o+=A}}return n}return[]}var Uc="EXT_mesh_features",Rq=Uc;async function Iq(t,e){let r=new ht(t);Oq(r,e)}function Bq(t,e){let r=new ht(t);return Lq(r,e),r.createBinaryChunk(),r.gltf}function Oq(t,e){let r=t.gltf.json;if(r.meshes)for(let i of r.meshes)for(let n of i.primitives)Fq(t,n,e)}function Fq(t,e,r){if(!r?.gltf?.loadBuffers)return;let n=e.extensions?.[Uc]?.featureIds;if(n)for(let s of n){let o;if(typeof s.attribute<"u"){let a=`_FEATURE_ID_${s.attribute}`,A=e.attributes[a];o=t.getTypedArrayForAccessor(A)}else typeof s.texture<"u"&&r?.gltf?.loadImages?o=kc(t,s.texture,e):o=[];s.data=o}}function Lq(t,e){let r=t.gltf.json.meshes;if(r)for(let i of r)for(let n of i.primitives)Dq(t,n)}function Nq(t,e,r,i){e.extensions||(e.extensions={});let n=e.extensions[Uc];n||(n={featureIds:[]},e.extensions[Uc]=n);let{featureIds:s}=n,o={featureCount:r.length,propertyTable:i,data:r};s.push(o),t.addObjectExtension(e,Uc,n)}function Dq(t,e){let r=e.extensions?.[Uc];if(!r)return;let i=r.featureIds;i.forEach((n,s)=>{if(n.data){let{accessorKey:o,index:a}=kq(e.attributes),A=new Uint32Array(n.data);i[s]={featureCount:A.length,propertyTable:n.propertyTable,attribute:a},t.gltf.buffers.push({arrayBuffer:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength});let h=t.addBufferView(A),g=t.addAccessor(h,{size:1,componentType:Xs(A),count:A.length});e.attributes[o]=g}})}function kq(t){let e="_FEATURE_ID_",r=Object.keys(t).filter(s=>s.indexOf(e)===0),i=-1;for(let s of r){let o=Number(s.substring(e.length));o>i&&(i=o)}return i++,{accessorKey:`${e}${i}`,index:i}}var w3={};fr(w3,{createExtStructuralMetadata:()=>oK,decode:()=>Vq,encode:()=>zq,name:()=>Uq});var Vc="EXT_structural_metadata",Uq=Vc;async function Vq(t,e){let r=new ht(t);Hq(r,e)}function zq(t,e){let r=new ht(t);return nK(r,e),r.createBinaryChunk(),r.gltf}function Hq(t,e){if(!e.gltf?.loadBuffers)return;let r=t.getExtension(Vc);r&&(e.gltf?.loadImages&&Gq(t,r),Wq(t,r))}function Gq(t,e){let r=e.propertyTextures,i=t.gltf.json;if(r&&i.meshes)for(let n of i.meshes)for(let s of n.primitives)Xq(t,r,s,e)}function Wq(t,e){let r=e.schema;if(!r)return;let i=r.classes,n=e.propertyTables;if(i&&n)for(let s in i){let o=jq(n,s);o&&Qq(t,r,o)}}function jq(t,e){for(let r of t)if(r.class===e)return r;return null}function Xq(t,e,r,i){if(!e)return;let s=r.extensions?.[Vc]?.propertyTextures;if(s)for(let o of s){let a=e[o];Yq(t,a,r,i)}}function Yq(t,e,r,i){if(!e.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);let n=e.class;for(let s in e.properties){let o=`${n}_${s}`,a=e.properties?.[s];if(!a)continue;a.data||(a.data=[]);let A=a.data,h=kc(t,a,r);h!==null&&(Yp(t,o,h,A,r),a.data=A,i.dataAttributeNames.push(o))}}function Qq(t,e,r){let i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let n=r.count;for(let s in i.properties){let o=i.properties[s],a=r.properties?.[s];if(a){let A=qq(t,e,o,n,a);a.data=A}}}function qq(t,e,r,i,n){let s=[],o=n.values,a=t.getTypedArrayForBufferView(o),A=Kq(t,r,n,i),h=Jq(t,n,i);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{s=Zq(r,i,a,A);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{s=Kp(i,a,A,h);break}case"ENUM":{s=$q(e,r,i,a,A);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return s}function Kq(t,e,r,i){return e.array&&typeof e.count>"u"&&typeof r.arrayOffsets<"u"?Nc(t,r.arrayOffsets,r.arrayOffsetType||"UINT32",i):null}function Jq(t,e,r){return typeof e.stringOffsets<"u"?Nc(t,e.stringOffsets,e.stringOffsetType||"UINT32",r):null}function Zq(t,e,r,i){let n=t.array,s=t.count,o=Sf(t.type,t.componentType),a=r.byteLength/o,A;return t.componentType?A=Dc(r,t.type,t.componentType,a):A=r,n?i?Qp(A,e,i,r.length,o):s?qp(A,e,s):[]:A}function $q(t,e,r,i,n){let s=e.enumType;if(!s)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let o=t.enums?.[s];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${s}`);let a=o.valueType||"UINT16",A=Sf(e.type,a),h=i.byteLength/A,g=Dc(i,e.type,a,h);if(g||(g=i),e.array){if(n)return eK({valuesData:g,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:i.length,elementSize:A,enumEntry:o});let _=e.count;return _?tK(g,r,_,o):[]}return v3(g,0,r,o)}function eK(t){let{valuesData:e,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:n,elementSize:s,enumEntry:o}=t,a=[];for(let A=0;A<r;A++){let h=i[A],g=i[A+1]-i[A];if(g+h>n)break;let _=h/s,b=g/s,T=v3(e,_,b,o);a.push(T)}return a}function tK(t,e,r,i){let n=[];for(let s=0;s<e;s++){let o=r*s,a=v3(t,o,r,i);n.push(a)}return n}function v3(t,e,r,i){let n=[];for(let s=0;s<r;s++)if(t instanceof BigInt64Array||t instanceof BigUint64Array)n.push("");else{let o=t[e+s],a=rK(i,o);a?n.push(a.name):n.push("")}return n}function rK(t,e){for(let r of t.values)if(r.value===e)return r;return null}var iK="schemaClassId";function nK(t,e){let r=t.getExtension(Vc);if(r&&r.propertyTables)for(let i of r.propertyTables){let n=i.class,s=r.schema?.classes?.[n];i.properties&&s&&sK(i,s,t)}}function sK(t,e,r){for(let i in t.properties){let n=t.properties[i].data;if(n){let s=e.properties[i];if(s){let o=lK(n,s,r);t.properties[i]=o}}}}function oK(t,e,r=iK){let i=t.getExtension(Vc);i||(i=t.addExtension(Vc)),i.schema=aK(e,r,i.schema);let n=cK(e,r,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(n)-1}function aK(t,e,r){let i=r??{id:"schema_id"},n={properties:{}};for(let s of t){let o={type:s.elementType,componentType:s.componentType};n.properties[s.name]=o}return i.classes={},i.classes[e]=n,i}function cK(t,e,r){let i={class:e,count:0},n=0,s=r.classes?.[e];for(let o of t){if(n===0&&(n=o.values.length),n!==o.values.length&&o.values.length)throw new Error("Illegal values in attributes");s?.properties[o.name]&&(i.properties||(i.properties={}),i.properties[o.name]={values:0,data:o.values})}return i.count=n,i}function lK(t,e,r){let i={values:0};if(e.type==="STRING"){let{stringData:n,stringOffsets:s}=fK(t);i.stringOffsets=E3(s,r),i.values=E3(n,r)}else if(e.type==="SCALAR"&&e.componentType){let n=uK(t,e.componentType);i.values=E3(n,r)}return i}var AK={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function uK(t,e){let r=[];for(let n of t)r.push(Number(n));let i=AK[e];if(!i)throw new Error("Illegal component type");return new i(r)}function fK(t){let e=new TextEncoder,r=[],i=0;for(let A of t){let h=e.encode(A);i+=h.length,r.push(h)}let n=new Uint8Array(i),s=[],o=0;for(let A of r)n.set(A,o),s.push(o),o+=A.length;s.push(o);let a=new Uint32Array(s);return{stringData:n,stringOffsets:a}}function E3(t,e){return e.gltf.buffers.push({arrayBuffer:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength}),e.addBufferView(t)}var C3={};fr(C3,{decode:()=>dK,name:()=>hK});var JI="EXT_feature_metadata",hK=JI;async function dK(t,e){let r=new ht(t);pK(r,e)}function pK(t,e){if(!e.gltf?.loadBuffers)return;let r=t.getExtension(JI);r&&(e.gltf?.loadImages&&gK(t,r),mK(t,r))}function gK(t,e){let r=e.schema;if(!r)return;let i=r.classes,{featureTextures:n}=e;if(i&&n)for(let s in i){let o=i[s],a=yK(n,s);a&&bK(t,a,o)}}function mK(t,e){let r=e.schema;if(!r)return;let i=r.classes,n=e.featureTables;if(i&&n)for(let s in i){let o=_K(n,s);o&&xK(t,r,o)}}function _K(t,e){for(let r in t){let i=t[r];if(i.class===e)return i}return null}function yK(t,e){for(let r in t){let i=t[r];if(i.class===e)return i}return null}function xK(t,e,r){if(!r.class)return;let i=e.classes?.[r.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let n=r.count;for(let s in i.properties){let o=i.properties[s],a=r.properties?.[s];if(a){let A=TK(t,e,o,n,a);a.data=A}}}function bK(t,e,r){let i=e.class;for(let n in r.properties){let s=e?.properties?.[n];if(s){let o=SK(t,s,i);s.data=o}}}function TK(t,e,r,i,n){let s=[],o=n.bufferView,a=t.getTypedArrayForBufferView(o),A=EK(t,r,n,i),h=vK(t,r,n,i);return r.type==="STRING"||r.componentType==="STRING"?s=Kp(i,a,A,h):wK(r)&&(s=CK(r,i,a,A)),s}function EK(t,e,r,i){return e.type==="ARRAY"&&typeof e.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?Nc(t,r.arrayOffsetBufferView,r.offsetType||"UINT32",i):null}function vK(t,e,r,i){return typeof r.stringOffsetBufferView<"u"?Nc(t,r.stringOffsetBufferView,r.offsetType||"UINT32",i):null}function wK(t){let e=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return e.includes(t.type)||typeof t.componentType<"u"&&e.includes(t.componentType)}function CK(t,e,r,i){let n=t.type==="ARRAY",s=t.componentCount,o="SCALAR",a=t.componentType||t.type,A=Sf(o,a),h=r.byteLength/A,g=Dc(r,o,a,h);return n?i?Qp(g,e,i,r.length,A):s?qp(g,e,s):[]:g}function SK(t,e,r){let i=t.gltf.json;if(!i.meshes)return[];let n=[];for(let s of i.meshes)for(let o of s.primitives)MK(t,r,e,n,o);return n}function MK(t,e,r,i,n){let s={channels:r.channels,...r.texture},o=kc(t,s,n);o&&Yp(t,e,o,i,n)}var ZI="4.3.2";var zc=!0,$I=1735152710,P3=12,Jp=8,PK=1313821514,RK=5130562,IK=0,BK=0,OK=1;function FK(t,e=0){return`${String.fromCharCode(t.getUint8(e+0))}${String.fromCharCode(t.getUint8(e+1))}${String.fromCharCode(t.getUint8(e+2))}${String.fromCharCode(t.getUint8(e+3))}`}function eB(t,e=0,r={}){let i=new DataView(t),{magic:n=$I}=r,s=i.getUint32(e,!1);return s===n||s===$I}function tB(t,e,r=0,i={}){let n=new DataView(e),s=FK(n,r+0),o=n.getUint32(r+4,zc),a=n.getUint32(r+8,zc);switch(Object.assign(t,{header:{byteOffset:r,byteLength:a,hasBinChunk:!1},type:s,version:o,json:{},binChunks:[]}),r+=P3,t.version){case 1:return LK(t,n,r);case 2:return NK(t,n,r,i={});default:throw new Error(`Invalid GLB version ${t.version}. Only supports version 1 and 2.`)}}function LK(t,e,r){Ze(t.header.byteLength>P3+Jp);let i=e.getUint32(r+0,zc),n=e.getUint32(r+4,zc);return r+=Jp,Ze(n===IK),S3(t,e,r,i),r+=i,r+=M3(t,e,r,t.header.byteLength),r}function NK(t,e,r,i){return Ze(t.header.byteLength>P3+Jp),DK(t,e,r,i),r+t.header.byteLength}function DK(t,e,r,i){for(;r+8<=t.header.byteLength;){let n=e.getUint32(r+0,zc),s=e.getUint32(r+4,zc);switch(r+=Jp,s){case PK:S3(t,e,r,n);break;case RK:M3(t,e,r,n);break;case BK:i.strict||S3(t,e,r,n);break;case OK:i.strict||M3(t,e,r,n);break;default:break}r+=hs(n,4)}return r}function S3(t,e,r,i){let n=new Uint8Array(e.buffer,r,i),o=new TextDecoder("utf8").decode(n);return t.json=JSON.parse(o),hs(i,4)}function M3(t,e,r,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:e.buffer}),hs(i,4)}function R3(t,e){if(t.startsWith("data:")||t.startsWith("http:")||t.startsWith("https:"))return t;let i=e.baseUri||e.uri;if(!i)throw new Error(`'baseUri' must be provided to resolve relative url ${t}`);return i.substr(0,i.lastIndexOf("/")+1)+t}var B3={};fr(B3,{decode:()=>qK,name:()=>QK});var kK="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",UK="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",VK=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),zK=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),HK={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},GK={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function rB(t,e,r,i,n,s="NONE"){let o=await WK();YK(o,o.exports[GK[n]],t,e,r,i,o.exports[HK[s||"NONE"]])}var I3;async function WK(){return I3||(I3=jK()),I3}async function jK(){let t=kK;WebAssembly.validate(VK)&&(t=UK,console.log("Warning: meshopt_decoder is using experimental SIMD support"));let e=await WebAssembly.instantiate(XK(t),{});return await e.instance.exports.__wasm_call_ctors(),e.instance}function XK(t){let e=new Uint8Array(t.length);for(let i=0;i<t.length;++i){let n=t.charCodeAt(i);e[i]=n>96?n-71:n>64?n-65:n>47?n+4:n>46?63:62}let r=0;for(let i=0;i<t.length;++i)e[r++]=e[i]<60?zK[e[i]]:(e[i]-60)*64+e[++i];return e.buffer.slice(0,r)}function YK(t,e,r,i,n,s,o){let a=t.exports.sbrk,A=i+3&-4,h=a(A*n),g=a(s.length),_=new Uint8Array(t.exports.memory.buffer);_.set(s,g);let b=e(h,i,n,g,s.length);if(b===0&&o&&o(h,A,n),r.set(_.subarray(h,h+i*n)),a(h-a(0)),b!==0)throw new Error(`Malformed buffer data: ${b}`)}var Zp="EXT_meshopt_compression",QK=Zp;async function qK(t,e){let r=new ht(t);if(!e?.gltf?.decompressMeshes||!e.gltf?.loadBuffers)return;let i=[];for(let n of t.json.bufferViews||[])i.push(KK(r,n));await Promise.all(i),r.removeExtension(Zp)}async function KK(t,e){let r=t.getObjectExtension(e,Zp);if(r){let{byteOffset:i=0,byteLength:n=0,byteStride:s,count:o,mode:a,filter:A="NONE",buffer:h}=r,g=t.gltf.buffers[h],_=new Uint8Array(g.arrayBuffer,g.byteOffset+i,n),b=new Uint8Array(t.gltf.buffers[e.buffer].arrayBuffer,e.byteOffset,e.byteLength);await rB(b,o,s,_,a,A),t.removeObjectExtension(e,Zp)}}var O3={};fr(O3,{name:()=>JK,preprocess:()=>ZK});var Hc="EXT_texture_webp",JK=Hc;function ZK(t,e){let r=new ht(t);if(!e1("image/webp")){if(r.getRequiredExtensions().includes(Hc))throw new Error(`gltf: Required extension ${Hc} not supported by browser`);return}let{json:i}=r;for(let n of i.textures||[]){let s=r.getObjectExtension(n,Hc);s&&(n.source=s.source),r.removeObjectExtension(n,Hc)}r.removeExtension(Hc)}var F3={};fr(F3,{name:()=>$K,preprocess:()=>eJ});var $p="KHR_texture_basisu",$K=$p;function eJ(t,e){let r=new ht(t),{json:i}=r;for(let n of i.textures||[]){let s=r.getObjectExtension(n,$p);s&&(n.source=s.source,r.removeObjectExtension(n,$p))}r.removeExtension($p)}var U3={};fr(U3,{decode:()=>gJ,encode:()=>mJ,name:()=>dJ,preprocess:()=>pJ});var iB="4.3.2";var nB={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:iB,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function oB(t,e,r){let i=aB(e.metadata),n=[],s=tJ(e.attributes);for(let o in t){let a=t[o],A=sB(o,a,s[o]);n.push(A)}if(r){let o=sB("indices",r);n.push(o)}return{fields:n,metadata:i}}function tJ(t){let e={};for(let r in t){let i=t[r];e[i.name||"undefined"]=i}return e}function sB(t,e,r){let i=r?aB(r.metadata):void 0;return Qm(t,e,i)}function aB(t){Object.entries(t);let e={};for(let r in t)e[`${r}.string`]=JSON.stringify(t[r]);return e}var cB={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},rJ={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},iJ=4,Mf=class{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,r={}){let i=new this.draco.DecoderBuffer;i.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(r);let n=this.decoder.GetEncodedGeometryType(i),s=n===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(n){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(i,s);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(i,s);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!s.ptr){let b=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(b)}let a=this._getDracoLoaderData(s,n,r),A=this._getMeshData(s,a,r),h=Nn(A.attributes),g=oB(A.attributes,a,A.indices);return{loader:"draco",loaderData:a,header:{vertexCount:s.num_points(),boundingBox:h},...A,schema:g}}finally{this.draco.destroy(i),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,r,i){let n=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,i);return{geometry_type:r,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:n,attributes:s}}_getDracoAttributes(e,r){let i={};for(let n=0;n<e.num_attributes();n++){let s=this.decoder.GetAttribute(e,n),o=this._getAttributeMetadata(e,n);i[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:n,metadata:o};let a=this._getQuantizationTransform(s,r);a&&(i[s.unique_id()].quantization_transform=a);let A=this._getOctahedronTransform(s,r);A&&(i[s.unique_id()].octahedron_transform=A)}return i}_getMeshData(e,r,i){let n=this._getMeshAttributes(r,e,i);if(!n.POSITION)throw new Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)switch(i.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:n,indices:{value:this._getTriangleStripIndices(e),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:n,indices:{value:this._getTriangleListIndices(e),size:1}}}return{topology:"point-list",mode:0,attributes:n}}_getMeshAttributes(e,r,i){let n={};for(let s of Object.values(e.attributes)){let o=this._deduceAttributeName(s,i);s.name=o;let a=this._getAttributeValues(r,s);if(a){let{value:A,size:h}=a;n[o]={value:A,size:h,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return n}_getTriangleListIndices(e){let i=e.num_faces()*3,n=i*iJ,s=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,s),new Uint32Array(this.draco.HEAPF32.buffer,s,i).slice()}finally{this.draco._free(s)}}_getTriangleStripIndices(e){let r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,r),oJ(r)}finally{this.draco.destroy(r)}}_getAttributeValues(e,r){let i=rJ[r.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;let n=r.num_components,o=e.num_points()*n,a=o*i.BYTES_PER_ELEMENT,A=nJ(this.draco,i),h,g=this.draco._malloc(a);try{let _=this.decoder.GetAttribute(e,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,_,A,a,g),h=new i(this.draco.HEAPF32.buffer,g,o).slice()}finally{this.draco._free(g)}return{value:h,size:n}}_deduceAttributeName(e,r){let i=e.unique_id;for(let[o,a]of Object.entries(r.extraAttributes||{}))if(a===i)return o;let n=e.attribute_type;for(let o in cB)if(this.draco[o]===n)return cB[o];let s=r.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${i}`}_getTopLevelMetadata(e){let r=this.decoder.GetMetadata(e);return this._getDracoMetadata(r)}_getAttributeMetadata(e,r){let i=this.decoder.GetAttributeMetadata(e,r);return this._getDracoMetadata(i)}_getDracoMetadata(e){if(!e||!e.ptr)return{};let r={},i=this.metadataQuerier.NumEntries(e);for(let n=0;n<i;n++){let s=this.metadataQuerier.GetEntryName(e,n);r[s]=this._getDracoMetadataField(e,s)}return r}_getDracoMetadataField(e,r){let i=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,r,i);let n=sJ(i);return{int:this.metadataQuerier.GetIntEntry(e,r),string:this.metadataQuerier.GetStringEntry(e,r),double:this.metadataQuerier.GetDoubleEntry(e,r),intArray:n}}finally{this.draco.destroy(i)}}_disableAttributeTransforms(e){let{quantizedAttributes:r=[],octahedronAttributes:i=[]}=e,n=[...r,...i];for(let s of n)this.decoder.SkipAttributeTransform(this.draco[s])}_getQuantizationTransform(e,r){let{quantizedAttributes:i=[]}=r,n=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(n)){let o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(e,r){let{octahedronAttributes:i=[]}=r,n=e.attribute_type();if(i.map(o=>this.decoder[o]).includes(n)){let o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(e))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}};function nJ(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32;default:return t.DT_INVALID}}function sJ(t){let e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}function oJ(t){let e=t.size(),r=new Int32Array(e);for(let i=0;i<e;i++)r[i]=t.GetValue(i);return r}var aJ="1.5.6",cJ="1.4.1",L3=`https://www.gstatic.com/draco/versioned/decoders/${aJ}`,Zr={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},N3={[Zr.DECODER]:`${L3}/${Zr.DECODER}`,[Zr.DECODER_WASM]:`${L3}/${Zr.DECODER_WASM}`,[Zr.FALLBACK_DECODER]:`${L3}/${Zr.FALLBACK_DECODER}`,[Zr.ENCODER]:`https://raw.githubusercontent.com/google/draco/${cJ}/javascript/${Zr.ENCODER}`},D3;async function lB(t){let e=t.modules||{};return e.draco3d?D3||=e.draco3d.createDecoderModule({}).then(r=>({draco:r})):D3||=lJ(t),await D3}async function lJ(t){let e,r;switch(t.draco&&t.draco.decoderType){case"js":e=await tn(N3[Zr.FALLBACK_DECODER],"draco",t,Zr.FALLBACK_DECODER);break;case"wasm":default:[e,r]=await Promise.all([await tn(N3[Zr.DECODER],"draco",t,Zr.DECODER),await tn(N3[Zr.DECODER_WASM],"draco",t,Zr.DECODER_WASM)])}return e=e||globalThis.DracoDecoderModule,await AJ(e,r)}function AJ(t,e){let r={};return e&&(r.wasmBinary=e),new Promise(i=>{t({...r,onModuleLoaded:n=>i({draco:n})})})}var eg={...nB,parse:uJ};async function uJ(t,e){let{draco:r}=await lB(e),i=new Mf(r);try{return i.parseSync(t,e?.draco)}finally{i.destroy()}}function AB(t){let e={};for(let r in t){let i=t[r];if(r!=="indices"){let n=k3(i);e[r]=n}}return e}function k3(t){let{buffer:e,size:r,count:i}=fJ(t);return{value:e,size:r,byteOffset:0,count:i,type:Xp(r),componentType:Xs(e)}}function fJ(t){let e=t,r=1,i=0;return t&&t.value&&(e=t.value,r=t.size||1),e&&(ArrayBuffer.isView(e)||(e=hJ(e,Float32Array)),i=e.length/r),{buffer:e,size:r,count:i}}function hJ(t,e,r=!1){return t?Array.isArray(t)?new e(t):r&&!(t instanceof e)?new e(t):t:null}var Ys="KHR_draco_mesh_compression",dJ=Ys;function pJ(t,e,r){let i=new ht(t);for(let n of uB(i))i.getObjectExtension(n,Ys)}async function gJ(t,e,r){if(!e?.gltf?.decompressMeshes)return;let i=new ht(t),n=[];for(let s of uB(i))i.getObjectExtension(s,Ys)&&n.push(_J(i,s,e,r));await Promise.all(n),i.removeExtension(Ys)}function mJ(t,e={}){let r=new ht(t);for(let i of r.json.meshes||[])yJ(i,e),r.addRequiredExtension(Ys)}async function _J(t,e,r,i){let n=t.getObjectExtension(e,Ys);if(!n)return;let s=t.getTypedArrayForBufferView(n.bufferView),o=co(s.buffer,s.byteOffset),a={...r};delete a["3d-tiles"];let A=await ii(o,eg,a,i),h=AB(A.attributes);for(let[g,_]of Object.entries(h))if(g in e.attributes){let b=e.attributes[g],T=t.getAccessor(b);T?.min&&T?.max&&(_.min=T.min,_.max=T.max)}e.attributes=h,A.indices&&(e.indices=k3(A.indices)),t.removeObjectExtension(e,Ys),xJ(e)}function yJ(t,e,r=4,i,n){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");let s=i.DracoWriter.encodeSync({attributes:t}),o=n?.parseSync?.({attributes:t}),a=i._addFauxAttributes(o.attributes),A=i.addBufferView(s);return{primitives:[{attributes:a,mode:r,extensions:{[Ys]:{bufferView:A,attributes:a}}}]}}function xJ(t){if(!t.attributes&&Object.keys(t.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*uB(t){for(let e of t.json.meshes||[])for(let r of e.primitives)yield r}var V3={};fr(V3,{decode:()=>vJ,name:()=>bJ});var rg="KHR_texture_transform",bJ=rg,tg=new G,TJ=new yt,EJ=new yt;async function vJ(t,e){if(!new ht(t).hasExtension(rg)||!e.gltf?.loadBuffers)return;let n=t.json.materials||[];for(let s=0;s<n.length;s++)wJ(s,t)}function wJ(t,e){let r=e.json.materials?.[t],i=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],n=[];for(let s of i)s&&s?.extensions?.[rg]&&CJ(e,t,s,n)}function CJ(t,e,r,i){let n=SJ(r,i);if(!n)return;let s=t.json.meshes||[];for(let o of s)for(let a of o.primitives){let A=a.material;Number.isFinite(A)&&e===A&&MJ(t,a,n)}}function SJ(t,e){let r=t.extensions?.[rg],{texCoord:i=0}=t,{texCoord:n=i}=r;if(!(e.findIndex(([o,a])=>o===i&&a===n)!==-1)){let o=IJ(r);return i!==n&&(t.texCoord=n),e.push([i,n]),{originalTexCoord:i,texCoord:n,matrix:o}}return null}function MJ(t,e,r){let{originalTexCoord:i,texCoord:n,matrix:s}=r,o=e.attributes[`TEXCOORD_${i}`];if(Number.isFinite(o)){let a=t.json.accessors?.[o];if(a&&a.bufferView){let A=t.json.bufferViews?.[a.bufferView];if(A){let{arrayBuffer:h,byteOffset:g}=t.buffers[A.buffer],_=(g||0)+(a.byteOffset||0)+(A.byteOffset||0),{ArrayType:b,length:T}=Lc(a,A),v=jp[a.componentType],C=Wp[a.type],S=A.byteStride||v*C,P=new Float32Array(T);for(let F=0;F<a.count;F++){let I=new b(h,_+F*S,2);tg.set(I[0],I[1],1),tg.transformByMatrix3(s),P.set([tg[0],tg[1]],F*C)}i===n?PJ(a,A,t.buffers,P):RJ(n,a,e,t,P)}}}}function PJ(t,e,r,i){t.componentType=5126,r.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),e.buffer=r.length-1,e.byteLength=i.buffer.byteLength,e.byteOffset=0,delete e.byteStride}function RJ(t,e,r,i,n){i.buffers.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength});let s=i.json.bufferViews;if(!s)return;s.push({buffer:i.buffers.length-1,byteLength:n.buffer.byteLength,byteOffset:0});let o=i.json.accessors;o&&(o.push({bufferView:s?.length-1,byteOffset:0,componentType:5126,count:e.count,type:"VEC2"}),r.attributes[`TEXCOORD_${t}`]=o.length-1)}function IJ(t){let{offset:e=[0,0],rotation:r=0,scale:i=[1,1]}=t,n=new yt().set(1,0,0,0,1,0,e[0],e[1],1),s=TJ.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),o=EJ.set(i[0],0,0,0,i[1],0,0,0,1);return n.multiplyRight(s).multiplyRight(o)}var z3={};fr(z3,{decode:()=>OJ,encode:()=>FJ,name:()=>BJ});var ra="KHR_lights_punctual",BJ=ra;async function OJ(t){let e=new ht(t),{json:r}=e,i=e.getExtension(ra);i&&(e.json.lights=i.lights,e.removeExtension(ra));for(let n of r.nodes||[]){let s=e.getObjectExtension(n,ra);s&&(n.light=s.light),e.removeObjectExtension(n,ra)}}async function FJ(t){let e=new ht(t),{json:r}=e;if(r.lights){let i=e.addExtension(ra);sr(!i.lights),i.lights=r.lights,delete r.lights}if(e.json.lights){for(let i of e.json.lights){let n=i.node;e.addObjectExtension(n,ra,i)}delete e.json.lights}}var H3={};fr(H3,{decode:()=>NJ,encode:()=>DJ,name:()=>LJ});var Pf="KHR_materials_unlit",LJ=Pf;async function NJ(t){let e=new ht(t),{json:r}=e;for(let i of r.materials||[])i.extensions&&i.extensions.KHR_materials_unlit&&(i.unlit=!0),e.removeObjectExtension(i,Pf);e.removeExtension(Pf)}function DJ(t){let e=new ht(t),{json:r}=e;if(e.materials)for(let i of r.materials||[])i.unlit&&(delete i.unlit,e.addObjectExtension(i,Pf,{}),e.addExtension(Pf))}var G3={};fr(G3,{decode:()=>UJ,encode:()=>VJ,name:()=>kJ});var Rf="KHR_techniques_webgl",kJ=Rf;async function UJ(t){let e=new ht(t),{json:r}=e,i=e.getExtension(Rf);if(i){let n=zJ(i,e);for(let s of r.materials||[]){let o=e.getObjectExtension(s,Rf);o&&(s.technique=Object.assign({},o,n[o.technique]),s.technique.values=HJ(s.technique,e)),e.removeObjectExtension(s,Rf)}e.removeExtension(Rf)}}async function VJ(t,e){}function zJ(t,e){let{programs:r=[],shaders:i=[],techniques:n=[]}=t,s=new TextDecoder;return i.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=s.decode(e.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(o=>{o.fragmentShader=i[o.fragmentShader],o.vertexShader=i[o.vertexShader]}),n.forEach(o=>{o.program=r[o.program]}),n}function HJ(t,e){let r=Object.assign({},t.values);return Object.keys(t.uniforms||{}).forEach(i=>{t.uniforms[i].value&&!(i in r)&&(r[i]=t.uniforms[i].value)}),Object.keys(r).forEach(i=>{typeof r[i]=="object"&&r[i].index!==void 0&&(r[i].texture=e.getTexture(r[i].index))}),r}var fB=[w3,T3,B3,O3,F3,U3,z3,H3,G3,V3,C3];function hB(t,e={},r){let i=fB.filter(n=>pB(n.name,e));for(let n of i)n.preprocess?.(t,e,r)}async function dB(t,e={},r){let i=fB.filter(n=>pB(n.name,e));for(let n of i)await n.decode?.(t,e,r)}function pB(t,e){let r=e?.gltf?.excludeExtensions||{};return!(t in r&&!r[t])}var W3="KHR_binary_glTF";function gB(t){let e=new ht(t),{json:r}=e;for(let i of r.images||[]){let n=e.getObjectExtension(i,W3);n&&Object.assign(i,n),e.removeObjectExtension(i,W3)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,e.removeExtension(W3)}var mB={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},WJ={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},j3=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,r){this.json=e.json;let i=e.json;switch(i.asset&&i.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${i.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(i),this._convertTopLevelObjectsToArrays(i),gB(e),this._convertObjectIdsToArrayIndices(i),this._updateObjects(i),this._updateMaterial(i)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(let r in mB)this._convertTopLevelObjectToArray(e,r)}_convertTopLevelObjectToArray(e,r){let i=e[r];if(!(!i||Array.isArray(i))){e[r]=[];for(let n in i){let s=i[n];s.id=s.id||n;let o=e[r].length;e[r].push(s),this.idToIndexMap[r][n]=o}}}_convertObjectIdsToArrayIndices(e){for(let r in mB)this._convertIdsToIndices(e,r);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(let r of e.textures)this._convertTextureIds(r);for(let r of e.meshes)this._convertMeshIds(r);for(let r of e.nodes)this._convertNodeIds(r);for(let r of e.scenes)this._convertSceneIds(r)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(let r of e.primitives){let{attributes:i,indices:n,material:s}=r;for(let o in i)i[o]=this._convertIdToIndex(i[o],"accessor");n&&(r.indices=this._convertIdToIndex(n,"accessor")),s&&(r.material=this._convertIdToIndex(s,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(r=>this._convertIdToIndex(r,"node"))),e.meshes&&(e.meshes=e.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(e,r){e[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),e[r]=[]);for(let i of e[r])for(let n in i){let s=i[n],o=this._convertIdToIndex(s,n);i[n]=o}}_convertIdToIndex(e,r){let i=WJ[r];if(i in this.idToIndexMap){let n=this.idToIndexMap[i][e];if(!Number.isFinite(n))throw new Error(`gltf v1: failed to resolve ${r} with id ${e}`);return n}return e}_updateObjects(e){for(let r of this.json.buffers)delete r.type}_updateMaterial(e){for(let r of e.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let i=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,n=e.textures.findIndex(s=>s.id===i);n!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:n})}}};function _B(t,e={}){return new j3().normalize(t,e)}async function yB(t,e,r=0,i,n){return jJ(t,e,r,i),_B(t,{normalize:i?.gltf?.normalize}),hB(t,i,n),i?.gltf?.loadBuffers&&t.json.buffers&&await XJ(t,i,n),i?.gltf?.loadImages&&await YJ(t,i,n),await dB(t,i,n),t}function jJ(t,e,r,i){if(i.uri&&(t.baseUri=i.uri),e instanceof ArrayBuffer&&!eB(e,r,i)&&(e=new TextDecoder().decode(e)),typeof e=="string")t.json=Pm(e);else if(e instanceof ArrayBuffer){let o={};r=tB(o,e,r,i.glb),sr(o.type==="glTF",`Invalid GLB magic string ${o.type}`),t._glb=o,t.json=o.json}else sr(!1,"GLTF: must be ArrayBuffer or string");let n=t.json.buffers||[];if(t.buffers=new Array(n.length).fill(null),t._glb&&t._glb.header.hasBinChunk){let{binChunks:o}=t._glb;t.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}let s=t.json.images||[];t.images=new Array(s.length).fill({})}async function XJ(t,e,r){let i=t.json.buffers||[];for(let n=0;n<i.length;++n){let s=i[n];if(s.uri){let{fetch:o}=r;sr(o);let a=R3(s.uri,e),h=await(await r?.fetch?.(a))?.arrayBuffer?.();t.buffers[n]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete s.uri}else t.buffers[n]===null&&(t.buffers[n]={arrayBuffer:new ArrayBuffer(s.byteLength),byteOffset:0,byteLength:s.byteLength})}}async function YJ(t,e,r){let i=QJ(t),n=t.json.images||[],s=[];for(let o of i)s.push(qJ(t,n[o],o,e,r));return await Promise.all(s)}function QJ(t){let e=new Set,r=t.json.textures||[];for(let i of r)i.source!==void 0&&e.add(i.source);return Array.from(e).sort()}async function qJ(t,e,r,i,n){let s;if(e.uri&&!e.hasOwnProperty("bufferView")){let a=R3(e.uri,i),{fetch:A}=n;s=await(await A(a)).arrayBuffer(),e.bufferView={data:s}}if(Number.isFinite(e.bufferView)){let a=XI(t.json,t.buffers,e.bufferView);s=co(a.buffer,a.byteOffset,a.byteLength)}sr(s,"glTF image has no data");let o=await ii(s,[ps,m3],{...i,mimeType:e.mimeType,basis:i.basis||{format:zp()}},n);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),t.images=t.images||[],t.images[r]=o}var es={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:ZI,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:KJ,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function KJ(t,e={},r){e={...es.options,...e},e.gltf={...es.options.gltf,...e.gltf};let{byteOffset:i=0}=e;return await yB({},t,i,e,r)}var JJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ZJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wi={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},$J={magFilter:wi.TEXTURE_MAG_FILTER,minFilter:wi.TEXTURE_MIN_FILTER,wrapS:wi.TEXTURE_WRAP_S,wrapT:wi.TEXTURE_WRAP_T},eZ={[wi.TEXTURE_MAG_FILTER]:wi.LINEAR,[wi.TEXTURE_MIN_FILTER]:wi.NEAREST_MIPMAP_LINEAR,[wi.TEXTURE_WRAP_S]:wi.REPEAT,[wi.TEXTURE_WRAP_T]:wi.REPEAT};function tZ(){return{id:"default-sampler",parameters:eZ}}function rZ(t){return ZJ[t]}function iZ(t){return JJ[t]}var X3=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,r={}){let{json:i,buffers:n=[],images:s=[]}=e,{baseUri:o=""}=e;return sr(i),this.baseUri=o,this.buffers=n,this.images=s,this.jsonUnprocessed=i,this.json=this._resolveTree(e.json,r),this.json}_resolveTree(e,r={}){let i={...e};return this.json=i,e.bufferViews&&(i.bufferViews=e.bufferViews.map((n,s)=>this._resolveBufferView(n,s))),e.images&&(i.images=e.images.map((n,s)=>this._resolveImage(n,s))),e.samplers&&(i.samplers=e.samplers.map((n,s)=>this._resolveSampler(n,s))),e.textures&&(i.textures=e.textures.map((n,s)=>this._resolveTexture(n,s))),e.accessors&&(i.accessors=e.accessors.map((n,s)=>this._resolveAccessor(n,s))),e.materials&&(i.materials=e.materials.map((n,s)=>this._resolveMaterial(n,s))),e.meshes&&(i.meshes=e.meshes.map((n,s)=>this._resolveMesh(n,s))),e.nodes&&(i.nodes=e.nodes.map((n,s)=>this._resolveNode(n,s)),i.nodes=i.nodes.map((n,s)=>this._resolveNodeChildren(n))),e.skins&&(i.skins=e.skins.map((n,s)=>this._resolveSkin(n,s))),e.scenes&&(i.scenes=e.scenes.map((n,s)=>this._resolveScene(n,s))),typeof this.json.scene=="number"&&i.scenes&&(i.scene=i.scenes[this.json.scene]),i}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,r){if(typeof r=="object")return r;let i=e&&e[r];return i||console.warn(`glTF file error: Could not find ${e}[${r}]`),i}_resolveScene(e,r){return{...e,id:e.id||`scene-${r}`,nodes:(e.nodes||[]).map(i=>this.getNode(i))}}_resolveNode(e,r){let i={...e,id:e?.id||`node-${r}`};return e.mesh!==void 0&&(i.mesh=this.getMesh(e.mesh)),e.camera!==void 0&&(i.camera=this.getCamera(e.camera)),e.skin!==void 0&&(i.skin=this.getSkin(e.skin)),e.meshes!==void 0&&e.meshes.length&&(i.mesh=e.meshes.reduce((n,s)=>{let o=this.getMesh(s);return n.id=o.id,n.primitives=n.primitives.concat(o.primitives),n},{primitives:[]})),i}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(r=>this.getNode(r))),e}_resolveSkin(e,r){let i=typeof e.inverseBindMatrices=="number"?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${r}`,inverseBindMatrices:i}}_resolveMesh(e,r){let i={...e,id:e.id||`mesh-${r}`,primitives:[]};return e.primitives&&(i.primitives=e.primitives.map(n=>{let s={...n,attributes:{},indices:void 0,material:void 0},o=n.attributes;for(let a in o)s.attributes[a]=this.getAccessor(o[a]);return n.indices!==void 0&&(s.indices=this.getAccessor(n.indices)),n.material!==void 0&&(s.material=this.getMaterial(n.material)),s})),i}_resolveMaterial(e,r){let i={...e,id:e.id||`material-${r}`};if(i.normalTexture&&(i.normalTexture={...i.normalTexture},i.normalTexture.texture=this.getTexture(i.normalTexture.index)),i.occlusionTexture&&(i.occlusionTexture={...i.occlusionTexture},i.occlusionTexture.texture=this.getTexture(i.occlusionTexture.index)),i.emissiveTexture&&(i.emissiveTexture={...i.emissiveTexture},i.emissiveTexture.texture=this.getTexture(i.emissiveTexture.index)),i.emissiveFactor||(i.emissiveFactor=i.emissiveTexture?[1,1,1]:[0,0,0]),i.pbrMetallicRoughness){i.pbrMetallicRoughness={...i.pbrMetallicRoughness};let n=i.pbrMetallicRoughness;n.baseColorTexture&&(n.baseColorTexture={...n.baseColorTexture},n.baseColorTexture.texture=this.getTexture(n.baseColorTexture.index)),n.metallicRoughnessTexture&&(n.metallicRoughnessTexture={...n.metallicRoughnessTexture},n.metallicRoughnessTexture.texture=this.getTexture(n.metallicRoughnessTexture.index))}return i}_resolveAccessor(e,r){let i=rZ(e.componentType),n=iZ(e.type),s=i*n,o={...e,id:e.id||`accessor-${r}`,bytesPerComponent:i,components:n,bytesPerElement:s,value:void 0,bufferView:void 0,sparse:void 0};if(e.bufferView!==void 0&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){let a=o.bufferView.buffer,{ArrayType:A,byteLength:h}=Lc(o,o.bufferView),g=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset,_=a.arrayBuffer.slice(g,g+h);o.bufferView.byteStride&&(_=this._getValueFromInterleavedBuffer(a,g,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new A(_)}return o}_getValueFromInterleavedBuffer(e,r,i,n,s){let o=new Uint8Array(s*n);for(let a=0;a<s;a++){let A=r+a*i;o.set(new Uint8Array(e.arrayBuffer.slice(A,A+n)),a*n)}return o.buffer}_resolveTexture(e,r){return{...e,id:e.id||`texture-${r}`,sampler:typeof e.sampler=="number"?this.getSampler(e.sampler):tZ(),source:typeof e.source=="number"?this.getImage(e.source):void 0}}_resolveSampler(e,r){let i={id:e.id||`sampler-${r}`,...e,parameters:{}};for(let n in i){let s=this._enumSamplerParameter(n);s!==void 0&&(i.parameters[s]=i[n])}return i}_enumSamplerParameter(e){return $J[e]}_resolveImage(e,r){let i={...e,id:e.id||`image-${r}`,image:null,bufferView:e.bufferView!==void 0?this.getBufferView(e.bufferView):void 0},n=this.images[r];return n&&(i.image=n),i}_resolveBufferView(e,r){let i=e.buffer,n=this.buffers[i].arrayBuffer,s=this.buffers[i].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${r}`,...e,buffer:this.buffers[i],data:new Uint8Array(n,s,e.byteLength)}}_resolveCamera(e,r){let i={...e,id:e.id||`camera-${r}`};return i.perspective,i.orthographic,i}};function ia(t,e){return new X3().postProcess(t,e)}async function xB(t){let e=[];return t.scenes.forEach(r=>{r.traverse(i=>{Object.values(i.model.uniforms).forEach(n=>{n.loaded===!1&&e.push(n)})})}),await nZ(()=>e.some(r=>!r.loaded))}async function nZ(t){for(;t();)await new Promise(e=>requestAnimationFrame(e))}var bB=`uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,TB={name:"scenegraph",vs:bB,fs:bB,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}};var EB=`#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var vB=`#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;var wB=[255,255,255,255],sZ={scenegraph:{type:"object",value:null,async:!0},getScene:t=>t&&t.scenes?typeof t.scene=="object"?t.scene:t.scenes[t.scene||0]:t,getAnimator:t=>t&&t.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:wB},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[es]},If=class extends xt{getShaders(){let e={},r;this.props._lighting==="pbr"?(r=wo,e.LIGHTING_PBR=1):r={name:"pbrMaterial"};let i=[et,Pt,TB,r];return super.getShaders({defines:e,vs:EB,fs:vB,modules:i})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:wB,transition:!0},instanceModelMatrix:Dp})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e;r.scenegraph!==i.scenegraph?this._updateScenegraph():r._animations!==i._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){let e=this.props,{device:r}=this.context,i=null;if(e.scenegraph instanceof hn)i={scenes:[e.scenegraph]};else if(e.scenegraph&&typeof e.scenegraph=="object"){let a=e.scenegraph,A=a.json?ia(a):a,h=b3(r,A,this._getModelOptions());i={gltf:A,...h},xB(h).then(()=>{this.setNeedsRedraw()}).catch(g=>{this.raiseError(g,"loading glTF")})}let n={layer:this,device:this.context.device},s=e.getScene(i,n),o=e.getAnimator(i,n);if(s instanceof jn){this.state.scenegraph?.destroy(),this._applyAnimationsProp(o,e._animations);let a=[];s.traverse(A=>{A instanceof Ss&&a.push(A.model)}),this.setState({scenegraph:s,animator:o,models:a}),this.getAttributeManager().invalidateAll()}else s!==null&&me.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,r){if(!e||!r)return;let i=e.getAnimations();Object.keys(r).sort().forEach(n=>{let s=r[n];if(n==="*")i.forEach(o=>{Object.assign(o,s)});else if(Number.isFinite(Number(n))){let o=Number(n);o>=0&&o<i.length?Object.assign(i[o],s):me.warn(`animation ${n} not found`)()}else{let o=i.find(({name:a})=>a===n);o?Object.assign(o,s):me.warn(`animation ${n} not found`)()}})}_getModelOptions(){let{_imageBasedLightingEnvironment:e}=this.props,r;return e&&(typeof e=="function"?r=e({gl:this.context.gl,layer:this}):r=e),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());let{viewport:r,renderPass:i}=this.context,{sizeScale:n,sizeMinPixels:s,sizeMaxPixels:o,coordinateSystem:a}=this.props,A=this.getNumInstances();this.state.scenegraph.traverse((h,{worldMatrix:g})=>{if(h instanceof Ss){let{model:_}=h;_.setInstanceCount(A);let b={camera:_.uniforms.cameraPosition},T={sizeScale:n,sizeMinPixels:s,sizeMaxPixels:o,composeModelMatrix:kp(r,a),sceneModelMatrix:g};_.shaderInputs.setProps({pbrProjection:b,scenegraph:T}),_.draw(i)}})}};If.defaultProps=sZ;If.layerName="ScenegraphLayer";var Y3=If;var CB=`uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,SB={name:"mesh",vs:CB,fs:CB,uniformTypes:{pickFeatureIds:"f32"}};var MB=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var PB=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function oZ(t){let e=t.positions||t.POSITION,r=e.value.length/e.size;t.COLOR_0||t.colors||(t.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}var aZ={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},Bf=class extends Fc{getShaders(){let e=super.getShaders();return e.modules.push(wo,SB),{...e,vs:MB,fs:PB}}initializeState(){let{featureIds:e}=this.props;super.initializeState();let r=this.getAttributeManager();e&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);let{props:r,oldProps:i}=e;r.pbrMaterial!==i.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(e){let{featureIds:r}=this.props,{model:i}=this.state;if(!i)return;let n={pickFeatureIds:!!r},s={camera:i.uniforms.cameraPosition};i.shaderInputs.setProps({pbrProjection:s,mesh:n}),super.draw(e)}getModel(e){let{id:r}=this.props,i=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:i});let n=this.getShaders();return oZ(e.attributes),new je(this.context.device,{...this.getShaders(),id:r,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...n.defines,...i?.defines,HAS_UV_REGIONS:e.attributes.uvRegions?1:0},parameters:i?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){let{model:r}=this.state;if(r){let{mesh:i}=this.props,n=this.parseMaterial(e,i);this.setState({parsedPBRMaterial:n});let{pbr_baseColorSampler:s}=n.bindings,{emptyTexture:o}=this.state,a={sampler:s||o,hasTexture:!!s},{camera:A,...h}={...n.bindings,...n.uniforms};r.shaderInputs.setProps({simpleMesh:a,pbrMaterial:h})}}parseMaterial(e,r){let i=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return wf(this.context.device,{unlit:i,...e},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){let r=this.props.featureIds,i=new Uint8ClampedArray(r.length*e.size),n=[];for(let s=0;s<r.length;s++)this.encodePickingColor(r[s],n),i[s*3]=n[0],i[s*3+1]=n[1],i[s*3+2]=n[2];e.value=i}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}};Bf.layerName="MeshLayer";Bf.defaultProps=aZ;var RB=Bf;var ts=6356752314245179e-9,cZ={radii:[6378137,6378137,ts],radiiSquared:[6378137*6378137,6378137*6378137,ts*ts],oneOverRadii:[1/6378137,1/6378137,1/ts],oneOverRadiiSquared:[1/(6378137*6378137),1/(6378137*6378137),1/(ts*ts)],maximumRadius:Math.max(6378137,6378137,ts),centerToleranceSquared:.1};function ig(t){return t}var lOe=new G;function lZ(t,e=[],r=ig){return"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):"x"in t?(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function IB(t,e=[]){return lZ(t,e,It._cartographicRadians?ig:s2)}function AZ(t,e,r=ig){return"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):"x"in e?(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]):(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]),e}function BB(t,e){return AZ(t,e,It._cartographicRadians?ig:o2)}var OB=1e-14,uZ=new G,FB={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Q3={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Of={east:new G,north:new G,up:new G,west:new G,south:new G,down:new G},fZ=new G,hZ=new G,dZ=new G;function q3(t,e,r,i,n,s){let o=FB[e]&&FB[e][r];gr(o&&(!i||i===o));let a,A,h,g=uZ.copy(n);if(er(g.x,0,OB)&&er(g.y,0,OB)){let b=Math.sign(g.z);a=fZ.fromArray(Q3[e]),e!=="east"&&e!=="west"&&a.scale(b),A=hZ.fromArray(Q3[r]),r!=="east"&&r!=="west"&&A.scale(b),h=dZ.fromArray(Q3[i]),i!=="east"&&i!=="west"&&h.scale(b)}else{let{up:b,east:T,north:v}=Of;T.set(-g.y,g.x,0).normalize(),t.geodeticSurfaceNormal(g,b),v.copy(b).cross(T);let{down:C,west:S,south:P}=Of;C.copy(b).scale(-1),S.copy(T).scale(-1),P.copy(v).scale(-1),a=Of[e],A=Of[r],h=Of[i]}return s[0]=a.x,s[1]=a.y,s[2]=a.z,s[3]=0,s[4]=A.x,s[5]=A.y,s[6]=A.z,s[7]=0,s[8]=h.x,s[9]=h.y,s[10]=h.z,s[11]=0,s[12]=g.x,s[13]=g.y,s[14]=g.z,s[15]=1,s}var Gc=new G,pZ=new G,gZ=new G;function LB(t,e,r=[]){let{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:s}=e;Gc.from(t);let o=Gc.x,a=Gc.y,A=Gc.z,h=i.x,g=i.y,_=i.z,b=o*o*h*h,T=a*a*g*g,v=A*A*_*_,C=b+T+v,S=Math.sqrt(1/C);if(!Number.isFinite(S))return;let P=pZ;if(P.copy(t).scale(S),C<s)return P.to(r);let F=n.x,I=n.y,k=n.z,W=gZ;W.set(P.x*F*2,P.y*I*2,P.z*k*2);let K=(1-S)*Gc.len()/(.5*W.len()),re=0,Y,z,L,se;do{K-=re,Y=1/(1+K*F),z=1/(1+K*I),L=1/(1+K*k);let le=Y*Y,ce=z*z,he=L*L,Re=le*Y,Ke=ce*z,Ye=he*L;se=b*le+T*ce+v*he-1;let nt=-2*(b*Re*F+T*Ke*I+v*Ye*k);re=se/nt}while(Math.abs(se)>Oi.EPSILON12);return Gc.scale([Y,z,L]).to(r)}var ng=new G,NB=new G,yZ=new G,ji=new G,xZ=new G,sg=new G,tt=class{constructor(e=0,r=0,i=0){this.centerToleranceSquared=Oi.EPSILON1,gr(e>=0),gr(r>=0),gr(i>=0),this.radii=new G(e,r,i),this.radiiSquared=new G(e*e,r*r,i*i),this.radiiToTheFourth=new G(e*e*e*e,r*r*r*r,i*i*i*i),this.oneOverRadii=new G(e===0?0:1/e,r===0?0:1/r,i===0?0:1/i),this.oneOverRadiiSquared=new G(e===0?0:1/(e*e),r===0?0:1/(r*r),i===0?0:1/(i*i)),this.minimumRadius=Math.min(e,r,i),this.maximumRadius=Math.max(e,r,i),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,r=[0,0,0]){let i=NB,n=yZ,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,i),n.copy(this.radiiSquared).scale(i);let o=Math.sqrt(i.dot(n));return n.scale(1/o),i.scale(s),n.add(i),n.to(r)}cartesianToCartographic(e,r=[0,0,0]){sg.from(e);let i=this.scaleToGeodeticSurface(sg,ji);if(!i)return;let n=this.geodeticSurfaceNormal(i,NB),s=xZ;s.copy(sg).subtract(i);let o=Math.atan2(n.y,n.x),a=Math.asin(n.z),A=Math.sign(Tr.dot(s,sg))*Tr.length(s);return BB([o,a,A],r)}eastNorthUpToFixedFrame(e,r=new Ce){return q3(this,"east","north","up",e,r)}localFrameToFixedFrame(e,r,i,n,s=new Ce){return q3(this,e,r,i,n,s)}geocentricSurfaceNormal(e,r=[0,0,0]){return ng.from(e).normalize().to(r)}geodeticSurfaceNormalCartographic(e,r=[0,0,0]){let i=IB(e),n=i[0],s=i[1],o=Math.cos(s);return ng.set(o*Math.cos(n),o*Math.sin(n),Math.sin(s)).normalize(),ng.to(r)}geodeticSurfaceNormal(e,r=[0,0,0]){return ng.from(e).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(e,r){return LB(e,this,r)}scaleToGeocentricSurface(e,r=[0,0,0]){ji.from(e);let i=ji.x,n=ji.y,s=ji.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(i*i*o.x+n*n*o.y+s*s*o.z);return ji.multiplyScalar(a).to(r)}transformPositionToScaledSpace(e,r=[0,0,0]){return ji.from(e).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(e,r=[0,0,0]){return ji.from(e).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(e,r=0,i=[0,0,0]){gr(er(this.radii.x,this.radii.y,Oi.EPSILON15)),gr(this.radii.z>0),ji.from(e);let n=ji.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-r))return ji.set(0,0,n).to(i)}};tt.WGS84=new tt(6378137,6378137,ts);var og=class{item;previous;next;constructor(e,r,i){this.item=e,this.previous=r,this.next=i}};var ag=class{head=null;tail=null;_length=0;get length(){return this._length}add(e){let r=new og(e,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,r){e!==r&&(this.remove(r),this._insert(e,r))}_insert(e,r){let i=e.next;e.next=r,this.tail===e?this.tail=r:i.previous=r,r.next=i,r.previous=e,++this._length}};var cg=class{_list;_sentinel;_trimTiles;constructor(){this._list=new ag,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){let r=e._cacheNode;r&&this._list.splice(this._sentinel,r)}add(e,r,i){r._cacheNode||(r._cacheNode=this._list.add(r),i&&i(e,r))}unloadTile(e,r,i){let n=r._cacheNode;n&&(this._list.remove(n),r._cacheNode=null,i&&i(e,r))}unloadTiles(e,r){let i=this._trimTiles;this._trimTiles=!1;let n=this._list,s=e.maximumMemoryUsage*1024*1024,o=this._sentinel,a=n.head;for(;a!==o&&(e.gpuMemoryUsageInBytes>s||i);){let A=a.item;a=a.next,this.unloadTile(e,A,r)}}trim(){this._trimTiles=!0}};function DB(t,e){Ze(t),Ze(e);let{rtcCenter:r,gltfUpAxis:i}=e,{computedTransform:n,boundingVolume:{center:s}}=t,o=new Ce(n);switch(r&&o.translate(r),i){case"Z":break;case"Y":let _=new Ce().rotateX(Math.PI/2);o=o.multiplyRight(_);break;case"X":let b=new Ce().rotateY(-Math.PI/2);o=o.multiplyRight(b);break;default:break}e.isQuantized&&o.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);let a=new G(s);e.cartesianModelMatrix=o,e.cartesianOrigin=a;let A=tt.WGS84.cartesianToCartographic(a,new G),g=tt.WGS84.eastNorthUpToFixedFrame(a).invert();e.cartographicModelMatrix=g.multiplyRight(o),e.cartographicOrigin=A,e.coordinateSystem||(e.modelMatrix=e.cartographicModelMatrix)}var kB=new G,K3=new G,J3=new zr([new Ir,new Ir,new Ir,new Ir,new Ir,new Ir]);function VB(t,e){let{cameraDirection:r,cameraUp:i,height:n}=t,{metersPerUnit:s}=t.distanceScales,o=lg(t,t.center),a=tt.WGS84.eastNorthUpToFixedFrame(o),A=t.unprojectPosition(t.cameraPosition),h=tt.WGS84.cartographicToCartesian(A,new G),g=new G(a.transformAsVector(new G(r).scale(s))).normalize(),_=new G(a.transformAsVector(new G(i).scale(s))).normalize();bZ(t);let b=t.constructor,{longitude:T,latitude:v,width:C,bearing:S,zoom:P}=t,F=new b({longitude:T,latitude:v,height:n,width:C,bearing:S,zoom:P,pitch:0});return{camera:{position:h,direction:g,up:_},viewport:t,topDownViewport:F,height:n,cullingVolume:J3,frameNumber:e,sseDenominator:1.15}}function zB(t,e,r){if(r===0||t.length<=r)return[t,[]];let i=[],{longitude:n,latitude:s}=e.viewport;for(let[h,g]of t.entries()){let[_,b]=g.header.mbs,T=Math.abs(n-_),v=Math.abs(s-b),C=Math.sqrt(v*v+T*T);i.push([h,C])}let o=i.sort((h,g)=>h[1]-g[1]),a=[];for(let h=0;h<r;h++)a.push(t[o[h][0]]);let A=[];for(let h=r;h<o.length;h++)A.push(t[o[h][0]]);return[a,A]}function bZ(t){let e=t.getFrustumPlanes(),r=UB(e.near,t.cameraPosition),i=lg(t,r),n=lg(t,t.cameraPosition,K3),s=0;J3.planes[s++].fromPointNormal(i,kB.copy(i).subtract(n));for(let o in e){if(o==="near")continue;let a=e[o],A=UB(a,r,K3),h=lg(t,A,K3);J3.planes[s++].fromPointNormal(h,kB.copy(i).subtract(h))}}function UB(t,e,r=new G){let i=t.normal.dot(e);return r.copy(t.normal).scale(t.distance-i).add(e),r}function lg(t,e,r=new G){let i=t.unprojectPosition(e);return tt.WGS84.cartographicToCartesian(i,r)}var TZ=6378137,EZ=6378137,Z3=6356752314245179e-9,Wc=new G;function HB(t,e){if(t instanceof Zn){let{halfAxes:r}=t,i=vZ(r);return Math.log2(Z3/(i+e[2]))}else if(t instanceof wn){let{radius:r}=t;return Math.log2(Z3/(r+e[2]))}else if(t.width&&t.height){let{width:r,height:i}=t,n=Math.log2(TZ/r),s=Math.log2(EZ/i);return(n+s)/2}return 1}function $3(t,e,r){tt.WGS84.cartographicToCartesian([t.xmax,t.ymax,t.zmax],Wc);let i=Math.sqrt(Math.pow(Wc[0]-r[0],2)+Math.pow(Wc[1]-r[1],2)+Math.pow(Wc[2]-r[2],2));return Math.log2(Z3/(i+e[2]))}function GB(t,e,r){let[i,n,s,o]=t;return $3({xmin:i,xmax:s,ymin:n,ymax:o,zmin:0,zmax:0},e,r)}function vZ(t){t.getColumn(0,Wc);let e=t.getColumn(1),r=t.getColumn(2);return Wc.add(e).add(r).len()}var Hr={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Or;(function(t){t[t.ADD=1]="ADD",t[t.REPLACE=2]="REPLACE"})(Or||(Or={}));var Ci;(function(t){t.EMPTY="empty",t.SCENEGRAPH="scenegraph",t.POINTCLOUD="pointcloud",t.MESH="mesh"})(Ci||(Ci={}));var yr;(function(t){t.I3S="I3S",t.TILES3D="TILES3D"})(yr||(yr={}));var rs;(function(t){t.GEOMETRIC_ERROR="geometricError",t.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(rs||(rs={}));var WB={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function QB(t){return t!=null}var Fr=new G,Ag=new G,wZ=new G,CZ=new G,na=new G,jB=new G,XB=new G,YB=new G;function ug(t,e,r){if(Ze(t,"3D Tile: boundingVolume must be defined"),t.box)return KB(t.box,e,r);if(t.region)return MZ(t.region);if(t.sphere)return SZ(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function qB(t,e){if(t.box)return PZ(e);if(t.region){let[r,i,n,s,o,a]=t.region;return[[oi(r),oi(i),o],[oi(n),oi(s),a]]}if(t.sphere)return RZ(e);throw new Error("Unkown boundingVolume type")}function KB(t,e,r){let i=new G(t[0],t[1],t[2]);e.transform(i,i);let n=[];if(t.length===10){let h=t.slice(3,6),g=new yi;g.fromArray(t,6);let _=new G([1,0,0]),b=new G([0,1,0]),T=new G([0,0,1]);_.transformByQuaternion(g),_.scale(h[0]),b.transformByQuaternion(g),b.scale(h[1]),T.transformByQuaternion(g),T.scale(h[2]),n=[..._.toArray(),...b.toArray(),...T.toArray()]}else n=[...t.slice(3,6),...t.slice(6,9),...t.slice(9,12)];let s=e.transformAsVector(n.slice(0,3)),o=e.transformAsVector(n.slice(3,6)),a=e.transformAsVector(n.slice(6,9)),A=new yt([s[0],s[1],s[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return QB(r)?(r.center=i,r.halfAxes=A,r):new Zn(i,A)}function SZ(t,e,r){let i=new G(t[0],t[1],t[2]);e.transform(i,i);let n=e.getScale(Ag),s=Math.max(Math.max(n[0],n[1]),n[2]),o=t[3]*s;return QB(r)?(r.center=i,r.radius=o,r):new wn(i,o)}function MZ(t){let[e,r,i,n,s,o]=t,a=tt.WGS84.cartographicToCartesian([oi(e),oi(n),s],wZ),A=tt.WGS84.cartographicToCartesian([oi(i),oi(r),o],CZ),h=new G().addVectors(a,A).multiplyByScalar(.5);return tt.WGS84.cartesianToCartographic(h,na),tt.WGS84.cartographicToCartesian([oi(i),na[1],na[2]],jB),tt.WGS84.cartographicToCartesian([na[0],oi(n),na[2]],XB),tt.WGS84.cartographicToCartesian([na[0],na[1],o],YB),KB([...h,...jB.subtract(h),...XB.subtract(h),...YB.subtract(h)],new Ce)}function PZ(t){let e=JB(),{halfAxes:r}=t,i=new G(r.getColumn(0)),n=new G(r.getColumn(1)),s=new G(r.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let A=0;A<2;A++)Fr.copy(t.center),Fr.add(i),Fr.add(n),Fr.add(s),ZB(e,Fr),s.negate();n.negate()}i.negate()}return e}function RZ(t){let e=JB(),{center:r,radius:i}=t,n=tt.WGS84.scaleToGeodeticSurface(r,Fr),s;n?s=tt.WGS84.geodeticSurfaceNormal(n):s=new G(0,0,1);let o=new G(s[2],-s[1],0);o.len()>0?o.normalize():o=new G(0,1,0);let a=o.clone().cross(s);for(let A of[o,a,s]){Ag.copy(A).scale(i);for(let h=0;h<2;h++)Fr.copy(r),Fr.add(Ag),ZB(e,Fr),Ag.negate()}return e}function JB(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function ZB(t,e){tt.WGS84.cartesianToCartographic(e,Fr),t[0][0]=Math.min(t[0][0],Fr[0]),t[0][1]=Math.min(t[0][1],Fr[1]),t[0][2]=Math.min(t[0][2],Fr[2]),t[1][0]=Math.max(t[1][0],Fr[0]),t[1][1]=Math.max(t[1][1],Fr[1]),t[1][2]=Math.max(t[1][2],Fr[2])}var qOe=new G,KOe=new G,JOe=new Ce,ZOe=new G,$Oe=new G,eFe=new G;function IZ(t,e){let r=t*e;return 1-Math.exp(-(r*r))}function BZ(t,e){if(t.dynamicScreenSpaceError&&t.dynamicScreenSpaceErrorComputedDensity){let r=t.dynamicScreenSpaceErrorComputedDensity,i=t.dynamicScreenSpaceErrorFactor;return IZ(e,r)*i}return 0}function $B(t,e,r){let i=t.tileset,n=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,s=r?n:t.lodMetricValue;if(s===0)return 0;let o=Math.max(t._distanceToCamera,1e-7),{height:a,sseDenominator:A}=e,{viewDistanceScale:h}=i.options,g=s*a*(h||1)/(o*A);return g-=BZ(i,o),g}var ex=new G,e6=new G,Qs=new G,t6=new G,OZ=new G,tx=new Ce,r6=new Ce;function i6(t,e){if(t.lodMetricValue===0||isNaN(t.lodMetricValue))return"DIG";let r=2*rx(t,e);return r<2?"OUT":!t.header.children||r<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}function rx(t,e){let{topDownViewport:r}=e,i=t.header.mbs[1],n=t.header.mbs[0],s=t.header.mbs[2],o=t.header.mbs[3],a=[...t.boundingVolume.center],A=r.unprojectPosition(r.cameraPosition);tt.WGS84.cartographicToCartesian(A,ex),e6.copy(ex).subtract(a).normalize(),tt.WGS84.eastNorthUpToFixedFrame(a,tx),r6.copy(tx).invert(),Qs.copy(ex).transform(r6);let h=Math.sqrt(Qs[0]*Qs[0]+Qs[1]*Qs[1]),g=h*h/Qs[2];t6.copy([Qs[0],Qs[1],g]);let b=t6.transform(tx).subtract(a).normalize(),v=e6.cross(b).normalize().scale(o).add(a),C=tt.WGS84.cartesianToCartographic(v),S=r.project([n,i,s]),P=r.project(C);return OZ.copy(S).subtract(P).magnitude()}function n6(t){return{assetGltfUpAxis:t.asset&&t.asset.gltfUpAxis||"Y"}}var Ff=class{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return Ze(e<this._array.length),this._array[e]}set(e,r){Ze(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=r,this._map.set(r,e)}delete(e){let r=this._map.get(e);r>=0&&(this._array.splice(r,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){let r=this.length++;this._array[r]=e,this._map.set(e,r)}}pop(){let e=this._array[--this.length];return this._map.delete(e),e}reserve(e){Ze(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){Ze(e>=0),this.length=e}trim(e){e==null&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}};var FZ={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""},Mn=class{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new Ff;_emptyTraversalStack=new Ff;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...FZ,...e}}traverse(e,r,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,r),this._frameNumber=r.frameNumber,this.executeTraversal(e,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,r){let i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){let s=i.pop(),o=!1;this.canTraverse(s,r)&&(this.updateChildTiles(s,r),o=this.updateAndPushChildren(s,r,i,s.hasRenderContent?s._selectionDepth+1:s._selectionDepth));let a=s.parent,A=!!(!a||a._shouldRefine),h=!o;s.hasRenderContent?s.refine===Or.ADD?(this.loadTile(s,r),this.selectTile(s,r)):s.refine===Or.REPLACE&&(this.loadTile(s,r),h&&this.selectTile(s,r)):(this.emptyTiles[s.id]=s,this.loadTile(s,r),h&&this.selectTile(s,r)),this.touchTile(s,r),s._shouldRefine=o&&A}let n=new Date().getTime();(this.traversalFinished(r)||n-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=n,this.options.onTraversalEnd(r))}updateChildTiles(e,r){let i=e.children;for(let n of i)this.updateTile(n,r)}updateAndPushChildren(e,r,i,n){let{loadSiblings:s,skipLevelOfDetail:o}=this.options,a=e.children;a.sort(this.compareDistanceToCamera.bind(this));let A=e.refine===Or.REPLACE&&e.hasRenderContent&&!o,h=!1,g=!0;for(let _ of a)if(_._selectionDepth=n,_.isVisibleAndInRequestVolume?(i.find(_)&&i.delete(_),i.push(_),h=!0):(A||s)&&(this.loadTile(_,r),this.touchTile(_,r)),A){let b;if(_._inRequestVolume?_.hasRenderContent?b=_.contentAvailable:b=this.executeEmptyTraversal(_,r):b=!1,g=g&&b,!g)return!1}return h||(g=!1),g}updateTile(e,r){this.updateTileVisibility(e,r)}selectTile(e,r){this.shouldSelectTile(e)&&(e._selectedFrame=r.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,r){this.shouldLoadTile(e)&&(e._requestedFrame=r.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,r){e.tileset._cache.touch(e),e._touchedFrame=r.frameNumber}canTraverse(e,r){return e.hasChildren?e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,r):!1}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,r,i=!1){let n=e._screenSpaceError;return i&&(n=e.getScreenSpaceError(r,!0)),n>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,r){let i=[];if(this.options.viewportTraversersMap)for(let n in this.options.viewportTraversersMap)this.options.viewportTraversersMap[n]===r.viewport.id&&i.push(n);else i.push(r.viewport.id);e.updateVisibility(r,i)}compareDistanceToCamera(e,r){return e._distanceToCamera-r._distanceToCamera}anyChildrenVisible(e,r){let i=!1;for(let n of e.children)n.updateVisibility(r),i=i||n.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,r){let i=!0,n=this._emptyTraversalStack;for(n.push(e);n.length>0;){let s=n.pop(),o=!s.hasRenderContent&&this.canTraverse(s,r),a=!s.hasRenderContent&&s.children.length===0;if(!o&&!s.contentAvailable&&!a&&(i=!1),this.updateTile(s,r),s.isVisibleAndInRequestVolume||(this.loadTile(s,r),this.touchTile(s,r)),o){let A=s.children;for(let h of A)n.push(h)}}return i}};var s6=new G;function LZ(t){return t!=null}var sa=class{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=Hr.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new Ce;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new Mn({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new Ce;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,r,i,n=""){this.header=r,this.tileset=e,this.id=n||r.id,this.url=r.url,this.parent=i,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Hr.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Hr.UNLOADED}get contentExpired(){return this.contentState===Hr.EXPIRED}get contentFailed(){return this.contentState===Hr.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=qB(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,r){switch(this.tileset.type){case yr.I3S:return rx(this,e);case yr.TILES3D:return $B(this,e,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){let e=this.tileset._traverser,{skipLevelOfDetail:r}=e.options,i=this.refine===Or.ADD||r;if(i&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Hr.UNLOADED)return-1;let n=this.parent,o=n&&(!i||this._screenSpaceError===0||n.hasTilesetContent)?n._screenSpaceError:this._screenSpaceError,a=e.root?e.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Hr.LOADING;let r=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!r)return this.contentState=Hr.UNLOADED,!1;try{let i=this.tileset.getTileUrl(this.contentUrl),n=this.tileset.loader,s={...this.tileset.loadOptions,[n.id]:{...this.tileset.loadOptions[n.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(n.id)}};return this.content=await dr(i,n,s),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Hr.READY,this._onContentLoaded(),!0}catch(i){throw this.contentState=Hr.FAILED,i}finally{r.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Hr.UNLOADED,!0}updateVisibility(e,r){if(this._frameNumber===e.frameNumber)return;let i=this.parent,n=i?i._visibilityPlaneMask:zr.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){let s=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(s)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,n),this._visible=this._visibilityPlaneMask!==zr.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=r}visibility(e,r){let{cullingVolume:i}=e,{boundingVolume:n}=this;return i.computeVisibilityWithPlaneMask(n,r)}contentVisibility(){return!0}distanceToTile(e){let r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){let r=this.boundingVolume;return s6.subVectors(r.center,e.position),e.direction.dot(s6)}insideViewerRequestVolume(e){let r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(LZ(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){let e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=Hr.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new Ce(e.transform):new Ce;let r=this.parent,i=this.tileset,n=r&&r.computedTransform?r.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new Ce(n).multiplyRight(this.transform);let s=r&&r._initialTransform?r._initialTransform.clone():new Ce;this._initialTransform=new Ce(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Hr.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=zr.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||Or.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break;default:}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=ug(e.boundingVolume,this.computedTransform,this.boundingVolume);let r=e.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=ug(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=ug(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new Ce){let r=e.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){switch(e){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return n6(this.tileset.tileset)}}};var fg=class extends Mn{compareDistanceToCamera(e,r){return r._distanceToCamera===0&&e._distanceToCamera===0?r._centerZDepth-e._centerZDepth:r._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,r){if(super.updateTileVisibility(e,r),!e.isVisibleAndInRequestVolume)return;let i=e.children.length>0;if(e.hasTilesetContent&&i){let o=e.children[0];this.updateTileVisibility(o,r),e._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(e,r)){e._visible=!1;return}let n=e.refine===Or.REPLACE,s=e._optimChildrenWithinParent===WB.USE_OPTIMIZATION;if(n&&s&&i&&!this.anyChildrenVisible(e,r)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,r){let{parent:i}=e;return!i||i.hasTilesetContent||i.refine!==Or.ADD?!1:!this.shouldRefine(e,r,!0)}};var hg=class{frameNumberMap=new Map;register(e,r){let i=this.frameNumberMap.get(e)||new Map,n=i.get(r)||0;i.set(r,n+1),this.frameNumberMap.set(e,i)}deregister(e,r){let i=this.frameNumberMap.get(e);if(!i)return;let n=i.get(r)||1;i.set(r,n-1)}isZero(e,r){return(this.frameNumberMap.get(e)?.get(r)||0)===0}};var ix={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"},dg=class{_statusMap;pendingTilesRegister=new hg;constructor(){this._statusMap={}}add(e,r,i,n){if(!this._statusMap[r]){let{frameNumber:s,viewport:{id:o}}=n;this._statusMap[r]={request:e,callback:i,key:r,frameState:n,status:ix.REQUESTED},this.pendingTilesRegister.register(o,s),e().then(a=>{this._statusMap[r].status=ix.COMPLETED;let{frameNumber:A,viewport:{id:h}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(h,A),this._statusMap[r].callback(a,n)}).catch(a=>{this._statusMap[r].status=ix.ERROR;let{frameNumber:A,viewport:{id:h}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(h,A),i(a)})}}update(e,r){if(this._statusMap[e]){let{frameNumber:i,viewport:{id:n}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(n,i);let{frameNumber:s,viewport:{id:o}}=r;this.pendingTilesRegister.register(o,s),this._statusMap[e].frameState=r}}find(e){return this._statusMap[e]}hasPendingTiles(e,r){return!this.pendingTilesRegister.isZero(e,r)}};var pg=class extends Mn{_tileManager;constructor(e){super(e),this._tileManager=new dg}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,r){return e._lodJudge=i6(e,r),e._lodJudge==="DIG"}updateChildTiles(e,r){let i=e.header.children||[],n=e.children,s=e.tileset;for(let o of i){let a=`${o.id}-${r.viewport.id}`,A=n&&n.find(h=>h.id===a);if(A)A&&this.updateTile(A,r);else{let h=()=>this._loadTile(o.id,s);this._tileManager.find(a)?this._tileManager.update(a,r):(s.tileset.nodePages&&(h=()=>s.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(h,a,_=>this._onTileLoad(_,e,a),r))}}return!1}async _loadTile(e,r){let{loader:i}=r,n=r.getTileUrl(`${r.url}/nodes/${e}`),s={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await dr(n,i,s)}_onTileLoad(e,r,i){let n=new sa(r.tileset,e,r,i);r.children.push(n);let s=this._tileManager.find(n.id).frameState;this.updateTile(n,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(n,s)}};var NZ={description:"",ellipsoid:tt.WGS84,modelMatrix:new Ce,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:t=>t,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},gg="Tiles In Tileset(s)",nx="Tiles In Memory",o6="Tiles In View",a6="Tiles To Render",c6="Tiles Loaded",sx="Tiles Loading",l6="Tiles Unloaded",A6="Failed Tile Loads",u6="Points/Vertices",ox="Tile Memory Use",f6="Maximum Screen Space Error",Lf=class{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new cg;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,r){this.options={...NZ,...r},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||ni.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new ds({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new Sr({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let i=e;return this.queryParams.length&&(i=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),i}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;let r=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;let i=[];for(let n of r){let s=n.id;this._needTraverse(s)?i.push(s):this.traverseCounter--}for(let n of r){let s=n.id;if(this.roots[s]||(this.roots[s]=this._initializeTileHeaders(this.tileset,null)),!i.includes(s))continue;let o=VB(n,this._frameNumber);this._traverser.traverse(this.roots[s],o,this.options)}}_needTraverse(e){let r=e;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[e]),r===e}_onTraversalEnd(e){let r=e.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});let i=this.frameStateData[r],n=Object.values(this._traverser.selectedTiles),[s,o]=zB(n,e,this.options.maximumTilesSelected);i.selectedTiles=s;for(let a of o)a.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(let e in this.frameStateData){let r=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(let e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,r){if(e.length!==r.length)return!0;let i=new Set(e.map(o=>o.id)),n=new Set(r.map(o=>o.id)),s=e.filter(o=>!n.has(o.id)).length>0;return s=s||r.filter(o=>!i.has(o.id)).length>0,s}_loadTiles(){for(let e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,r)=>e._unloadTile(r))}_updateStats(){let e=0,r=0;for(let i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?r+=i.content.pointCount:r+=i.content.vertexCount);this.stats.get(o6).count=this.selectedTiles.length,this.stats.get(a6).count=e,this.stats.get(u6).count=r,this.stats.get(f6).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===yr.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===yr.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===yr.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){let e=this.tileset.fullExtent;if(e){let{xmin:i,xmax:n,ymin:s,ymax:o,zmin:a,zmax:A}=e;this.cartographicCenter=new G(i+(n-i)/2,s+(o-s)/2,a+(A-a)/2),this.cartesianCenter=new G,tt.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=$3(e,this.cartographicCenter,this.cartesianCenter);return}let r=this.tileset.store?.extent;if(r){let[i,n,s,o]=r;this.cartographicCenter=new G(i+(s-i)/2,n+(o-n)/2,0),this.cartesianCenter=new G,tt.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=GB(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new G,this.zoom=1}calculateViewPropsTiles3D(){let e=this.root,{center:r}=e.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new G,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new G,tt.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new G(0,0,-tt.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=HB(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(gg),this.stats.get(sx),this.stats.get(nx),this.stats.get(o6),this.stats.get(a6),this.stats.get(c6),this.stats.get(l6),this.stats.get(A6),this.stats.get(u6),this.stats.get(ox,"memory"),this.stats.get(f6)}_initializeTileHeaders(e,r){let i=new sa(this,e.root,r);if(r&&(r.children.push(i),i.depth=r.depth+1),this.type===yr.TILES3D){let n=[];for(n.push(i);n.length>0;){let s=n.pop();this.stats.get(gg).incrementCount();let o=s.header.children||[];for(let a of o){let A=new sa(this,a,s);if(A.contentUrl?.includes("?session=")){let g=new URL(A.contentUrl).searchParams.get("session");g&&(this._queryParams.session=g)}s.children.push(A),A.depth=s.depth+1,n.push(A)}}}return i}_initializeTraverser(){let e;switch(this.type){case yr.TILES3D:e=fg;break;case yr.I3S:e=pg;break;default:e=Mn}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let r;try{this._onStartTileLoading(),r=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,r)}}_onTileLoadError(e,r){this.stats.get(A6).incrementCount();let i=r.message||r.toString(),n=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,n)}_onTileLoad(e,r){if(r){if(this.type===yr.I3S){let i=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(gg).reset(),this.stats.get(gg).addCount(i)}e&&e.content&&DB(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===yr.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break;default:}else if(this.type===yr.TILES3D){let{extensionsRemoved:r=[]}=e.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(sx).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(sx).decrementCount()}_addTileToCache(e){this._cache.add(this,e,r=>r._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(c6).incrementCount(),this.stats.get(nx).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(ox).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(nx).decrementCount(),this.stats.get(l6).incrementCount(),this.stats.get(ox).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){let e=[];for(this.root&&e.push(this.root);e.length>0;){let r=e.pop();for(let i of r.children)e.push(i);this._destroyTile(r)}this.root=null}_destroySubtree(e){let r=e,i=[];for(i.push(r);i.length>0;){e=i.pop();for(let n of e.children)i.push(n);e!==r&&this._destroyTile(e)}r.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){let r=new URLSearchParams(e.queryString),i=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}};var mg="4.3.2";var oa={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},JFe=Object.keys(oa);function ax(t,e,r){Ze(t instanceof ArrayBuffer);let i=new TextDecoder("utf8"),n=new Uint8Array(t,e,r);return i.decode(n)}function h6(t,e=0){let r=new DataView(t);return`${String.fromCharCode(r.getUint8(e+0))}${String.fromCharCode(r.getUint8(e+1))}${String.fromCharCode(r.getUint8(e+2))}${String.fromCharCode(r.getUint8(e+3))}`}var DZ={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Jt={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},qe={...DZ,...Jt};var cx={[Jt.DOUBLE]:Float64Array,[Jt.FLOAT]:Float32Array,[Jt.UNSIGNED_SHORT]:Uint16Array,[Jt.UNSIGNED_INT]:Uint32Array,[Jt.UNSIGNED_BYTE]:Uint8Array,[Jt.BYTE]:Int8Array,[Jt.SHORT]:Int16Array,[Jt.INT]:Int32Array},kZ={DOUBLE:Jt.DOUBLE,FLOAT:Jt.FLOAT,UNSIGNED_SHORT:Jt.UNSIGNED_SHORT,UNSIGNED_INT:Jt.UNSIGNED_INT,UNSIGNED_BYTE:Jt.UNSIGNED_BYTE,BYTE:Jt.BYTE,SHORT:Jt.SHORT,INT:Jt.INT},lx="Failed to convert GL type",Xi=class t{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(let r in cx)if(cx[r]===e)return r;throw new Error(lx)}static fromName(e){let r=kZ[e];if(!r)throw new Error(lx);return r}static getArrayType(e){switch(e){case Jt.UNSIGNED_SHORT_5_6_5:case Jt.UNSIGNED_SHORT_4_4_4_4:case Jt.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:let r=cx[e];if(!r)throw new Error(lx);return r}}static getByteSize(e){return t.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!t.getArrayType(e)}static createTypedArray(e,r,i=0,n){n===void 0&&(n=(r.byteLength-i)/t.getByteSize(e));let s=t.getArrayType(e);return new s(r,i,n)}};function d6(t,e){if(!t)throw new Error(`math.gl assertion failed. ${e}`)}function Ax(t,e=[0,0,0]){let r=t>>11&31,i=t>>5&63,n=t&31;return e[0]=r<<3,e[1]=i<<2,e[2]=n<<3,e}var cLe=1/256;var lLe=new To,ALe=new G,uLe=new To,fLe=new To,hLe=new Uint8Array(1);function p6(t,e=255){return pr(t,0,e)/e*2-1}function g6(t){return t<0?-1:1}function m6(t,e,r,i){if(d6(i),t<0||t>r||e<0||e>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=p6(t,r),i.y=p6(e,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){let n=i.x;i.x=(1-Math.abs(i.y))*g6(n),i.y=(1-Math.abs(n))*g6(i.y)}return i.normalize()}function ux(t,e,r){return m6(t,e,255,r)}var is=class{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,r){this.json=e,this.buffer=r}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,r=qe.UNSIGNED_INT,i=1){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?this._getTypedArrayFromBinary(e,r,i,1,n.byteOffset):n}getPropertyArray(e,r,i){let n=this.json[e];return n&&Number.isFinite(n.byteOffset)?("componentType"in n&&(r=Xi.fromName(n.componentType)),this._getTypedArrayFromBinary(e,r,i,this.featuresLength,n.byteOffset)):this._getTypedArrayFromArray(e,r,n)}getProperty(e,r,i,n,s){let o=this.json[e];if(!o)return o;let a=this.getPropertyArray(e,r,i);if(i===1)return a[n];for(let A=0;A<i;++A)s[A]=a[i*n+A];return s}_getTypedArrayFromBinary(e,r,i,n,s){let o=this._cachedTypedArrays,a=o[e];return a||(a=Xi.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+s,n*i),o[e]=a),a}_getTypedArrayFromArray(e,r,i){let n=this._cachedTypedArrays,s=n[e];return s||(s=Xi.createTypedArray(r,i),n[e]=s),s}};var UZ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},VZ={SCALAR:(t,e)=>t[e],VEC2:(t,e)=>[t[2*e+0],t[2*e+1]],VEC3:(t,e)=>[t[3*e+0],t[3*e+1],t[3*e+2]],VEC4:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT2:(t,e)=>[t[4*e+0],t[4*e+1],t[4*e+2],t[4*e+3]],MAT3:(t,e)=>[t[9*e+0],t[9*e+1],t[9*e+2],t[9*e+3],t[9*e+4],t[9*e+5],t[9*e+6],t[9*e+7],t[9*e+8]],MAT4:(t,e)=>[t[16*e+0],t[16*e+1],t[16*e+2],t[16*e+3],t[16*e+4],t[16*e+5],t[16*e+6],t[16*e+7],t[16*e+8],t[16*e+9],t[16*e+10],t[16*e+11],t[16*e+12],t[16*e+13],t[16*e+14],t[16*e+15]]},zZ={SCALAR:(t,e,r)=>{e[r]=t},VEC2:(t,e,r)=>{e[2*r+0]=t[0],e[2*r+1]=t[1]},VEC3:(t,e,r)=>{e[3*r+0]=t[0],e[3*r+1]=t[1],e[3*r+2]=t[2]},VEC4:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT2:(t,e,r)=>{e[4*r+0]=t[0],e[4*r+1]=t[1],e[4*r+2]=t[2],e[4*r+3]=t[3]},MAT3:(t,e,r)=>{e[9*r+0]=t[0],e[9*r+1]=t[1],e[9*r+2]=t[2],e[9*r+3]=t[3],e[9*r+4]=t[4],e[9*r+5]=t[5],e[9*r+6]=t[6],e[9*r+7]=t[7],e[9*r+8]=t[8],e[9*r+9]=t[9]},MAT4:(t,e,r)=>{e[16*r+0]=t[0],e[16*r+1]=t[1],e[16*r+2]=t[2],e[16*r+3]=t[3],e[16*r+4]=t[4],e[16*r+5]=t[5],e[16*r+6]=t[6],e[16*r+7]=t[7],e[16*r+8]=t[8],e[16*r+9]=t[9],e[16*r+10]=t[10],e[16*r+11]=t[11],e[16*r+12]=t[12],e[16*r+13]=t[13],e[16*r+14]=t[14],e[16*r+15]=t[15]}};function _6(t,e,r,i){let{componentType:n}=t;Ze(t.componentType);let s=typeof n=="string"?Xi.fromName(n):n,o=UZ[t.type],a=VZ[t.type],A=zZ[t.type];return r+=t.byteOffset,{values:Xi.createTypedArray(s,e,r,o*i),type:s,size:o,unpacker:a,packer:A}}var Pn=t=>t!==void 0;function y6(t,e,r){if(!e)return null;let i=t.getExtension("3DTILES_batch_table_hierarchy"),n=e.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),e.extensions=e.extensions||{},e.extensions["3DTILES_batch_table_hierarchy"]=n,i=n),i?HZ(i,r):null}function HZ(t,e){let r,i,n,s=t.instancesLength,o=t.classes,a=t.classIds,A=t.parentCounts,h=t.parentIds,g=s;Pn(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,n=getBinaryAccessor(a),a=n.createArrayBufferView(e.buffer,e.byteOffset+a.byteOffset,s));let _;if(Pn(A))for(Pn(A.byteOffset)&&(A.componentType=defaultValue(A.componentType,GL.UNSIGNED_SHORT),A.type=AttributeType.SCALAR,n=getBinaryAccessor(A),A=n.createArrayBufferView(e.buffer,e.byteOffset+A.byteOffset,s)),_=new Uint16Array(s),g=0,r=0;r<s;++r)_[r]=g,g+=A[r];Pn(h)&&Pn(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,n=getBinaryAccessor(h),h=n.createArrayBufferView(e.buffer,e.byteOffset+h.byteOffset,g));let b=o.length;for(r=0;r<b;++r){let S=o[r].length,P=o[r].instances,F=getBinaryProperties(S,P,e);o[r].instances=combine(F,P)}let T=new Array(b).fill(0),v=new Uint16Array(s);for(r=0;r<s;++r)i=a[r],v[r]=T[i],++T[i];let C={classes:o,classIds:a,classIndexes:v,parentCounts:A,parentIndexes:_,parentIds:h};return jZ(C),C}function jc(t,e,r){if(!t)return;let i=t.parentCounts;return t.parentIds?r(t,e):i>0?GZ(t,e,r):WZ(t,e,r)}function GZ(t,e,r){let i=t.classIds,n=t.parentCounts,s=t.parentIds,o=t.parentIndexes,a=i.length,A=scratchVisited;A.length=Math.max(A.length,a);let h=++marker,g=scratchStack;for(g.length=0,g.push(e);g.length>0;){if(e=g.pop(),A[e]===h)continue;A[e]=h;let _=r(t,e);if(Pn(_))return _;let b=n[e],T=o[e];for(let v=0;v<b;++v){let C=s[T+v];C!==e&&g.push(C)}}return null}function WZ(t,e,r){let i=!0;for(;i;){let n=r(t,e);if(Pn(n))return n;let s=t.parentIds[e];i=s!==e,e=s}throw new Error("traverseHierarchySingleParent")}function jZ(t){let e=[],i=t.classIds.length;for(let n=0;n<i;++n)x6(t,n,stack)}function x6(t,e,r){let i=t.parentCounts,n=t.parentIds,s=t.parentIndexes,a=t.classIds.length;if(!Pn(n))return;assert(e<a,`Parent index ${e} exceeds the total number of instances: ${a}`),assert(r.indexOf(e)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(e);let A=Pn(i)?i[e]:1,h=Pn(i)?s[e]:e;for(let g=0;g<A;++g){let _=n[h+g];_!==e&&x6(t,_,r)}r.pop(e)}function $r(t){return t!=null}var _g=(t,e)=>t,XZ={HIERARCHY:!0,extensions:!0,extras:!0},aa=class{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,r,i,n={}){Ze(i>=0),this.json=e||{},this.binary=r,this.featureCount=i,this._extensions=this.json?.extensions||{},this._properties={};for(let s in this.json)XZ[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),n["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=y6(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,r){if(this._checkBatchId(e),Ze(typeof r=="string",r),this._hierarchy){let i=jc(this._hierarchy,e,(n,s)=>{let o=n.classIds[s];return n.classes[o].name===r});return $r(i)}return!1}isExactClass(e,r){return Ze(typeof r=="string",r),this.getExactClassName(e)===r}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){let r=this._hierarchy.classIds[e];return this._hierarchy.classes[r].name}}hasProperty(e,r){return this._checkBatchId(e),Ze(typeof r=="string",r),$r(this._properties[r])||this._hasPropertyInHierarchy(e,r)}getPropertyNames(e,r){this._checkBatchId(e),r=$r(r)?r:[],r.length=0;let i=Object.keys(this._properties);return r.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,r),r}getProperty(e,r){if(this._checkBatchId(e),Ze(typeof r=="string",r),this._binaryProperties){let n=this._binaryProperties[r];if($r(n))return this._getBinaryProperty(n,e)}let i=this._properties[r];if($r(i))return _g(i[e],!0);if(this._hierarchy){let n=this._getHierarchyProperty(e,r);if($r(n))return n}}setProperty(e,r,i){let n=this.featureCount;if(this._checkBatchId(e),Ze(typeof r=="string",r),this._binaryProperties){let o=this._binaryProperties[r];if(o){this._setBinaryProperty(o,e,i);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,r,i))return;let s=this._properties[r];$r(s)||(this._properties[r]=new Array(n),s=this._properties[r]),s[e]=_g(i,!0)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,r){return e.unpack(e.typedArray,r)}_setBinaryProperty(e,r,i){e.pack(i,e.typedArray,r)}_initializeBinaryProperties(){let e=null;for(let r in this._properties){let i=this._properties[r],n=this._initializeBinaryProperty(r,i);n&&(e=e||{},e[r]=n)}return e}_initializeBinaryProperty(e,r){if("byteOffset"in r){let i=r;Ze(this.binary,`Property ${e} requires a batch table binary.`),Ze(i.type,`Property ${e} requires a type.`);let n=_6(i,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:n.values,componentCount:n.size,unpack:n.unpacker,pack:n.packer}}return null}_hasPropertyInHierarchy(e,r){if(!this._hierarchy)return!1;let i=jc(this._hierarchy,e,(n,s)=>{let o=n.classIds[s],a=n.classes[o].instances;return $r(a[r])});return $r(i)}_getPropertyNamesInHierarchy(e,r){jc(this._hierarchy,e,(i,n)=>{let s=i.classIds[n],o=i.classes[s].instances;for(let a in o)o.hasOwnProperty(a)&&r.indexOf(a)===-1&&r.push(a)})}_getHierarchyProperty(e,r){return jc(this._hierarchy,e,(i,n)=>{let s=i.classIds[n],o=i.classes[s],a=i.classIndexes[n],A=o.instances[r];return $r(A)?$r(A.typedArray)?this._getBinaryProperty(A,a):_g(A[a],!0):null})}_setHierarchyProperty(e,r,i,n){let s=jc(this._hierarchy,r,(o,a)=>{let A=o.classIds[a],h=o.classes[A],g=o.classIndexes[a],_=h.instances[i];return $r(_)?(Ze(a===r,`Inherited property "${i}" is read-only.`),$r(_.typedArray)?this._setBinaryProperty(_,g,n):_[g]=_g(n,!0),!0):!1});return $r(s)}};function qs(t,e,r=0){let i=new DataView(e);if(t.magic=i.getUint32(r,!0),r+=4,t.version=i.getUint32(r,!0),r+=4,t.byteLength=i.getUint32(r,!0),r+=4,t.version!==1)throw new Error(`3D Tile Version ${t.version} not supported`);return r}var Xc=4,b6="b3dm tile in legacy format.";function Yc(t,e,r){let i=new DataView(e),n;t.header=t.header||{};let s=i.getUint32(r,!0);r+=Xc;let o=i.getUint32(r,!0);r+=Xc;let a=i.getUint32(r,!0);r+=Xc;let A=i.getUint32(r,!0);return r+=Xc,a>=570425344?(r-=Xc*2,n=s,a=o,A=0,s=0,o=0,console.warn(b6)):A>=570425344&&(r-=Xc,n=a,a=s,A=o,s=0,o=0,console.warn(b6)),t.header.featureTableJsonByteLength=s,t.header.featureTableBinaryByteLength=o,t.header.batchTableJsonByteLength=a,t.header.batchTableBinaryByteLength=A,t.header.batchLength=n,r}function Qc(t,e,r,i){return r=YZ(t,e,r,i),r=QZ(t,e,r,i),r}function YZ(t,e,r,i){let{featureTableJsonByteLength:n,featureTableBinaryByteLength:s,batchLength:o}=t.header||{};if(t.featureTableJson={BATCH_LENGTH:o||0},n&&n>0){let a=ax(e,r,n);t.featureTableJson=JSON.parse(a)}return r+=n||0,t.featureTableBinary=new Uint8Array(e,r,s),r+=s||0,r}function QZ(t,e,r,i){let{batchTableJsonByteLength:n,batchTableBinaryByteLength:s}=t.header||{};if(n&&n>0){let o=ax(e,r,n);t.batchTableJson=JSON.parse(o),r+=n,s&&s>0&&(t.batchTableBinary=new Uint8Array(e,r,s),t.batchTableBinary=new Uint8Array(t.batchTableBinary),r+=s)}return r}function fx(t,e,r){if(!e&&(!t||!t.batchIds||!r))return null;let{batchIds:i,isRGB565:n,pointCount:s=0}=t;if(i&&r){let o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){let A=i[a],g=r.getProperty(A,"dimensions").map(_=>_*255);o[a*3]=g[0],o[a*3+1]=g[1],o[a*3+2]=g[2]}return{type:qe.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(e&&n){let o=new Uint8ClampedArray(s*3);for(let a=0;a<s;a++){let A=Ax(e[a]);o[a*3]=A[0],o[a*3+1]=A[1],o[a*3+2]=A[2]}return{type:qe.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return e&&e.length===s*3?{type:qe.UNSIGNED_BYTE,value:e,size:3,normalized:!0}:{type:qe.UNSIGNED_BYTE,value:e||new Uint8ClampedArray,size:4,normalized:!0}}var T6=new G;function E6(t,e){if(!e)return null;if(t.isOctEncoded16P){let r=new Float32Array((t.pointsLength||0)*3);for(let i=0;i<(t.pointsLength||0);i++)ux(e[i*2],e[i*2+1],T6),T6.toArray(r,i*3);return{type:qe.FLOAT,size:2,value:r}}return{type:qe.FLOAT,size:2,value:e}}function v6(t,e,r){return t.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(t.isQuantized=!1,qZ(t,e)):{type:qe.UNSIGNED_SHORT,value:e,size:3,normalized:!0}:e}function qZ(t,e){let r=new G,i=new Float32Array(t.pointCount*3);for(let n=0;n<t.pointCount;n++)r.set(e[n*3],e[n*3+1],e[n*3+2]).scale(1/t.quantizedRange).multiply(t.quantizedVolumeScale).add(t.quantizedVolumeOffset).toArray(i,n*3);return i}async function w6(t,e,r,i,n){r=qs(t,e,r),r=Yc(t,e,r),r=Qc(t,e,r,i),KZ(t);let{featureTable:s,batchTable:o}=JZ(t);return await r$(t,s,o,i,n),ZZ(t,s,i),$Z(t,s,o),e$(t,s),r}function KZ(t){t.attributes={positions:null,colors:null,normals:null,batchIds:null},t.isQuantized=!1,t.isTranslucent=!1,t.isRGB565=!1,t.isOctEncoded16P=!1}function JZ(t){let e=new is(t.featureTableJson,t.featureTableBinary),r=e.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");e.featuresLength=r,t.featuresLength=r,t.pointsLength=r,t.pointCount=r,t.rtcCenter=e.getGlobalProperty("RTC_CENTER",qe.FLOAT,3);let i=t$(t,e);return{featureTable:e,batchTable:i}}function ZZ(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.positions){if(e.hasProperty("POSITION"))t.attributes.positions=e.getPropertyArray("POSITION",qe.FLOAT,3);else if(e.hasProperty("POSITION_QUANTIZED")){let i=e.getPropertyArray("POSITION_QUANTIZED",qe.UNSIGNED_SHORT,3);if(t.isQuantized=!0,t.quantizedRange=65535,t.quantizedVolumeScale=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",qe.FLOAT,3),!t.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(t.quantizedVolumeOffset=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",qe.FLOAT,3),!t.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");t.attributes.positions=v6(t,i,r)}}if(!t.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function $Z(t,e,r){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.colors){let i=null;e.hasProperty("RGBA")?(i=e.getPropertyArray("RGBA",qe.UNSIGNED_BYTE,4),t.isTranslucent=!0):e.hasProperty("RGB")?i=e.getPropertyArray("RGB",qe.UNSIGNED_BYTE,3):e.hasProperty("RGB565")&&(i=e.getPropertyArray("RGB565",qe.UNSIGNED_SHORT,1),t.isRGB565=!0),t.attributes.colors=fx(t,i,r)}e.hasProperty("CONSTANT_RGBA")&&(t.constantRGBA=e.getGlobalProperty("CONSTANT_RGBA",qe.UNSIGNED_BYTE,4))}function e$(t,e){if(t.attributes=t.attributes||{positions:null,colors:null,normals:null,batchIds:null},!t.attributes.normals){let r=null;e.hasProperty("NORMAL")?r=e.getPropertyArray("NORMAL",qe.FLOAT,3):e.hasProperty("NORMAL_OCT16P")&&(r=e.getPropertyArray("NORMAL_OCT16P",qe.UNSIGNED_BYTE,2),t.isOctEncoded16P=!0),t.attributes.normals=E6(t,r)}}function t$(t,e){let r=null;if(!t.batchIds&&e.hasProperty("BATCH_ID")&&(t.batchIds=e.getPropertyArray("BATCH_ID",qe.UNSIGNED_SHORT,1),t.batchIds)){let i=e.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");let{batchTableJson:n,batchTableBinary:s}=t;r=new aa(n,s,i)}return r}async function r$(t,e,r,i,n){let s,o,a,A=t.batchTableJson&&t.batchTableJson.extensions&&t.batchTableJson.extensions["3DTILES_draco_point_compression"];A&&(a=A.properties);let h=e.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;let _=h.byteOffset,b=h.byteLength;if(!o||!Number.isFinite(_)||!b)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(t.featureTableBinary||[]).slice(_,_+b),t.hasPositions=Number.isFinite(o.POSITION),t.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),t.hasNormals=Number.isFinite(o.NORMAL),t.hasBatchIds=Number.isFinite(o.BATCH_ID),t.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;let g={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await i$(t,g,i,n)}async function i$(t,e,r,i){if(!i)return;let n={...r,draco:{...r?.draco,extraAttributes:e.batchTableProperties||{}}};delete n["3d-tiles"];let s=await ii(e.buffer,eg,n,i),o=s.attributes.POSITION&&s.attributes.POSITION.value,a=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,A=s.attributes.NORMAL&&s.attributes.NORMAL.value,h=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,g=o&&s.attributes.POSITION.value.quantization,_=A&&s.attributes.NORMAL.value.quantization;if(g){let T=s.POSITION.data.quantization,v=T.range;t.quantizedVolumeScale=new G(v,v,v),t.quantizedVolumeOffset=new G(T.minValues),t.quantizedRange=(1<<T.quantizationBits)-1,t.isQuantizedDraco=!0}_&&(t.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,t.isOctEncodedDraco=!0);let b={};if(e.batchTableProperties)for(let T of Object.keys(e.batchTableProperties))s.attributes[T]&&s.attributes[T].value&&(b[T.toLowerCase()]=s.attributes[T].value);t.attributes={positions:o,colors:fx(t,a,void 0),normals:A,batchIds:h,...b}}var yg={URI:0,EMBEDDED:1};function xg(t,e,r,i){t.rotateYtoZ=!0;let n=(t.byteOffset||0)+(t.byteLength||0)-r;if(n===0)throw new Error("glTF byte length must be greater than 0.");return t.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",t.gltfArrayBuffer=co(e,r,n),t.gltfByteOffset=0,t.gltfByteLength=n,r%4===0||console.warn(`${t.type}: embedded glb is not aligned to a 4-byte boundary.`),(t.byteOffset||0)+(t.byteLength||0)}async function bg(t,e,r,i){let n=r?.["3d-tiles"]||{};if(n$(t,e,r),n.loadGLTF){if(!i)return;if(t.gltfUrl){let{fetch:s}=i,o=await s(t.gltfUrl,r);t.gltfArrayBuffer=await o.arrayBuffer(),t.gltfByteOffset=0}if(t.gltfArrayBuffer){let s=await ii(t.gltfArrayBuffer,es,r,i);t.gltf=ia(s),t.gpuMemoryUsageInBytes=Cf(t.gltf),delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength}}}function n$(t,e,r){switch(e){case yg.URI:if(t.gltfArrayBuffer){let i=new Uint8Array(t.gltfArrayBuffer,t.gltfByteOffset),s=new TextDecoder().decode(i);t.gltfUrl=s.replace(/[\s\0]+$/,"")}delete t.gltfArrayBuffer,delete t.gltfByteOffset,delete t.gltfByteLength;break;case yg.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function C6(t,e,r,i,n){r=s$(t,e,r,i,n),await bg(t,yg.EMBEDDED,i,n);let s=t?.gltf?.extensions;return s&&s.CESIUM_RTC&&(t.rtcCenter=s.CESIUM_RTC.center),r}function s$(t,e,r,i,n){r=qs(t,e,r),r=Yc(t,e,r),r=Qc(t,e,r,i),r=xg(t,e,r,i);let s=new is(t.featureTableJson,t.featureTableBinary);return t.rtcCenter=s.getGlobalProperty("RTC_CENTER",qe.FLOAT,3),r}async function S6(t,e,r,i,n){return r=o$(t,e,r,i,n),await bg(t,t.gltfFormat||0,i,n),r}function o$(t,e,r,i,n){if(r=qs(t,e,r),t.version!==1)throw new Error(`Instanced 3D Model version ${t.version} is not supported`);r=Yc(t,e,r);let s=new DataView(e);if(t.gltfFormat=s.getUint32(r,!0),r+=4,r=Qc(t,e,r,i),r=xg(t,e,r,i),!t?.header?.featureTableJsonByteLength||t.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");let o=new is(t.featureTableJson,t.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");t.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),t.rtcCenter=o.getGlobalProperty("RTC_CENTER",qe.FLOAT,3);let A=new aa(t.batchTableJson,t.batchTableBinary,a);return a$(t,o,A,a),r}function a$(t,e,r,i){let n=new Array(i),s=new G,o=new G,a=new G,A=new G,h=new yt,g=new yi,_=new G,b={},T=new Ce,v=[],C=[],S=[],P=[];for(let F=0;F<i;F++){let I;if(e.hasProperty("POSITION"))I=e.getProperty("POSITION",qe.FLOAT,3,F,s);else if(e.hasProperty("POSITION_QUANTIZED")){I=e.getProperty("POSITION_QUANTIZED",qe.UNSIGNED_SHORT,3,F,s);let L=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",qe.FLOAT,3);if(!L)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let se=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",qe.FLOAT,3);if(!se)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let le=65535;for(let ce=0;ce<3;ce++)I[ce]=I[ce]/le*se[ce]+L[ce]}if(!I)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");s.copy(I),b.translation=s,t.normalUp=e.getProperty("NORMAL_UP",qe.FLOAT,3,F,v),t.normalRight=e.getProperty("NORMAL_RIGHT",qe.FLOAT,3,F,C);let k=!1;if(t.normalUp){if(!t.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");t.hasCustomOrientation=!0}else{if(t.octNormalUp=e.getProperty("NORMAL_UP_OCT32P",qe.UNSIGNED_SHORT,2,F,v),t.octNormalRight=e.getProperty("NORMAL_RIGHT_OCT32P",qe.UNSIGNED_SHORT,2,F,C),t.octNormalUp)throw t.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");t.eastNorthUp?(tt.WGS84.eastNorthUpToFixedFrame(s,T),T.getRotationMatrix3(h)):h.identity()}k&&(A.copy(o).cross(a).normalize(),h.setColumn(0,o),h.setColumn(1,a),h.setColumn(2,A)),g.fromMatrix3(h),b.rotation=g,_.set(1,1,1);let W=e.getProperty("SCALE",qe.FLOAT,1,F,S);Number.isFinite(W)&&_.multiplyByScalar(W);let K=e.getProperty("SCALE_NON_UNIFORM",qe.FLOAT,3,F,v);K&&_.scale(K),b.scale=_;let re=e.getProperty("BATCH_ID",qe.UNSIGNED_SHORT,1,F,P);re===void 0&&(re=F);let Y=new Ce().fromQuaternion(b.rotation);T.identity(),T.translate(b.translation),T.multiplyRight(Y),T.scale(b.scale);let z=T.clone();n[F]={modelMatrix:z,batchId:re}}t.instances=n}async function M6(t,e,r,i,n,s){r=qs(t,e,r);let o=new DataView(e);for(t.tilesLength=o.getUint32(r,!0),r+=4,t.tiles=[];t.tiles.length<t.tilesLength&&(t.byteLength||0)-r>12;){let a={shape:"tile3d"};t.tiles.push(a),r=await s(e,r,i,n,a)}return r}async function P6(t,e,r,i){if(t.rotateYtoZ=!0,t.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!i)return e.byteLength;let n=await ii(e,es,r,i);t.gltf=ia(n),t.gpuMemoryUsageInBytes=Cf(t.gltf)}else t.gltfArrayBuffer=e;return e.byteLength}async function hx(t,e=0,r,i,n={shape:"tile3d"}){switch(n.byteOffset=e,n.type=h6(t,e),n.type){case oa.COMPOSITE:return await M6(n,t,e,r,i,hx);case oa.BATCHED_3D_MODEL:return await C6(n,t,e,r,i);case oa.GLTF:return await P6(n,t,r,i);case oa.INSTANCED_3D_MODEL:return await S6(n,t,e,r,i);case oa.POINT_CLOUD:return await w6(n,t,e,r,i);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}async function dx(t,e,r){if(new Uint32Array(t.slice(0,4))[0]!==1952609651)throw new Error("Wrong subtree file magic number");if(new Uint32Array(t.slice(4,8))[0]!==1)throw new Error("Wrong subtree file verson, must be 1");let s=R6(t.slice(8,16)),o=new Uint8Array(t,24,s),A=new TextDecoder("utf8").decode(o),h=JSON.parse(A),g=R6(t.slice(16,24)),_=new ArrayBuffer(0);if(g&&(_=t.slice(24+s)),await Tg(h,h.tileAvailability,_,r),Array.isArray(h.contentAvailability))for(let b of h.contentAvailability)await Tg(h,b,_,r);else await Tg(h,h.contentAvailability,_,r);return await Tg(h,h.childSubtreeAvailability,_,r),h}async function Tg(t,e,r,i){let n=Number.isFinite(e.bitstream)?e.bitstream:e.bufferView;if(typeof n!="number")return;let s=t.bufferViews[n],o=t.buffers[s.buffer];if(!i?.baseUrl)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(o.uri){let A=`${i?.baseUrl||""}/${o.uri}`,g=await(await i.fetch(A)).arrayBuffer();e.explicitBitstream=new Uint8Array(g,s.byteOffset,s.byteLength);return}let a=t.buffers.slice(0,s.buffer).reduce((A,h)=>A+h.byteLength,0);e.explicitBitstream=new Uint8Array(r.slice(a,a+o.byteLength),s.byteOffset,s.byteLength)}function R6(t){let e=new DataView(t),r=e.getUint32(0,!0),i=e.getUint32(4,!0);return r+2**32*i}var Eg={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:mg,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:dx,options:{}};var Si=null;try{Si=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Nt(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}Nt.prototype.__isLong__;Object.defineProperty(Nt.prototype,"__isLong__",{value:!0});function Lr(t){return(t&&t.__isLong__)===!0}function I6(t){var e=Math.clz32(t&-t);return t?31-e:e}Nt.isLong=Lr;var B6={},O6={};function ca(t,e){var r,i,n;return e?(t>>>=0,(n=0<=t&&t<256)&&(i=O6[t],i)?i:(r=dt(t,0,!0),n&&(O6[t]=r),r)):(t|=0,(n=-128<=t&&t<128)&&(i=B6[t],i)?i:(r=dt(t,t<0?-1:0,!1),n&&(B6[t]=r),r))}Nt.fromInt=ca;function Mi(t,e){if(isNaN(t))return e?ns:Yi;if(e){if(t<0)return ns;if(t>=D6)return V6}else{if(t<=-L6)return ei;if(t+1>=L6)return U6}return t<0?Mi(-t,e).neg():dt(t%Kc|0,t/Kc|0,e)}Nt.fromNumber=Mi;function dt(t,e,r){return new Nt(t,e,r)}Nt.fromBits=dt;var vg=Math.pow;function gx(t,e,r){if(t.length===0)throw Error("empty string");if(typeof e=="number"?(r=e,e=!1):e=!!e,t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return e?ns:Yi;if(r=r||10,r<2||36<r)throw RangeError("radix");var i;if((i=t.indexOf("-"))>0)throw Error("interior hyphen");if(i===0)return gx(t.substring(1),e,r).neg();for(var n=Mi(vg(r,8)),s=Yi,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),A=parseInt(t.substring(o,o+a),r);if(a<8){var h=Mi(vg(r,a));s=s.mul(h).add(Mi(A))}else s=s.mul(n),s=s.add(Mi(A))}return s.unsigned=e,s}Nt.fromString=gx;function Qi(t,e){return typeof t=="number"?Mi(t,e):typeof t=="string"?gx(t,e):dt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Nt.fromValue=Qi;var F6=65536,c$=1<<24,Kc=F6*F6,D6=Kc*Kc,L6=D6/2,N6=ca(c$),Yi=ca(0);Nt.ZERO=Yi;var ns=ca(0,!0);Nt.UZERO=ns;var qc=ca(1);Nt.ONE=qc;var k6=ca(1,!0);Nt.UONE=k6;var px=ca(-1);Nt.NEG_ONE=px;var U6=dt(-1,2147483647,!1);Nt.MAX_VALUE=U6;var V6=dt(-1,-1,!0);Nt.MAX_UNSIGNED_VALUE=V6;var ei=dt(0,-2147483648,!1);Nt.MIN_VALUE=ei;var de=Nt.prototype;de.toInt=function(){return this.unsigned?this.low>>>0:this.low};de.toNumber=function(){return this.unsigned?(this.high>>>0)*Kc+(this.low>>>0):this.high*Kc+(this.low>>>0)};de.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ei)){var r=Mi(e),i=this.div(r),n=i.mul(r).sub(this);return i.toString(e)+n.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=Mi(vg(e,6),this.unsigned),o=this,a="";;){var A=o.div(s),h=o.sub(A.mul(s)).toInt()>>>0,g=h.toString(e);if(o=A,o.isZero())return g+a;for(;g.length<6;)g="0"+g;a=""+g+a}};de.getHighBits=function(){return this.high};de.getHighBitsUnsigned=function(){return this.high>>>0};de.getLowBits=function(){return this.low};de.getLowBitsUnsigned=function(){return this.low>>>0};de.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ei)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;r>0&&!(e&1<<r);r--);return this.high!=0?r+33:r+1};de.isZero=function(){return this.high===0&&this.low===0};de.eqz=de.isZero;de.isNegative=function(){return!this.unsigned&&this.high<0};de.isPositive=function(){return this.unsigned||this.high>=0};de.isOdd=function(){return(this.low&1)===1};de.isEven=function(){return(this.low&1)===0};de.equals=function(e){return Lr(e)||(e=Qi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};de.eq=de.equals;de.notEquals=function(e){return!this.eq(e)};de.neq=de.notEquals;de.ne=de.notEquals;de.lessThan=function(e){return this.comp(e)<0};de.lt=de.lessThan;de.lessThanOrEqual=function(e){return this.comp(e)<=0};de.lte=de.lessThanOrEqual;de.le=de.lessThanOrEqual;de.greaterThan=function(e){return this.comp(e)>0};de.gt=de.greaterThan;de.greaterThanOrEqual=function(e){return this.comp(e)>=0};de.gte=de.greaterThanOrEqual;de.ge=de.greaterThanOrEqual;de.compare=function(e){if(Lr(e)||(e=Qi(e)),this.eq(e))return 0;var r=this.isNegative(),i=e.isNegative();return r&&!i?-1:!r&&i?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};de.comp=de.compare;de.negate=function(){return!this.unsigned&&this.eq(ei)?ei:this.not().add(qc)};de.neg=de.negate;de.add=function(e){Lr(e)||(e=Qi(e));var r=this.high>>>16,i=this.high&65535,n=this.low>>>16,s=this.low&65535,o=e.high>>>16,a=e.high&65535,A=e.low>>>16,h=e.low&65535,g=0,_=0,b=0,T=0;return T+=s+h,b+=T>>>16,T&=65535,b+=n+A,_+=b>>>16,b&=65535,_+=i+a,g+=_>>>16,_&=65535,g+=r+o,g&=65535,dt(b<<16|T,g<<16|_,this.unsigned)};de.subtract=function(e){return Lr(e)||(e=Qi(e)),this.add(e.neg())};de.sub=de.subtract;de.multiply=function(e){if(this.isZero())return this;if(Lr(e)||(e=Qi(e)),Si){var r=Si.mul(this.low,this.high,e.low,e.high);return dt(r,Si.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?ns:Yi;if(this.eq(ei))return e.isOdd()?ei:Yi;if(e.eq(ei))return this.isOdd()?ei:Yi;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(N6)&&e.lt(N6))return Mi(this.toNumber()*e.toNumber(),this.unsigned);var i=this.high>>>16,n=this.high&65535,s=this.low>>>16,o=this.low&65535,a=e.high>>>16,A=e.high&65535,h=e.low>>>16,g=e.low&65535,_=0,b=0,T=0,v=0;return v+=o*g,T+=v>>>16,v&=65535,T+=s*g,b+=T>>>16,T&=65535,T+=o*h,b+=T>>>16,T&=65535,b+=n*g,_+=b>>>16,b&=65535,b+=s*h,_+=b>>>16,b&=65535,b+=o*A,_+=b>>>16,b&=65535,_+=i*g+n*h+s*A+o*a,_&=65535,dt(T<<16|v,_<<16|b,this.unsigned)};de.mul=de.multiply;de.divide=function(e){if(Lr(e)||(e=Qi(e)),e.isZero())throw Error("division by zero");if(Si){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?Si.div_u:Si.div_s)(this.low,this.high,e.low,e.high);return dt(r,Si.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ns:Yi;var i,n,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ns;if(e.gt(this.shru(1)))return k6;s=ns}else{if(this.eq(ei)){if(e.eq(qc)||e.eq(px))return ei;if(e.eq(ei))return qc;var o=this.shr(1);return i=o.div(e).shl(1),i.eq(Yi)?e.isNegative()?qc:px:(n=this.sub(e.mul(i)),s=i.add(n.div(e)),s)}else if(e.eq(ei))return this.unsigned?ns:Yi;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=Yi}for(n=this;n.gte(e);){i=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(i)/Math.LN2),A=a<=48?1:vg(2,a-48),h=Mi(i),g=h.mul(e);g.isNegative()||g.gt(n);)i-=A,h=Mi(i,this.unsigned),g=h.mul(e);h.isZero()&&(h=qc),s=s.add(h),n=n.sub(g)}return s};de.div=de.divide;de.modulo=function(e){if(Lr(e)||(e=Qi(e)),Si){var r=(this.unsigned?Si.rem_u:Si.rem_s)(this.low,this.high,e.low,e.high);return dt(r,Si.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};de.mod=de.modulo;de.rem=de.modulo;de.not=function(){return dt(~this.low,~this.high,this.unsigned)};de.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};de.clz=de.countLeadingZeros;de.countTrailingZeros=function(){return this.low?I6(this.low):I6(this.high)+32};de.ctz=de.countTrailingZeros;de.and=function(e){return Lr(e)||(e=Qi(e)),dt(this.low&e.low,this.high&e.high,this.unsigned)};de.or=function(e){return Lr(e)||(e=Qi(e)),dt(this.low|e.low,this.high|e.high,this.unsigned)};de.xor=function(e){return Lr(e)||(e=Qi(e)),dt(this.low^e.low,this.high^e.high,this.unsigned)};de.shiftLeft=function(e){return Lr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):dt(0,this.low<<e-32,this.unsigned)};de.shl=de.shiftLeft;de.shiftRight=function(e){return Lr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):dt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};de.shr=de.shiftRight;de.shiftRightUnsigned=function(e){return Lr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?dt(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?dt(this.high,0,this.unsigned):dt(this.high>>>e-32,0,this.unsigned)};de.shru=de.shiftRightUnsigned;de.shr_u=de.shiftRightUnsigned;de.rotateLeft=function(e){var r;return Lr(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?dt(this.high,this.low,this.unsigned):e<32?(r=32-e,dt(this.low<<e|this.high>>>r,this.high<<e|this.low>>>r,this.unsigned)):(e-=32,r=32-e,dt(this.high<<e|this.low>>>r,this.low<<e|this.high>>>r,this.unsigned))};de.rotl=de.rotateLeft;de.rotateRight=function(e){var r;return Lr(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?dt(this.high,this.low,this.unsigned):e<32?(r=32-e,dt(this.high<<r|this.low>>>e,this.low<<r|this.high>>>e,this.unsigned)):(e-=32,r=32-e,dt(this.low<<r|this.high>>>e,this.high<<r|this.low>>>e,this.unsigned))};de.rotr=de.rotateRight;de.toSigned=function(){return this.unsigned?dt(this.low,this.high,!1):this};de.toUnsigned=function(){return this.unsigned?this:dt(this.low,this.high,!0)};de.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};de.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};de.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};Nt.fromBytes=function(e,r,i){return i?Nt.fromBytesLE(e,r):Nt.fromBytesBE(e,r)};Nt.fromBytesLE=function(e,r){return new Nt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)};Nt.fromBytesBE=function(e,r){return new Nt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};var Jc=Nt;var l$=16;function Nf(t){t==="X"&&(t="");let e=t.padEnd(l$,"0");return Jc.fromString(e,!0,16)}function mx(t){if(t.isZero())return"X";let e=t.countTrailingZeros(),r=e%4;e=(e-r)/4;let i=e;e*=4;let s=t.shiftRightUnsigned(e).toString(16).replace(/0+$/,"");return Array(17-i-s.length).join("0")+s}function _x(t,e){let r=A$(t).shiftRightUnsigned(2);return t.add(Jc.fromNumber(2*e+1-4).multiply(r))}function A$(t){return t.and(t.not().add(1))}var u$=3,f$=30,h$=2*f$+1,z6=180/Math.PI;function G6(t){if(t.length===0)throw new Error(`Invalid Hilbert quad key ${t}`);let e=t.split("/"),r=parseInt(e[0],10),i=e[1],n=i.length,s=0,o=[0,0];for(let a=n-1;a>=0;a--){s=n-a;let A=i[a],h=0,g=0;A==="1"?g=1:A==="2"?(h=1,g=1):A==="3"&&(h=1);let _=Math.pow(2,s-1);d$(_,o,h,g),o[0]+=_*h,o[1]+=_*g}if(r%2===1){let a=o[0];o[0]=o[1],o[1]=a}return{face:r,ij:o,level:s}}function W6(t){if(t.isZero())return"";let e=t.toString(2);for(;e.length<u$+h$;)e="0"+e;let r=e.lastIndexOf("1"),i=e.substring(0,3),n=e.substring(3,r),s=n.length/2,o=Jc.fromString(i,!0,2).toString(10),a="";if(s!==0)for(a=Jc.fromString(n,!0,2).toString(4);a.length<s;)a="0"+a;return`${o}/${a}`}function yx(t,e,r){let i=1<<e;return[(t[0]+r[0])/i,(t[1]+r[1])/i]}function H6(t){return t>=.5?1/3*(4*t*t-1):1/3*(1-4*(1-t)*(1-t))}function xx(t){return[H6(t[0]),H6(t[1])]}function bx(t,[e,r]){switch(t){case 0:return[1,e,r];case 1:return[-e,1,r];case 2:return[-e,-r,1];case 3:return[-1,-r,-e];case 4:return[r,-1,-e];case 5:return[r,e,-1];default:throw new Error("Invalid face")}}function Tx([t,e,r]){let i=Math.atan2(r,Math.sqrt(t*t+e*e));return[Math.atan2(e,t)*z6,i*z6]}function d$(t,e,r,i){if(i===0){r===1&&(e[0]=t-1-e[0],e[1]=t-1-e[1]);let n=e[0];e[0]=e[1],e[1]=n}}function j6(t){let e=yx(t.ij,t.level,[.5,.5]),r=xx(e),i=bx(t.face,r);return Tx(i)}var p$=100;function Ex(t){let{face:e,ij:r,level:i}=t,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(p$*Math.pow(2,-i))),o=new Float64Array(4*s*2+2),a=0,A=0;for(let h=0;h<4;h++){let g=n[h].slice(0),_=n[h+1],b=(_[0]-g[0])/s,T=(_[1]-g[1])/s;for(let v=0;v<s;v++){g[0]+=b,g[1]+=T;let C=yx(r,i,g),S=xx(C),P=bx(e,S),F=Tx(P);Math.abs(F[1])>89.999&&(F[0]=A);let I=F[0]-A;F[0]+=I>180?-360:I<-180?360:0,o[a++]=F[0],o[a++]=F[1],A=F[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Zc(t){let e=g$(t);return G6(e)}function g$(t){if(t.indexOf("/")>0)return t;let e=Nf(t);return W6(e)}function vx(t){let e=Zc(t);return j6(e)}function Y6(t){let e;if(t.face===2||t.face===5){let r=null,i=0;for(let n=0;n<4;n++){let s=`${t.face}/${n}`,o=Zc(s),a=Ex(o);(typeof r>"u"||r===null)&&(r=new Float64Array(4*a.length)),r.set(a,i),i+=a.length}e=X6(r)}else{let r=Ex(t);e=X6(r)}return e}function X6(t){if(t.length%2!==0)throw new Error("Invalid corners");let e=[],r=[];for(let i=0;i<t.length;i+=2)e.push(t[i]),r.push(t[i+1]);return e.sort((i,n)=>i-n),r.sort((i,n)=>i-n),{west:e[0],east:e[e.length-1],north:r[r.length-1],south:r[0]}}function wx(t,e){let r=e?.minimumHeight||0,i=e?.maximumHeight||0,n=Zc(t),s=Y6(n),o=s.west,a=s.south,A=s.east,h=s.north,g=[];return g.push(new G(o,h,r)),g.push(new G(A,h,r)),g.push(new G(A,a,r)),g.push(new G(o,a,r)),g.push(new G(o,h,i)),g.push(new G(A,h,i)),g.push(new G(A,a,i)),g.push(new G(o,a,i)),g}function wg(t){let e=t.token,r={minimumHeight:t.minimumHeight,maximumHeight:t.maximumHeight},i=wx(e,r),n=vx(e),s=n[0],o=n[1],a=tt.WGS84.cartographicToCartesian([s,o,r.maximumHeight]),A=new G(a[0],a[1],a[2]);i.push(A);let h=gf(i);return[...h.center,...h.halfAxes]}var m$=4,_$=8,y$={QUADTREE:m$,OCTREE:_$};function x$(t,e,r){if(t?.box){let i=Nf(t.s2VolumeInfo.token),n=_x(i,e),s=mx(n),o={...t.s2VolumeInfo};switch(o.token=s,r){case"OCTREE":let h=t.s2VolumeInfo,g=h.maximumHeight-h.minimumHeight,_=g/2,b=h.minimumHeight+g/2;h.minimumHeight=b-_,h.maximumHeight=b+_;break;default:break}return{box:wg(o),s2VolumeInfo:o}}}async function Sx(t){let{subtree:e,subtreeData:r={level:0,x:0,y:0,z:0},parentData:i={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:n=0,implicitOptions:s,loaderOptions:o,s2VolumeBox:a}=t,{subdivisionScheme:A,subtreeLevels:h,maximumLevel:g,contentUrlTemplate:_,subtreesUriTemplate:b,basePath:T}=s,v={children:[],lodMetricValue:0,contentUrl:""};if(!g)return mm.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${_} won't be loaded...`),v;let C=i.localLevel+1,S=r.level+C;if(S>g)return v;let P=y$[A],F=Math.log2(P),I=n&1,k=n>>1&1,W=n>>2&1,K=la(i.localX,I,1),re=la(i.localY,k,1),Y=la(i.localZ,W,1),z=la(r.x,K,C),L=la(r.y,re,C),se=la(r.z,Y,C),le=la(i.mortonIndex,n,F),ce=C===h&&Cx(e.childSubtreeAvailability,le),he,Re,Ke,Ye;if(ce){let rt=`${T}/${b}`,Ne=Cg(rt,S,z,L,se);he=await dr(Ne,Eg,o),Ye=0,Re={level:S,x:z,y:L,z:se},Ke={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else he=e,Ye=(P**C-1)/(P-1)+le,Re=r,Ke={mortonIndex:le,localLevel:C,localX:K,localY:re,localZ:Y};if(!Cx(he.tileAvailability,Ye))return v;Cx(he.contentAvailability,Ye)&&(v.contentUrl=Cg(_,S,z,L,se));for(let rt=0;rt<P;rt++){let Ne=x$(a,rt,A),ir=await Sx({subtree:he,subtreeData:Re,parentData:Ke,childIndex:rt,implicitOptions:s,loaderOptions:o,s2VolumeBox:Ne});(ir.contentUrl||ir.children.length)&&v.children.push(ir)}return v.contentUrl||v.children.length?b$(v,{level:S,x:z,y:L,z:se},s,a):v}function Cx(t,e){let r;return Array.isArray(t)?(r=t[0],t.length>1&&mm.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=t,"constant"in r?!!r.constant:r.explicitBitstream?v$(e,r.explicitBitstream):!1}function b$(t,e,r,i){let{basePath:n,refine:s,getRefine:o,lodMetricType:a,getTileType:A,rootLodMetricValue:h,rootBoundingVolume:g}=r,_=t.contentUrl&&t.contentUrl.replace(`${n}/`,""),b=h/2**e.level,T=i?.box?{box:i.box}:g,v=T$(T,e,r.subdivisionScheme);return{children:t.children,contentUrl:t.contentUrl,content:{uri:_},id:t.contentUrl,refine:o(s),type:A(t),lodMetricType:a,lodMetricValue:b,geometricError:b,transform:t.transform,boundingVolume:v}}function T$(t,e,r){if(t.region){let{level:i,x:n,y:s,z:o}=e,[a,A,h,g,_,b]=t.region,T=2**i,v=(h-a)/T,[C,S]=[a+v*n,a+v*(n+1)],P=(g-A)/T,[F,I]=[A+P*s,A+P*(s+1)],k,W;if(r==="OCTREE"){let K=(b-_)/T;[k,W]=[_+K*o,_+K*(o+1)]}else[k,W]=[_,b];return{region:[C,F,S,I,k,W]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function la(t,e,r){return(t<<r)+e}function Cg(t,e,r,i,n){let s=E$({level:e,x:r,y:i,z:n});return t.replace(/{level}|{x}|{y}|{z}/gi,o=>s[o])}function E$(t){let e={};for(let r in t)e[`{${r}}`]=t[r];return e}function v$(t,e){let r=Math.floor(t/8),i=t%8;return(e[r]>>i&1)===1}function Px(t,e=""){if(!e)return Ci.EMPTY;let i=e.split("?")[0].split(".").pop();switch(i){case"pnts":return Ci.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Ci.SCENEGRAPH;default:return i||Ci.EMPTY}}function Rx(t){switch(t){case"REPLACE":case"replace":return Or.REPLACE;case"ADD":case"add":return Or.ADD;default:return t}}function Mx(t,e){if(/^[a-z][0-9a-z+.-]*:/i.test(e)){let i=new URL(t,`${e}/`);return decodeURI(i.toString())}else if(t.startsWith("/"))return t;return ni.resolve(e,t)}function Q6(t,e){if(!t)return null;let r;if(t.content){let n=t.content.uri||t.content?.url;typeof n<"u"&&(r=Mx(n,e))}return{...t,id:r,contentUrl:r,lodMetricType:rs.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Px(t,r),refine:Rx(t.refine)}}async function J6(t,e,r){let i=null,n=K6(t.root);n&&t.root?i=await q6(t.root,t,e,n,r):i=Q6(t.root,e);let s=[];for(s.push(i);s.length>0;){let o=s.pop()||{},a=o.children||[],A=[];for(let h of a){let g=K6(h),_;g?_=await q6(h,t,e,g,r):_=Q6(h,e),_&&(A.push(_),s.push(_))}o.children=A}return i}async function q6(t,e,r,i,n){let{subdivisionScheme:s,maximumLevel:o,availableLevels:a,subtreeLevels:A,subtrees:{uri:h}}=i,g=Cg(h,0,0,0,0),_=Mx(g,r),b=await dr(_,Eg,n),T=t.content?.uri,v=T?Mx(T,r):"",C=e?.root?.refine,S=t.geometricError,P=t.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(P){let W={box:wg(P),s2VolumeInfo:P};t.boundingVolume=W}let F=t.boundingVolume,I={contentUrlTemplate:v,subtreesUriTemplate:h,subdivisionScheme:s,subtreeLevels:A,maximumLevel:Number.isFinite(a)?a-1:o,refine:C,basePath:r,lodMetricType:rs.GEOMETRIC_ERROR,rootLodMetricValue:S,rootBoundingVolume:F,getTileType:Px,getRefine:Rx};return await w$(t,r,b,I,n)}async function w$(t,e,r,i,n){if(!t)return null;let{children:s,contentUrl:o}=await Sx({subtree:r,implicitOptions:i,loaderOptions:n}),a,A=null;return o&&(a=o,A={uri:o.replace(`${e}/`,"")}),{...t,id:a,contentUrl:a,lodMetricType:rs.GEOMETRIC_ERROR,lodMetricValue:t.geometricError,transformMatrix:t.transform,type:Px(t,a),refine:Rx(t.refine),content:A||t.content,children:s}}function K6(t){return t?.extensions?.["3DTILES_implicit_tiling"]||t?.implicitTiling}var Sg={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:mg,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:C$,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function C$(t,e={},r){let i=e["3d-tiles"]||{},n;return i.isTileset==="auto"?n=r?.url&&r.url.indexOf(".json")!==-1:n=i.isTileset,n?S$(t,e,r):M$(t,e,r)}async function S$(t,e,r){let i=JSON.parse(new TextDecoder().decode(t)),n=r?.url||"",s=P$(n),o=await J6(i,s,e||{});return{...i,shape:"tileset3d",loader:Sg,url:n,queryString:r?.queryString||"",basePath:s,root:o||i.root,type:yr.TILES3D,lodMetricType:rs.GEOMETRIC_ERROR,lodMetricValue:i.root?.geometricError||0}}async function M$(t,e,r){let i={content:{shape:"tile3d",featureIds:null}};return await hx(t,0,e,r,i.content),i.content}function P$(t){return ni.dirname(t)}var Z6=[0],R$={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:Sg,onTilesetLoad:{type:"function",value:t=>{}},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:(t,e,r)=>{}},_getMeshColor:{type:"function",value:t=>[255,255,255]}},Df=class extends zt{initializeState(){"onTileLoadFail"in this.props&&me.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:r,changeFlags:i}){if(e.data&&e.data!==r.data&&this._loadTileset(e.data),i.viewportChanged){let{activeViewports:n}=this.state;Object.keys(n).length&&(this._updateTileset(n),this.state.lastUpdatedViewports=n,this.state.activeViewports={})}if(i.propsChanged){let{layerMap:n}=this.state;for(let s in n)n[s].needsUpdate=!0}}activateViewport(e){let{activeViewports:r,lastUpdatedViewports:i}=this.state;this.internalState.viewport=e,r[e.id]=e;let n=i?.[e.id];(!n||!e.equals(n))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:r}){let i=r&&r.props.tile;return e.picked&&(e.object=i),e.sourceTile=i,e}filterSubLayer({layer:e,viewport:r}){let{tile:i}=e.props,{id:n}=r;return i.selected&&i.viewportIds.includes(n)}_updateAutoHighlight(e){let r=e.sourceTile,i=this.state.layerMap[r?.id];i&&i.layer&&i.layer.updateAutoHighlight(e)}async _loadTileset(e){let{loadOptions:r={}}=this.props,i=this.props.loader||this.props.loaders,n=Array.isArray(i)?i[0]:i,s={loadOptions:{...r}},o=e;if(n.preload){let h=await n.preload(e,r);h.url&&(o=h.url),h.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:h.headers}),Object.assign(s,h)}let a=await dr(o,n,s.loadOptions),A=new Lf(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:A,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(A)}_onTileLoad(e){let{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(e),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;let{tileset3d:r}=this.state,{timeline:i}=this.context,n=Object.keys(e).length;!i||!n||!r||r.selectTiles(Object.values(e)).then(s=>{this.state.frameNumber!==s&&this.setState({frameNumber:s})})}_getSubLayer(e,r){if(!e.content)return null;switch(e.type){case Ci.POINTCLOUD:return this._makePointCloudLayer(e,r);case Ci.SCENEGRAPH:return this._make3DModelLayer(e);case Ci.MESH:return this._makeSimpleMeshLayer(e,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,r){let{attributes:i,pointCount:n,constantRGBA:s,cartographicOrigin:o,modelMatrix:a}=e.content,{positions:A,normals:h,colors:g}=i;if(!A)return null;let _=r&&r.props.data||{header:{vertexCount:n},attributes:{POSITION:A,NORMAL:h,COLOR_0:g}},{pointSize:b,getPointColor:T}=this.props,v=this.getSubLayerClass("pointcloud",Fd);return new v({pointSize:b},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:_,coordinateSystem:Se.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:s||T,_offset:0})}_make3DModelLayer(e){let{gltf:r,instances:i,cartographicOrigin:n,modelMatrix:s}=e.content,o=this.getSubLayerClass("scenegraph",Y3);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:i||Z6,scenegraph:r,coordinateSystem:Se.METER_OFFSETS,coordinateOrigin:n,modelMatrix:s,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,r){let i=e.content,{attributes:n,indices:s,modelMatrix:o,cartographicOrigin:a,coordinateSystem:A=Se.METER_OFFSETS,material:h,featureIds:g}=i,{_getMeshColor:_}=this.props,b=r&&r.props.mesh||new ut({topology:"triangle-list",attributes:I$(n),indices:s}),T=this.getSubLayerClass("mesh",RB);return new T(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:b,data:Z6,getColor:_(e),pbrMaterial:h,modelMatrix:o,coordinateOrigin:a,coordinateSystem:A,featureIds:g,_offset:0})}renderLayers(){let{tileset3d:e,layerMap:r}=this.state;return e?e.tiles.map(i=>{let n=r[i.id]=r[i.id]||{tile:i},{layer:s}=n;return i.selected&&(s?n.needsUpdate&&(s=this._getSubLayer(i,s),n.needsUpdate=!1):s=this._getSubLayer(i)),n.layer=s,s}).filter(Boolean):null}};Df.defaultProps=R$;Df.layerName="Tile3DLayer";var $6=Df;function I$(t){let e={};return e.positions={...t.positions,value:new Float32Array(t.positions.value)},t.normals&&(e.normals=t.normals),t.texCoords&&(e.texCoords=t.texCoords),t.colors&&(e.colors=t.colors),t.uvRegions&&(e.uvRegions=t.uvRegions),e}var B$=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function Ix(t){return t>>1^-(t&1)}function O$(t){let e=0,r={};for(let[i,n]of B$){let s=n===8?t.getFloat64:t.getFloat32;r[i]=s.call(t,e,!0),e+=n}return{header:r,headerEndPosition:e}}function F$(t,e){let r=e,i=3,n=t.getUint32(r,!0),s=new Uint16Array(n*i);r+=Uint32Array.BYTES_PER_ELEMENT;let o=Uint16Array.BYTES_PER_ELEMENT,a=n*o,A=r,h=A+a,g=h+a,_=0,b=0,T=0;for(let v=0;v<n;v++)_+=Ix(t.getUint16(A+o*v,!0)),b+=Ix(t.getUint16(h+o*v,!0)),T+=Ix(t.getUint16(g+o*v,!0)),s[v]=_,s[v+n]=b,s[v+n*2]=T;return r+=a*3,{vertexData:s,vertexDataEndPosition:r}}function kf(t,e,r,i,n=!0){let s;if(i===2?s=new Uint16Array(t,e,r):s=new Uint32Array(t,e,r),!n)return s;let o=0;for(let a=0;a<s.length;++a){let A=s[a];s[a]=o-A,A===0&&++o}return s}function L$(t,e,r){let i=r,n=3,o=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;i%o!==0&&(i+=o-i%o);let a=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let A=a*3,h=kf(t.buffer,i,A,o);return i+=A*o,{triangleIndicesEndPosition:i,triangleIndices:h}}function N$(t,e,r){let i=r,n=3,o=e.length/n>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,a=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let A=kf(t.buffer,i,a,o,!1);i+=a*o;let h=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let g=kf(t.buffer,i,h,o,!1);i+=h*o;let _=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let b=kf(t.buffer,i,_,o,!1);i+=_*o;let T=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let v=kf(t.buffer,i,T,o,!1);return i+=T*o,{edgeIndicesEndPosition:i,westIndices:A,southIndices:g,eastIndices:b,northIndices:v}}function D$(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function k$(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function U$(t,e){let r={};if(t.byteLength<=e)return{extensions:r,extensionsEndPosition:e};let i=e;for(;i<t.byteLength;){let n=t.getUint8(i,!0);i+=Uint8Array.BYTES_PER_ELEMENT;let s=t.getUint32(i,!0);i+=Uint32Array.BYTES_PER_ELEMENT;let o=new DataView(t.buffer,i,s);switch(n){case 1:{r.vertexNormals=D$(o);break}case 2:{r.waterMask=k$(o);break}default:}i+=s}return{extensions:r,extensionsEndPosition:i}}var Aa={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},V$={maxDecodingStep:Aa.extensions};function Bx(t,e){let r=Object.assign({},V$,e),i=new DataView(t),{header:n,headerEndPosition:s}=O$(i);if(r.maxDecodingStep<Aa.vertices)return{header:n};let{vertexData:o,vertexDataEndPosition:a}=F$(i,s);if(r.maxDecodingStep<Aa.triangleIndices)return{header:n,vertexData:o};let{triangleIndices:A,triangleIndicesEndPosition:h}=L$(i,o,a);if(r.maxDecodingStep<Aa.edgeIndices)return{header:n,vertexData:o,triangleIndices:A};let{westIndices:g,southIndices:_,eastIndices:b,northIndices:T,edgeIndicesEndPosition:v}=N$(i,o,h);if(r.maxDecodingStep<Aa.extensions)return{header:n,vertexData:o,triangleIndices:A,westIndices:g,northIndices:T,eastIndices:b,southIndices:_};let{extensions:C}=U$(i,v);return{header:n,vertexData:o,triangleIndices:A,westIndices:g,northIndices:T,eastIndices:b,southIndices:_,extensions:C}}function Mg(t,e,r,i){let n=i?H$(i,t.POSITION.value):z$(e),s=new t.POSITION.value.constructor(n.length*6),o=new t.TEXCOORD_0.value.constructor(n.length*4),a=new e.constructor(n.length*6);for(let h=0;h<n.length;h++){let g=n[h];G$({edge:g,edgeIndex:h,attributes:t,skirtHeight:r,newPosition:s,newTexcoord0:o,newTriangles:a})}t.POSITION.value=Tl(t.POSITION.value,s),t.TEXCOORD_0.value=Tl(t.TEXCOORD_0.value,o);let A=e instanceof Array?e.concat(a):Tl(e,a);return{attributes:t,triangles:A}}function z$(t){let e=[];for(let n=0;n<t.length;n+=3)e.push([t[n],t[n+1]]),e.push([t[n+1],t[n+2]]),e.push([t[n+2],t[n]]);e.sort((n,s)=>Math.min(...n)-Math.min(...s)||Math.max(...n)-Math.max(...s));let r=[],i=0;for(;i<e.length;)e[i][0]===e[i+1]?.[1]&&e[i][1]===e[i+1]?.[0]?i+=2:(r.push(e[i]),i++);return r}function H$(t,e){t.westIndices.sort((i,n)=>e[3*i+1]-e[3*n+1]),t.eastIndices.sort((i,n)=>e[3*n+1]-e[3*i+1]),t.southIndices.sort((i,n)=>e[3*n]-e[3*i]),t.northIndices.sort((i,n)=>e[3*i]-e[3*n]);let r=[];for(let i in t){let n=t[i];for(let s=0;s<n.length-1;s++)r.push([n[s],n[s+1]])}return r}function G$({edge:t,edgeIndex:e,attributes:r,skirtHeight:i,newPosition:n,newTexcoord0:s,newTriangles:o}){let a=r.POSITION.value.length,A=e*2,h=e*2+1;n.set(r.POSITION.value.subarray(t[0]*3,t[0]*3+3),A*3),n[A*3+2]=n[A*3+2]-i,n.set(r.POSITION.value.subarray(t[1]*3,t[1]*3+3),h*3),n[h*3+2]=n[h*3+2]-i,s.set(r.TEXCOORD_0.value.subarray(t[0]*2,t[0]*2+2),A*2),s.set(r.TEXCOORD_0.value.subarray(t[1]*2,t[1]*2+2),h*2);let g=e*2*3;o[g]=t[0],o[g+1]=a/3+h,o[g+2]=t[1],o[g+3]=a/3+h,o[g+4]=t[0],o[g+5]=a/3+A}function Ox(t,e={}){let{bounds:r}=e,{header:i,vertexData:n,triangleIndices:s,westIndices:o,northIndices:a,eastIndices:A,southIndices:h}=Bx(t,Aa.triangleIndices),g=s,_=W$(n,i,r),b=Nn(_);if(e?.skirtHeight){let{attributes:T,triangles:v}=Mg(_,g,e.skirtHeight,{westIndices:o,northIndices:a,eastIndices:A,southIndices:h});_=T,g=v}return{loaderData:{header:{}},header:{vertexCount:g.length,boundingBox:b},schema:void 0,topology:"triangle-list",mode:4,indices:{value:g,size:1},attributes:_}}function W$(t,e,r){let{minHeight:i,maxHeight:n}=e,[s,o,a,A]=r||[0,0,1,1],h=a-s,g=A-o,_=n-i,b=t.length/3,T=new Float32Array(b*3),v=new Float32Array(b*2);for(let C=0;C<b;C++){let S=t[C]/32767,P=t[C+b]/32767,F=t[C+b*2]/32767;T[3*C+0]=S*h+s,T[3*C+1]=P*g+o,T[3*C+2]=F*_+i,v[2*C+0]=S,v[2*C+1]=P}return{POSITION:{value:T,size:3},TEXCOORD_0:{value:v,size:2}}}var Uf=class{constructor(e=257){this.gridSize=e;let r=e-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${e}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let i=0;i<this.numTriangles;i++){let n=i+2,s=0,o=0,a=0,A=0,h=0,g=0;for(n&1?a=A=h=r:s=o=g=r;(n>>=1)>1;){let b=s+a>>1,T=o+A>>1;n&1?(a=s,A=o,s=h,o=g):(s=a,o=A,a=h,A=g),h=b,g=T}let _=i*4;this.coords[_+0]=s,this.coords[_+1]=o,this.coords[_+2]=a,this.coords[_+3]=A}}createTile(e){return new Fx(e,this)}},Fx=class{constructor(e,r){let i=r.gridSize;if(e.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${e.length}.`);this.terrain=e,this.martini=r,this.errors=new Float32Array(e.length),this.update()}update(){let{numTriangles:e,numParentTriangles:r,coords:i,gridSize:n}=this.martini,{terrain:s,errors:o}=this;for(let a=e-1;a>=0;a--){let A=a*4,h=i[A+0],g=i[A+1],_=i[A+2],b=i[A+3],T=h+_>>1,v=g+b>>1,C=T+v-g,S=v+h-T,P=(s[g*n+h]+s[b*n+_])/2,F=v*n+T,I=Math.abs(P-s[F]);if(o[F]=Math.max(o[F],I),a<r){let k=(g+S>>1)*n+(h+C>>1),W=(b+S>>1)*n+(_+C>>1);o[F]=Math.max(o[F],o[k],o[W])}}}getMesh(e=0){let{gridSize:r,indices:i}=this.martini,{errors:n}=this,s=0,o=0,a=r-1;i.fill(0);function A(T,v,C,S,P,F){let I=T+C>>1,k=v+S>>1;Math.abs(T-P)+Math.abs(v-F)>1&&n[k*r+I]>e?(A(P,F,T,v,I,k),A(C,S,P,F,I,k)):(i[v*r+T]=i[v*r+T]||++s,i[S*r+C]=i[S*r+C]||++s,i[F*r+P]=i[F*r+P]||++s,o++)}A(0,0,a,a,a,0),A(a,a,0,0,0,a);let h=new Uint16Array(s*2),g=new Uint32Array(o*3),_=0;function b(T,v,C,S,P,F){let I=T+C>>1,k=v+S>>1;if(Math.abs(T-P)+Math.abs(v-F)>1&&n[k*r+I]>e)b(P,F,T,v,I,k),b(C,S,P,F,I,k);else{let W=i[v*r+T]-1,K=i[S*r+C]-1,re=i[F*r+P]-1;h[2*W]=T,h[2*W+1]=v,h[2*K]=C,h[2*K+1]=S,h[2*re]=P,h[2*re+1]=F,g[_++]=W,g[_++]=K,g[_++]=re}}return b(0,0,a,a,a,0),b(a,a,0,0,0,a),{vertices:h,triangles:g}}};var Vf=class{constructor(e,r,i=r){this.data=e,this.width=r,this.height=i,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;let n=r-1,s=i-1,o=this._addPoint(0,0),a=this._addPoint(n,0),A=this._addPoint(0,s),h=this._addPoint(n,s),g=this._addTriangle(h,o,A,-1,-1,-1);this._addTriangle(o,h,a,g,-1,-1),this._flush()}run(e=1){for(;this.getMaxError()>e;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(e,r){return this.data[this.width*r+e]}_flush(){let e=this.coords;for(let r=0;r<this._pendingLen;r++){let i=this._pending[r],n=2*this.triangles[i*3+0],s=2*this.triangles[i*3+1],o=2*this.triangles[i*3+2];this._findCandidate(e[n],e[n+1],e[s],e[s+1],e[o],e[o+1],i)}this._pendingLen=0}_findCandidate(e,r,i,n,s,o,a){let A=Math.min(e,i,s),h=Math.min(r,n,o),g=Math.max(e,i,s),_=Math.max(r,n,o),b=ua(i,n,s,o,A,h),T=ua(s,o,e,r,A,h),v=ua(e,r,i,n,A,h),C=n-r,S=e-i,P=o-n,F=i-s,I=r-o,k=s-e,W=ua(e,r,i,n,s,o),K=this.heightAt(e,r)/W,re=this.heightAt(i,n)/W,Y=this.heightAt(s,o)/W,z=0,L=0,se=0,le=0;for(let ce=h;ce<=_;ce++){let he=0;b<0&&P!==0&&(he=Math.max(he,Math.floor(-b/P))),T<0&&I!==0&&(he=Math.max(he,Math.floor(-T/I))),v<0&&C!==0&&(he=Math.max(he,Math.floor(-v/C)));let Re=b+P*he,Ke=T+I*he,Ye=v+C*he,$e=!1;for(let nt=A+he;nt<=g;nt++){if(Re>=0&&Ke>=0&&Ye>=0){$e=!0;let rt=K*Re+re*Ke+Y*Ye,Ne=Math.abs(rt-this.heightAt(nt,ce));le+=Ne*Ne,Ne>z&&(z=Ne,L=nt,se=ce)}else if($e)break;Re+=P,Ke+=I,Ye+=C}b+=F,T+=k,v+=S}(L===e&&se===r||L===i&&se===n||L===s&&se===o)&&(z=0),this._candidates[2*a]=L,this._candidates[2*a+1]=se,this._rms[a]=le,this._queuePush(a,z,le)}_step(){let e=this._queuePop(),r=e*3+0,i=e*3+1,n=e*3+2,s=this.triangles[r],o=this.triangles[i],a=this.triangles[n],A=this.coords[2*s],h=this.coords[2*s+1],g=this.coords[2*o],_=this.coords[2*o+1],b=this.coords[2*a],T=this.coords[2*a+1],v=this._candidates[2*e],C=this._candidates[2*e+1],S=this._addPoint(v,C);if(ua(A,h,g,_,v,C)===0)this._handleCollinear(S,r);else if(ua(g,_,b,T,v,C)===0)this._handleCollinear(S,i);else if(ua(b,T,A,h,v,C)===0)this._handleCollinear(S,n);else{let P=this._halfedges[r],F=this._halfedges[i],I=this._halfedges[n],k=this._addTriangle(s,o,S,P,-1,-1,r),W=this._addTriangle(o,a,S,F,-1,k+1),K=this._addTriangle(a,s,S,I,k+2,W+1);this._legalize(k),this._legalize(W),this._legalize(K)}}_addPoint(e,r){let i=this.coords.length>>1;return this.coords.push(e,r),i}_addTriangle(e,r,i,n,s,o,a=this.triangles.length){let A=a/3;return this.triangles[a+0]=e,this.triangles[a+1]=r,this.triangles[a+2]=i,this._halfedges[a+0]=n,this._halfedges[a+1]=s,this._halfedges[a+2]=o,n>=0&&(this._halfedges[n]=a+0),s>=0&&(this._halfedges[s]=a+1),o>=0&&(this._halfedges[o]=a+2),this._candidates[2*A+0]=0,this._candidates[2*A+1]=0,this._queueIndices[A]=-1,this._rms[A]=0,this._pending[this._pendingLen++]=A,a}_legalize(e){let r=this._halfedges[e];if(r<0)return;let i=e-e%3,n=r-r%3,s=i+(e+1)%3,o=i+(e+2)%3,a=n+(r+2)%3,A=n+(r+1)%3,h=this.triangles[o],g=this.triangles[e],_=this.triangles[s],b=this.triangles[a],T=this.coords;if(!j$(T[2*h],T[2*h+1],T[2*g],T[2*g+1],T[2*_],T[2*_+1],T[2*b],T[2*b+1]))return;let v=this._halfedges[s],C=this._halfedges[o],S=this._halfedges[a],P=this._halfedges[A];this._queueRemove(i/3),this._queueRemove(n/3);let F=this._addTriangle(h,b,_,-1,S,v,i),I=this._addTriangle(b,h,g,F,C,P,n);this._legalize(F+1),this._legalize(I+2)}_handleCollinear(e,r){let i=r-r%3,n=i+(r+1)%3,s=i+(r+2)%3,o=this.triangles[s],a=this.triangles[r],A=this.triangles[n],h=this._halfedges[n],g=this._halfedges[s],_=this._halfedges[r];if(_<0){let K=this._addTriangle(e,o,a,-1,g,-1,i),re=this._addTriangle(o,e,A,K,-1,h);this._legalize(K+1),this._legalize(re+2);return}let b=_-_%3,T=b+(_+2)%3,v=b+(_+1)%3,C=this.triangles[T],S=this._halfedges[T],P=this._halfedges[v];this._queueRemove(b/3);let F=this._addTriangle(o,a,e,g,-1,-1,i),I=this._addTriangle(a,C,e,P,-1,F+1,b),k=this._addTriangle(C,A,e,S,-1,I+1),W=this._addTriangle(A,o,e,h,F+2,k+1);this._legalize(F),this._legalize(I),this._legalize(k),this._legalize(W)}_queuePush(e,r,i){let n=this._queue.length;this._queueIndices[e]=n,this._queue.push(e),this._errors.push(r),this._rmsSum+=i,this._queueUp(n)}_queuePop(){let e=this._queue.length-1;return this._queueSwap(0,e),this._queueDown(0,e),this._queuePopBack()}_queuePopBack(){let e=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[e],this._queueIndices[e]=-1,e}_queueRemove(e){let r=this._queueIndices[e];if(r<0){let n=this._pending.indexOf(e);if(n!==-1)this._pending[n]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}let i=this._queue.length-1;i!==r&&(this._queueSwap(r,i),this._queueDown(r,i)||this._queueUp(r)),this._queuePopBack()}_queueLess(e,r){return this._errors[e]>this._errors[r]}_queueSwap(e,r){let i=this._queue[e],n=this._queue[r];this._queue[e]=n,this._queue[r]=i,this._queueIndices[i]=r,this._queueIndices[n]=e;let s=this._errors[e];this._errors[e]=this._errors[r],this._errors[r]=s}_queueUp(e){let r=e;for(;;){let i=r-1>>1;if(i===r||!this._queueLess(r,i))break;this._queueSwap(i,r),r=i}}_queueDown(e,r){let i=e;for(;;){let n=2*i+1;if(n>=r||n<0)break;let s=n+1,o=n;if(s<r&&this._queueLess(s,n)&&(o=s),!this._queueLess(o,i))break;this._queueSwap(i,o),i=o}return i>e}};function ua(t,e,r,i,n,s){return(r-n)*(e-s)-(i-s)*(t-n)}function j$(t,e,r,i,n,s,o,a){let A=t-o,h=e-a,g=r-o,_=i-a,b=n-o,T=s-a,v=A*A+h*h,C=g*g+_*_,S=b*b+T*T;return A*(_*S-C*T)-h*(g*S-C*b)+v*(g*T-_*b)<0}function r8(t,e){let{meshMaxError:r,bounds:i,elevationDecoder:n}=e,{data:s,width:o,height:a}=t,A,h;switch(e.tesselator){case"martini":A=Pg(s,o,a,n,e.tesselator),h=e8(r,o,A);break;case"delatin":A=Pg(s,o,a,n,e.tesselator),h=t8(r,o,a,A);break;default:o===a&&!(a&o-1)?(A=Pg(s,o,a,n,"martini"),h=e8(r,o,A)):(A=Pg(s,o,a,n,"delatin"),h=t8(r,o,a,A));break}let{vertices:g}=h,{triangles:_}=h,b=X$(g,A,o,a,i),T=Nn(b);if(e.skirtHeight){let{attributes:v,triangles:C}=Mg(b,_,e.skirtHeight);b=v,_=C}return{loaderData:{header:{}},header:{vertexCount:_.length,boundingBox:T},mode:4,indices:{value:Uint32Array.from(_),size:1},attributes:b}}function e8(t,e,r){let i=e+1,s=new Uf(i).createTile(r),{vertices:o,triangles:a}=s.getMesh(t);return{vertices:o,triangles:a}}function t8(t,e,r,i){let n=new Vf(i,e+1,r+1);n.run(t);let{coords:s,triangles:o}=n;return{vertices:s,triangles:o}}function Pg(t,e,r,i,n){let{rScaler:s,bScaler:o,gScaler:a,offset:A}=i,h=new Float32Array((e+1)*(r+1));for(let g=0,_=0;_<r;_++)for(let b=0;b<e;b++,g++){let T=g*4,v=t[T+0],C=t[T+1],S=t[T+2];h[g+_]=v*s+C*a+S*o+A}if(n==="martini"){for(let g=(e+1)*e,_=0;_<e;_++,g++)h[g]=h[g-e-1];for(let g=r,_=0;_<r+1;_++,g+=r+1)h[g]=h[g-1]}return h}function X$(t,e,r,i,n){let s=r+1,o=t.length/2,a=new Float32Array(o*3),A=new Float32Array(o*2),[h,g,_,b]=n||[0,0,r,i],T=(_-h)/r,v=(b-g)/i;for(let C=0;C<o;C++){let S=t[C*2],P=t[C*2+1],F=P*s+S;a[3*C+0]=S*T+h,a[3*C+1]=-P*v+b,a[3*C+2]=e[F],A[2*C+0]=S/r,A[2*C+1]=P/i}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:A,size:2}}}var Rg="4.3.2";var Ig={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:Rg,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};var i8={dataType:null,batchType:null,name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:Rg,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};var Y$={...Ig,parse:Q$};async function Q$(t,e,r){let i={...e,mimeType:"application/x.image",image:{...e?.image,type:"data"}},n=await ii(t,[],i,r),s={...Y$.options.terrain,...e?.terrain};return r8(n,s)}var E9e={...i8,parseSync:(t,e)=>Ox(t,e?.["quantized-mesh"]),parse:async(t,e)=>Ox(t,e?.["quantized-mesh"])};var n8=[1],q$={...Jo.defaultProps,elevationData:Ws,texture:{...Ws,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[Ig]};function s8(t){return Array.isArray(t)?t.join(";"):t||""}var zf=class extends zt{updateState({props:e,oldProps:r}){let i=e.elevationData!==r.elevationData;if(i){let{elevationData:s}=e,o=s&&(Array.isArray(s)||s.includes("{x}")&&s.includes("{y}"));this.setState({isTiled:o})}let n=i||e.meshMaxError!==r.meshMaxError||e.elevationDecoder!==r.elevationDecoder||e.bounds!==r.bounds;if(!this.state.isTiled&&n){let s=this.loadTerrain(e);this.setState({terrain:s})}e.workerUrl&&me.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:e,bounds:r,elevationDecoder:i,meshMaxError:n,signal:s}){if(!e)return null;let o=this.getLoadOptions();o={...o,terrain:{skirtHeight:this.state.isTiled?n*2:0,...o?.terrain,bounds:r,meshMaxError:n,elevationDecoder:i}};let{fetch:a}=this.props;return a(e,{propName:"elevationData",layer:this,loadOptions:o,signal:s})}getTiledTerrainData(e){let{elevationData:r,fetch:i,texture:n,elevationDecoder:s,meshMaxError:o}=this.props,{viewport:a}=this.context,A=Sn(r,e),h=n&&Sn(n,e),{signal:g}=e,_=[0,0],b=[0,0];if(a.isGeospatial){let S=e.bbox;_=a.projectFlat([S.west,S.south]),b=a.projectFlat([S.east,S.north])}else{let S=e.bbox;_=[S.left,S.bottom],b=[S.right,S.top]}let T=[_[0],_[1],b[0],b[1]],v=this.loadTerrain({elevationData:A,bounds:T,elevationDecoder:s,meshMaxError:o,signal:g}),C=h?i(h,{propName:"texture",layer:this,loaders:[],signal:g}).catch(S=>null):Promise.resolve(null);return Promise.all([v,C])}renderSubLayers(e){let r=this.getSubLayerClass("mesh",Fc),{color:i,wireframe:n,material:s}=this.props,{data:o}=e;if(!o)return null;let[a,A]=o;return new r(e,{data:n8,mesh:a,texture:A,_instanced:!1,coordinateSystem:Se.CARTESIAN,getPosition:h=>[0,0,0],getColor:i,wireframe:n,material:s})}onViewportLoad(e){if(!e)return;let{zRange:r}=this.state,i=e.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(A=>A[2]));if(i.length===0)return;let n=Math.min(...i.map(o=>o[0])),s=Math.max(...i.map(o=>o[1]));(!r||n<r[0]||s>r[1])&&this.setState({zRange:[n,s]})}renderLayers(){let{color:e,material:r,elevationData:i,texture:n,wireframe:s,meshMaxError:o,elevationDecoder:a,tileSize:A,maxZoom:h,minZoom:g,extent:_,maxRequests:b,onTileLoad:T,onTileUnload:v,onTileError:C,maxCacheSize:S,maxCacheByteSize:P,refinementStrategy:F}=this.props;if(this.state.isTiled)return new Jo(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:s8(i),texture:s8(n),meshMaxError:o,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:A,maxZoom:h,minZoom:g,extent:_,maxRequests:b,onTileLoad:T,onTileUnload:v,onTileError:C,maxCacheSize:S,maxCacheByteSize:P,refinementStrategy:F});if(!i)return null;let I=this.getSubLayerClass("mesh",Fc);return new I(this.getSubLayerProps({id:"mesh"}),{data:n8,mesh:this.state.terrain,texture:n,_instanced:!1,getPosition:k=>[0,0,0],getColor:e,material:r,wireframe:s})}};zf.defaultProps=q$;zf.layerName="TerrainLayer";var o8=zf;var K$={clipBounds:[0,0,1,1],clipByInstance:void 0},a8=`
uniform clipUniforms {
  vec4 bounds;
} clip;

bool clip_isInBounds(vec2 position) {
  return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
}
`,J$={name:"clip",vs:a8,uniformTypes:{bounds:"vec4<f32>"}},Z$={"vs:#decl":`
out float clip_isVisible;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
`,"fs:#decl":`
in float clip_isVisible;
`,"fs:DECKGL_FILTER_COLOR":`
  if (clip_isVisible < 0.5) discard;
`},$$={name:"clip",fs:a8,uniformTypes:{bounds:"vec4<f32>"}},eee={"vs:#decl":`
out vec2 clip_commonPosition;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  clip_commonPosition = geometry.position.xy;
`,"fs:#decl":`
in vec2 clip_commonPosition;
`,"fs:DECKGL_FILTER_COLOR":`
  if (!clip_isInBounds(clip_commonPosition)) discard;
`},Hf=class extends K_{getShaders(){let e="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(e=!!this.props.clipByInstance),this.state.clipByInstance=e,e?{modules:[J$],inject:Z$}:{modules:[$$],inject:eee}}draw(){let{clipBounds:e}=this.props,r={};if(this.state.clipByInstance)r.bounds=e;else{let i=this.projectPosition([e[0],e[1],0]),n=this.projectPosition([e[2],e[3],0]);r.bounds=[Math.min(i[0],n[0]),Math.min(i[1],n[1]),Math.max(i[0],n[0]),Math.max(i[1],n[1])]}this.setShaderModuleProps({clip:r})}};Hf.defaultProps=K$;Hf.extensionName="ClipExtension";var Lx=Hf;function kx(t,e,r){let i=tee(t),n=Object.keys(i).filter(s=>i[s]!==Array);return ree(t,{propArrayTypes:i,...e},{numericPropKeys:r&&r.numericPropKeys||n,PositionDataType:r?r.PositionDataType:Float32Array,triangulate:r?r.triangulate:!0})}function tee(t){let e={};for(let r of t)if(r.properties)for(let i in r.properties){let n=r.properties[i];e[i]=cee(n,e[i])}return e}function ree(t,e,r){let{pointPositionsCount:i,pointFeaturesCount:n,linePositionsCount:s,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:A,polygonObjectsCount:h,polygonRingsCount:g,polygonFeaturesCount:_,propArrayTypes:b,coordLength:T}=e,{numericPropKeys:v=[],PositionDataType:C=Float32Array,triangulate:S=!0}=r,P=t[0]&&"id"in t[0],F=t.length>65535?Uint32Array:Uint16Array,I={type:"Point",positions:new C(i*T),globalFeatureIds:new F(i),featureIds:n>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},k={type:"LineString",pathIndices:s>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new C(s*T),globalFeatureIds:new F(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},W={type:"Polygon",polygonIndices:A>65535?new Uint32Array(h+1):new Uint16Array(h+1),primitivePolygonIndices:A>65535?new Uint32Array(g+1):new Uint16Array(g+1),positions:new C(A*T),globalFeatureIds:new F(A),featureIds:_>65535?new Uint32Array(A):new Uint16Array(A),numericProps:{},properties:[],fields:[]};S&&(W.triangles=[]);for(let re of[I,k,W])for(let Y of v){let z=b[Y];re.numericProps[Y]=new z(re.positions.length/T)}k.pathIndices[o]=s,W.polygonIndices[h]=A,W.primitivePolygonIndices[g]=A;let K={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(let re of t){let Y=re.geometry,z=re.properties||{};switch(Y.type){case"Point":iee(Y,I,K,T,z),I.properties.push(Dx(z,v)),P&&I.fields.push({id:re.id}),K.pointFeature++;break;case"LineString":nee(Y,k,K,T,z),k.properties.push(Dx(z,v)),P&&k.fields.push({id:re.id}),K.lineFeature++;break;case"Polygon":see(Y,W,K,T,z),W.properties.push(Dx(z,v)),P&&W.fields.push({id:re.id}),K.polygonFeature++;break;default:throw new Error("Invalid geometry type")}K.feature++}return aee(I,k,W,T)}function iee(t,e,r,i,n){e.positions.set(t.data,r.pointPosition*i);let s=t.data.length/i;Ux(e,n,r.pointPosition,s),e.globalFeatureIds.fill(r.feature,r.pointPosition,r.pointPosition+s),e.featureIds.fill(r.pointFeature,r.pointPosition,r.pointPosition+s),r.pointPosition+=s}function nee(t,e,r,i,n){e.positions.set(t.data,r.linePosition*i);let s=t.data.length/i;Ux(e,n,r.linePosition,s),e.globalFeatureIds.fill(r.feature,r.linePosition,r.linePosition+s),e.featureIds.fill(r.lineFeature,r.linePosition,r.linePosition+s);for(let o=0,a=t.indices.length;o<a;++o){let A=t.indices[o],h=o===a-1?t.data.length:t.indices[o+1];e.pathIndices[r.linePath++]=r.linePosition,r.linePosition+=(h-A)/i}}function see(t,e,r,i,n){e.positions.set(t.data,r.polygonPosition*i);let s=t.data.length/i;Ux(e,n,r.polygonPosition,s),e.globalFeatureIds.fill(r.feature,r.polygonPosition,r.polygonPosition+s),e.featureIds.fill(r.polygonFeature,r.polygonPosition,r.polygonPosition+s);for(let o=0,a=t.indices.length;o<a;++o){let A=r.polygonPosition;e.polygonIndices[r.polygonObject++]=A;let h=t.areas[o],g=t.indices[o],_=t.indices[o+1];for(let T=0,v=g.length;T<v;++T){let C=g[T],S=T===v-1?_===void 0?t.data.length:_[0]:g[T+1];e.primitivePolygonIndices[r.polygonRing++]=r.polygonPosition,r.polygonPosition+=(S-C)/i}let b=r.polygonPosition;oee(e,h,g,{startPosition:A,endPosition:b,coordLength:i})}}function oee(t,e,r,{startPosition:i,endPosition:n,coordLength:s}){if(!t.triangles)return;let o=i*s,a=n*s,A=t.positions.subarray(o,a),h=r[0],g=r.slice(1).map(b=>(b-h)/s),_=uy(A,g,s,e);for(let b=0,T=_.length;b<T;++b)t.triangles.push(i+_[b])}function Nx(t,e){let r={};for(let i in t)r[i]={value:t[i],size:e};return r}function aee(t,e,r,i){let n={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:i},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:Nx(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:i},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:Nx(e.numericProps,1)},polygons:{...r,positions:{value:r.positions,size:i},polygonIndices:{value:r.polygonIndices,size:1},primitivePolygonIndices:{value:r.primitivePolygonIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:Nx(r.numericProps,1)}};return n.polygons&&r.triangles&&(n.polygons.triangles={value:new Uint32Array(r.triangles),size:1}),n}function Ux(t,e,r,i){for(let n in t.numericProps)if(n in e){let s=e[n];t.numericProps[n].fill(s,r,r+i)}}function Dx(t,e){let r={};for(let i in t)e.includes(i)||(r[i]=t[i]);return r}function cee(t,e){return e===Array||!Number.isFinite(t)?Array:e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array}function Fg(t,e){let r=e?.globalFeatureId;return r!==void 0?lee(t,r):Aee(t,e?.type)}function lee(t,e){let r=l8(t);for(let i of r){let n=0,s=i.featureIds.value[0];for(let o=0;o<i.featureIds.value.length;o++){let a=i.featureIds.value[o];if(a!==s){if(e===i.globalFeatureIds.value[n])return Bg(i,n,o);n=o,s=a}}if(e===i.globalFeatureIds.value[n])return Bg(i,n,i.featureIds.value.length)}throw new Error(`featureId:${e} not found`)}function Aee(t,e){let r=l8(t,e);return uee(r)}function c8(t,e,r){switch(t.type){case"Point":return pee(t,e,r);case"LineString":return dee(t,e,r);case"Polygon":return A8(t,e,r);default:let i=t;throw new Error(`Unsupported geometry type: ${i?.type}`)}}function l8(t,e){let r=[];return t.points&&(t.points.type="Point",r.push(t.points)),t.lines&&(t.lines.type="LineString",r.push(t.lines)),t.polygons&&(t.polygons.type="Polygon",r.push(t.polygons)),r}function uee(t){let e=[];for(let r of t){if(r.featureIds.value.length===0)continue;let i=0,n=r.featureIds.value[0];for(let s=0;s<r.featureIds.value.length;s++){let o=r.featureIds.value[s];o!==n&&(e.push(Bg(r,i,s)),i=s,n=o)}e.push(Bg(r,i,r.featureIds.value.length))}return e}function Bg(t,e,r){let i=c8(t,e,r),n=hee(t,e,r),s=fee(t,e,r);return{type:"Feature",geometry:i,properties:n,...s}}function fee(t,e=0,r){return t.fields&&t.fields[t.featureIds.value[e]]}function hee(t,e=0,r){let i=Object.assign({},t.properties[t.featureIds.value[e]]);for(let n in t.numericProps)i[n]=t.numericProps[n].value[e];return i}function A8(t,e=-1/0,r=1/0){let{positions:i}=t,n=t.polygonIndices.value.filter(A=>A>=e&&A<=r),s=t.primitivePolygonIndices.value.filter(A=>A>=e&&A<=r);if(!(n.length>2)){let A=[];for(let h=0;h<s.length-1;h++){let g=s[h],_=s[h+1],b=Og(i,g,_);A.push(b)}return{type:"Polygon",coordinates:A}}let a=[];for(let A=0;A<n.length-1;A++){let h=n[A],g=n[A+1],_=A8(t,h,g).coordinates;a.push(_)}return{type:"MultiPolygon",coordinates:a}}function dee(t,e=-1/0,r=1/0){let{positions:i}=t,n=t.pathIndices.value.filter(a=>a>=e&&a<=r);if(!(n.length>2))return{type:"LineString",coordinates:Og(i,n[0],n[1])};let o=[];for(let a=0;a<n.length-1;a++){let A=Og(i,n[a],n[a+1]);o.push(A)}return{type:"MultiLineString",coordinates:o}}function pee(t,e,r){let{positions:i}=t,n=Og(i,e,r);return n.length>1?{type:"MultiPoint",coordinates:n}:{type:"Point",coordinates:n[0]}}function Og(t,e,r){e=e||0,r=r||t.value.length/t.size;let i=[];for(let n=e;n<r;n++){let s=Array();for(let o=n*t.size;o<(n+1)*t.size;o++)s.push(Number(t.value[o]));i.push(s)}return i}var jx=_a(m8(),1);function Oee(t){let e=0;for(let r=0,i=t.length-1,n,s;r<t.length;i=r++)n=t[r],s=t[i],e+=(s[0]-n[0])*(n[1]+s[1]);return e}function Hx(t,e){if(Array.isArray(t[0])){for(let i of t)Hx(i,e);return}let r=t;r[0]/=e,r[1]/=e}function _8(t,e){for(let r=0;r<t.length;++r)t[r]/=e}function Gx(t,e,r){if(typeof t[0][0]!="number"){for(let o of t)Gx(o,e,r);return}let i=r*Math.pow(2,e.z),n=r*e.x,s=r*e.y;for(let o=0;o<t.length;o++){let a=t[o];a[0]=(a[0]+n)*360/i-180;let A=180-(a[1]+s)*360/i;a[1]=360/Math.PI*Math.atan(Math.exp(A*Math.PI/180))-90}}function y8(t,e,r){let{x:i,y:n,z:s}=e,o=r*Math.pow(2,s),a=r*i,A=r*n;for(let h=0,g=t.length;h<g;h+=2){t[h]=(t[h]+a)*360/o-180;let _=180-(t[h+1]+A)*360/o;t[h+1]=360/Math.PI*Math.atan(Math.exp(_*Math.PI/180))-90}}function x8(t){let e=t.length;if(e<=1)return[t];let r=[],i,n;for(let s=0;s<e;s++){let o=Oee(t[s]);o!==0&&(n===void 0&&(n=o<0),n===o<0?(i&&r.push(i),i=[t[s]]):i&&i.push(t[s]))}return i&&r.push(i),r}function b8(t){let e=t.indices.length,r="Polygon";if(e<=1)return{type:r,data:t.data,areas:[[Ls(t.data)]],indices:[t.indices]};let i=[],n=[],s=[],o=[],a,A=0;for(let h,g=0,_;g<e;g++){_=t.indices[g]-A,h=t.indices[g+1]-A||t.data.length;let b=t.data.slice(_,h),T=Ls(b);if(T===0){let v=t.data.slice(0,_),C=t.data.slice(h);t.data=v.concat(C),A+=h-_;continue}a===void 0&&(a=T<0),a===T<0?(o.length&&(i.push(s),n.push(o)),o=[_],s=[T]):(s.push(T),o.push(_))}return s&&i.push(s),o.length&&n.push(o),{type:r,areas:i,indices:n,data:t.data}}var tl=class{properties;extent;type;id;_pbf;_geometry;_keys;_values;_geometryInfo;static types=["Unknown","Point","LineString","Polygon"];constructor(e,r,i,n,s,o){this.properties={},this.extent=i,this.type=0,this.id=null,this._pbf=e,this._geometry=-1,this._keys=n,this._values=s,this._geometryInfo=o,e.readFields(Fee,this,r)}toGeoJSONFeature(e,r){let i=this.loadGeometry();switch(e){case"wgs84":return T8(this,i,n=>Gx(n,r,this.extent));default:return T8(this,i,Hx)}}toBinaryFeature(e,r){let i=this.loadFlatGeometry();switch(e){case"wgs84":return this._toBinaryCoordinates(i,n=>y8(n,r,this.extent));default:return this._toBinaryCoordinates(i,_8)}}bbox(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n=0,s=0,o=0,a=1/0,A=-1/0,h=1/0,g=-1/0;for(;e.pos<r;){if(n<=0){let _=e.readVarint();i=_&7,n=_>>3}if(n--,i===1||i===2)s+=e.readSVarint(),o+=e.readSVarint(),s<a&&(a=s),s>A&&(A=s),o<h&&(h=o),o>g&&(g=o);else if(i!==7)throw new Error(`unknown command ${i}`)}return[a,h,A,g]}_toBinaryCoordinates(e,r){let i;r(e.data,this.extent);let n=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=e.indices.length,i={type:"Point",...e};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=e.indices.length,this._geometryInfo.linePositionsCount+=e.data.length/n,i={type:"LineString",...e};break;case 3:i=b8(e),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=i.indices.length;for(let o of i.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=i.data.length/n;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}let s={type:"Feature",geometry:i,properties:this.properties};return this.id!==null&&(s.id=this.id),s}loadGeometry(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n=0,s=0,o=0,a=[],A;for(;e.pos<r;){if(n<=0){let h=e.readVarint();i=h&7,n=h>>3}switch(n--,i){case 1:case 2:s+=e.readSVarint(),o+=e.readSVarint(),i===1&&(A&&a.push(A),A=[]),A&&A.push([s,o]);break;case 7:A&&A.push(A[0].slice());break;default:throw new Error(`unknown command ${i}`)}}return A&&a.push(A),a}loadFlatGeometry(){let e=this._pbf;e.pos=this._geometry;let r=e.readVarint()+e.pos,i=1,n,s=0,o=0,a=0,A=0,h=[],g=[];for(;e.pos<r;)if(s<=0&&(n=e.readVarint(),i=n&7,s=n>>3),s--,i===1||i===2)o+=e.readSVarint(),a+=e.readSVarint(),i===1&&h.push(A),g.push(o,a),A+=2;else if(i===7){if(A>0){let _=h[h.length-1];g.push(g[_],g[_+1]),A+=2}}else throw new Error(`unknown command ${i}`);return{data:g,indices:h}}};function T8(t,e,r){let i=tl.types[t.type],n,s,o;switch(t.type){case 1:let A=[];for(n=0;n<e.length;n++)A[n]=e[n][0];o=A,r(o,t.extent);break;case 2:for(o=e,n=0;n<o.length;n++)r(o[n],t.extent);break;case 3:for(o=x8(e),n=0;n<o.length;n++)for(s=0;s<o[n].length;s++)r(o[n][s],t.extent);break;default:throw new Error("illegal vector tile type")}o.length===1?o=o[0]:i=`Multi${i}`;let a={type:"Feature",geometry:{type:i,coordinates:o},properties:t.properties};return t.id!==null&&(a.properties||={},a.properties.id=t.id),a}function Fee(t,e,r){e&&r&&(t===1?e.id=r.readVarint():t===2?Lee(r,e):t===3?e.type=r.readVarint():t===4&&(e._geometry=r.pos))}function Lee(t,e){let r=t.readVarint()+t.pos;for(;t.pos<r;){let i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}var Dg=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(e,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Nee,this,r),this.length=this._features.length}getGeoJSONFeature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let r=this._pbf.readVarint()+this._pbf.pos;return new tl(this._pbf,r,this.extent,this._keys,this._values)}getBinaryFeature(e,r){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];let i=this._pbf.readVarint()+this._pbf.pos;return new tl(this._pbf,i,this.extent,this._keys,this._values,r)}};function Nee(t,e,r){e&&r&&(t===15?e.version=r.readVarint():t===1?e.name=r.readString():t===5?e.extent=r.readVarint():t===2?e._features.push(r.pos):t===3?e._keys.push(r.readString()):t===4&&e._values.push(Dee(r)))}function Dee(t){let e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){let i=t.readVarint()>>3;e=i===1?t.readString():i===2?t.readFloat():i===3?t.readDouble():i===4?t.readVarint64():i===5?t.readVarint():i===6?t.readSVarint():i===7?t.readBoolean():null}return e}var Gf=class{layers;constructor(e,r){this.layers=e.readFields(kee,{},r)}};function kee(t,e,r){if(t===3&&r){let i=new Dg(r,r.readVarint()+r.pos);i.length&&e&&(e[i.name]=i)}}function Xx(t,e){let r=Vee(e),i=e?.gis?.format||e?.mvt?.shape||e?.shape;switch(i){case"columnar-table":return{shape:"columnar-table",data:Wx(t,r)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:E8(t,r)};case"geojson":return E8(t,r);case"binary-geometry":return Wx(t,r);case"binary":return Wx(t,r);default:throw new Error(i||"undefined shape")}}function Wx(t,e){let[r,i]=Uee(t,e),n=kx(r,i);return n.byteLength=t.byteLength,n}function Uee(t,e){let r=[],i={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(t.byteLength<=0)return[r,i];let n=new Gf(new jx.default(t));return(e&&Array.isArray(e.layers)?e.layers:Object.keys(n.layers)).forEach(o=>{let a=n.layers[o];if(a)for(let A=0;A<a.length;A++){let h=a.getBinaryFeature(A,i),g=Hee(h,e,o);r.push(g)}}),[r,i]}function E8(t,e){if(t.byteLength<=0)return[];let r=[],i=new Gf(new jx.default(t));return(Array.isArray(e.layers)?e.layers:Object.keys(i.layers)).forEach(s=>{let o=i.layers[s];if(o)for(let a=0;a<o.length;a++){let A=o.getGeoJSONFeature(a),h=zee(A,e,s);r.push(h)}}),r}function Vee(t){if(!t?.mvt)throw new Error("mvt options required");if(t.mvt?.coordinates==="wgs84"&&!t.mvt.tileIndex)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return t.gis&&gl.warn('MVTLoader: "options.gis" is deprecated, use "options.mvt.shape" instead')(),t.mvt}function zee(t,e,r){let i=t.toGeoJSONFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&(i.properties||={},i.properties[e.layerProperty]=r),i}function Hee(t,e,r){let i=t.toBinaryFeature(e.coordinates||"local",e.tileIndex);return e.layerProperty&&i.properties&&(i.properties[e.layerProperty]=r),i}var Gee="4.3.2",kg={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:Gee,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:void 0}}},Wee={...kg,parse:async(t,e)=>Xx(t,e),parseSync:Xx,binary:!0};var jee={Point:v8,MultiPoint:Xee,LineString:w8,MultiLineString:Yee,Polygon:C8,MultiPolygon:Qee};function v8([t,e],[r,i],n){let s=br(r[0],i[0],t),o=br(r[1],i[1],e);return n.unprojectFlat([s,o])}function Yx(t,e,r){return t.map(i=>v8(i,e,r))}function Xee(t,e,r){return Yx(t,e,r)}function w8(t,e,r){return Yx(t,e,r)}function Yee(t,e,r){return t.map(i=>w8(i,e,r))}function C8(t,e,r){return t.map(i=>Yx(i,e,r))}function Qee(t,e,r){return t.map(i=>C8(i,e,r))}function S8(t,e,r){let i=r.projectFlat([e.west,e.north]),n=r.projectFlat([e.east,e.south]),s=[i,n];return{...t,coordinates:jee[t.type](t.coordinates,s,r)}}var qee=["points","lines","polygons"];function Qx(t,e,r,i){for(let n of qee){let s=t[n]&&Kee(t[n],e,r,i);if(s>=0)return s}return-1}function Kee(t,e,r,i){let n=t.featureIds.value;if(!n.length)return-1;let s=0,o=n[n.length-1]+1;if(i){let A=Jee(t,i);if(A)s=A[0],o=A[1]+1;else return-1}let a=-1;if(e in t.numericProps){let A=t.numericProps[e].value.findIndex((h,g)=>h===r&&n[g]>=s&&n[g]<o);return A>=0?t.globalFeatureIds.value[A]:-1}else e?a=M8(t.properties,A=>A[e]===r,s,o):t.fields&&(a=M8(t.fields,A=>A.id===r,s,o));return a>=0?Zee(t,a):-1}function Jee(t,e){if(!t.__layers){let r={},{properties:i}=t;for(let n=0;n<i.length;n++){let{layerName:s}=i[n];s&&(r[s]?r[s][1]=n:r[s]=[n,n])}t.__layers=r}return t.__layers[e]}function Zee(t,e){if(!t.__ids){let r=[],i=t.featureIds.value,n=t.globalFeatureIds.value;for(let s=0;s<i.length;s++)r[i[s]]=n[s];t.__ids=r}return t.__ids[e]}function M8(t,e,r,i){for(let n=r;n<i;n++)if(e(t[n],n))return n;return-1}var qx=512,$ee={...jo.defaultProps,data:Ws,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[kg],binary:!0},Wf=class extends Jo{initializeState(){super.initializeState();let e=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:e,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return!!(this.state?.data&&super.isLoaded)}updateState({props:e,oldProps:r,context:i,changeFlags:n}){n.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:e,oldProps:r,context:i,changeFlags:n}),this._setWGS84PropertyForTiles());let{highlightColor:s}=e;s!==r.highlightColor&&Array.isArray(s)&&this.setState({highlightColor:s})}async _updateTileData(){let e=this.props.data,r=null;if(typeof e=="string"&&!o3(e)){let{onDataLoad:i,fetch:n}=this.props;this.setState({data:null,tileJSON:null});try{r=await n(e,{propName:"data",layer:this,loaders:[]})}catch(s){this.raiseError(s,"loading TileJSON"),e=null}i&&i(r,{propName:"data",layer:this})}else e&&typeof e=="object"&&"tilejson"in e&&(r=e);r&&(e=r.tiles),this.setState({data:e,tileJSON:r})}_getTilesetOptions(){let e=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:i,maxZoom:n}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>i&&(e.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(n)||r.maxzoom<n)&&(e.maxZoom=r.maxzoom)),e}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(e){let{data:r,binary:i}=this.state,{index:n,signal:s}=e,o=Sn(r,e);if(!o)return Promise.reject("Invalid URL");let a=this.getLoadOptions(),{fetch:A}=this.props;return a={...a,mimeType:"application/x-protobuf",mvt:{...a?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:n},gis:i?{format:"binary"}:{}},A(o,{propName:"data",layer:this,loadOptions:a,signal:s})}renderSubLayers(e){let{x:r,y:i,z:n}=e.tile.index,s=Math.pow(2,n),o=qx/s,a=-o,A=qx*r/s,h=qx*(1-i/s),g=new Ce().scale([o,a,1]);e.autoHighlight=!1,this.context.viewport.resolution||(e.modelMatrix=g,e.coordinateOrigin=[A,h,0],e.coordinateSystem=Se.CARTESIAN,e.extensions=[...e.extensions||[],new Lx]);let _=super.renderSubLayers(e);return this.state.binary&&!(_ instanceof jo)&&me.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),_}_updateAutoHighlight(e){let{uniqueIdProperty:r}=this.props,{hoveredFeatureId:i,hoveredFeatureLayerName:n}=this.state,s=e.object,o=null,a=null;s&&(o=Kx(s,r),a=P8(s));let{highlightColor:A}=this.props;typeof A=="function"&&(A=A(e)),(i!==o||n!==a)&&this.setState({highlightColor:A,hoveredFeatureId:o,hoveredFeatureLayerName:a})}_isWGS84(){return!!this.context.viewport.resolution}getPickingInfo(e){let r=super.getPickingInfo(e);if(this.state.binary&&r.index!==-1){let{data:i}=e.sourceLayer.props;r.object=Fg(i,{globalFeatureId:r.index})}return r.object&&!this._isWGS84()&&(r.object=I8(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){let{hoveredFeatureId:r,hoveredFeatureLayerName:i,binary:n}=this.state,{uniqueIdProperty:s,highlightedFeatureId:o}=this.props,a=e.content,A=R8(o);if(!(R8(r)||A))return-1;let g=A?o:r;return Array.isArray(a)?a.findIndex(_=>{let b=Kx(_,s)===g,T=A||P8(_)===i;return b&&T}):a&&n?Qx(a,s,g,A?"":i):-1}_pickObjects(e){let{deck:r,viewport:i}=this.context,n=i.width,s=i.height,o=i.x,a=i.y,A=[this.id];return r.pickObjects({x:o,y:a,width:n,height:s,layerIds:A,maxObjects:e})}getRenderedFeatures(e=null){let r=this._pickObjects(e),i=new Set,n=[];for(let s of r){let o=Kx(s.object,this.props.uniqueIdProperty);o===void 0?n.push(s.object):i.has(o)||(i.add(o),n.push(s.object))}return n}_setWGS84PropertyForTiles(){let e="dataInWGS84";this.state.tileset.selectedTiles.forEach(i=>{i.hasOwnProperty(e)||Object.defineProperty(i,e,{get:()=>{if(!i.content)return null;if(this.state.binary&&Array.isArray(i.content)&&!i.content.length)return[];let{bbox:n}=i;if(i._contentWGS84===void 0&&a3(n)){let s=this.state.binary?Fg(i.content):i.content;i._contentWGS84=s.map(o=>I8(o,n,this.context.viewport))}return i._contentWGS84}})})}};Wf.layerName="MVTLayer";Wf.defaultProps=$ee;var B8=Wf;function Kx(t,e){if(t.properties&&e)return t.properties[e];if("id"in t)return t.id}function P8(t){return t.properties?.layerName||null}function R8(t){return t!=null&&t!==""}function I8(t,e,r){let i={...t,geometry:{type:t.geometry.type}};return Object.defineProperty(i.geometry,"coordinates",{get:()=>S8(t.geometry,e,r).coordinates}),i}var O8="0123456789bcdefghjkmnpqrstuvwxyz",F8={};for(let t=0;t<O8.length;t++)F8[O8.charAt(t)]=t;var ete=-90,tte=90,rte=-180,ite=180;function nte(t){let e=!0,r=tte,i=ete,n=ite,s=rte,o,a=0;for(let A=0,h=t.length;A<h;A++){let g=t[A].toLowerCase();a=F8[g];for(let _=4;_>=0;_--){let b=a>>_&1;e?(o=(n+s)/2,b===1?s=o:n=o):(o=(r+i)/2,b===1?i=o:r=o),e=!e}}return[i,s,r,n]}function L8(t){let[e,r,i,n]=nte(t);return[n,i,n,e,r,e,r,i,n,i]}var ste={getGeohash:{type:"accessor",value:t=>t.geohash}},jf=class extends vn{indexToBounds(){let{data:e,getGeohash:r}=this.props;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(i,n)=>L8(r(i,n))}}};jf.layerName="GeohashLayer";jf.defaultProps=ste;var N8=jf;import Ug from"https://esm.sh/@mapbox/mapbox-gl-draw@1.4.3";Ug.constants.classes.CONTROL_BASE="maplibregl-ctrl";Ug.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-";Ug.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";var D8=Ug;var ote=Object.prototype.toString,il=Array.isArray||function(e){return ote.call(e)==="[object Array]"};function $x(t){return typeof t=="function"}function ate(t){return il(t)?"array":typeof t}function Zx(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function k8(t,e){return t!=null&&typeof t=="object"&&e in t}function cte(t,e){return t!=null&&typeof t!="object"&&t.hasOwnProperty&&t.hasOwnProperty(e)}var lte=RegExp.prototype.test;function Ate(t,e){return lte.call(t,e)}var ute=/\S/;function fte(t){return!Ate(ute,t)}var hte={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function dte(t){return String(t).replace(/[&<>"'`=\/]/g,function(r){return hte[r]})}var pte=/\s*/,gte=/\s+/,U8=/\s*=/,mte=/\s*\}/,_te=/#|\^|\/|>|\{|&|=|!/;function yte(t,e){if(!t)return[];var r=!1,i=[],n=[],s=[],o=!1,a=!1,A="",h=0;function g(){if(o&&!a)for(;s.length;)delete n[s.pop()];else s=[];o=!1,a=!1}var _,b,T;function v(Y){if(typeof Y=="string"&&(Y=Y.split(gte,2)),!il(Y)||Y.length!==2)throw new Error("Invalid tags: "+Y);_=new RegExp(Zx(Y[0])+"\\s*"),b=new RegExp("\\s*"+Zx(Y[1])),T=new RegExp("\\s*"+Zx("}"+Y[1]))}v(e||Pi.tags);for(var C=new Yf(t),S,P,F,I,k,W;!C.eos();){if(S=C.pos,F=C.scanUntil(_),F)for(var K=0,re=F.length;K<re;++K)I=F.charAt(K),fte(I)?(s.push(n.length),A+=I):(a=!0,r=!0,A+=" "),n.push(["text",I,S,S+1]),S+=1,I===`
`&&(g(),A="",h=0,r=!1);if(!C.scan(_))break;if(o=!0,P=C.scan(_te)||"name",C.scan(pte),P==="="?(F=C.scanUntil(U8),C.scan(U8),C.scanUntil(b)):P==="{"?(F=C.scanUntil(T),C.scan(mte),C.scanUntil(b),P="&"):F=C.scanUntil(b),!C.scan(b))throw new Error("Unclosed tag at "+C.pos);if(P==">"?k=[P,F,S,C.pos,A,h,r]:k=[P,F,S,C.pos],h++,n.push(k),P==="#"||P==="^")i.push(k);else if(P==="/"){if(W=i.pop(),!W)throw new Error('Unopened section "'+F+'" at '+S);if(W[1]!==F)throw new Error('Unclosed section "'+W[1]+'" at '+S)}else P==="name"||P==="{"||P==="&"?a=!0:P==="="&&v(F)}if(g(),W=i.pop(),W)throw new Error('Unclosed section "'+W[1]+'" at '+C.pos);return bte(xte(n))}function xte(t){for(var e=[],r,i,n=0,s=t.length;n<s;++n)r=t[n],r&&(r[0]==="text"&&i&&i[0]==="text"?(i[1]+=r[1],i[3]=r[3]):(e.push(r),i=r));return e}function bte(t){for(var e=[],r=e,i=[],n,s,o=0,a=t.length;o<a;++o)switch(n=t[o],n[0]){case"#":case"^":r.push(n),i.push(n),r=n[4]=[];break;case"/":s=i.pop(),s[5]=n[2],r=i.length>0?i[i.length-1][4]:e;break;default:r.push(n)}return e}function Yf(t){this.string=t,this.tail=t,this.pos=0}Yf.prototype.eos=function(){return this.tail===""};Yf.prototype.scan=function(e){var r=this.tail.match(e);if(!r||r.index!==0)return"";var i=r[0];return this.tail=this.tail.substring(i.length),this.pos+=i.length,i};Yf.prototype.scanUntil=function(e){var r=this.tail.search(e),i;switch(r){case-1:i=this.tail,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=i.length,i};function rl(t,e){this.view=t,this.cache={".":this.view},this.parent=e}rl.prototype.push=function(e){return new rl(e,this)};rl.prototype.lookup=function(e){var r=this.cache,i;if(r.hasOwnProperty(e))i=r[e];else{for(var n=this,s,o,a,A=!1;n;){if(e.indexOf(".")>0)for(s=n.view,o=e.split("."),a=0;s!=null&&a<o.length;)a===o.length-1&&(A=k8(s,o[a])||cte(s,o[a])),s=s[o[a++]];else s=n.view[e],A=k8(n.view,e);if(A){i=s;break}n=n.parent}r[e]=i}return $x(i)&&(i=i.call(this.view)),i};function Gr(){this.templateCache={_cache:{},set:function(e,r){this._cache[e]=r},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Gr.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Gr.prototype.parse=function(e,r){var i=this.templateCache,n=e+":"+(r||Pi.tags).join(":"),s=typeof i<"u",o=s?i.get(n):void 0;return o==null&&(o=yte(e,r),s&&i.set(n,o)),o};Gr.prototype.render=function(e,r,i,n){var s=this.getConfigTags(n),o=this.parse(e,s),a=r instanceof rl?r:new rl(r,void 0);return this.renderTokens(o,a,i,e,n)};Gr.prototype.renderTokens=function(e,r,i,n,s){for(var o="",a,A,h,g=0,_=e.length;g<_;++g)h=void 0,a=e[g],A=a[0],A==="#"?h=this.renderSection(a,r,i,n,s):A==="^"?h=this.renderInverted(a,r,i,n,s):A===">"?h=this.renderPartial(a,r,i,s):A==="&"?h=this.unescapedValue(a,r):A==="name"?h=this.escapedValue(a,r,s):A==="text"&&(h=this.rawValue(a)),h!==void 0&&(o+=h);return o};Gr.prototype.renderSection=function(e,r,i,n,s){var o=this,a="",A=r.lookup(e[1]);function h(b){return o.render(b,r,i,s)}if(A){if(il(A))for(var g=0,_=A.length;g<_;++g)a+=this.renderTokens(e[4],r.push(A[g]),i,n,s);else if(typeof A=="object"||typeof A=="string"||typeof A=="number")a+=this.renderTokens(e[4],r.push(A),i,n,s);else if($x(A)){if(typeof n!="string")throw new Error("Cannot use higher-order sections without the original template");A=A.call(r.view,n.slice(e[3],e[5]),h),A!=null&&(a+=A)}else a+=this.renderTokens(e[4],r,i,n,s);return a}};Gr.prototype.renderInverted=function(e,r,i,n,s){var o=r.lookup(e[1]);if(!o||il(o)&&o.length===0)return this.renderTokens(e[4],r,i,n,s)};Gr.prototype.indentPartial=function(e,r,i){for(var n=r.replace(/[^ \t]/g,""),s=e.split(`
`),o=0;o<s.length;o++)s[o].length&&(o>0||!i)&&(s[o]=n+s[o]);return s.join(`
`)};Gr.prototype.renderPartial=function(e,r,i,n){if(i){var s=this.getConfigTags(n),o=$x(i)?i(e[1]):i[e[1]];if(o!=null){var a=e[6],A=e[5],h=e[4],g=o;A==0&&h&&(g=this.indentPartial(o,h,a));var _=this.parse(g,s);return this.renderTokens(_,r,i,g,n)}}};Gr.prototype.unescapedValue=function(e,r){var i=r.lookup(e[1]);if(i!=null)return i};Gr.prototype.escapedValue=function(e,r,i){var n=this.getConfigEscape(i)||Pi.escape,s=r.lookup(e[1]);if(s!=null)return typeof s=="number"&&n===Pi.escape?String(s):n(s)};Gr.prototype.rawValue=function(e){return e[1]};Gr.prototype.getConfigTags=function(e){return il(e)?e:e&&typeof e=="object"?e.tags:void 0};Gr.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!il(e))return e.escape};var Pi={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(t){Xf.templateCache=t},get templateCache(){return Xf.templateCache}},Xf=new Gr;Pi.clearCache=function(){return Xf.clearCache()};Pi.parse=function(e,r){return Xf.parse(e,r)};Pi.render=function(e,r,i,n){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+ate(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Xf.render(e,r,i,n)};Pi.escape=dte;Pi.Scanner=Yf;Pi.Context=rl;Pi.Writer=Gr;var eb=Pi;function tb(t,e,r){return r!==null?eb.render(r,t.properties):e===null?Object.keys(t.properties).map(n=>`${n}: ${t.properties[n]}`).join("</br>"):t.properties[e]}function rb(t){let e={background:"white",color:"black","border-radius":"3px"};return({layer:r,object:i})=>{if(i){let n=typeof t=="object"?t[r.id]:t;return n&&{html:eb.render(n,i),style:e}}return null}}var Tte=new ac({configuration:new xn({layers:Jx})});function z8(t,e){let[r,i]=e;console.log(r,i),t[r](...i)}function V8(t){return t.map(e=>Tte.convert(Object.assign(e,{onHover:({object:r})=>console.log(r)})))}function H8(t,e){let r=null,i=null;return{addTooltip:function(n,s=null,o=null){let a={closeButton:!1,closeOnClick:!1},A=new t.Popup(a);e.on("mousemove",n,h=>{let g=h.features[0],_=tb(g,s,o);A.setLngLat(h.lngLat).setHTML(_).addTo(e)}),e.on("mouseleave",n,()=>{A.remove()})},addControl:function(n,s,o){e.addControl(new t[n](s),o)},addPopup:function(n,s=null,o=null){let a={closeButton:!1},A=new t.Popup(a);e.on("click",n,h=>{let g=h.features[0],_=tb(g,s,o);A.setLngLat(h.lngLat).setHTML(_).addTo(e)})},addMarker:function({lngLat:n,popup:s,options:o}){let a=new t.Marker(o).setLngLat(n);if(s){let A=new t.Popup(s.options).setHTML(s.text);a.setPopup(A)}a.addTo(e)},setSourceData:function(n,s){e.getSource(n).setData(s)},addDeckOverlay:function(n,s=null){let o=V8(n);r=new nc({interleaved:!0,layers:o,getTooltip:s?rb(s):null}),e.addControl(r)},setDeckLayers:function(n,s=null){console.log("Updating Deck.GL layers");let o=V8(n);r.setProps({layers:o,getTooltip:s?rb(s):null})},addMapboxDraw(n,s,o=null){i=new D8(n),e.addControl(i,s),o&&i.add(o)},getMapboxDraw:function(){return i}}}var vte=new Ete;nl.addProtocol("pmtiles",vte.tile);nl.LayerSwitcherControl=dl;nl.InfoBoxControl=hl;function wte(t){let e="pymaplibregl",r=document.createElement("div");return r.id=e,r.style.height=t.get("height"),r}function ib(t,e){let r={center:e.getCenter(),zoom:e.getZoom(),bounds:e.getBounds(),bearing:e.getBearing(),pitch:e.getPitch()};t.set("view_state",r),t.save_changes()}function Cte(t,e){let r=new nl.Map(t);return r.on("mouseover",()=>{r.getCanvas().style.cursor="pointer"}),r.on("mouseout",()=>{r.getCanvas().style.cursor=""}),r.on("click",i=>{e.set("clicked",i.lngLat),e.save_changes()}),r.on("zoomend",i=>{ib(e,r)}),r.on("moveend",i=>{ib(e,r)}),r.once("load",()=>{r.resize(),ib(e,r)}),r.on("draw.selectionchange",i=>{let n=i.features;console.log("selection changed",n),e.set("draw_features_selected",n),e.save_changes()}),r}function Ste({model:t,el:e}){console.log("maplibregl",nl.version);let r=wte(t),i=Object.assign({container:r},t.get("map_options"));console.log(i);let n=Cte(i,t),s=H8(nl,n),o=[{name:"draw.create",destVar:"draw_features_created"},{name:"draw.update",destVar:"draw_features_updated"},{name:"draw.delete",destVar:"draw_features_deleted"}];for(let h of o)n.on(h.name,g=>{let _=s.getMapboxDraw();console.log("all features",_.getAll()),t.set("draw_feature_collection_all",_.getAll()),console.log("event features",g.features),t.set(h.destVar,g.features),t.save_changes()});let a=h=>{h.forEach(g=>{if(Object.keys(s).includes(g[0])){console.log("internal call",g);let[_,b]=g;s[_](...b);return}z8(n,g)})},A=t.get("calls");n.on("load",()=>{console.log("init calls",A),a(A),t.set("_rendered",!0),t.save_changes()}),t.on("msg:custom",h=>{console.log("custom msg",h),a(h.calls)}),e.appendChild(r)}var lke={render:Ste};export{lke as default};
/*! Bundled license information:

long/dist/long.js:
  (**
   * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
   * Released under the Apache License, Version 2.0
   * see: https://github.com/dcodeIO/long.js for details
   *)

ieee754/index.js:
  (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)

long/index.js:
  (**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   *)

mustache/mustache.mjs:
  (*!
   * mustache.js - Logic-less {{mustache}} templates with JavaScript
   * http://github.com/janl/mustache.js
   *)
*/
